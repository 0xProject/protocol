{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/entities/RfqmV2JobEntity.ts","mappings":"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","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/entities/RfqmV2JobEntity.ts"],"sourcesContent":["import { Signature } from '@0x/protocol-utils';\r\nimport { BigNumber } from '@0x/utils';\r\nimport { Column, Entity, Index, PrimaryColumn, UpdateDateColumn } from 'typeorm';\r\n\r\nimport { Approval, StoredFee } from '../core/types';\r\n\r\nimport { BigNumberTransformer } from './transformers';\r\nimport { RfqmJobStatus, StoredOtcOrder } from './types';\r\n\r\nexport type RfqmV2JobApprovalOpts = Pick<RfqmV2JobEntity, 'approval' | 'approvalSignature'>;\r\n\r\nexport type RfqmV2JobConstructorOpts = Pick<\r\n    RfqmV2JobEntity,\r\n    'chainId' | 'expiry' | 'fee' | 'makerUri' | 'order' | 'orderHash'\r\n> &\r\n    Partial<RfqmV2JobEntity>;\r\n\r\n@Entity({ name: 'rfqm_v2_jobs' })\r\nexport class RfqmV2JobEntity {\r\n    // Differentiator for different flavors of RFQM jobs\r\n    public kind: 'rfqm_v2_job';\r\n\r\n    @PrimaryColumn({ name: 'order_hash', type: 'varchar' })\r\n    public orderHash: string;\r\n\r\n    @Index()\r\n    @Column({ name: 'created_at', type: 'timestamptz', default: () => 'now()' })\r\n    public createdAt!: Date;\r\n\r\n    @UpdateDateColumn({ name: 'updated_at', type: 'timestamptz', nullable: true })\r\n    public updatedAt: Date | null;\r\n\r\n    // The expiration time of the job, in unix seconds\r\n    @Column({ name: 'expiry', type: 'numeric', transformer: BigNumberTransformer })\r\n    public expiry: BigNumber;\r\n\r\n    @Column({ name: 'chain_id', type: 'integer' })\r\n    public chainId: number;\r\n\r\n    @Column({ name: 'integrator_id', type: 'varchar', nullable: true })\r\n    public integratorId: string | null;\r\n\r\n    @Column({ name: 'maker_uri', type: 'varchar' })\r\n    public makerUri: string;\r\n\r\n    @Index()\r\n    @Column({ name: 'status', type: 'varchar' })\r\n    public status: RfqmJobStatus;\r\n\r\n    @Column({ name: 'fee', type: 'jsonb' })\r\n    public fee: StoredFee;\r\n\r\n    @Column({ name: 'order', type: 'jsonb' })\r\n    public order: StoredOtcOrder;\r\n\r\n    @Column({ name: 'worker_address', type: 'varchar', nullable: true })\r\n    public workerAddress: string | null;\r\n\r\n    @Column({ name: 'last_look_result', type: 'boolean', nullable: true })\r\n    public lastLookResult: boolean | null;\r\n\r\n    @Column({ name: 'affiliate_address', type: 'varchar', nullable: true })\r\n    public affiliateAddress: string | null;\r\n\r\n    // The taker's signature of the order hash.\r\n    // Should be deleted upon job failure or last look rejection.\r\n    @Column({ name: 'taker_signature', type: 'jsonb', nullable: true })\r\n    public takerSignature: Signature | null;\r\n\r\n    // The maker's signature of the order hash.\r\n    // Should be deleted upon job failure.\r\n    @Column({ name: 'maker_signature', type: 'jsonb', nullable: true })\r\n    public makerSignature: Signature | null;\r\n\r\n    // Whether the maker wrapped native token will be unwrapped to the native token\r\n    // when passed to the taker\r\n    @Column({ name: 'is_unwrap', type: Boolean })\r\n    public isUnwrap: boolean;\r\n\r\n    // When a market maker rejects a last look, the server queries the market maker\r\n    // for a price for the same trade that was just rejected (same pair and size).\r\n    // The difference between the rejected price and the new price is stored here.\r\n    @Column({ name: 'll_reject_price_difference_bps', type: 'integer', nullable: true })\r\n    public llRejectPriceDifferenceBps: number | null;\r\n\r\n    // The optional approval object that contains the EIP-712 context (which includes\r\n    // the message that the taker will sign). This is stored to help us prepare the\r\n    // calldata for gasless approvals\r\n    @Column({ name: 'approval', type: 'jsonb', nullable: true })\r\n    public approval: Approval | null;\r\n\r\n    // The signature for the approval.\r\n    @Column({ name: 'approval_signature', type: 'jsonb', nullable: true })\r\n    public approvalSignature: Signature | null;\r\n\r\n    // When requesting a quote, taker specifies one amount (maker or taker amount)\r\n    // and the MM populates the other field.\r\n    // This field preserves that information.\r\n    // This field is accepted to be null, only for backward compatibility,\r\n    // in normal operation \"taker_specified_side\" is always known.\r\n    @Column({ name: 'taker_specified_side', type: 'varchar', nullable: true })\r\n    public takerSpecifiedSide: 'makerToken' | 'takerToken' | null;\r\n\r\n    /**\r\n     * Used to get the 'canonical' hash of the job. This is useful\r\n     * because it can also be called on a metatransaction job and\r\n     * that will return the metatransaction hash.\r\n     */\r\n    public getHash(): string {\r\n        return this.orderHash;\r\n    }\r\n\r\n    // TypeORM runs a validation check where it calls this initializer with no argument.\r\n    // With no default `opts`, `opts` will be undefined and the validation will throw,\r\n    // therefore, add this hacky default.\r\n    // tslint:disable-next-line no-object-literal-type-assertion\r\n    constructor(opts: RfqmV2JobConstructorOpts = {} as RfqmV2JobConstructorOpts) {\r\n        this.kind = 'rfqm_v2_job';\r\n\r\n        // allow createdAt overrides for testing\r\n        if (opts.createdAt) {\r\n            this.createdAt = opts.createdAt;\r\n        }\r\n\r\n        this.affiliateAddress = opts.affiliateAddress ?? null;\r\n        this.approval = opts.approval ?? null;\r\n        this.approvalSignature = opts.approvalSignature ?? null;\r\n        this.chainId = opts.chainId;\r\n        this.expiry = opts.expiry;\r\n        this.fee = opts.fee;\r\n        this.integratorId = opts.integratorId ?? null;\r\n        this.isUnwrap = opts.isUnwrap ?? false;\r\n        this.lastLookResult = opts.lastLookResult ?? null;\r\n        this.llRejectPriceDifferenceBps = opts.llRejectPriceDifferenceBps ?? null;\r\n        this.makerSignature = opts.makerSignature ?? null;\r\n        this.makerUri = opts.makerUri;\r\n        this.order = opts.order;\r\n        this.orderHash = opts.orderHash;\r\n        this.status = opts.status ?? RfqmJobStatus.PendingEnqueued;\r\n        this.takerSignature = opts.takerSignature ?? null;\r\n        this.updatedAt = opts.updatedAt ?? null;\r\n        this.workerAddress = opts.workerAddress ?? null;\r\n        this.takerSpecifiedSide = opts.takerSpecifiedSide ?? null;\r\n    }\r\n}\r\n"],"version":3}