124be772bcd73f3a7f75c8f037c066b3
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const contract_addresses_1 = require("@0x/contract-addresses");
const bullmq_1 = require("bullmq");
const chai_1 = require("chai");
const ioredis_1 = require("ioredis");
const ts_mockito_1 = require("ts-mockito");
const maker_balance_cache_evict_1 = require("../src/background-jobs/maker_balance_cache_evict");
const maker_balance_cache_update_1 = require("../src/background-jobs/maker_balance_cache_update");
const config_1 = require("../src/config");
const rfq_maker_balance_cache_service_1 = require("../src/services/rfq_maker_balance_cache_service");
const serviceBuilder = require("../src/utils/rfqm_service_builder");
describe('Background Jobs Unit Tests', () => {
    describe('maker-balance-cache-evict', () => {
        it('should fail to create background job when bad chain id is passed', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn(undefined);
            const { createAsync, processAsync } = maker_balance_cache_evict_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_evict_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const badChainId = 11111111;
            const timestamp = Date.now();
            try {
                const job = await createAsync(queue, {
                    chainId: badChainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_evict_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                (0, chai_1.expect)(processAsync(job)).to.be.rejectedWith('chain configuration');
            }
            catch (error) {
                chai_1.expect.fail('should create background job without error');
            }
        });
        it('processes maker balance cache eviction without error', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn((0, ts_mockito_1.anything)());
            const rfqMakerBalanceCacheServiceMock = (0, ts_mockito_1.mock)(rfq_maker_balance_cache_service_1.RfqMakerBalanceCacheService);
            (0, ts_mockito_1.when)(rfqMakerBalanceCacheServiceMock.evictZeroBalancesAsync((0, ts_mockito_1.anything)())).thenResolve(1);
            const spiedServiceBuilderAsync = (0, ts_mockito_1.spy)(serviceBuilder);
            (0, ts_mockito_1.when)(spiedServiceBuilderAsync.buildRfqMakerBalanceCacheServiceAsync((0, ts_mockito_1.anything)())).thenResolve((0, ts_mockito_1.instance)(rfqMakerBalanceCacheServiceMock));
            const { createAsync, processAsync } = maker_balance_cache_evict_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_evict_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const chainId = contract_addresses_1.ChainId.Ganache;
            const timestamp = Date.now();
            try {
                const job = await createAsync(queue, {
                    chainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_evict_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                const result = await processAsync(job);
                (0, chai_1.expect)(result.chainId).to.eq(chainId);
                (0, chai_1.expect)(result.numEvicted).to.eq(1);
            }
            catch (error) {
                chai_1.expect.fail('should create and update background job without error');
            }
        });
        it('should fail to process job when malformed cache service is passed', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn((0, ts_mockito_1.anything)());
            const spiedServiceBuilderAsync = (0, ts_mockito_1.spy)(serviceBuilder);
            (0, ts_mockito_1.when)(spiedServiceBuilderAsync.buildRfqMakerBalanceCacheServiceAsync((0, ts_mockito_1.anything)())).thenResolve();
            const { createAsync, processAsync } = maker_balance_cache_evict_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_evict_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const chainId = contract_addresses_1.ChainId.Ganache;
            const timestamp = Date.now();
            try {
                const job = await createAsync(queue, {
                    chainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_evict_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                (0, chai_1.expect)(processAsync(job)).to.be.rejectedWith('initialize dependencies');
            }
            catch (error) {
                chai_1.expect.fail('should create background job without error');
            }
        });
        it('should fail to process job when the cache service fails to evict entries', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn((0, ts_mockito_1.anything)());
            const rfqMakerBalanceCacheServiceMock = (0, ts_mockito_1.mock)(rfq_maker_balance_cache_service_1.RfqMakerBalanceCacheService);
            (0, ts_mockito_1.when)(rfqMakerBalanceCacheServiceMock.evictZeroBalancesAsync((0, ts_mockito_1.anything)())).thenReject(new Error('cache failed'));
            const spiedServiceBuilderAsync = (0, ts_mockito_1.spy)(serviceBuilder);
            (0, ts_mockito_1.when)(spiedServiceBuilderAsync.buildRfqMakerBalanceCacheServiceAsync((0, ts_mockito_1.anything)())).thenResolve((0, ts_mockito_1.instance)(rfqMakerBalanceCacheServiceMock));
            const { createAsync, processAsync } = maker_balance_cache_evict_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_evict_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const chainId = contract_addresses_1.ChainId.Ganache;
            const timestamp = Date.now();
            try {
                const job = await createAsync(queue, {
                    chainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_evict_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                (0, chai_1.expect)(processAsync(job)).to.be.rejectedWith('evict maker balance cache');
            }
            catch (error) {
                chai_1.expect.fail('should create background job without error');
            }
        });
    });
    describe('maker-balance-cache-update', () => {
        it('should fail to create background job when bad chain id is passed', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn(undefined);
            const { createAsync, processAsync } = maker_balance_cache_update_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_update_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const badChainId = 11111111;
            const timestamp = Date.now();
            try {
                const job = await createAsync(queue, {
                    chainId: badChainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_update_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                (0, chai_1.expect)(processAsync(job)).to.be.rejectedWith('chain configuration');
            }
            catch (error) {
                chai_1.expect.fail('should create background job without error');
            }
        });
        it('processes maker balance cache update without error', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn((0, ts_mockito_1.anything)());
            const rfqMakerBalanceCacheServiceMock = (0, ts_mockito_1.mock)(rfq_maker_balance_cache_service_1.RfqMakerBalanceCacheService);
            (0, ts_mockito_1.when)(rfqMakerBalanceCacheServiceMock.updateERC20OwnerBalancesAsync((0, ts_mockito_1.anything)())).thenResolve();
            const spiedServiceBuilderAsync = (0, ts_mockito_1.spy)(serviceBuilder);
            (0, ts_mockito_1.when)(spiedServiceBuilderAsync.buildRfqMakerBalanceCacheServiceAsync((0, ts_mockito_1.anything)())).thenResolve((0, ts_mockito_1.instance)(rfqMakerBalanceCacheServiceMock));
            const { createAsync, processAsync } = maker_balance_cache_update_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_update_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const chainId = contract_addresses_1.ChainId.Ganache;
            const timestamp = Date.now();
            let job;
            try {
                job = await createAsync(queue, {
                    chainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_update_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                const result = await processAsync(job);
                (0, chai_1.expect)(result.chainId).to.eq(chainId);
            }
            catch (error) {
                chai_1.expect.fail('should create and update background job without error');
            }
        });
        it('should fail to process job when the cache service fails to update entries', async () => {
            const spiedChainConfigurations = (0, ts_mockito_1.spy)(config_1.CHAIN_CONFIGURATIONS);
            (0, ts_mockito_1.when)(spiedChainConfigurations.find((0, ts_mockito_1.anything)())).thenReturn((0, ts_mockito_1.anything)());
            const rfqMakerBalanceCacheServiceMock = (0, ts_mockito_1.mock)(rfq_maker_balance_cache_service_1.RfqMakerBalanceCacheService);
            (0, ts_mockito_1.when)(rfqMakerBalanceCacheServiceMock.updateERC20OwnerBalancesAsync((0, ts_mockito_1.anything)())).thenReject(new Error('cache failed'));
            const spiedServiceBuilderAsync = (0, ts_mockito_1.spy)(serviceBuilder);
            (0, ts_mockito_1.when)(spiedServiceBuilderAsync.buildRfqMakerBalanceCacheServiceAsync((0, ts_mockito_1.anything)())).thenResolve((0, ts_mockito_1.instance)(rfqMakerBalanceCacheServiceMock));
            const { createAsync, processAsync } = maker_balance_cache_update_1.default;
            const connectionMock = (0, ts_mockito_1.mock)(ioredis_1.default);
            const queue = new bullmq_1.Queue(maker_balance_cache_update_1.default.queueName, { connection: (0, ts_mockito_1.instance)(connectionMock) });
            const spiedQueue = (0, ts_mockito_1.spy)(queue);
            (0, ts_mockito_1.when)(spiedQueue.emit((0, ts_mockito_1.anything)())).thenReturn(true);
            const spiedJob = (0, ts_mockito_1.spy)(bullmq_1.Job);
            (0, ts_mockito_1.when)(spiedJob.create((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall(
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            (q, name, data) => new bullmq_1.Job(q, name, data));
            const chainId = contract_addresses_1.ChainId.Ganache;
            const timestamp = Date.now();
            let job;
            try {
                job = await createAsync(queue, {
                    chainId,
                    timestamp,
                });
                (0, chai_1.expect)(job.queueName).to.eq(maker_balance_cache_update_1.default.queueName);
                const spiedJobInstance = (0, ts_mockito_1.spy)(job);
                (0, ts_mockito_1.when)(spiedJobInstance.updateProgress((0, ts_mockito_1.anything)())).thenResolve();
                (0, chai_1.expect)(processAsync(job)).to.be.rejectedWith('update maker balance cache');
            }
            catch (error) {
                chai_1.expect.fail('should create background job without error');
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvYmFja2dyb3VuZF9qb2JfdGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLCtEQUFpRDtBQUNqRCxtQ0FBb0M7QUFDcEMsK0JBQThCO0FBQzlCLHFDQUE0QjtBQUM1QiwyQ0FBaUU7QUFFakUsZ0dBQXFGO0FBQ3JGLGtHQUcyRDtBQUMzRCwwQ0FBcUQ7QUFDckQscUdBQThGO0FBQzlGLG9FQUFvRTtBQUVwRSxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO0lBQ3hDLFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDdkMsRUFBRSxDQUFDLGtFQUFrRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlFLE1BQU0sd0JBQXdCLEdBQUcsSUFBQSxnQkFBRyxFQUFDLDZCQUFvQixDQUFDLENBQUM7WUFDM0QsSUFBQSxpQkFBSSxFQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxJQUFBLHFCQUFRLEdBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRXRFLE1BQU0sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLEdBQUcsbUNBQXFCLENBQUM7WUFFNUQsTUFBTSxjQUFjLEdBQUcsSUFBQSxpQkFBSSxFQUFDLGlCQUFLLENBQUMsQ0FBQztZQUVuQyxNQUFNLEtBQUssR0FBRyxJQUFJLGNBQUssQ0FBQyxtQ0FBcUIsQ0FBQyxTQUFTLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBQSxxQkFBUSxFQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNuRyxNQUFNLFVBQVUsR0FBRyxJQUFBLGdCQUFHLEVBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUIsSUFBQSxpQkFBSSxFQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBQSxxQkFBUSxHQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVuRCxNQUFNLFFBQVEsR0FBRyxJQUFBLGdCQUFHLEVB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QzthQUM5RTtZQUFDLE9BQU8sS0FBSyxFQUFFO2dCQUNaLGFBQU0sQ0FBQyxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQzthQUM3RDtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZGF2aWR3YWxzaC9jb2RlLWxvY2FsLzB4LXJmcS1hcGkvdGVzdC9iYWNrZ3JvdW5kX2pvYl90ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYWluSWQgfSBmcm9tICdAMHgvY29udHJhY3QtYWRkcmVzc2VzJztcbmltcG9ydCB7IEpvYiwgUXVldWUgfSBmcm9tICdidWxsbXEnO1xuaW1wb3J0IHsgZXhwZWN0IH0gZnJvbSAnY2hhaSc7XG5pbXBvcnQgUmVkaXMgZnJvbSAnaW9yZWRpcyc7XG5pbXBvcnQgeyBhbnl0aGluZywgaW5zdGFuY2UsIG1vY2ssIHNweSwgd2hlbiB9IGZyb20gJ3RzLW1vY2tpdG8nO1xuXG5pbXBvcnQgYmFja2dyb3VuZEpvYk1CQ0V2aWN0IGZyb20gJy4uL3NyYy9iYWNrZ3JvdW5kLWpvYnMvbWFrZXJfYmFsYW5jZV9jYWNoZV9ldmljdCc7XG5pbXBvcnQgYmFja2dyb3VuZEpvYk1CQ1VwZGF0ZSwge1xuICAgIEJhY2tncm91bmRKb2JNQkNVcGRhdGVEYXRhLFxuICAgIEJhY2tncm91bmRKb2JNQkNVcGRhdGVSZXN1bHQsXG59IGZyb20gJy4uL3NyYy9iYWNrZ3JvdW5kLWpvYnMvbWFrZXJfYmFsYW5jZV9jYWNoZV91cGRhdGUnO1xuaW1wb3J0IHsgQ0hBSU5fQ09ORklHVVJBVElPTlMgfSBmcm9tICcuLi9zcmMvY29uZmlnJztcbmltcG9ydCB7IFJmcU1ha2VyQmFsYW5jZUNhY2hlU2VydmljZSB9IGZyb20gJy4uL3NyYy9zZXJ2aWNlcy9yZnFfbWFrZXJfYmFsYW5jZV9jYWNoZV9zZXJ2aWNlJztcbmltcG9ydCAqIGFzIHNlcnZpY2VCdWlsZGVyIGZyb20gJy4uL3NyYy91dGlscy9yZnFtX3NlcnZpY2VfYnVpbGRlcic7XG5cbmRlc2NyaWJlKCdCYWNrZ3JvdW5kIEpvYnMgVW5pdCBUZXN0cycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnbWFrZXItYmFsYW5jZS1jYWNoZS1ldmljdCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBmYWlsIHRvIGNyZWF0ZSBiYWNrZ3JvdW5kIGpvYiB3aGVuIGJhZCBjaGFpbiBpZCBpcyBwYXNzZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzcGllZENoYWluQ29uZmlndXJhdGlvbnMgPSBzcHkoQ0hBSU5fQ09ORklHVVJBVElPTlMpO1xuICAgICAgICAgICAgd2hlbihzcGllZENoYWluQ29uZmlndXJhdGlvbnMuZmluZChhbnl0aGluZygpKSkudGhlblJldHVybih1bmRlZmluZWQpO1xuXG4gICAgICAgICAgICBjb25zdCB7IGNyZWF0ZUFzeW5jLCBwcm9jZXNzQXN5bmMgfSA9IGJhY2tncm91bmRKb2JNQkNFdmljdDtcblxuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbk1vY2sgPSBtb2NrKFJlZGlzKTtcblxuICAgICAgICAgICAgY29uc3QgcXVldWUgPSBuZXcgUXVldWUoYmFja2dyb3VuZEpvYk1CQ0V2aWN0LnF1ZXVlTmFtZSwgeyBjb25uZWN0aW9uOiBpbnN0YW5jZShjb25uZWN0aW9uTW9jaykgfSk7XG4gICAgICAgICAgICBjb25zdCBzcGllZFF1ZXVlID0gc3B5KHF1ZXVlKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRRdWV1ZS5lbWl0KGFueXRoaW5nKCkpKS50aGVuUmV0dXJuKHRydWUpO1xuXG4gICAgICAgICAgICBjb25zdCBzcGllZEpvYiA9IHNweShKb2IpO1xuICAgICAgICAgICAgd2hlbihzcGllZEpvYi5jcmVhdGUoYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLnRoZW5DYWxsKFxuICAgICAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIChxOiBRdWV1ZSwgbmFtZTogYW55LCBkYXRhOiBhbnkpID0+IG5ldyBKb2IocSwgbmFtZSwgZGF0YSksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCBiYWRDaGFpbklkID0gMTExMTExMTE7XG4gICAgICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGpvYiA9IGF3YWl0IGNyZWF0ZUFzeW5jKHF1ZXVlLCB7XG4gICAgICAgICAgICAgICAgICAgIGNoYWluSWQ6IGJhZENoYWluSWQsXG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBleHBlY3Qoam9iLnF1ZXVlTmFtZSkudG8uZXEoYmFja2dyb3VuZEpvYk1CQ0V2aWN0LnF1ZXVlTmFtZSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzcGllZEpvYkluc3RhbmNlID0gc3B5KGpvYik7XG4gICAgICAgICAgICAgICAgd2hlbihzcGllZEpvYkluc3RhbmNlLnVwZGF0ZVByb2dyZXNzKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZSgpO1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KHByb2Nlc3NBc3luYyhqb2IpKS50by5iZS5yZWplY3RlZFdpdGgoJ2NoYWluIGNvbmZpZ3VyYXRpb24nKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0LmZhaWwoJ3Nob3VsZCBjcmVhdGUgYmFja2dyb3VuZCBqb2Igd2l0aG91dCBlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgncHJvY2Vzc2VzIG1ha2VyIGJhbGFuY2UgY2FjaGUgZXZpY3Rpb24gd2l0aG91dCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNwaWVkQ2hhaW5Db25maWd1cmF0aW9ucyA9IHNweShDSEFJTl9DT05GSUdVUkFUSU9OUyk7XG4gICAgICAgICAgICB3aGVuKHNwaWVkQ2hhaW5Db25maWd1cmF0aW9ucy5maW5kKGFueXRoaW5nKCkpKS50aGVuUmV0dXJuKGFueXRoaW5nKCkpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VNb2NrID0gbW9jayhSZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2UpO1xuICAgICAgICAgICAgd2hlbihyZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VNb2NrLmV2aWN0WmVyb0JhbGFuY2VzQXN5bmMoYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKDEpO1xuXG4gICAgICAgICAgICBjb25zdCBzcGllZFNlcnZpY2VCdWlsZGVyQXN5bmMgPSBzcHkoc2VydmljZUJ1aWxkZXIpO1xuICAgICAgICAgICAgd2hlbihzcGllZFNlcnZpY2VCdWlsZGVyQXN5bmMuYnVpbGRSZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VBc3luYyhhbnl0aGluZygpKSkudGhlblJlc29sdmUoXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UocmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlTW9jayksXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgeyBjcmVhdGVBc3luYywgcHJvY2Vzc0FzeW5jIH0gPSBiYWNrZ3JvdW5kSm9iTUJDRXZpY3Q7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25Nb2NrID0gbW9jayhSZWRpcyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHF1ZXVlID0gbmV3IFF1ZXVlKGJhY2tncm91bmRKb2JNQkNFdmljdC5xdWV1ZU5hbWUsIHsgY29ubmVjdGlvbjogaW5zdGFuY2UoY29ubmVjdGlvbk1vY2spIH0pO1xuICAgICAgICAgICAgY29uc3Qgc3BpZWRRdWV1ZSA9IHNweShxdWV1ZSk7XG4gICAgICAgICAgICB3aGVuKHNwaWVkUXVldWUuZW1pdChhbnl0aGluZygpKSkudGhlblJldHVybih0cnVlKTtcblxuICAgICAgICAgICAgY29uc3Qgc3BpZWRKb2IgPSBzcHkoSm9iKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRKb2IuY3JlYXRlKGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS50aGVuQ2FsbChcbiAgICAgICAgICAgICAgICAvLyAkZXNsaW50LWZpeC1tZSBodHRwczovL2dpdGh1Yi5jb20vcmhpbm9kYXZpZC9lc2xpbnQtZml4LW1lXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgICAgICAocTogUXVldWUsIG5hbWU6IGFueSwgZGF0YTogYW55KSA9PiBuZXcgSm9iKHEsIG5hbWUsIGRhdGEpLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgY29uc3QgY2hhaW5JZCA9IENoYWluSWQuR2FuYWNoZTtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgam9iID0gYXdhaXQgY3JlYXRlQXN5bmMocXVldWUsIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGV4cGVjdChqb2IucXVldWVOYW1lKS50by5lcShiYWNrZ3JvdW5kSm9iTUJDRXZpY3QucXVldWVOYW1lKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHNwaWVkSm9iSW5zdGFuY2UgPSBzcHkoam9iKTtcbiAgICAgICAgICAgICAgICB3aGVuKHNwaWVkSm9iSW5zdGFuY2UudXBkYXRlUHJvZ3Jlc3MoYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm9jZXNzQXN5bmMoam9iKTtcbiAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoYWluSWQpLnRvLmVxKGNoYWluSWQpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQubnVtRXZpY3RlZCkudG8uZXEoMSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGV4cGVjdC5mYWlsKCdzaG91bGQgY3JlYXRlIGFuZCB1cGRhdGUgYmFja2dyb3VuZCBqb2Igd2l0aG91dCBlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGZhaWwgdG8gcHJvY2VzcyBqb2Igd2hlbiBtYWxmb3JtZWQgY2FjaGUgc2VydmljZSBpcyBwYXNzZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzcGllZENoYWluQ29uZmlndXJhdGlvbnMgPSBzcHkoQ0hBSU5fQ09ORklHVVJBVElPTlMpO1xuICAgICAgICAgICAgd2hlbihzcGllZENoYWluQ29uZmlndXJhdGlvbnMuZmluZChhbnl0aGluZygpKSkudGhlblJldHVybihhbnl0aGluZygpKTtcblxuICAgICAgICAgICAgY29uc3Qgc3BpZWRTZXJ2aWNlQnVpbGRlckFzeW5jID0gc3B5KHNlcnZpY2VCdWlsZGVyKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRTZXJ2aWNlQnVpbGRlckFzeW5jLmJ1aWxkUmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlQXN5bmMoYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKCk7XG4gICAgICAgICAgICBjb25zdCB7IGNyZWF0ZUFzeW5jLCBwcm9jZXNzQXN5bmMgfSA9IGJhY2tncm91bmRKb2JNQkNFdmljdDtcblxuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbk1vY2sgPSBtb2NrKFJlZGlzKTtcblxuICAgICAgICAgICAgY29uc3QgcXVldWUgPSBuZXcgUXVldWUoYmFja2dyb3VuZEpvYk1CQ0V2aWN0LnF1ZXVlTmFtZSwgeyBjb25uZWN0aW9uOiBpbnN0YW5jZShjb25uZWN0aW9uTW9jaykgfSk7XG4gICAgICAgICAgICBjb25zdCBzcGllZFF1ZXVlID0gc3B5KHF1ZXVlKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRRdWV1ZS5lbWl0KGFueXRoaW5nKCkpKS50aGVuUmV0dXJuKHRydWUpO1xuXG4gICAgICAgICAgICBjb25zdCBzcGllZEpvYiA9IHNweShKb2IpO1xuICAgICAgICAgICAgd2hlbihzcGllZEpvYi5jcmVhdGUoYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLnRoZW5DYWxsKFxuICAgICAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIChxOiBRdWV1ZSwgbmFtZTogYW55LCBkYXRhOiBhbnkpID0+IG5ldyBKb2IocSwgbmFtZSwgZGF0YSksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCBjaGFpbklkID0gQ2hhaW5JZC5HYW5hY2hlO1xuICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBqb2IgPSBhd2FpdCBjcmVhdGVBc3luYyhxdWV1ZSwge1xuICAgICAgICAgICAgICAgICAgICBjaGFpbklkLFxuICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGpvYi5xdWV1ZU5hbWUpLnRvLmVxKGJhY2tncm91bmRKb2JNQkNFdmljdC5xdWV1ZU5hbWUpO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgc3BpZWRKb2JJbnN0YW5jZSA9IHNweShqb2IpO1xuICAgICAgICAgICAgICAgIHdoZW4oc3BpZWRKb2JJbnN0YW5jZS51cGRhdGVQcm9ncmVzcyhhbnl0aGluZygpKSkudGhlblJlc29sdmUoKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChwcm9jZXNzQXN5bmMoam9iKSkudG8uYmUucmVqZWN0ZWRXaXRoKCdpbml0aWFsaXplIGRlcGVuZGVuY2llcycpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QuZmFpbCgnc2hvdWxkIGNyZWF0ZSBiYWNrZ3JvdW5kIGpvYiB3aXRob3V0IGVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZmFpbCB0byBwcm9jZXNzIGpvYiB3aGVuIHRoZSBjYWNoZSBzZXJ2aWNlIGZhaWxzIHRvIGV2aWN0IGVudHJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzcGllZENoYWluQ29uZmlndXJhdGlvbnMgPSBzcHkoQ0hBSU5fQ09ORklHVVJBVElPTlMpO1xuICAgICAgICAgICAgd2hlbihzcGllZENoYWluQ29uZmlndXJhdGlvbnMuZmluZChhbnl0aGluZygpKSkudGhlblJldHVybihhbnl0aGluZygpKTtcblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlTW9jayA9IG1vY2soUmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlKTtcbiAgICAgICAgICAgIHdoZW4ocmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlTW9jay5ldmljdFplcm9CYWxhbmNlc0FzeW5jKGFueXRoaW5nKCkpKS50aGVuUmVqZWN0KFxuICAgICAgICAgICAgICAgIG5ldyBFcnJvcignY2FjaGUgZmFpbGVkJyksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCBzcGllZFNlcnZpY2VCdWlsZGVyQXN5bmMgPSBzcHkoc2VydmljZUJ1aWxkZXIpO1xuICAgICAgICAgICAgd2hlbihzcGllZFNlcnZpY2VCdWlsZGVyQXN5bmMuYnVpbGRSZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VBc3luYyhhbnl0aGluZygpKSkudGhlblJlc29sdmUoXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UocmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlTW9jayksXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgeyBjcmVhdGVBc3luYywgcHJvY2Vzc0FzeW5jIH0gPSBiYWNrZ3JvdW5kSm9iTUJDRXZpY3Q7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25Nb2NrID0gbW9jayhSZWRpcyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHF1ZXVlID0gbmV3IFF1ZXVlKGJhY2tncm91bmRKb2JNQkNFdmljdC5xdWV1ZU5hbWUsIHsgY29ubmVjdGlvbjogaW5zdGFuY2UoY29ubmVjdGlvbk1vY2spIH0pO1xuICAgICAgICAgICAgY29uc3Qgc3BpZWRRdWV1ZSA9IHNweShxdWV1ZSk7XG4gICAgICAgICAgICB3aGVuKHNwaWVkUXVldWUuZW1pdChhbnl0aGluZygpKSkudGhlblJldHVybih0cnVlKTtcblxuICAgICAgICAgICAgY29uc3Qgc3BpZWRKb2IgPSBzcHkoSm9iKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRKb2IuY3JlYXRlKGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS50aGVuQ2FsbChcbiAgICAgICAgICAgICAgICAvLyAkZXNsaW50LWZpeC1tZSBodHRwczovL2dpdGh1Yi5jb20vcmhpbm9kYXZpZC9lc2xpbnQtZml4LW1lXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgICAgICAocTogUXVldWUsIG5hbWU6IGFueSwgZGF0YTogYW55KSA9PiBuZXcgSm9iKHEsIG5hbWUsIGRhdGEpLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgY29uc3QgY2hhaW5JZCA9IENoYWluSWQuR2FuYWNoZTtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgam9iID0gYXdhaXQgY3JlYXRlQXN5bmMocXVldWUsIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGV4cGVjdChqb2IucXVldWVOYW1lKS50by5lcShiYWNrZ3JvdW5kSm9iTUJDRXZpY3QucXVldWVOYW1lKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHNwaWVkSm9iSW5zdGFuY2UgPSBzcHkoam9iKTtcbiAgICAgICAgICAgICAgICB3aGVuKHNwaWVkSm9iSW5zdGFuY2UudXBkYXRlUHJvZ3Jlc3MoYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKCk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QocHJvY2Vzc0FzeW5jKGpvYikpLnRvLmJlLnJlamVjdGVkV2l0aCgnZXZpY3QgbWFrZXIgYmFsYW5jZSBjYWNoZScpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QuZmFpbCgnc2hvdWxkIGNyZWF0ZSBiYWNrZ3JvdW5kIGpvYiB3aXRob3V0IGVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ21ha2VyLWJhbGFuY2UtY2FjaGUtdXBkYXRlJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGZhaWwgdG8gY3JlYXRlIGJhY2tncm91bmQgam9iIHdoZW4gYmFkIGNoYWluIGlkIGlzIHBhc3NlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNwaWVkQ2hhaW5Db25maWd1cmF0aW9ucyA9IHNweShDSEFJTl9DT05GSUdVUkFUSU9OUyk7XG4gICAgICAgICAgICB3aGVuKHNwaWVkQ2hhaW5Db25maWd1cmF0aW9ucy5maW5kKGFueXRoaW5nKCkpKS50aGVuUmV0dXJuKHVuZGVmaW5lZCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHsgY3JlYXRlQXN5bmMsIHByb2Nlc3NBc3luYyB9ID0gYmFja2dyb3VuZEpvYk1CQ1VwZGF0ZTtcblxuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbk1vY2sgPSBtb2NrKFJlZGlzKTtcblxuICAgICAgICAgICAgY29uc3QgcXVldWUgPSBuZXcgUXVldWUoYmFja2dyb3VuZEpvYk1CQ1VwZGF0ZS5xdWV1ZU5hbWUsIHsgY29ubmVjdGlvbjogaW5zdGFuY2UoY29ubmVjdGlvbk1vY2spIH0pO1xuICAgICAgICAgICAgY29uc3Qgc3BpZWRRdWV1ZSA9IHNweShxdWV1ZSk7XG4gICAgICAgICAgICB3aGVuKHNwaWVkUXVldWUuZW1pdChhbnl0aGluZygpKSkudGhlblJldHVybih0cnVlKTtcblxuICAgICAgICAgICAgY29uc3Qgc3BpZWRKb2IgPSBzcHkoSm9iKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRKb2IuY3JlYXRlKGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS50aGVuQ2FsbChcbiAgICAgICAgICAgICAgICAvLyAkZXNsaW50LWZpeC1tZSBodHRwczovL2dpdGh1Yi5jb20vcmhpbm9kYXZpZC9lc2xpbnQtZml4LW1lXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgICAgICAocTogUXVldWUsIG5hbWU6IGFueSwgZGF0YTogYW55KSA9PiBuZXcgSm9iKHEsIG5hbWUsIGRhdGEpLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgY29uc3QgYmFkQ2hhaW5JZCA9IDExMTExMTExO1xuICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBqb2IgPSBhd2FpdCBjcmVhdGVBc3luYyhxdWV1ZSwge1xuICAgICAgICAgICAgICAgICAgICBjaGFpbklkOiBiYWRDaGFpbklkLFxuICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGpvYi5xdWV1ZU5hbWUpLnRvLmVxKGJhY2tncm91bmRKb2JNQkNVcGRhdGUucXVldWVOYW1lKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHNwaWVkSm9iSW5zdGFuY2UgPSBzcHkoam9iKTtcbiAgICAgICAgICAgICAgICB3aGVuKHNwaWVkSm9iSW5zdGFuY2UudXBkYXRlUHJvZ3Jlc3MoYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKCk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QocHJvY2Vzc0FzeW5jKGpvYikpLnRvLmJlLnJlamVjdGVkV2l0aCgnY2hhaW4gY29uZmlndXJhdGlvbicpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QuZmFpbCgnc2hvdWxkIGNyZWF0ZSBiYWNrZ3JvdW5kIGpvYiB3aXRob3V0IGVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdwcm9jZXNzZXMgbWFrZXIgYmFsYW5jZSBjYWNoZSB1cGRhdGUgd2l0aG91dCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNwaWVkQ2hhaW5Db25maWd1cmF0aW9ucyA9IHNweShDSEFJTl9DT05GSUdVUkFUSU9OUyk7XG4gICAgICAgICAgICB3aGVuKHNwaWVkQ2hhaW5Db25maWd1cmF0aW9ucy5maW5kKGFueXRoaW5nKCkpKS50aGVuUmV0dXJuKGFueXRoaW5nKCkpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VNb2NrID0gbW9jayhSZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2UpO1xuICAgICAgICAgICAgd2hlbihyZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VNb2NrLnVwZGF0ZUVSQzIwT3duZXJCYWxhbmNlc0FzeW5jKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZSgpO1xuXG4gICAgICAgICAgICBjb25zdCBzcGllZFNlcnZpY2VCdWlsZGVyQXN5bmMgPSBzcHkoc2VydmljZUJ1aWxkZXIpO1xuICAgICAgICAgICAgd2hlbihzcGllZFNlcnZpY2VCdWlsZGVyQXN5bmMuYnVpbGRSZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VBc3luYyhhbnl0aGluZygpKSkudGhlblJlc29sdmUoXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UocmZxTWFrZXJCYWxhbmNlQ2FjaGVTZXJ2aWNlTW9jayksXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgeyBjcmVhdGVBc3luYywgcHJvY2Vzc0FzeW5jIH0gPSBiYWNrZ3JvdW5kSm9iTUJDVXBkYXRlO1xuXG4gICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uTW9jayA9IG1vY2soUmVkaXMpO1xuXG4gICAgICAgICAgICBjb25zdCBxdWV1ZSA9IG5ldyBRdWV1ZShiYWNrZ3JvdW5kSm9iTUJDVXBkYXRlLnF1ZXVlTmFtZSwgeyBjb25uZWN0aW9uOiBpbnN0YW5jZShjb25uZWN0aW9uTW9jaykgfSk7XG4gICAgICAgICAgICBjb25zdCBzcGllZFF1ZXVlID0gc3B5KHF1ZXVlKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRRdWV1ZS5lbWl0KGFueXRoaW5nKCkpKS50aGVuUmV0dXJuKHRydWUpO1xuXG4gICAgICAgICAgICBjb25zdCBzcGllZEpvYiA9IHNweShKb2IpO1xuICAgICAgICAgICAgd2hlbihzcGllZEpvYi5jcmVhdGUoYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLnRoZW5DYWxsKFxuICAgICAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIChxOiBRdWV1ZSwgbmFtZTogYW55LCBkYXRhOiBhbnkpID0+IG5ldyBKb2IocSwgbmFtZSwgZGF0YSksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCBjaGFpbklkID0gQ2hhaW5JZC5HYW5hY2hlO1xuICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgbGV0IGpvYjogSm9iPEJhY2tncm91bmRKb2JNQkNVcGRhdGVEYXRhLCBCYWNrZ3JvdW5kSm9iTUJDVXBkYXRlUmVzdWx0PjtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgam9iID0gYXdhaXQgY3JlYXRlQXN5bmMocXVldWUsIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGV4cGVjdChqb2IucXVldWVOYW1lKS50by5lcShiYWNrZ3JvdW5kSm9iTUJDVXBkYXRlLnF1ZXVlTmFtZSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzcGllZEpvYkluc3RhbmNlID0gc3B5KGpvYik7XG4gICAgICAgICAgICAgICAgd2hlbihzcGllZEpvYkluc3RhbmNlLnVwZGF0ZVByb2dyZXNzKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZSgpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJvY2Vzc0FzeW5jKGpvYik7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGFpbklkKS50by5lcShjaGFpbklkKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0LmZhaWwoJ3Nob3VsZCBjcmVhdGUgYW5kIHVwZGF0ZSBiYWNrZ3JvdW5kIGpvYiB3aXRob3V0IGVycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZmFpbCB0byBwcm9jZXNzIGpvYiB3aGVuIHRoZSBjYWNoZSBzZXJ2aWNlIGZhaWxzIHRvIHVwZGF0ZSBlbnRyaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3BpZWRDaGFpbkNvbmZpZ3VyYXRpb25zID0gc3B5KENIQUlOX0NPTkZJR1VSQVRJT05TKTtcbiAgICAgICAgICAgIHdoZW4oc3BpZWRDaGFpbkNvbmZpZ3VyYXRpb25zLmZpbmQoYW55dGhpbmcoKSkpLnRoZW5SZXR1cm4oYW55dGhpbmcoKSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyQmFsYW5jZUNhY2hlU2VydmljZU1vY2sgPSBtb2NrKFJmcU1ha2VyQmFsYW5jZUNhY2hlU2VydmljZSk7XG4gICAgICAgICAgICB3aGVuKHJmcU1ha2VyQmFsYW5jZUNhY2hlU2VydmljZU1vY2sudXBkYXRlRVJDMjBPd25lckJhbGFuY2VzQXN5bmMoYW55dGhpbmcoKSkpLnRoZW5SZWplY3QoXG4gICAgICAgICAgICAgICAgbmV3IEVycm9yKCdjYWNoZSBmYWlsZWQnKSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNwaWVkU2VydmljZUJ1aWxkZXJBc3luYyA9IHNweShzZXJ2aWNlQnVpbGRlcik7XG4gICAgICAgICAgICB3aGVuKHNwaWVkU2VydmljZUJ1aWxkZXJBc3luYy5idWlsZFJmcU1ha2VyQmFsYW5jZUNhY2hlU2VydmljZUFzeW5jKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZShcbiAgICAgICAgICAgICAgICBpbnN0YW5jZShyZnFNYWtlckJhbGFuY2VDYWNoZVNlcnZpY2VNb2NrKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCB7IGNyZWF0ZUFzeW5jLCBwcm9jZXNzQXN5bmMgfSA9IGJhY2tncm91bmRKb2JNQkNVcGRhdGU7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25Nb2NrID0gbW9jayhSZWRpcyk7XG5cbiAgICAgICAgICAgIGNvbnN0IHF1ZXVlID0gbmV3IFF1ZXVlKGJhY2tncm91bmRKb2JNQkNVcGRhdGUucXVldWVOYW1lLCB7IGNvbm5lY3Rpb246IGluc3RhbmNlKGNvbm5lY3Rpb25Nb2NrKSB9KTtcbiAgICAgICAgICAgIGNvbnN0IHNwaWVkUXVldWUgPSBzcHkocXVldWUpO1xuICAgICAgICAgICAgd2hlbihzcGllZFF1ZXVlLmVtaXQoYW55dGhpbmcoKSkpLnRoZW5SZXR1cm4odHJ1ZSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHNwaWVkSm9iID0gc3B5KEpvYik7XG4gICAgICAgICAgICB3aGVuKHNwaWVkSm9iLmNyZWF0ZShhbnl0aGluZygpLCBhbnl0aGluZygpLCBhbnl0aGluZygpLCBhbnl0aGluZygpKSkudGhlbkNhbGwoXG4gICAgICAgICAgICAgICAgLy8gJGVzbGludC1maXgtbWUgaHR0cHM6Ly9naXRodWIuY29tL3JoaW5vZGF2aWQvZXNsaW50LWZpeC1tZVxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICAgICAgKHE6IFF1ZXVlLCBuYW1lOiBhbnksIGRhdGE6IGFueSkgPT4gbmV3IEpvYihxLCBuYW1lLCBkYXRhKSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IGNoYWluSWQgPSBDaGFpbklkLkdhbmFjaGU7XG4gICAgICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICBsZXQgam9iOiBKb2I8QmFja2dyb3VuZEpvYk1CQ1VwZGF0ZURhdGEsIEJhY2tncm91bmRKb2JNQkNVcGRhdGVSZXN1bHQ+O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBqb2IgPSBhd2FpdCBjcmVhdGVBc3luYyhxdWV1ZSwge1xuICAgICAgICAgICAgICAgICAgICBjaGFpbklkLFxuICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGpvYi5xdWV1ZU5hbWUpLnRvLmVxKGJhY2tncm91bmRKb2JNQkNVcGRhdGUucXVldWVOYW1lKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHNwaWVkSm9iSW5zdGFuY2UgPSBzcHkoam9iKTtcbiAgICAgICAgICAgICAgICB3aGVuKHNwaWVkSm9iSW5zdGFuY2UudXBkYXRlUHJvZ3Jlc3MoYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKCk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QocHJvY2Vzc0FzeW5jKGpvYikpLnRvLmJlLnJlamVjdGVkV2l0aCgndXBkYXRlIG1ha2VyIGJhbGFuY2UgY2FjaGUnKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0LmZhaWwoJ3Nob3VsZCBjcmVhdGUgYmFja2dyb3VuZCBqb2Igd2l0aG91dCBlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9