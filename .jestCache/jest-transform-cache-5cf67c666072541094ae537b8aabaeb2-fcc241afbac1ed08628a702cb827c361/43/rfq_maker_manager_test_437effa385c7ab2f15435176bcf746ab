39f696477cfee3bf5d080bdf9213fa8a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// tslint:disable:custom-no-magic-numbers
// tslint:disable:no-empty
// tslint:disable:max-file-line-count
const ts_mockito_1 = require("ts-mockito");
const config_manager_1 = require("../../src/utils/config_manager");
const rfq_maker_db_utils_1 = require("../../src/utils/rfq_maker_db_utils");
const rfq_maker_manager_1 = require("../../src/utils/rfq_maker_manager");
const constants_1 = require("../constants");
const createMockConfigManager = (rfqtRfqMakers, rfqtOtcMakers, rfqmOtcMakers) => {
    const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
    (0, ts_mockito_1.when)(configManagerMock.getRfqmMakerIdSetForOtcOrder()).thenReturn(rfqmOtcMakers);
    (0, ts_mockito_1.when)(configManagerMock.getRfqtMakerIdSetForRfqOrder()).thenReturn(rfqtRfqMakers);
    (0, ts_mockito_1.when)(configManagerMock.getRfqtMakerIdSetForOtcOrder()).thenReturn(rfqtOtcMakers);
    return (0, ts_mockito_1.instance)(configManagerMock);
};
const createMockRfqMakerDbUtilsInstance = (rfqMaker) => {
    const rfqMakerDbUtilsMock = (0, ts_mockito_1.mock)(rfq_maker_db_utils_1.RfqMakerDbUtils);
    (0, ts_mockito_1.when)(rfqMakerDbUtilsMock.getRfqMakersAsync((0, ts_mockito_1.anything)())).thenResolve(rfqMaker);
    (0, ts_mockito_1.when)(rfqMakerDbUtilsMock.getRfqMakersUpdateTimeHashAsync((0, ts_mockito_1.anything)())).thenResolve('hash');
    return (0, ts_mockito_1.instance)(rfqMakerDbUtilsMock);
};
describe('RfqMakerManager', () => {
    // Tokens in Checksum representation
    const tokenA = '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2';
    const tokenB = '0x6B175474E89094C44Da98b954EedeAC495271d0F';
    const tokenC = '0xdAC17F958D2ee523a2206206994597C13D831ec7';
    const makerIdSet = new Set();
    makerIdSet.add('maker1');
    makerIdSet.add('maker2');
    const rfqMaker = [
        {
            makerId: 'maker1',
            chainId: constants_1.CHAIN_ID,
            pairs: [],
            updatedAt: new Date(),
            rfqtUri: 'https://maker1.asdf',
            rfqmUri: 'https://maker1.asdf',
        },
        {
            makerId: 'maker2',
            chainId: constants_1.CHAIN_ID,
            pairs: [],
            updatedAt: new Date(),
            rfqtUri: 'https://maker2.asdf',
            rfqmUri: 'https://maker2.asdf',
        },
    ];
    describe('getRfqmV2MakerUrisForPair', () => {
        it('should return a list of maker uris for a given config', async () => {
            // Given
            rfqMaker[0].pairs = [[tokenA, tokenB]];
            rfqMaker[1].pairs = [[tokenA, tokenB]];
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const makerUris = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenA, tokenB);
            // Then
            expect(makerUris).toEqual(['https://maker1.asdf', 'https://maker2.asdf']);
        });
        it('should ignore ordering when considering pairs', async () => {
            // Given
            rfqMaker[0].pairs = [[tokenA, tokenB]];
            rfqMaker[1].pairs = [[tokenB, tokenA]];
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const makerUris1 = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenB, tokenA); // order doesn't matter
            const makerUris2 = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenB, tokenA); // order doesn't matter
            // Then
            expect(makerUris1).toEqual(['https://maker1.asdf', 'https://maker2.asdf']);
            expect(makerUris2).toEqual(['https://maker1.asdf', 'https://maker2.asdf']);
        });
        it('should return whitelisted makers only', async () => {
            // Given
            rfqMaker[0].pairs = [[tokenA, tokenB]];
            rfqMaker[1].pairs = [[tokenA, tokenB]];
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            const whitelistedMakerIds = [rfqMaker[0].makerId];
            // When
            const makerUris1 = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenA, tokenB);
            const makerUris2 = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenA, tokenB, whitelistedMakerIds);
            // Then
            expect(makerUris1).toEqual(['https://maker1.asdf', 'https://maker2.asdf']);
            expect(makerUris2).toEqual(['https://maker1.asdf']);
        });
        it('should filter out blacklisted makers', async () => {
            // Given
            rfqMaker[0].pairs = [[tokenA, tokenB]];
            rfqMaker[1].pairs = [[tokenA, tokenB]];
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            const blacklistedMakerIds = [rfqMaker[0].makerId];
            // When
            const makerUris1 = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenA, tokenB);
            const makerUris2 = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenA, tokenB, null, blacklistedMakerIds);
            // Then
            expect(makerUris1).toEqual(['https://maker1.asdf', 'https://maker2.asdf']);
            expect(makerUris2).toEqual(['https://maker2.asdf']);
        });
        it('should ignore casing when considering pairs', async () => {
            // Given
            // These pairs are selected such that when sorted as is: [0xF, 0xd]
            // But their order fips when sorted after lower casing:  [0xd, 0xf]
            const token_0xd = '0xdAC17F958D2ee523a2206206994597C13D831ec7';
            const token_0xF = '0xFA2562da1Bba7B954f26C74725dF51fb62646313';
            rfqMaker[0].pairs = [[token_0xd, token_0xF]];
            rfqMaker[1].pairs = [[token_0xd.toLowerCase(), token_0xF.toLowerCase()]]; // case doesn't matter
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const makerUris1 = rfqMakerManager.getRfqmV2MakerUrisForPair(token_0xd, token_0xF);
            const makerUris2 = rfqMakerManager.getRfqmV2MakerUrisForPair(token_0xd.toUpperCase(), token_0xF.toUpperCase()); // case doesn't matter
            // Then
            expect(makerUris1).toEqual(makerUris2);
        });
        it('should return [] if no maker uris are providing liquidity', async () => {
            // Given
            rfqMaker[0].pairs = [[tokenA, tokenB]];
            rfqMaker[1].pairs = [[tokenA, tokenB]];
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const makerIdSetForMaker2Only = new Set();
            makerIdSetForMaker2Only.add('maker2');
            const configManager = createMockConfigManager(new Set(), makerIdSet, makerIdSetForMaker2Only);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const makerUris = rfqMakerManager.getRfqmV2MakerUrisForPair(tokenA, tokenC);
            // Then
            expect(makerUris).toEqual([]);
        });
    });
    describe('findMakerIdWithRfqmUri', () => {
        it('should return correct maker Id if the rfqm URI exists', async () => {
            // Given
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const maker1Id = rfqMakerManager.findMakerIdWithRfqmUri('https://maker1.asdf');
            const maker2Id = rfqMakerManager.findMakerIdWithRfqmUri('https://maker2.asdf');
            // Then
            expect(maker1Id).toEqual('maker1');
            expect(maker2Id).toEqual('maker2');
        });
        it('should return null if the maker URI does not exist', async () => {
            // Given
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(makerIdSet, makerIdSet, makerIdSet);
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const nullMakerId = rfqMakerManager.findMakerIdWithRfqmUri('https://maker-null.asdf');
            // Then
            expect(nullMakerId).toEqual(null);
        });
    });
    describe('getRfqtV2MakerOfferings', () => {
        it('should return the RfqMakerAssetOfferings for OtcOrder', async () => {
            // Given
            const rfqMakerForMaker123 = [...rfqMaker];
            rfqMakerForMaker123[0].pairs = [[tokenA, tokenB]];
            rfqMakerForMaker123[1].pairs = [[tokenA, tokenB]];
            rfqMakerForMaker123.push({
                makerId: 'maker3',
                chainId: constants_1.CHAIN_ID,
                pairs: [[tokenA, tokenC]],
                updatedAt: new Date(),
                rfqtUri: 'https://maker3.asdf',
                rfqmUri: null,
            });
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMakerForMaker123);
            const makerIdSetWithMakers23 = new Set();
            makerIdSetWithMakers23.add('maker2');
            makerIdSetWithMakers23.add('maker3');
            const configManager = createMockConfigManager(makerIdSetWithMakers23, makerIdSetWithMakers23, new Set());
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const assetOfferings = rfqMakerManager.getRfqtV2MakerOfferings();
            // Then
            expect(assetOfferings).toEqual({
                'https://maker2.asdf': [[tokenA, tokenB]],
                'https://maker3.asdf': [[tokenA, tokenC]],
            });
        });
    });
    describe('getRfqtV1MakerOfferings', () => {
        it('should return the RfqMakerAssetOfferings for RfqOrder', async () => {
            // Given
            const rfqMakerForMaker123 = [...rfqMaker];
            rfqMakerForMaker123[0].pairs = [[tokenA, tokenB]];
            rfqMakerForMaker123[1].pairs = [[tokenA, tokenB]];
            rfqMakerForMaker123.push({
                makerId: 'maker3',
                chainId: constants_1.CHAIN_ID,
                pairs: [[tokenA, tokenC]],
                updatedAt: new Date(),
                rfqmUri: null,
                rfqtUri: 'https://maker3.asdf',
            });
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMakerForMaker123);
            const makerIdSetWithMakers23 = new Set();
            makerIdSetWithMakers23.add('maker2');
            makerIdSetWithMakers23.add('maker3');
            const configManager = createMockConfigManager(makerIdSetWithMakers23, new Set(), new Set());
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            // When
            const assetOfferings = rfqMakerManager.getRfqtV1MakerOfferings();
            // Then
            expect(assetOfferings).toEqual({
                'https://maker2.asdf': [[tokenA, tokenB]],
                'https://maker3.asdf': [[tokenA, tokenC]],
            });
        });
    });
    describe('getRfqtV2MakersForPair', () => {
        it('should return the market makers trading rfqt-otc', async () => {
            rfqMaker[0].pairs = [[tokenB, tokenA]];
            rfqMaker[1].pairs = [[tokenB, tokenB]]; // This maker should not be included in the result
            const rfqMakerDbUtils = createMockRfqMakerDbUtilsInstance(rfqMaker);
            const configManager = createMockConfigManager(new Set(), new Set(['maker1', 'maker2']), new Set());
            const rfqMakerManager = new rfq_maker_manager_1.RfqMakerManager(configManager, rfqMakerDbUtils, constants_1.CHAIN_ID);
            await rfqMakerManager.initializeAsync();
            const makers = rfqMakerManager.getRfqtV2MakersForPair(tokenA, tokenB);
            expect(makers.length).toEqual(1);
            expect(makers[0].makerId).toEqual('maker1');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvdXRpbHMvcmZxX21ha2VyX21hbmFnZXJfdGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHlDQUF5QztBQUN6QywwQkFBMEI7QUFDMUIscUNBQXFDO0FBRXJDLDJDQUE0RDtBQUk1RCxtRUFBK0Q7QUFDL0QsMkVBQXFFO0FBQ3JFLHlFQUFvRTtBQUNwRSw0Q0FBd0M7QUFFeEMsTUFBTSx1QkFBdUIsR0FBRyxDQUM1QixhQUF5QixFQUN6QixhQUF5QixFQUN6QixhQUF5QixFQUNaLEVBQUU7SUFDZixNQUFNLGlCQUFpQixHQUFHLElBQUEsaUJBQUksRUFBQyw4QkFBYSxDQUFDLENBQUM7SUFDOUMsSUFBQSxpQkFBSSxFQUFDLGlCQUFpQixDQUFDLDRCQUE0QixFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDakYsSUFBQSxpQkFBSSxFQUFDLGlCQUFpQixDQUFDLDRCQUE0QixFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDakYsSUFBQSxpQkFBSSxFQUFDLGlCQUFpQixDQUFDLDRCQUE0QixFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7SUFFakYsT0FBTyxJQUFBLHFCQUFRLEVBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUN2QyxDQUFDLENBQUM7QUFFRixNQUFNLGlDQUFpQyxHQUFHLENBQUMsUUFBb0IsRUFBbUIsRUFBRTtJQUNoRixNQUFNLG1CQUFtQixHQUFHLElBQUEsaUJBQUksRUFBQyxvQ0FBZSxDQUFDLENBQUM7SUFDbEQsSUFBQSxpQkFBSSxFQUFDLG1CQUFtQixDQUFDLGlCQUFpQixDQUFDLElBQUEscUJBQVEsR0FBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUUsSUFBQSxpQkFBSSxFQUFDLG1CQUFtQixDQUFDLCtCQUErQixDQUFDLElBQUEscUJBQVEsR0FBRSxDQUFDLENB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Q0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsa0RBQWtEO1lBRTFGLE1BQU0sZUFBZSxHQUFHLGlDQUFpQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BFLE1BQU0sYUFBYSxHQUFHLHVCQUF1QixDQUFDLElBQUksR0FBRyxFQUFFLEVBQUUsSUFBSSxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFBRSxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbkcsTUFBTSxlQUFlLEdBQUcsSUFBSSxtQ0FBZSxDQUFDLGFBQWEsRUFBRSxlQUFlLEVBQUUsb0JBQVEsQ0FBQyxDQUFDO1lBQ3RGLE1BQU0sZUFBZSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBRXhDLE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFFdEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS90ZXN0L3V0aWxzL3JmcV9tYWtlcl9tYW5hZ2VyX3Rlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6Y3VzdG9tLW5vLW1hZ2ljLW51bWJlcnNcbi8vIHRzbGludDpkaXNhYmxlOm5vLWVtcHR5XG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZmlsZS1saW5lLWNvdW50XG5cbmltcG9ydCB7IGFueXRoaW5nLCBpbnN0YW5jZSwgbW9jaywgd2hlbiB9IGZyb20gJ3RzLW1vY2tpdG8nO1xuXG5pbXBvcnQgeyBNYWtlcklkU2V0IH0gZnJvbSAnLi4vLi4vc3JjL2NvbmZpZyc7XG5pbXBvcnQgeyBSZnFNYWtlciB9IGZyb20gJy4uLy4uL3NyYy9lbnRpdGllcyc7XG5pbXBvcnQgeyBDb25maWdNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vc3JjL3V0aWxzL2NvbmZpZ19tYW5hZ2VyJztcbmltcG9ydCB7IFJmcU1ha2VyRGJVdGlscyB9IGZyb20gJy4uLy4uL3NyYy91dGlscy9yZnFfbWFrZXJfZGJfdXRpbHMnO1xuaW1wb3J0IHsgUmZxTWFrZXJNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vc3JjL3V0aWxzL3JmcV9tYWtlcl9tYW5hZ2VyJztcbmltcG9ydCB7IENIQUlOX0lEIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcblxuY29uc3QgY3JlYXRlTW9ja0NvbmZpZ01hbmFnZXIgPSAoXG4gICAgcmZxdFJmcU1ha2VyczogTWFrZXJJZFNldCxcbiAgICByZnF0T3RjTWFrZXJzOiBNYWtlcklkU2V0LFxuICAgIHJmcW1PdGNNYWtlcnM6IE1ha2VySWRTZXQsXG4pOiBDb25maWdNYW5hZ2VyID0+IHtcbiAgICBjb25zdCBjb25maWdNYW5hZ2VyTW9jayA9IG1vY2soQ29uZmlnTWFuYWdlcik7XG4gICAgd2hlbihjb25maWdNYW5hZ2VyTW9jay5nZXRSZnFtTWFrZXJJZFNldEZvck90Y09yZGVyKCkpLnRoZW5SZXR1cm4ocmZxbU90Y01ha2Vycyk7XG4gICAgd2hlbihjb25maWdNYW5hZ2VyTW9jay5nZXRSZnF0TWFrZXJJZFNldEZvclJmcU9yZGVyKCkpLnRoZW5SZXR1cm4ocmZxdFJmcU1ha2Vycyk7XG4gICAgd2hlbihjb25maWdNYW5hZ2VyTW9jay5nZXRSZnF0TWFrZXJJZFNldEZvck90Y09yZGVyKCkpLnRoZW5SZXR1cm4ocmZxdE90Y01ha2Vycyk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2UoY29uZmlnTWFuYWdlck1vY2spO1xufTtcblxuY29uc3QgY3JlYXRlTW9ja1JmcU1ha2VyRGJVdGlsc0luc3RhbmNlID0gKHJmcU1ha2VyOiBSZnFNYWtlcltdKTogUmZxTWFrZXJEYlV0aWxzID0+IHtcbiAgICBjb25zdCByZnFNYWtlckRiVXRpbHNNb2NrID0gbW9jayhSZnFNYWtlckRiVXRpbHMpO1xuICAgIHdoZW4ocmZxTWFrZXJEYlV0aWxzTW9jay5nZXRSZnFNYWtlcnNBc3luYyhhbnl0aGluZygpKSkudGhlblJlc29sdmUocmZxTWFrZXIpO1xuICAgIHdoZW4ocmZxTWFrZXJEYlV0aWxzTW9jay5nZXRSZnFNYWtlcnNVcGRhdGVUaW1lSGFzaEFzeW5jKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZSgnaGFzaCcpO1xuXG4gICAgcmV0dXJuIGluc3RhbmNlKHJmcU1ha2VyRGJVdGlsc01vY2spO1xufTtcblxuZGVzY3JpYmUoJ1JmcU1ha2VyTWFuYWdlcicsICgpID0+IHtcbiAgICAvLyBUb2tlbnMgaW4gQ2hlY2tzdW0gcmVwcmVzZW50YXRpb25cbiAgICBjb25zdCB0b2tlbkEgPSAnMHhDMDJhYUEzOWIyMjNGRThEMEEwZTVDNEYyN2VBRDkwODNDNzU2Q2MyJztcbiAgICBjb25zdCB0b2tlbkIgPSAnMHg2QjE3NTQ3NEU4OTA5NEM0NERhOThiOTU0RWVkZUFDNDk1MjcxZDBGJztcbiAgICBjb25zdCB0b2tlbkMgPSAnMHhkQUMxN0Y5NThEMmVlNTIzYTIyMDYyMDY5OTQ1OTdDMTNEODMxZWM3JztcblxuICAgIGNvbnN0IG1ha2VySWRTZXQ6IE1ha2VySWRTZXQgPSBuZXcgU2V0KCk7XG4gICAgbWFrZXJJZFNldC5hZGQoJ21ha2VyMScpO1xuICAgIG1ha2VySWRTZXQuYWRkKCdtYWtlcjInKTtcblxuICAgIGNvbnN0IHJmcU1ha2VyOiBSZnFNYWtlcltdID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBtYWtlcklkOiAnbWFrZXIxJyxcbiAgICAgICAgICAgIGNoYWluSWQ6IENIQUlOX0lELFxuICAgICAgICAgICAgcGFpcnM6IFtdLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgcmZxdFVyaTogJ2h0dHBzOi8vbWFrZXIxLmFzZGYnLFxuICAgICAgICAgICAgcmZxbVVyaTogJ2h0dHBzOi8vbWFrZXIxLmFzZGYnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBtYWtlcklkOiAnbWFrZXIyJyxcbiAgICAgICAgICAgIGNoYWluSWQ6IENIQUlOX0lELFxuICAgICAgICAgICAgcGFpcnM6IFtdLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgcmZxdFVyaTogJ2h0dHBzOi8vbWFrZXIyLmFzZGYnLFxuICAgICAgICAgICAgcmZxbVVyaTogJ2h0dHBzOi8vbWFrZXIyLmFzZGYnLFxuICAgICAgICB9LFxuICAgIF07XG5cbiAgICBkZXNjcmliZSgnZ2V0UmZxbVYyTWFrZXJVcmlzRm9yUGFpcicsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBsaXN0IG9mIG1ha2VyIHVyaXMgZm9yIGEgZ2l2ZW4gY29uZmlnJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gR2l2ZW5cbiAgICAgICAgICAgIHJmcU1ha2VyWzBdLnBhaXJzID0gW1t0b2tlbkEsIHRva2VuQl1dO1xuICAgICAgICAgICAgcmZxTWFrZXJbMV0ucGFpcnMgPSBbW3Rva2VuQSwgdG9rZW5CXV07XG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckRiVXRpbHMgPSBjcmVhdGVNb2NrUmZxTWFrZXJEYlV0aWxzSW5zdGFuY2UocmZxTWFrZXIpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlciA9IGNyZWF0ZU1vY2tDb25maWdNYW5hZ2VyKG1ha2VySWRTZXQsIG1ha2VySWRTZXQsIG1ha2VySWRTZXQpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlck1hbmFnZXIgPSBuZXcgUmZxTWFrZXJNYW5hZ2VyKGNvbmZpZ01hbmFnZXIsIHJmcU1ha2VyRGJVdGlscywgQ0hBSU5fSUQpO1xuICAgICAgICAgICAgYXdhaXQgcmZxTWFrZXJNYW5hZ2VyLmluaXRpYWxpemVBc3luYygpO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBjb25zdCBtYWtlclVyaXMgPSByZnFNYWtlck1hbmFnZXIuZ2V0UmZxbVYyTWFrZXJVcmlzRm9yUGFpcih0b2tlbkEsIHRva2VuQik7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChtYWtlclVyaXMpLnRvRXF1YWwoWydodHRwczovL21ha2VyMS5hc2RmJywgJ2h0dHBzOi8vbWFrZXIyLmFzZGYnXSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaWdub3JlIG9yZGVyaW5nIHdoZW4gY29uc2lkZXJpbmcgcGFpcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgcmZxTWFrZXJbMF0ucGFpcnMgPSBbW3Rva2VuQSwgdG9rZW5CXV07XG4gICAgICAgICAgICByZnFNYWtlclsxXS5wYWlycyA9IFtbdG9rZW5CLCB0b2tlbkFdXTtcbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyRGJVdGlscyA9IGNyZWF0ZU1vY2tSZnFNYWtlckRiVXRpbHNJbnN0YW5jZShyZnFNYWtlcik7XG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gY3JlYXRlTW9ja0NvbmZpZ01hbmFnZXIobWFrZXJJZFNldCwgbWFrZXJJZFNldCwgbWFrZXJJZFNldCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyTWFuYWdlciA9IG5ldyBSZnFNYWtlck1hbmFnZXIoY29uZmlnTWFuYWdlciwgcmZxTWFrZXJEYlV0aWxzLCBDSEFJTl9JRCk7XG4gICAgICAgICAgICBhd2FpdCByZnFNYWtlck1hbmFnZXIuaW5pdGlhbGl6ZUFzeW5jKCk7XG5cbiAgICAgICAgICAgIC8vIFdoZW5cbiAgICAgICAgICAgIGNvbnN0IG1ha2VyVXJpczEgPSByZnFNYWtlck1hbmFnZXIuZ2V0UmZxbVYyTWFrZXJVcmlzRm9yUGFpcih0b2tlbkIsIHRva2VuQSk7IC8vIG9yZGVyIGRvZXNuJ3QgbWF0dGVyXG4gICAgICAgICAgICBjb25zdCBtYWtlclVyaXMyID0gcmZxTWFrZXJNYW5hZ2VyLmdldFJmcW1WMk1ha2VyVXJpc0ZvclBhaXIodG9rZW5CLCB0b2tlbkEpOyAvLyBvcmRlciBkb2Vzbid0IG1hdHRlclxuXG4gICAgICAgICAgICAvLyBUaGVuXG4gICAgICAgICAgICBleHBlY3QobWFrZXJVcmlzMSkudG9FcXVhbChbJ2h0dHBzOi8vbWFrZXIxLmFzZGYnLCAnaHR0cHM6Ly9tYWtlcjIuYXNkZiddKTtcbiAgICAgICAgICAgIGV4cGVjdChtYWtlclVyaXMyKS50b0VxdWFsKFsnaHR0cHM6Ly9tYWtlcjEuYXNkZicsICdodHRwczovL21ha2VyMi5hc2RmJ10pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB3aGl0ZWxpc3RlZCBtYWtlcnMgb25seScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICByZnFNYWtlclswXS5wYWlycyA9IFtbdG9rZW5BLCB0b2tlbkJdXTtcbiAgICAgICAgICAgIHJmcU1ha2VyWzFdLnBhaXJzID0gW1t0b2tlbkEsIHRva2VuQl1dO1xuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJEYlV0aWxzID0gY3JlYXRlTW9ja1JmcU1ha2VyRGJVdGlsc0luc3RhbmNlKHJmcU1ha2VyKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXIgPSBjcmVhdGVNb2NrQ29uZmlnTWFuYWdlcihtYWtlcklkU2V0LCBtYWtlcklkU2V0LCBtYWtlcklkU2V0KTtcblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJNYW5hZ2VyID0gbmV3IFJmcU1ha2VyTWFuYWdlcihjb25maWdNYW5hZ2VyLCByZnFNYWtlckRiVXRpbHMsIENIQUlOX0lEKTtcbiAgICAgICAgICAgIGF3YWl0IHJmcU1ha2VyTWFuYWdlci5pbml0aWFsaXplQXN5bmMoKTtcblxuICAgICAgICAgICAgY29uc3Qgd2hpdGVsaXN0ZWRNYWtlcklkcyA9IFtyZnFNYWtlclswXS5tYWtlcklkXTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgbWFrZXJVcmlzMSA9IHJmcU1ha2VyTWFuYWdlci5nZXRSZnFtVjJNYWtlclVyaXNGb3JQYWlyKHRva2VuQSwgdG9rZW5CKTtcbiAgICAgICAgICAgIGNvbnN0IG1ha2VyVXJpczIgPSByZnFNYWtlck1hbmFnZXIuZ2V0UmZxbVYyTWFrZXJVcmlzRm9yUGFpcih0b2tlbkEsIHRva2VuQiwgd2hpdGVsaXN0ZWRNYWtlcklkcyk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChtYWtlclVyaXMxKS50b0VxdWFsKFsnaHR0cHM6Ly9tYWtlcjEuYXNkZicsICdodHRwczovL21ha2VyMi5hc2RmJ10pO1xuICAgICAgICAgICAgZXhwZWN0KG1ha2VyVXJpczIpLnRvRXF1YWwoWydodHRwczovL21ha2VyMS5hc2RmJ10pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGZpbHRlciBvdXQgYmxhY2tsaXN0ZWQgbWFrZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gR2l2ZW5cbiAgICAgICAgICAgIHJmcU1ha2VyWzBdLnBhaXJzID0gW1t0b2tlbkEsIHRva2VuQl1dO1xuICAgICAgICAgICAgcmZxTWFrZXJbMV0ucGFpcnMgPSBbW3Rva2VuQSwgdG9rZW5CXV07XG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckRiVXRpbHMgPSBjcmVhdGVNb2NrUmZxTWFrZXJEYlV0aWxzSW5zdGFuY2UocmZxTWFrZXIpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlciA9IGNyZWF0ZU1vY2tDb25maWdNYW5hZ2VyKG1ha2VySWRTZXQsIG1ha2VySWRTZXQsIG1ha2VySWRTZXQpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlck1hbmFnZXIgPSBuZXcgUmZxTWFrZXJNYW5hZ2VyKGNvbmZpZ01hbmFnZXIsIHJmcU1ha2VyRGJVdGlscywgQ0hBSU5fSUQpO1xuICAgICAgICAgICAgYXdhaXQgcmZxTWFrZXJNYW5hZ2VyLmluaXRpYWxpemVBc3luYygpO1xuXG4gICAgICAgICAgICBjb25zdCBibGFja2xpc3RlZE1ha2VySWRzID0gW3JmcU1ha2VyWzBdLm1ha2VySWRdO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBjb25zdCBtYWtlclVyaXMxID0gcmZxTWFrZXJNYW5hZ2VyLmdldFJmcW1WMk1ha2VyVXJpc0ZvclBhaXIodG9rZW5BLCB0b2tlbkIpO1xuICAgICAgICAgICAgY29uc3QgbWFrZXJVcmlzMiA9IHJmcU1ha2VyTWFuYWdlci5nZXRSZnFtVjJNYWtlclVyaXNGb3JQYWlyKHRva2VuQSwgdG9rZW5CLCBudWxsLCBibGFja2xpc3RlZE1ha2VySWRzKTtcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KG1ha2VyVXJpczEpLnRvRXF1YWwoWydodHRwczovL21ha2VyMS5hc2RmJywgJ2h0dHBzOi8vbWFrZXIyLmFzZGYnXSk7XG4gICAgICAgICAgICBleHBlY3QobWFrZXJVcmlzMikudG9FcXVhbChbJ2h0dHBzOi8vbWFrZXIyLmFzZGYnXSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaWdub3JlIGNhc2luZyB3aGVuIGNvbnNpZGVyaW5nIHBhaXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gR2l2ZW5cbiAgICAgICAgICAgIC8vIFRoZXNlIHBhaXJzIGFyZSBzZWxlY3RlZCBzdWNoIHRoYXQgd2hlbiBzb3J0ZWQgYXMgaXM6IFsweEYsIDB4ZF1cbiAgICAgICAgICAgIC8vIEJ1dCB0aGVpciBvcmRlciBmaXBzIHdoZW4gc29ydGVkIGFmdGVyIGxvd2VyIGNhc2luZzogIFsweGQsIDB4Zl1cbiAgICAgICAgICAgIGNvbnN0IHRva2VuXzB4ZCA9ICcweGRBQzE3Rjk1OEQyZWU1MjNhMjIwNjIwNjk5NDU5N0MxM0Q4MzFlYzcnO1xuICAgICAgICAgICAgY29uc3QgdG9rZW5fMHhGID0gJzB4RkEyNTYyZGExQmJhN0I5NTRmMjZDNzQ3MjVkRjUxZmI2MjY0NjMxMyc7XG4gICAgICAgICAgICByZnFNYWtlclswXS5wYWlycyA9IFtbdG9rZW5fMHhkLCB0b2tlbl8weEZdXTtcbiAgICAgICAgICAgIHJmcU1ha2VyWzFdLnBhaXJzID0gW1t0b2tlbl8weGQudG9Mb3dlckNhc2UoKSwgdG9rZW5fMHhGLnRvTG93ZXJDYXNlKCldXTsgLy8gY2FzZSBkb2Vzbid0IG1hdHRlclxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJEYlV0aWxzID0gY3JlYXRlTW9ja1JmcU1ha2VyRGJVdGlsc0luc3RhbmNlKHJmcU1ha2VyKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXIgPSBjcmVhdGVNb2NrQ29uZmlnTWFuYWdlcihtYWtlcklkU2V0LCBtYWtlcklkU2V0LCBtYWtlcklkU2V0KTtcblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJNYW5hZ2VyID0gbmV3IFJmcU1ha2VyTWFuYWdlcihjb25maWdNYW5hZ2VyLCByZnFNYWtlckRiVXRpbHMsIENIQUlOX0lEKTtcbiAgICAgICAgICAgIGF3YWl0IHJmcU1ha2VyTWFuYWdlci5pbml0aWFsaXplQXN5bmMoKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgbWFrZXJVcmlzMSA9IHJmcU1ha2VyTWFuYWdlci5nZXRSZnFtVjJNYWtlclVyaXNGb3JQYWlyKHRva2VuXzB4ZCwgdG9rZW5fMHhGKTtcbiAgICAgICAgICAgIGNvbnN0IG1ha2VyVXJpczIgPSByZnFNYWtlck1hbmFnZXIuZ2V0UmZxbVYyTWFrZXJVcmlzRm9yUGFpcihcbiAgICAgICAgICAgICAgICB0b2tlbl8weGQudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgICAgICB0b2tlbl8weEYudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgICk7IC8vIGNhc2UgZG9lc24ndCBtYXR0ZXJcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KG1ha2VyVXJpczEpLnRvRXF1YWwobWFrZXJVcmlzMik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIFtdIGlmIG5vIG1ha2VyIHVyaXMgYXJlIHByb3ZpZGluZyBsaXF1aWRpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgcmZxTWFrZXJbMF0ucGFpcnMgPSBbW3Rva2VuQSwgdG9rZW5CXV07XG4gICAgICAgICAgICByZnFNYWtlclsxXS5wYWlycyA9IFtbdG9rZW5BLCB0b2tlbkJdXTtcbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyRGJVdGlscyA9IGNyZWF0ZU1vY2tSZnFNYWtlckRiVXRpbHNJbnN0YW5jZShyZnFNYWtlcik7XG5cbiAgICAgICAgICAgIGNvbnN0IG1ha2VySWRTZXRGb3JNYWtlcjJPbmx5OiBNYWtlcklkU2V0ID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgbWFrZXJJZFNldEZvck1ha2VyMk9ubHkuYWRkKCdtYWtlcjInKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXIgPSBjcmVhdGVNb2NrQ29uZmlnTWFuYWdlcihuZXcgU2V0KCksIG1ha2VySWRTZXQsIG1ha2VySWRTZXRGb3JNYWtlcjJPbmx5KTtcblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJNYW5hZ2VyID0gbmV3IFJmcU1ha2VyTWFuYWdlcihjb25maWdNYW5hZ2VyLCByZnFNYWtlckRiVXRpbHMsIENIQUlOX0lEKTtcbiAgICAgICAgICAgIGF3YWl0IHJmcU1ha2VyTWFuYWdlci5pbml0aWFsaXplQXN5bmMoKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgbWFrZXJVcmlzID0gcmZxTWFrZXJNYW5hZ2VyLmdldFJmcW1WMk1ha2VyVXJpc0ZvclBhaXIodG9rZW5BLCB0b2tlbkMpO1xuXG4gICAgICAgICAgICAvLyBUaGVuXG4gICAgICAgICAgICBleHBlY3QobWFrZXJVcmlzKS50b0VxdWFsKFtdKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmluZE1ha2VySWRXaXRoUmZxbVVyaScsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBtYWtlciBJZCBpZiB0aGUgcmZxbSBVUkkgZXhpc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gR2l2ZW5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyRGJVdGlscyA9IGNyZWF0ZU1vY2tSZnFNYWtlckRiVXRpbHNJbnN0YW5jZShyZnFNYWtlcik7XG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gY3JlYXRlTW9ja0NvbmZpZ01hbmFnZXIobWFrZXJJZFNldCwgbWFrZXJJZFNldCwgbWFrZXJJZFNldCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyTWFuYWdlciA9IG5ldyBSZnFNYWtlck1hbmFnZXIoY29uZmlnTWFuYWdlciwgcmZxTWFrZXJEYlV0aWxzLCBDSEFJTl9JRCk7XG4gICAgICAgICAgICBhd2FpdCByZnFNYWtlck1hbmFnZXIuaW5pdGlhbGl6ZUFzeW5jKCk7XG5cbiAgICAgICAgICAgIC8vIFdoZW5cbiAgICAgICAgICAgIGNvbnN0IG1ha2VyMUlkID0gcmZxTWFrZXJNYW5hZ2VyLmZpbmRNYWtlcklkV2l0aFJmcW1VcmkoJ2h0dHBzOi8vbWFrZXIxLmFzZGYnKTtcbiAgICAgICAgICAgIGNvbnN0IG1ha2VyMklkID0gcmZxTWFrZXJNYW5hZ2VyLmZpbmRNYWtlcklkV2l0aFJmcW1VcmkoJ2h0dHBzOi8vbWFrZXIyLmFzZGYnKTtcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KG1ha2VyMUlkKS50b0VxdWFsKCdtYWtlcjEnKTtcbiAgICAgICAgICAgIGV4cGVjdChtYWtlcjJJZCkudG9FcXVhbCgnbWFrZXIyJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgaWYgdGhlIG1ha2VyIFVSSSBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckRiVXRpbHMgPSBjcmVhdGVNb2NrUmZxTWFrZXJEYlV0aWxzSW5zdGFuY2UocmZxTWFrZXIpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlciA9IGNyZWF0ZU1vY2tDb25maWdNYW5hZ2VyKG1ha2VySWRTZXQsIG1ha2VySWRTZXQsIG1ha2VySWRTZXQpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlck1hbmFnZXIgPSBuZXcgUmZxTWFrZXJNYW5hZ2VyKGNvbmZpZ01hbmFnZXIsIHJmcU1ha2VyRGJVdGlscywgQ0hBSU5fSUQpO1xuICAgICAgICAgICAgYXdhaXQgcmZxTWFrZXJNYW5hZ2VyLmluaXRpYWxpemVBc3luYygpO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBjb25zdCBudWxsTWFrZXJJZCA9IHJmcU1ha2VyTWFuYWdlci5maW5kTWFrZXJJZFdpdGhSZnFtVXJpKCdodHRwczovL21ha2VyLW51bGwuYXNkZicpO1xuXG4gICAgICAgICAgICAvLyBUaGVuXG4gICAgICAgICAgICBleHBlY3QobnVsbE1ha2VySWQpLnRvRXF1YWwobnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldFJmcXRWMk1ha2VyT2ZmZXJpbmdzJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgUmZxTWFrZXJBc3NldE9mZmVyaW5ncyBmb3IgT3RjT3JkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJGb3JNYWtlcjEyMyA9IFsuLi5yZnFNYWtlcl07XG4gICAgICAgICAgICByZnFNYWtlckZvck1ha2VyMTIzWzBdLnBhaXJzID0gW1t0b2tlbkEsIHRva2VuQl1dO1xuICAgICAgICAgICAgcmZxTWFrZXJGb3JNYWtlcjEyM1sxXS5wYWlycyA9IFtbdG9rZW5BLCB0b2tlbkJdXTtcbiAgICAgICAgICAgIHJmcU1ha2VyRm9yTWFrZXIxMjMucHVzaCh7XG4gICAgICAgICAgICAgICAgbWFrZXJJZDogJ21ha2VyMycsXG4gICAgICAgICAgICAgICAgY2hhaW5JZDogQ0hBSU5fSUQsXG4gICAgICAgICAgICAgICAgcGFpcnM6IFtbdG9rZW5BLCB0b2tlbkNdXSxcbiAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgcmZxdFVyaTogJ2h0dHBzOi8vbWFrZXIzLmFzZGYnLFxuICAgICAgICAgICAgICAgIHJmcW1Vcmk6IG51bGwsXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJEYlV0aWxzID0gY3JlYXRlTW9ja1JmcU1ha2VyRGJVdGlsc0luc3RhbmNlKHJmcU1ha2VyRm9yTWFrZXIxMjMpO1xuXG4gICAgICAgICAgICBjb25zdCBtYWtlcklkU2V0V2l0aE1ha2VyczIzOiBNYWtlcklkU2V0ID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgbWFrZXJJZFNldFdpdGhNYWtlcnMyMy5hZGQoJ21ha2VyMicpO1xuICAgICAgICAgICAgbWFrZXJJZFNldFdpdGhNYWtlcnMyMy5hZGQoJ21ha2VyMycpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlciA9IGNyZWF0ZU1vY2tDb25maWdNYW5hZ2VyKG1ha2VySWRTZXRXaXRoTWFrZXJzMjMsIG1ha2VySWRTZXRXaXRoTWFrZXJzMjMsIG5ldyBTZXQoKSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyTWFuYWdlciA9IG5ldyBSZnFNYWtlck1hbmFnZXIoY29uZmlnTWFuYWdlciwgcmZxTWFrZXJEYlV0aWxzLCBDSEFJTl9JRCk7XG4gICAgICAgICAgICBhd2FpdCByZnFNYWtlck1hbmFnZXIuaW5pdGlhbGl6ZUFzeW5jKCk7XG5cbiAgICAgICAgICAgIC8vIFdoZW5cbiAgICAgICAgICAgIGNvbnN0IGFzc2V0T2ZmZXJpbmdzID0gcmZxTWFrZXJNYW5hZ2VyLmdldFJmcXRWMk1ha2VyT2ZmZXJpbmdzKCk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChhc3NldE9mZmVyaW5ncykudG9FcXVhbCh7XG4gICAgICAgICAgICAgICAgJ2h0dHBzOi8vbWFrZXIyLmFzZGYnOiBbW3Rva2VuQSwgdG9rZW5CXV0sXG4gICAgICAgICAgICAgICAgJ2h0dHBzOi8vbWFrZXIzLmFzZGYnOiBbW3Rva2VuQSwgdG9rZW5DXV0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0UmZxdFYxTWFrZXJPZmZlcmluZ3MnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBSZnFNYWtlckFzc2V0T2ZmZXJpbmdzIGZvciBSZnFPcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckZvck1ha2VyMTIzID0gWy4uLnJmcU1ha2VyXTtcbiAgICAgICAgICAgIHJmcU1ha2VyRm9yTWFrZXIxMjNbMF0ucGFpcnMgPSBbW3Rva2VuQSwgdG9rZW5CXV07XG4gICAgICAgICAgICByZnFNYWtlckZvck1ha2VyMTIzWzFdLnBhaXJzID0gW1t0b2tlbkEsIHRva2VuQl1dO1xuICAgICAgICAgICAgcmZxTWFrZXJGb3JNYWtlcjEyMy5wdXNoKHtcbiAgICAgICAgICAgICAgICBtYWtlcklkOiAnbWFrZXIzJyxcbiAgICAgICAgICAgICAgICBjaGFpbklkOiBDSEFJTl9JRCxcbiAgICAgICAgICAgICAgICBwYWlyczogW1t0b2tlbkEsIHRva2VuQ11dLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICByZnFtVXJpOiBudWxsLFxuICAgICAgICAgICAgICAgIHJmcXRVcmk6ICdodHRwczovL21ha2VyMy5hc2RmJyxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckRiVXRpbHMgPSBjcmVhdGVNb2NrUmZxTWFrZXJEYlV0aWxzSW5zdGFuY2UocmZxTWFrZXJGb3JNYWtlcjEyMyk7XG5cbiAgICAgICAgICAgIGNvbnN0IG1ha2VySWRTZXRXaXRoTWFrZXJzMjM6IE1ha2VySWRTZXQgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICBtYWtlcklkU2V0V2l0aE1ha2VyczIzLmFkZCgnbWFrZXIyJyk7XG4gICAgICAgICAgICBtYWtlcklkU2V0V2l0aE1ha2VyczIzLmFkZCgnbWFrZXIzJyk7XG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gY3JlYXRlTW9ja0NvbmZpZ01hbmFnZXIobWFrZXJJZFNldFdpdGhNYWtlcnMyMywgbmV3IFNldCgpLCBuZXcgU2V0KCkpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlck1hbmFnZXIgPSBuZXcgUmZxTWFrZXJNYW5hZ2VyKGNvbmZpZ01hbmFnZXIsIHJmcU1ha2VyRGJVdGlscywgQ0hBSU5fSUQpO1xuICAgICAgICAgICAgYXdhaXQgcmZxTWFrZXJNYW5hZ2VyLmluaXRpYWxpemVBc3luYygpO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBjb25zdCBhc3NldE9mZmVyaW5ncyA9IHJmcU1ha2VyTWFuYWdlci5nZXRSZnF0VjFNYWtlck9mZmVyaW5ncygpO1xuXG4gICAgICAgICAgICAvLyBUaGVuXG4gICAgICAgICAgICBleHBlY3QoYXNzZXRPZmZlcmluZ3MpLnRvRXF1YWwoe1xuICAgICAgICAgICAgICAgICdodHRwczovL21ha2VyMi5hc2RmJzogW1t0b2tlbkEsIHRva2VuQl1dLFxuICAgICAgICAgICAgICAgICdodHRwczovL21ha2VyMy5hc2RmJzogW1t0b2tlbkEsIHRva2VuQ11dLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKCdnZXRSZnF0VjJNYWtlcnNGb3JQYWlyJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgbWFya2V0IG1ha2VycyB0cmFkaW5nIHJmcXQtb3RjJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgcmZxTWFrZXJbMF0ucGFpcnMgPSBbW3Rva2VuQiwgdG9rZW5BXV07XG4gICAgICAgICAgICByZnFNYWtlclsxXS5wYWlycyA9IFtbdG9rZW5CLCB0b2tlbkJdXTsgLy8gVGhpcyBtYWtlciBzaG91bGQgbm90IGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHRcblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJEYlV0aWxzID0gY3JlYXRlTW9ja1JmcU1ha2VyRGJVdGlsc0luc3RhbmNlKHJmcU1ha2VyKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXIgPSBjcmVhdGVNb2NrQ29uZmlnTWFuYWdlcihuZXcgU2V0KCksIG5ldyBTZXQoWydtYWtlcjEnLCAnbWFrZXIyJ10pLCBuZXcgU2V0KCkpO1xuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJNYW5hZ2VyID0gbmV3IFJmcU1ha2VyTWFuYWdlcihjb25maWdNYW5hZ2VyLCByZnFNYWtlckRiVXRpbHMsIENIQUlOX0lEKTtcbiAgICAgICAgICAgIGF3YWl0IHJmcU1ha2VyTWFuYWdlci5pbml0aWFsaXplQXN5bmMoKTtcblxuICAgICAgICAgICAgY29uc3QgbWFrZXJzID0gcmZxTWFrZXJNYW5hZ2VyLmdldFJmcXRWMk1ha2Vyc0ZvclBhaXIodG9rZW5BLCB0b2tlbkIpO1xuXG4gICAgICAgICAgICBleHBlY3QobWFrZXJzLmxlbmd0aCkudG9FcXVhbCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChtYWtlcnNbMF0ubWFrZXJJZCkudG9FcXVhbCgnbWFrZXIxJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=