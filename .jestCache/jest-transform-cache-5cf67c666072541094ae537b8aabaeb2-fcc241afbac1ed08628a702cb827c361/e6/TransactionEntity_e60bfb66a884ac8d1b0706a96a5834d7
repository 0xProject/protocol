2df31119c000ac4b27182219944f6a95
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TransactionEntity_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TransactionEntity = void 0;
const assert_1 = require("@0x/assert");
const utils_1 = require("@0x/utils");
const typeorm_1 = require("typeorm");
const config_1 = require("../config");
const constants_1 = require("../core/constants");
const transformers_1 = require("./transformers");
var TransactionStates;
(function (TransactionStates) {
    // transaction has been constructed, but not yet submitted to the network.
    TransactionStates["Unsubmitted"] = "unsubmitted";
    // transaction has been submitted to the network.
    TransactionStates["Submitted"] = "submitted";
    // transaction has been spotted in the mempool.
    TransactionStates["Mempool"] = "mempool";
    // transaction has not been mined in the expected time.
    TransactionStates["Stuck"] = "stuck";
    // transaction has been mined.
    TransactionStates["Included"] = "included";
    // transaction is confirmed.
    TransactionStates["Confirmed"] = "confirmed";
    // transaction is no longer in the mempool.
    TransactionStates["Dropped"] = "dropped";
    // transaction has been aborted because a new transaction with the same
    // nonce has been mined.
    TransactionStates["Aborted"] = "aborted";
    // transaction was in an unsubmitted state for too long.
    TransactionStates["Cancelled"] = "cancelled";
})(TransactionStates || (TransactionStates = {}));
let TransactionEntity = TransactionEntity_1 = class TransactionEntity {
    // HACK(oskar) we want all fields to be set and valid, otherwise we should
    // not accept a transaction entity, however because of this issue:
    // https://github.com/typeorm/typeorm/issues/1772 we cannot accept undefined
    // as an argument to the constructor, to not break migrations with
    // serialize. Please use the public static make method instead.
    constructor(opts = {
        refHash: '',
        txHash: '',
        to: '',
        data: '',
        apiKey: '',
        takerAddress: '',
        status: '',
        expectedMinedInSec: config_1.META_TXN_RELAY_EXPECTED_MINED_SEC,
        nonce: 0,
        gasPrice: constants_1.ZERO,
        value: constants_1.ZERO,
        from: '',
        gas: null,
        gasUsed: null,
        txStatus: null,
    }) {
        this.refHash = opts.refHash;
        this.txHash = opts.txHash;
        this.takerAddress = opts.takerAddress;
        this.to = opts.to;
        this.data = opts.data;
        this.apiKey = opts.apiKey;
        this.status = opts.status;
        this.expectedMinedInSec = opts.expectedMinedInSec;
        this.nonce = opts.nonce;
        this.gasPrice = opts.gasPrice;
        this.value = opts.value;
        this.blockNumber = opts.blockNumber;
        this.from = opts.from;
        this.gas = opts.gas;
        this.gasUsed = opts.gasUsed;
        this.txStatus = opts.txStatus;
        const now = new Date();
        this.expectedAt = new Date(now.getTime() + this.expectedMinedInSec * constants_1.ONE_SECOND_MS);
    }
    static make(opts) {
        assert_1.assert.isHexString('refHash', opts.refHash);
        if (opts.txHash !== undefined) {
            assert_1.assert.isHexString('txHash', opts.txHash);
        }
        if (opts.from !== undefined) {
            assert_1.assert.isETHAddressHex('from', opts.from);
        }
        assert_1.assert.doesBelongToStringEnum('status', opts.status, TransactionStates);
        if (opts.nonce !== undefined && !Number.isInteger(opts.nonce) && opts.nonce <= 0) {
            throw new Error(`Expected nonce to be a positive integer, encountered: ${opts.nonce}`);
        }
        if (opts.blockNumber !== undefined && !Number.isInteger(opts.blockNumber) && opts.blockNumber <= 0) {
            throw new Error(`Expected blockNumber to be a positive integer, encountered: ${opts.blockNumber}`);
        }
        return new TransactionEntity_1(opts);
    }
};
__decorate([
    (0, typeorm_1.PrimaryColumn)({ name: 'ref_hash', type: 'varchar' }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "refHash", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'data', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "data", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'to', type: 'varchar' }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "to", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'tx_hash', type: 'varchar', unique: true, nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "txHash", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'status', type: 'varchar' }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'taker_address', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "takerAddress", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'expected_mined_in_sec', type: 'int' }),
    __metadata("design:type", Number)
], TransactionEntity.prototype, "expectedMinedInSec", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'gas_price', type: 'bigint', nullable: true, transformer: transformers_1.BigNumberTransformer }),
    __metadata("design:type", utils_1.BigNumber)
], TransactionEntity.prototype, "gasPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'value', type: 'bigint', nullable: true, transformer: transformers_1.BigNumberTransformer }),
    __metadata("design:type", utils_1.BigNumber)
], TransactionEntity.prototype, "value", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'gas', type: 'int', nullable: true }),
    __metadata("design:type", Object)
], TransactionEntity.prototype, "gas", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'from', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "from", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'nonce', type: 'bigint', nullable: true, transformer: transformers_1.BigIntTransformer }),
    __metadata("design:type", Number)
], TransactionEntity.prototype, "nonce", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'gas_used', type: 'int', nullable: true }),
    __metadata("design:type", Object)
], TransactionEntity.prototype, "gasUsed", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'block_number', type: 'bigint', nullable: true, transformer: transformers_1.BigIntTransformer }),
    __metadata("design:type", Number)
], TransactionEntity.prototype, "blockNumber", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'tx_status', type: 'int', nullable: true }),
    __metadata("design:type", Object)
], TransactionEntity.prototype, "txStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'api_key', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "apiKey", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({ name: 'created_at', type: 'timestamptz' }),
    __metadata("design:type", Date)
], TransactionEntity.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)({ name: 'updated_at', type: 'timestamptz' }),
    __metadata("design:type", Date)
], TransactionEntity.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'expected_at', type: 'timestamptz' }),
    __metadata("design:type", Date)
], TransactionEntity.prototype, "expectedAt", void 0);
TransactionEntity = TransactionEntity_1 = __decorate([
    (0, typeorm_1.Entity)({ name: 'transactions' }),
    __metadata("design:paramtypes", [Object])
], TransactionEntity);
exports.TransactionEntity = TransactionEntity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy9lbnRpdGllcy9UcmFuc2FjdGlvbkVudGl0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsdUNBQW9DO0FBQ3BDLHFDQUFzQztBQUN0QyxxQ0FBNEY7QUFFNUYsc0NBQThEO0FBQzlELGlEQUF3RDtBQUV4RCxpREFBeUU7QUFHekUsSUFBSyxpQkFvQko7QUFwQkQsV0FBSyxpQkFBaUI7SUFDbEIsMEVBQTBFO0lBQzFFLGdEQUEyQixDQUFBO0lBQzNCLGlEQUFpRDtJQUNqRCw0Q0FBdUIsQ0FBQTtJQUN2QiwrQ0FBK0M7SUFDL0Msd0NBQW1CLENBQUE7SUFDbkIsdURBQXVEO0lBQ3ZELG9DQUFlLENBQUE7SUFDZiw4QkFBOEI7SUFDOUIsMENBQXFCLENBQUE7SUFDckIsNEJBQTRCO0lBQzVCLDRDQUF1QixDQUFBO0lBQ3ZCLDJDQUEyQztJQUMzQyx3Q0FBbUIsQ0FBQTtJQUNuQix1RUFBdUU7SUFDdkUsd0JBQXdCO0lBQ3hCLHdDQUFtQixDQUFBO0lBQ25CLHdEQUF3RDtJQUN4RCw0Q0FBdUIsQ0FBQTtBQUMzQixDQUFDLEVBcEJJLGlCQUFpQixLQUFqQixpQkFBaUIsUUFvQnJCO0FBR0QsSUFBYSxpQkFBaUIseUJBQTlCLE1BQWEsaUJBQWlCO0lBK0UxQiwwRUFBMEU7SUFDMUUsa0VBQWtFO0lBQ2xFLDRFQUE0RTtJQUM1RSxrRUFBa0U7SUFDbEUsK0RBQStEO0lBQy9ELFlBQ0ksT0FBOEI7UUFDMUIsT0FBTyxFQUFFLEVBQUU7UUFDWCxNQUFNLEVBQUUsRUFBRTtRQUNWLEVBQUUsRUFBRSxFQUFFO1FBQ04sSUFBSSxFQUFFLEVBQUU7UUFDUixNQUFNLEVBQUUsRUFBRTtRQUNWLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE1BQU0sRUFBRSxFQUFFO1FBQ1Ysa0JBQWtCLEVBQUUsMENBQWlDO1FBQ3JELEtBQUssRUFBRSxDQUFDO1FBQ1IsUUFBUSxFQUFFLGdCQUFJO1FBQ2QsS0FBSyxFQUFFLGdC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RUFBRSxhQUFhLEVBQUUsQ0FBQzs4QkFDM0MsSUFBSTtvREFBQztBQUd4QjtJQURDLElBQUEsMEJBQWdCLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsQ0FBQzs4QkFDM0MsSUFBSTtvREFBQztBQUd4QjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDOzhCQUNsQyxJQUFJO3FEQUFDO0FBM0RmLGlCQUFpQjtJQUQ3QixJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLENBQUM7O0dBQ3BCLGlCQUFpQixDQTBIN0I7QUExSFksOENBQWlCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS9zcmMvZW50aXRpZXMvVHJhbnNhY3Rpb25FbnRpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXNzZXJ0IH0gZnJvbSAnQDB4L2Fzc2VydCc7XHJcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ0AweC91dGlscyc7XHJcbmltcG9ydCB7IENvbHVtbiwgQ3JlYXRlRGF0ZUNvbHVtbiwgRW50aXR5LCBQcmltYXJ5Q29sdW1uLCBVcGRhdGVEYXRlQ29sdW1uIH0gZnJvbSAndHlwZW9ybSc7XHJcblxyXG5pbXBvcnQgeyBNRVRBX1RYTl9SRUxBWV9FWFBFQ1RFRF9NSU5FRF9TRUMgfSBmcm9tICcuLi9jb25maWcnO1xyXG5pbXBvcnQgeyBPTkVfU0VDT05EX01TLCBaRVJPIH0gZnJvbSAnLi4vY29yZS9jb25zdGFudHMnO1xyXG5cclxuaW1wb3J0IHsgQmlnSW50VHJhbnNmb3JtZXIsIEJpZ051bWJlclRyYW5zZm9ybWVyIH0gZnJvbSAnLi90cmFuc2Zvcm1lcnMnO1xyXG5pbXBvcnQgeyBUcmFuc2FjdGlvbkVudGl0eU9wdHMgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmVudW0gVHJhbnNhY3Rpb25TdGF0ZXMge1xyXG4gICAgLy8gdHJhbnNhY3Rpb24gaGFzIGJlZW4gY29uc3RydWN0ZWQsIGJ1dCBub3QgeWV0IHN1Ym1pdHRlZCB0byB0aGUgbmV0d29yay5cclxuICAgIFVuc3VibWl0dGVkID0gJ3Vuc3VibWl0dGVkJyxcclxuICAgIC8vIHRyYW5zYWN0aW9uIGhhcyBiZWVuIHN1Ym1pdHRlZCB0byB0aGUgbmV0d29yay5cclxuICAgIFN1Ym1pdHRlZCA9ICdzdWJtaXR0ZWQnLFxyXG4gICAgLy8gdHJhbnNhY3Rpb24gaGFzIGJlZW4gc3BvdHRlZCBpbiB0aGUgbWVtcG9vbC5cclxuICAgIE1lbXBvb2wgPSAnbWVtcG9vbCcsXHJcbiAgICAvLyB0cmFuc2FjdGlvbiBoYXMgbm90IGJlZW4gbWluZWQgaW4gdGhlIGV4cGVjdGVkIHRpbWUuXHJcbiAgICBTdHVjayA9ICdzdHVjaycsXHJcbiAgICAvLyB0cmFuc2FjdGlvbiBoYXMgYmVlbiBtaW5lZC5cclxuICAgIEluY2x1ZGVkID0gJ2luY2x1ZGVkJyxcclxuICAgIC8vIHRyYW5zYWN0aW9uIGlzIGNvbmZpcm1lZC5cclxuICAgIENvbmZpcm1lZCA9ICdjb25maXJtZWQnLFxyXG4gICAgLy8gdHJhbnNhY3Rpb24gaXMgbm8gbG9uZ2VyIGluIHRoZSBtZW1wb29sLlxyXG4gICAgRHJvcHBlZCA9ICdkcm9wcGVkJyxcclxuICAgIC8vIHRyYW5zYWN0aW9uIGhhcyBiZWVuIGFib3J0ZWQgYmVjYXVzZSBhIG5ldyB0cmFuc2FjdGlvbiB3aXRoIHRoZSBzYW1lXHJcbiAgICAvLyBub25jZSBoYXMgYmVlbiBtaW5lZC5cclxuICAgIEFib3J0ZWQgPSAnYWJvcnRlZCcsXHJcbiAgICAvLyB0cmFuc2FjdGlvbiB3YXMgaW4gYW4gdW5zdWJtaXR0ZWQgc3RhdGUgZm9yIHRvbyBsb25nLlxyXG4gICAgQ2FuY2VsbGVkID0gJ2NhbmNlbGxlZCcsXHJcbn1cclxuXHJcbkBFbnRpdHkoeyBuYW1lOiAndHJhbnNhY3Rpb25zJyB9KVxyXG5leHBvcnQgY2xhc3MgVHJhbnNhY3Rpb25FbnRpdHkge1xyXG4gICAgQFByaW1hcnlDb2x1bW4oeyBuYW1lOiAncmVmX2hhc2gnLCB0eXBlOiAndmFyY2hhcicgfSlcclxuICAgIC8vIHJlZmVyZW5jZSBoYXNoIGNhbiBiZSBlaXRoZXIgYmUgdGhlIHplcm9FeFRyYW5zYWN0aW9uIGhhc2ggb3IgdGhlIGFjdHVhbFxyXG4gICAgLy8gdHhIYXNoIGRlcGVuZGluZyBvbiB3aGV0aGVyIHdlIGFyZSBzdWJtaXR0aW5nIGEgbWV0YS10cmFuc2FjdGlvbiBvciBhblxyXG4gICAgLy8gdW5zdGlja2luZyBldGhlcmV1bSB0cmFuc2FjdGlvbi5cclxuICAgIHB1YmxpYyByZWZIYXNoOiBzdHJpbmc7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICdkYXRhJywgdHlwZTogJ3ZhcmNoYXInLCBudWxsYWJsZTogdHJ1ZSB9KVxyXG4gICAgcHVibGljIGRhdGE/OiBzdHJpbmc7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICd0bycsIHR5cGU6ICd2YXJjaGFyJyB9KVxyXG4gICAgcHVibGljIHRvPzogc3RyaW5nO1xyXG5cclxuICAgIEBDb2x1bW4oeyBuYW1lOiAndHhfaGFzaCcsIHR5cGU6ICd2YXJjaGFyJywgdW5pcXVlOiB0cnVlLCBudWxsYWJsZTogdHJ1ZSB9KVxyXG4gICAgcHVibGljIHR4SGFzaD86IHN0cmluZztcclxuXHJcbiAgICBAQ29sdW1uKHsgbmFtZTogJ3N0YXR1cycsIHR5cGU6ICd2YXJjaGFyJyB9KVxyXG4gICAgcHVibGljIHN0YXR1czogc3RyaW5nO1xyXG5cclxuICAgIEBDb2x1bW4oeyBuYW1lOiAndGFrZXJfYWRkcmVzcycsIHR5cGU6ICd2YXJjaGFyJywgbnVsbGFibGU6IHRydWUgfSlcclxuICAgIHB1YmxpYyB0YWtlckFkZHJlc3M/OiBzdHJpbmc7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICdleHBlY3RlZF9taW5lZF9pbl9zZWMnLCB0eXBlOiAnaW50JyB9KVxyXG4gICAgcHVibGljIGV4cGVjdGVkTWluZWRJblNlYz86IG51bWJlcjtcclxuXHJcbiAgICBAQ29sdW1uKHsgbmFtZTogJ2dhc19wcmljZScsIHR5cGU6ICdiaWdpbnQnLCBudWxsYWJsZTogdHJ1ZSwgdHJhbnNmb3JtZXI6IEJpZ051bWJlclRyYW5zZm9ybWVyIH0pXHJcbiAgICBwdWJsaWMgZ2FzUHJpY2U/OiBCaWdOdW1iZXI7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICd2YWx1ZScsIHR5cGU6ICdiaWdpbnQnLCBudWxsYWJsZTogdHJ1ZSwgdHJhbnNmb3JtZXI6IEJpZ051bWJlclRyYW5zZm9ybWVyIH0pXHJcbiAgICBwdWJsaWMgdmFsdWU/OiBCaWdOdW1iZXI7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICdnYXMnLCB0eXBlOiAnaW50JywgbnVsbGFibGU6IHRydWUgfSlcclxuICAgIHB1YmxpYyBnYXM/OiBudW1iZXIgfCBudWxsO1xyXG5cclxuICAgIEBDb2x1bW4oeyBuYW1lOiAnZnJvbScsIHR5cGU6ICd2YXJjaGFyJywgbnVsbGFibGU6IHRydWUgfSlcclxuICAgIHB1YmxpYyBmcm9tPzogc3RyaW5nO1xyXG5cclxuICAgIEBDb2x1bW4oeyBuYW1lOiAnbm9uY2UnLCB0eXBlOiAnYmlnaW50JywgbnVsbGFibGU6IHRydWUsIHRyYW5zZm9ybWVyOiBCaWdJbnRUcmFuc2Zvcm1lciB9KVxyXG4gICAgcHVibGljIG5vbmNlPzogbnVtYmVyO1xyXG5cclxuICAgIEBDb2x1bW4oeyBuYW1lOiAnZ2FzX3VzZWQnLCB0eXBlOiAnaW50JywgbnVsbGFibGU6IHRydWUgfSlcclxuICAgIHB1YmxpYyBnYXNVc2VkPzogbnVtYmVyIHwgbnVsbDtcclxuXHJcbiAgICBAQ29sdW1uKHsgbmFtZTogJ2Jsb2NrX251bWJlcicsIHR5cGU6ICdiaWdpbnQnLCBudWxsYWJsZTogdHJ1ZSwgdHJhbnNmb3JtZXI6IEJpZ0ludFRyYW5zZm9ybWVyIH0pXHJcbiAgICBwdWJsaWMgYmxvY2tOdW1iZXI/OiBudW1iZXI7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICd0eF9zdGF0dXMnLCB0eXBlOiAnaW50JywgbnVsbGFibGU6IHRydWUgfSlcclxuICAgIHB1YmxpYyB0eFN0YXR1cz86IG51bWJlciB8IG51bGw7XHJcblxyXG4gICAgQENvbHVtbih7IG5hbWU6ICdhcGlfa2V5JywgdHlwZTogJ3ZhcmNoYXInLCBudWxsYWJsZTogdHJ1ZSB9KVxyXG4gICAgcHVibGljIGFwaUtleT86IHN0cmluZztcclxuXHJcbiAgICBAQ3JlYXRlRGF0ZUNvbHVtbih7IG5hbWU6ICdjcmVhdGVkX2F0JywgdHlwZTogJ3RpbWVzdGFtcHR6JyB9KVxyXG4gICAgcHVibGljIGNyZWF0ZWRBdD86IERhdGU7XHJcblxyXG4gICAgQFVwZGF0ZURhdGVDb2x1bW4oeyBuYW1lOiAndXBkYXRlZF9hdCcsIHR5cGU6ICd0aW1lc3RhbXB0eicgfSlcclxuICAgIHB1YmxpYyB1cGRhdGVkQXQ/OiBEYXRlO1xyXG5cclxuICAgIEBDb2x1bW4oeyBuYW1lOiAnZXhwZWN0ZWRfYXQnLCB0eXBlOiAndGltZXN0YW1wdHonIH0pXHJcbiAgICBwdWJsaWMgZXhwZWN0ZWRBdDogRGF0ZTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIG1ha2Uob3B0czogVHJhbnNhY3Rpb25FbnRpdHlPcHRzKTogVHJhbnNhY3Rpb25FbnRpdHkge1xyXG4gICAgICAgIGFzc2VydC5pc0hleFN0cmluZygncmVmSGFzaCcsIG9wdHMucmVmSGFzaCk7XHJcbiAgICAgICAgaWYgKG9wdHMudHhIYXNoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgYXNzZXJ0LmlzSGV4U3RyaW5nKCd0eEhhc2gnLCBvcHRzLnR4SGFzaCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRzLmZyb20gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBhc3NlcnQuaXNFVEhBZGRyZXNzSGV4KCdmcm9tJywgb3B0cy5mcm9tKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXNzZXJ0LmRvZXNCZWxvbmdUb1N0cmluZ0VudW0oJ3N0YXR1cycsIG9wdHMuc3RhdHVzLCBUcmFuc2FjdGlvblN0YXRlcyk7XHJcbiAgICAgICAgaWYgKG9wdHMubm9uY2UgIT09IHVuZGVmaW5lZCAmJiAhTnVtYmVyLmlzSW50ZWdlcihvcHRzLm5vbmNlKSAmJiBvcHRzLm5vbmNlIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBub25jZSB0byBiZSBhIHBvc2l0aXZlIGludGVnZXIsIGVuY291bnRlcmVkOiAke29wdHMubm9uY2V9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRzLmJsb2NrTnVtYmVyICE9PSB1bmRlZmluZWQgJiYgIU51bWJlci5pc0ludGVnZXIob3B0cy5ibG9ja051bWJlcikgJiYgb3B0cy5ibG9ja051bWJlciA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgYmxvY2tOdW1iZXIgdG8gYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLCBlbmNvdW50ZXJlZDogJHtvcHRzLmJsb2NrTnVtYmVyfWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uRW50aXR5KG9wdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEhBQ0sob3NrYXIpIHdlIHdhbnQgYWxsIGZpZWxkcyB0byBiZSBzZXQgYW5kIHZhbGlkLCBvdGhlcndpc2Ugd2Ugc2hvdWxkXHJcbiAgICAvLyBub3QgYWNjZXB0IGEgdHJhbnNhY3Rpb24gZW50aXR5LCBob3dldmVyIGJlY2F1c2Ugb2YgdGhpcyBpc3N1ZTpcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS90eXBlb3JtL3R5cGVvcm0vaXNzdWVzLzE3NzIgd2UgY2Fubm90IGFjY2VwdCB1bmRlZmluZWRcclxuICAgIC8vIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSBjb25zdHJ1Y3RvciwgdG8gbm90IGJyZWFrIG1pZ3JhdGlvbnMgd2l0aFxyXG4gICAgLy8gc2VyaWFsaXplLiBQbGVhc2UgdXNlIHRoZSBwdWJsaWMgc3RhdGljIG1ha2UgbWV0aG9kIGluc3RlYWQuXHJcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIG9wdHM6IFRyYW5zYWN0aW9uRW50aXR5T3B0cyA9IHtcclxuICAgICAgICAgICAgcmVmSGFzaDogJycsXHJcbiAgICAgICAgICAgIHR4SGFzaDogJycsXHJcbiAgICAgICAgICAgIHRvOiAnJyxcclxuICAgICAgICAgICAgZGF0YTogJycsXHJcbiAgICAgICAgICAgIGFwaUtleTogJycsXHJcbiAgICAgICAgICAgIHRha2VyQWRkcmVzczogJycsXHJcbiAgICAgICAgICAgIHN0YXR1czogJycsXHJcbiAgICAgICAgICAgIGV4cGVjdGVkTWluZWRJblNlYzogTUVUQV9UWE5fUkVMQVlfRVhQRUNURURfTUlORURfU0VDLFxyXG4gICAgICAgICAgICBub25jZTogMCxcclxuICAgICAgICAgICAgZ2FzUHJpY2U6IFpFUk8sXHJcbiAgICAgICAgICAgIHZhbHVlOiBaRVJPLFxyXG4gICAgICAgICAgICBmcm9tOiAnJyxcclxuICAgICAgICAgICAgZ2FzOiBudWxsLFxyXG4gICAgICAgICAgICBnYXNVc2VkOiBudWxsLFxyXG4gICAgICAgICAgICB0eFN0YXR1czogbnVsbCxcclxuICAgICAgICB9LFxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5yZWZIYXNoID0gb3B0cy5yZWZIYXNoO1xyXG4gICAgICAgIHRoaXMudHhIYXNoID0gb3B0cy50eEhhc2g7XHJcbiAgICAgICAgdGhpcy50YWtlckFkZHJlc3MgPSBvcHRzLnRha2VyQWRkcmVzcztcclxuICAgICAgICB0aGlzLnRvID0gb3B0cy50bztcclxuICAgICAgICB0aGlzLmRhdGEgPSBvcHRzLmRhdGE7XHJcbiAgICAgICAgdGhpcy5hcGlLZXkgPSBvcHRzLmFwaUtleTtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IG9wdHMuc3RhdHVzO1xyXG4gICAgICAgIHRoaXMuZXhwZWN0ZWRNaW5lZEluU2VjID0gb3B0cy5leHBlY3RlZE1pbmVkSW5TZWM7XHJcbiAgICAgICAgdGhpcy5ub25jZSA9IG9wdHMubm9uY2U7XHJcbiAgICAgICAgdGhpcy5nYXNQcmljZSA9IG9wdHMuZ2FzUHJpY2U7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IG9wdHMudmFsdWU7XHJcbiAgICAgICAgdGhpcy5ibG9ja051bWJlciA9IG9wdHMuYmxvY2tOdW1iZXI7XHJcbiAgICAgICAgdGhpcy5mcm9tID0gb3B0cy5mcm9tO1xyXG4gICAgICAgIHRoaXMuZ2FzID0gb3B0cy5nYXM7XHJcbiAgICAgICAgdGhpcy5nYXNVc2VkID0gb3B0cy5nYXNVc2VkO1xyXG4gICAgICAgIHRoaXMudHhTdGF0dXMgPSBvcHRzLnR4U3RhdHVzO1xyXG4gICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdGhpcy5leHBlY3RlZEF0ID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIHRoaXMuZXhwZWN0ZWRNaW5lZEluU2VjICogT05FX1NFQ09ORF9NUyk7XHJcbiAgICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9