2b19fa2f0e128d69a0b671f7b8a01124
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getQuoteRpc = exports.getV2QuoteAsync = exports.getV1QuoteAsync = void 0;
const api_utils_1 = require("@0x/api-utils");
const asset_swapper_1 = require("@0x/asset-swapper");
const protocol_utils_1 = require("@0x/protocol-utils");
const utils_1 = require("@0x/utils");
const http_status_codes_1 = require("http-status-codes");
const config_1 = require("../config");
const constants_1 = require("../core/constants");
const errors_1 = require("../core/errors");
const meta_transaction_fee_utils_1 = require("../core/meta_transaction_fee_utils");
const meta_transaction_pb_1 = require("../proto-ts/meta_transaction.pb");
const types_1 = require("../services/types");
const ProtoUtils_1 = require("./ProtoUtils");
const rfqm_request_utils_1 = require("./rfqm_request_utils");
/**
 * Queries the MetaTransaction v1 service for an AMM quote wrapped in a
 * MetaTransaction.
 * If no AMM liquidity is available, returns `null`.
 *
 * If a prometheus 'Summary' is provided to the `requestDurationSummary`
 * parameter, the function will call its `observe` method with the request
 * duration in ms.
 *
 * @throws `AxiosError`
 */
async function getV1QuoteAsync(axiosInstance, url, params, meter, noLiquidityLogger) {
    const stopTimer = meter === null || meter === void 0 ? void 0 : meter.requestDurationSummary.startTimer({ chainId: meter.chainId });
    let response;
    try {
        response = await axiosInstance.get(url.toString(), {
            params,
            // TODO (rhinodavid): Formalize this value once we have a good idea of the
            // actual numbers
            timeout: 10000,
            paramsSerializer: (data) => {
                const result = new URLSearchParams({
                    buyToken: data.buyToken,
                    sellToken: data.sellToken,
                    takerAddress: data.takerAddress,
                    integratorId: data.integratorId,
                    chainId: data.chainId.toString(),
                });
                const { affiliateAddress, buyAmount: buyAmountData, sellAmount: sellAmountData, slippagePercentage, quoteUniqueId, } = data;
                affiliateAddress && result.append('affiliateAddress', affiliateAddress);
                buyAmountData && result.append('buyAmount', buyAmountData.toString());
                sellAmountData && result.append('sellAmount', sellAmountData.toString());
                slippagePercentage && result.append('slippagePercentage', slippagePercentage.toString());
                quoteUniqueId && result.append('quoteUniqueId', quoteUniqueId);
                return result.toString();
            },
        });
    }
    catch (e) {
        stopTimer && stopTimer({ success: 'false' });
        return handleQuoteError(e, params, noLiquidityLogger);
    }
    stopTimer && stopTimer({ success: 'true' });
    const { buyAmount, buyTokenAddress, gas, price, sellAmount, sellTokenAddress } = response.data;
    // A fun thing here is that the return from the API, @0x/types:ExchangeProxyMetaTransaction
    // does not match @0x/protocol-utils:MetaTransaction. So, we pull the domain information out
    // and put it at the top level of the constructor parameters
    return {
        metaTransaction: new protocol_utils_1.MetaTransaction({
            ...response.data.metaTransaction,
            chainId: response.data.metaTransaction.domain.chainId,
            verifyingContract: response.data.metaTransaction.domain.verifyingContract,
        }),
        price: { buyAmount, buyTokenAddress, gas, price, sellAmount, sellTokenAddress },
    };
}
exports.getV1QuoteAsync = getV1QuoteAsync;
/**
 * Queries the meta-transaction v2 service for a meta-transaction quote wrapped in a
 * meta-transaction.
 *
 * If no liquidity is available, returns `null`.
 *
 * If a prometheus 'Summary' is provided to the `requestDurationSummary`
 * parameter, the function will call its `observe` method with the request
 * duration in ms.
 *
 * @throws `AxiosError`
 */
async function getV2QuoteAsync(axiosInstance, url, params, meter, noLiquidityLogger) {
    const stopTimer = meter === null || meter === void 0 ? void 0 : meter.requestDurationSummary.startTimer({ chainId: meter.chainId });
    let response;
    try {
        response = await axiosInstance.post(url.toString(), params);
    }
    catch (e) {
        stopTimer && stopTimer({ success: 'false' });
        return handleQuoteError(e, params, noLiquidityLogger);
    }
    stopTimer && stopTimer({ success: 'true' });
    const { buyAmount, buyTokenAddress, gas, price, sellAmount, sellTokenAddress } = response.data;
    return {
        // TODO: This needs to be updated to the new meta-transaction type when smart contract changes are finished and corresponding types are published in packages
        metaTransaction: new types_1.MetaTransactionV2((0, rfqm_request_utils_1.stringsToMetaTransactionFields)({
            ...response.data.metaTransaction,
            chainId: response.data.metaTransaction.domain.chainId,
            verifyingContract: response.data.metaTransaction.domain.verifyingContract,
        })),
        price: {
            buyAmount: new utils_1.BigNumber(buyAmount),
            buyTokenAddress,
            gas: new utils_1.BigNumber(gas),
            price: new utils_1.BigNumber(price),
            sellAmount: new utils_1.BigNumber(sellAmount),
            sellTokenAddress,
        },
        sources: response.data.sources
            .map((source) => {
            return {
                ...source,
                proportion: new utils_1.BigNumber(source.proportion),
            };
        })
            .filter((source) => source.proportion.gt(constants_1.ZERO)),
        fees: (0, meta_transaction_fee_utils_1.rawFeesToFees)(response.data.fees),
    };
}
exports.getV2QuoteAsync = getV2QuoteAsync;
/**
 * Internal function to handle meta-transaction quote responses.
 *
 * @returns Null if it's no liquidty error.
 */
function handleQuoteError(e, // eslint-disable-line @typescript-eslint/no-explicit-any
params, noLiquidityLogger) {
    var _a, _b, _c, _d, _f, _g, _h, _j, _k, _l, _m;
    if ((_a = e.response) === null || _a === void 0 ? void 0 : _a.data) {
        const axiosError = e;
        //  The response for no liquidity is a 400 status with a body like:
        //  {
        //     "code": 100,
        //     "reason": "Validation Failed",
        //     "validationErrors": [
        //       {
        //         "field": "sellAmount",
        //         "code": 1004,
        //         "reason": "INSUFFICIENT_ASSET_LIQUIDITY"
        //       }
        //     ]
        //   }
        if (((_b = axiosError.response) === null || _b === void 0 ? void 0 : _b.status) === http_status_codes_1.BAD_REQUEST &&
            ((_f = (_d = (_c = axiosError.response) === null || _c === void 0 ? void 0 : _c.data) === null || _d === void 0 ? void 0 : _d.validationErrors) === null || _f === void 0 ? void 0 : _f.length) === 1 &&
            ((_j = (_h = (_g = axiosError.response) === null || _g === void 0 ? void 0 : _g.data) === null || _h === void 0 ? void 0 : _h.validationErrors) === null || _j === void 0 ? void 0 : _j.map((v) => v.reason).includes(asset_swapper_1.SwapQuoterError.InsufficientAssetLiquidity))) {
            // Looks like there is no liquidity for the quote...
            noLiquidityLogger &&
                noLiquidityLogger({ ammQuoteRequestParams: params }, `[MetaTransactionClient] No liquidity returned for pair`);
            return null;
        }
        // The response for insufficient fund error (primarily caused by trading amount is less than the fee)
        // is a 400 status and with a body like:
        // {
        //      "code": 109,
        //      "reason": "Insufficient funds for transaction"
        // }
        if (((_k = axiosError.response) === null || _k === void 0 ? void 0 : _k.status) === http_status_codes_1.BAD_REQUEST &&
            ((_m = (_l = axiosError.response) === null || _l === void 0 ? void 0 : _l.data) === null || _m === void 0 ? void 0 : _m.code) === errors_1.APIErrorCodes.InsufficientFundsError) {
            if (params.sellAmount) {
                throw new api_utils_1.ValidationError([
                    {
                        field: 'sellAmount',
                        code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                        reason: 'sellAmount too small',
                    },
                ]);
            }
            throw new api_utils_1.ValidationError([
                {
                    field: 'buyAmount',
                    code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                    reason: 'buyAmount too small',
                },
            ]);
        }
    }
    // This error is neither the standard no liquidity error nor the insufficient fund error
    throw e;
}
/**
 * Queries the MetaTransaction RPC service for an AMM quote wrapped in a
 * MetaTransaction.
 * If no AMM liquidity is available, returns `null`.
 *
 * If a prometheus 'Summary' is provided to the `requestDurationSummary`
 * parameter, the function will call its `observe` method with the request
 * duration in ms.
 */
async function getQuoteRpc(params, meter, noLiquidityLogger) {
    var _a, _b, _c, _d, _f, _g;
    const stopTimer = meter === null || meter === void 0 ? void 0 : meter.requestDurationSummary.startTimer({ chainId: meter.chainId });
    let response;
    try {
        // TODO (rhinodavid): Figure out how to set a timeout
        response = await (0, meta_transaction_pb_1.GetQuote)({
            affiliateAddress: params.affiliateAddress,
            buyAmount: params.buyAmount ? (0, ProtoUtils_1.bigNumberToProto)(params.buyAmount) : undefined,
            buyTokenAddress: params.buyToken,
            chainId: params.chainId,
            integratorId: params.integratorId,
            quoteUniqueId: params.quoteUniqueId,
            sellAmount: params.sellAmount ? (0, ProtoUtils_1.bigNumberToProto)(params.sellAmount) : undefined,
            sellTokenAddress: params.sellToken,
            slippagePercentage: params.slippagePercentage ? (0, ProtoUtils_1.bigNumberToProto)(params.slippagePercentage) : undefined,
            takerAddress: params.takerAddress,
        }, { baseURL: config_1.META_TRANSACTION_SERVICE_RPC_URL });
    }
    catch (_e) {
        stopTimer && stopTimer({ success: 'false' });
        /**
         * Error handling:
         *
         * Twirp throws an error of the following type:
         * export interface TwirpError {
         *   code: ErrorCode;
         *   msg: string;
         *   meta?: Record<string, string>;
         * }
         *
         * To support the current error codes, we type `meta` as:
         *  meta: {
         *     zeroexErrorCode?: APIErrorCodes,
         *     validationErrors: JSON.stringify(ValidationErrorItem[])
         *  }
         */
        const e = _e;
        const zeroexErrorCode = Number.isNaN(parseInt((_b = (_a = e.meta) === null || _a === void 0 ? void 0 : _a.zeroexErrorCode) !== null && _b !== void 0 ? _b : ''))
            ? null
            : parseInt((_d = (_c = e.meta) === null || _c === void 0 ? void 0 : _c.zeroexErrorCode) !== null && _d !== void 0 ? _d : '');
        const validationErrors = JSON.parse((_g = (_f = e.meta) === null || _f === void 0 ? void 0 : _f.validationErrors) !== null && _g !== void 0 ? _g : '[]');
        if ((validationErrors === null || validationErrors === void 0 ? void 0 : validationErrors.length) === 1 &&
            (validationErrors === null || validationErrors === void 0 ? void 0 : validationErrors.map((v) => v.reason).includes(asset_swapper_1.SwapQuoterError.InsufficientAssetLiquidity))) {
            // Looks like there is no liquidity for the quote...
            noLiquidityLogger &&
                noLiquidityLogger({ ammQuoteRequestParams: params }, `[MetaTransactionClient] No liquidity returned for pair`);
            return null;
        }
        // The response for insufficient fund error (primarily caused by trading amount is less than the fee)
        // is a zeroexGeneralErrorCode `InsufficientFundsError`
        if (zeroexErrorCode === errors_1.APIErrorCodes.InsufficientFundsError) {
            if (params.sellAmount) {
                throw new api_utils_1.ValidationError([
                    {
                        field: 'sellAmount',
                        code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                        reason: 'sellAmount too small',
                    },
                ]);
            }
            throw new api_utils_1.ValidationError([
                {
                    field: 'buyAmount',
                    code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                    reason: 'buyAmount too small',
                },
            ]);
        }
        // This error is neither the standard no liquidity error nor the insufficient fund error
        throw e;
    }
    stopTimer && stopTimer({ success: 'true' });
    return {
        metaTransaction: new protocol_utils_1.MetaTransaction({
            signer: response.metaTransaction.signerAddress,
            sender: response.metaTransaction.senderAddress,
            minGasPrice: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.minGasPrice),
            maxGasPrice: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.maxGasPrice),
            expirationTimeSeconds: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.expirationTimeSeconds),
            salt: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.salt),
            callData: response.metaTransaction.callData,
            value: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.value),
            feeToken: response.metaTransaction.feeTokenAddress,
            feeAmount: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.feeAmount),
            chainId: response.metaTransaction.chainId,
            verifyingContract: response.metaTransaction.verifyingContract,
        }),
        price: {
            buyAmount: (0, ProtoUtils_1.protoToBigNumber)(response.quote.buyAmount),
            buyTokenAddress: response.quote.buyTokenAddress,
            gas: (0, ProtoUtils_1.protoToBigNumber)(response.quote.gas),
            price: (0, ProtoUtils_1.protoToBigNumber)(response.quote.price),
            sellAmount: (0, ProtoUtils_1.protoToBigNumber)(response.quote.sellAmount),
            sellTokenAddress: response.quote.sellTokenAddress,
        },
    };
}
exports.getQuoteRpc = getQuoteRpc;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9NZXRhVHJhbnNhY3Rpb25DbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQWlHO0FBQ2pHLHFEQUFvRDtBQUNwRCx1REFBcUQ7QUFFckQscUNBQXNDO0FBRXRDLHlEQUFnRDtBQUdoRCxzQ0FBNkQ7QUFDN0QsaURBQXlDO0FBQ3pDLDJDQUErQztBQUMvQyxtRkFBbUU7QUFFbkUseUVBQTZFO0FBRTdFLDZDQUFxRztBQUNyRyw2Q0FBa0U7QUFDbEUsNkRBQXNFO0FBK0Z0RTs7Ozs7Ozs7OztHQVVHO0FBQ0ksS0FBSyxVQUFVLGVBQWUsQ0FDakMsYUFBNEIsRUFDNUIsR0FBUSxFQUNSLE1BQW1CLEVBQ25CLEtBQW1GLEVBQ25GLGlCQUE4QjtJQUU5QixNQUFNLFNBQVMsR0FBRyxLQUFLLGFBQUwsS0FBSyx1QkFBTCxLQUFLLENBQUUsc0JBQXNCLENBQUMsVUFBVSxDQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBRXZGLElBQUksUUFBd0QsQ0FBQztJQUM3RCxJQUFJO1FBQ0EsUUFBUSxHQUFHLE1BQU0sYUFBYSxDQUFDLEdBQUcsQ0FBa0MsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ2hGLE1BQU07WUFDTiwwRUFBMEU7WUFDMUUsaUJBQWlCO1lBQ2pCLE9BQU8sRUFBRSxLQUFLO1lBQ2QsZ0JBQWdCLEVBQUUsQ0FBQyxJQUFtQixFQUFFLEVBQUU7Z0JBQ3RDLE1BQU0sTUFBTSxHQUFHLElBQUksZUFBZSxDQUFDO29CQUMvQixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7b0JBQ3ZCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztvQkFDekIsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZO29CQUMvQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7b0JBQy9CLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRTtpQkFDbkMs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QS9IRCxrQ0ErSEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9NZXRhVHJhbnNhY3Rpb25DbGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGlubywgVmFsaWRhdGlvbkVycm9yLCBWYWxpZGF0aW9uRXJyb3JDb2RlcywgVmFsaWRhdGlvbkVycm9ySXRlbSB9IGZyb20gJ0AweC9hcGktdXRpbHMnO1xyXG5pbXBvcnQgeyBTd2FwUXVvdGVyRXJyb3IgfSBmcm9tICdAMHgvYXNzZXQtc3dhcHBlcic7XHJcbmltcG9ydCB7IE1ldGFUcmFuc2FjdGlvbiB9IGZyb20gJ0AweC9wcm90b2NvbC11dGlscyc7XHJcbmltcG9ydCB7IEV4Y2hhbmdlUHJveHlNZXRhVHJhbnNhY3Rpb24gfSBmcm9tICdAMHgvdHlwZXMnO1xyXG5pbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdAMHgvdXRpbHMnO1xyXG5pbXBvcnQgeyBBeGlvc0Vycm9yLCBBeGlvc0luc3RhbmNlLCBBeGlvc1Jlc3BvbnNlIH0gZnJvbSAnYXhpb3MnO1xyXG5pbXBvcnQgeyBCQURfUkVRVUVTVCB9IGZyb20gJ2h0dHAtc3RhdHVzLWNvZGVzJztcclxuaW1wb3J0IHsgU3VtbWFyeSB9IGZyb20gJ3Byb20tY2xpZW50JztcclxuaW1wb3J0IHsgVHdpcnBFcnJvciB9IGZyb20gJ3R3aXJwc2NyaXB0JztcclxuaW1wb3J0IHsgTUVUQV9UUkFOU0FDVElPTl9TRVJWSUNFX1JQQ19VUkwgfSBmcm9tICcuLi9jb25maWcnO1xyXG5pbXBvcnQgeyBaRVJPIH0gZnJvbSAnLi4vY29yZS9jb25zdGFudHMnO1xyXG5pbXBvcnQgeyBBUElFcnJvckNvZGVzIH0gZnJvbSAnLi4vY29yZS9lcnJvcnMnO1xyXG5pbXBvcnQgeyByYXdGZWVzVG9GZWVzIH0gZnJvbSAnLi4vY29yZS9tZXRhX3RyYW5zYWN0aW9uX2ZlZV91dGlscyc7XHJcbmltcG9ydCB7IEZlZUNvbmZpZ3MsIEZlZXMsIFJhd0ZlZXMgfSBmcm9tICcuLi9jb3JlL3R5cGVzL21ldGFfdHJhbnNhY3Rpb25fZmVlcyc7XHJcbmltcG9ydCB7IEdldFF1b3RlLCBHZXRRdW90ZVJlc3BvbnNlIH0gZnJvbSAnLi4vcHJvdG8tdHMvbWV0YV90cmFuc2FjdGlvbi5wYic7XHJcblxyXG5pbXBvcnQgeyBGZXRjaEluZGljYXRpdmVRdW90ZVJlc3BvbnNlLCBMaXF1aWRpdHlTb3VyY2UsIE1ldGFUcmFuc2FjdGlvblYyIH0gZnJvbSAnLi4vc2VydmljZXMvdHlwZXMnO1xyXG5pbXBvcnQgeyBiaWdOdW1iZXJUb1Byb3RvLCBwcm90b1RvQmlnTnVtYmVyIH0gZnJvbSAnLi9Qcm90b1V0aWxzJztcclxuaW1wb3J0IHsgc3RyaW5nc1RvTWV0YVRyYW5zYWN0aW9uRmllbGRzIH0gZnJvbSAnLi9yZnFtX3JlcXVlc3RfdXRpbHMnO1xyXG5cclxuaW50ZXJmYWNlIFF1b3RlUGFyYW1zIHtcclxuICAgIGFmZmlsaWF0ZUFkZHJlc3M/OiBzdHJpbmc7XHJcbiAgICBjaGFpbklkOiBudW1iZXI7XHJcbiAgICBidXlBbW91bnQ/OiBCaWdOdW1iZXI7XHJcbiAgICBidXlUb2tlbjogc3RyaW5nO1xyXG4gICAgaW50ZWdyYXRvcklkOiBzdHJpbmc7XHJcbiAgICBzZWxsQW1vdW50PzogQmlnTnVtYmVyO1xyXG4gICAgc2VsbFRva2VuOiBzdHJpbmc7XHJcbiAgICBzbGlwcGFnZVBlcmNlbnRhZ2U/OiBCaWdOdW1iZXI7XHJcbiAgICB0YWtlckFkZHJlc3M6IHN0cmluZztcclxuICAgIHF1b3RlVW5pcXVlSWQ/OiBzdHJpbmc7IC8vIElEIHRvIHVzZSBmb3IgdGhlIHF1b3RlIHJlcG9ydCBgZGVjb2RlZFVuaXF1ZUlkYFxyXG4gICAgZmVlQ29uZmlncz86IEZlZUNvbmZpZ3M7XHJcbn1cclxuXHJcbi8vIFR5cGVzXHJcbi8vXHJcbi8vIE5PVEU6IFRoZXNlIHR5cGVzIGFyZSBjb3BpZWQgaGVyZSBmcm9tIDB4IEFQSS4gT25jZSB3ZSBoYXZlXHJcbi8vIGEgc29sdXRpb24gZm9yIGEgcmVhbCBzZXJ2aWNlIGFyY2hpdGVjdHVyZSwgdGhlc2UgdHlwZXMgc2hvdWxkXHJcbi8vIGJlY29tZSBwYXJ0IG9mIHRoZSBSUEMgaW50ZXJmYWNlIHB1Ymxpc2hlZCBieSBhIGZ1dHVyZVxyXG4vLyBNZXRhVHJhbnNhY3Rpb25TZXJ2aWNlLiBBbHNvIHdlIHdpbGwgbWFrZSBpdCBNZXRhdHJhbnNhY3Rpb25TZXJ2aWNlLlxyXG5cclxuaW50ZXJmYWNlIFF1b3RlQmFzZSB7XHJcbiAgICBjaGFpbklkOiBudW1iZXI7XHJcbiAgICBwcmljZTogQmlnTnVtYmVyO1xyXG4gICAgYnV5QW1vdW50OiBCaWdOdW1iZXI7XHJcbiAgICBzZWxsQW1vdW50OiBCaWdOdW1iZXI7XHJcbiAgICBzb3VyY2VzOiBMaXF1aWRpdHlTb3VyY2VbXTtcclxuICAgIGdhc1ByaWNlOiBCaWdOdW1iZXI7XHJcbiAgICBlc3RpbWF0ZWRHYXM6IEJpZ051bWJlcjtcclxuICAgIHNlbGxUb2tlblRvRXRoUmF0ZTogQmlnTnVtYmVyO1xyXG4gICAgYnV5VG9rZW5Ub0V0aFJhdGU6IEJpZ051bWJlcjtcclxuICAgIHByb3RvY29sRmVlOiBCaWdOdW1iZXI7XHJcbiAgICBtaW5pbXVtUHJvdG9jb2xGZWU6IEJpZ051bWJlcjtcclxuICAgIGFsbG93YW5jZVRhcmdldD86IHN0cmluZztcclxuICAgIC8vIE91ciBjYWxjdWxhdGVkIHByaWNlIGltcGFjdCBvciBudWxsIGlmIHdlIHdlcmUgdW5hYmxlIHRvXHJcbiAgICAvLyB0byBjYWxjdWxhdGUgYW55IHByaWNlIGltcGFjdFxyXG4gICAgZXN0aW1hdGVkUHJpY2VJbXBhY3Q6IEJpZ051bWJlciB8IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVByaWNlUmVzcG9uc2UgZXh0ZW5kcyBRdW90ZUJhc2Uge1xyXG4gICAgc2VsbFRva2VuQWRkcmVzczogc3RyaW5nO1xyXG4gICAgYnV5VG9rZW5BZGRyZXNzOiBzdHJpbmc7XHJcbiAgICB2YWx1ZTogQmlnTnVtYmVyO1xyXG4gICAgZ2FzOiBCaWdOdW1iZXI7XHJcbn1cclxuXHJcbmludGVyZmFjZSBHZXRNZXRhVHJhbnNhY3Rpb25RdW90ZVJlc3BvbnNlIGV4dGVuZHMgQmFzZVByaWNlUmVzcG9uc2Uge1xyXG4gICAgbWV0YVRyYW5zYWN0aW9uSGFzaDogc3RyaW5nO1xyXG4gICAgbWV0YVRyYW5zYWN0aW9uOiBFeGNoYW5nZVByb3h5TWV0YVRyYW5zYWN0aW9uO1xyXG59XHJcblxyXG4vLyBSYXcgdHlwZSBvZiBgUXVvdGVCYXNlYCBhcyB0aGUgcXVvdGUgcmVzcG9uc2Ugc2VudCBieSBtZXRhLXRyYW5zYWN0aW9uIGVuZHBvaW50cyBpcyBzZXJpYWxpemVkLlxyXG5pbnRlcmZhY2UgUmF3UXVvdGVCYXNlIHtcclxuICAgIGNoYWluSWQ6IG51bWJlcjtcclxuICAgIHByaWNlOiBzdHJpbmc7XHJcbiAgICBidXlBbW91bnQ6IHN0cmluZztcclxuICAgIHNlbGxBbW91bnQ6IHN0cmluZztcclxuICAgIHNvdXJjZXM6IHtcclxuICAgICAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAgICAgcHJvcG9ydGlvbjogc3RyaW5nO1xyXG4gICAgICAgIGludGVybWVkaWF0ZVRva2VuPzogc3RyaW5nO1xyXG4gICAgICAgIGhvcHM/OiBzdHJpbmdbXTtcclxuICAgIH1bXTtcclxuICAgIGdhc1ByaWNlOiBzdHJpbmc7XHJcbiAgICBlc3RpbWF0ZWRHYXM6IHN0cmluZztcclxuICAgIHNlbGxUb2tlblRvRXRoUmF0ZTogc3RyaW5nO1xyXG4gICAgYnV5VG9rZW5Ub0V0aFJhdGU6IHN0cmluZztcclxuICAgIHByb3RvY29sRmVlOiBzdHJpbmc7XHJcbiAgICBtaW5pbXVtUHJvdG9jb2xGZWU6IHN0cmluZztcclxuICAgIGFsbG93YW5jZVRhcmdldD86IHN0cmluZztcclxuICAgIC8vIE91ciBjYWxjdWxhdGVkIHByaWNlIGltcGFjdCBvciBudWxsIGlmIHdlIHdlcmUgdW5hYmxlIHRvXHJcbiAgICAvLyB0byBjYWxjdWxhdGUgYW55IHByaWNlIGltcGFjdFxyXG4gICAgZXN0aW1hdGVkUHJpY2VJbXBhY3Q6IHN0cmluZyB8IG51bGw7XHJcbn1cclxuXHJcbi8vIFJhdyB0eXBlIG9mIGBCYXNlUHJpY2VSZXNwb25zZWAgYXMgdGhlIHF1b3RlIHJlc3BvbnNlIHNlbnQgYnkgbWV0YS10cmFuc2FjdGlvbiBlbmRwb2ludHMgaXMgc2VyaWFsaXplZC5cclxuaW50ZXJmYWNlIFJhd0Jhc2VQcmljZVJlc3BvbnNlIGV4dGVuZHMgUmF3UXVvdGVCYXNlIHtcclxuICAgIHNlbGxUb2tlbkFkZHJlc3M6IHN0cmluZztcclxuICAgIGJ1eVRva2VuQWRkcmVzczogc3RyaW5nO1xyXG4gICAgdmFsdWU6IHN0cmluZztcclxuICAgIGdhczogc3RyaW5nO1xyXG59XHJcblxyXG4vLyBRdW90ZSByZXNwb25zZSBzZW50IGJ5IG1ldGEtdHJhbnNhY3Rpb24gdjIgL3F1b3RlIGVuZHBvaW50XHJcbmludGVyZmFjZSBHZXRNZXRhVHJhbnNhY3Rpb25WMlF1b3RlUmVzcG9uc2UgZXh0ZW5kcyBSYXdCYXNlUHJpY2VSZXNwb25zZSB7XHJcbiAgICBtZXRhVHJhbnNhY3Rpb25IYXNoOiBzdHJpbmc7XHJcbiAgICAvLyBUT0RPOiBUaGlzIG5lZWRzIHRvIGJlIHVwZGF0ZWQgd2hlbiB0aGUgc21hcnQgY29udHJhY3QgY2hhbmdlIGlzIGZpbmlzaGVkIGFuZCB0aGUgbmV3IHR5cGUgaXMgcHVibGlzaGVkXHJcbiAgICBtZXRhVHJhbnNhY3Rpb246IFJlY29yZDxrZXlvZiBPbWl0PEV4Y2hhbmdlUHJveHlNZXRhVHJhbnNhY3Rpb24sICdkb21haW4nPiwgc3RyaW5nPiAmIHtcclxuICAgICAgICBkb21haW46IHsgY2hhaW5JZDogbnVtYmVyOyB2ZXJpZnlpbmdDb250cmFjdDogc3RyaW5nIH07XHJcbiAgICB9O1xyXG4gICAgZmVlcz86IFJhd0ZlZXM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBRdWVyaWVzIHRoZSBNZXRhVHJhbnNhY3Rpb24gdjEgc2VydmljZSBmb3IgYW4gQU1NIHF1b3RlIHdyYXBwZWQgaW4gYVxyXG4gKiBNZXRhVHJhbnNhY3Rpb24uXHJcbiAqIElmIG5vIEFNTSBsaXF1aWRpdHkgaXMgYXZhaWxhYmxlLCByZXR1cm5zIGBudWxsYC5cclxuICpcclxuICogSWYgYSBwcm9tZXRoZXVzICdTdW1tYXJ5JyBpcyBwcm92aWRlZCB0byB0aGUgYHJlcXVlc3REdXJhdGlvblN1bW1hcnlgXHJcbiAqIHBhcmFtZXRlciwgdGhlIGZ1bmN0aW9uIHdpbGwgY2FsbCBpdHMgYG9ic2VydmVgIG1ldGhvZCB3aXRoIHRoZSByZXF1ZXN0XHJcbiAqIGR1cmF0aW9uIGluIG1zLlxyXG4gKlxyXG4gKiBAdGhyb3dzIGBBeGlvc0Vycm9yYFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFYxUXVvdGVBc3luYyhcclxuICAgIGF4aW9zSW5zdGFuY2U6IEF4aW9zSW5zdGFuY2UsXHJcbiAgICB1cmw6IFVSTCxcclxuICAgIHBhcmFtczogUXVvdGVQYXJhbXMsXHJcbiAgICBtZXRlcj86IHsgcmVxdWVzdER1cmF0aW9uU3VtbWFyeTogU3VtbWFyeTwnY2hhaW5JZCcgfCAnc3VjY2Vzcyc+OyBjaGFpbklkOiBudW1iZXIgfSxcclxuICAgIG5vTGlxdWlkaXR5TG9nZ2VyPzogcGluby5Mb2dGbixcclxuKTogUHJvbWlzZTx7IG1ldGFUcmFuc2FjdGlvbjogTWV0YVRyYW5zYWN0aW9uOyBwcmljZTogRmV0Y2hJbmRpY2F0aXZlUXVvdGVSZXNwb25zZSB9IHwgbnVsbD4ge1xyXG4gICAgY29uc3Qgc3RvcFRpbWVyID0gbWV0ZXI/LnJlcXVlc3REdXJhdGlvblN1bW1hcnkuc3RhcnRUaW1lcih7IGNoYWluSWQ6IG1ldGVyLmNoYWluSWQgfSk7XHJcblxyXG4gICAgbGV0IHJlc3BvbnNlOiBBeGlvc1Jlc3BvbnNlPEdldE1ldGFUcmFuc2FjdGlvblF1b3RlUmVzcG9uc2U+O1xyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXNwb25zZSA9IGF3YWl0IGF4aW9zSW5zdGFuY2UuZ2V0PEdldE1ldGFUcmFuc2FjdGlvblF1b3RlUmVzcG9uc2U+KHVybC50b1N0cmluZygpLCB7XHJcbiAgICAgICAgICAgIHBhcmFtcyxcclxuICAgICAgICAgICAgLy8gVE9ETyAocmhpbm9kYXZpZCk6IEZvcm1hbGl6ZSB0aGlzIHZhbHVlIG9uY2Ugd2UgaGF2ZSBhIGdvb2QgaWRlYSBvZiB0aGVcclxuICAgICAgICAgICAgLy8gYWN0dWFsIG51bWJlcnNcclxuICAgICAgICAgICAgdGltZW91dDogMTAwMDAsXHJcbiAgICAgICAgICAgIHBhcmFtc1NlcmlhbGl6ZXI6IChkYXRhOiB0eXBlb2YgcGFyYW1zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcclxuICAgICAgICAgICAgICAgICAgICBidXlUb2tlbjogZGF0YS5idXlUb2tlbixcclxuICAgICAgICAgICAgICAgICAgICBzZWxsVG9rZW46IGRhdGEuc2VsbFRva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgIHRha2VyQWRkcmVzczogZGF0YS50YWtlckFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgaW50ZWdyYXRvcklkOiBkYXRhLmludGVncmF0b3JJZCxcclxuICAgICAgICAgICAgICAgICAgICBjaGFpbklkOiBkYXRhLmNoYWluSWQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICAgICAgICAgIGFmZmlsaWF0ZUFkZHJlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgYnV5QW1vdW50OiBidXlBbW91bnREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGxBbW91bnQ6IHNlbGxBbW91bnREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHNsaXBwYWdlUGVyY2VudGFnZSxcclxuICAgICAgICAgICAgICAgICAgICBxdW90ZVVuaXF1ZUlkLFxyXG4gICAgICAgICAgICAgICAgfSA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgYWZmaWxpYXRlQWRkcmVzcyAmJiByZXN1bHQuYXBwZW5kKCdhZmZpbGlhdGVBZGRyZXNzJywgYWZmaWxpYXRlQWRkcmVzcyk7XHJcbiAgICAgICAgICAgICAgICBidXlBbW91bnREYXRhICYmIHJlc3VsdC5hcHBlbmQoJ2J1eUFtb3VudCcsIGJ1eUFtb3VudERhdGEudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICBzZWxsQW1vdW50RGF0YSAmJiByZXN1bHQuYXBwZW5kKCdzZWxsQW1vdW50Jywgc2VsbEFtb3VudERhdGEudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICBzbGlwcGFnZVBlcmNlbnRhZ2UgJiYgcmVzdWx0LmFwcGVuZCgnc2xpcHBhZ2VQZXJjZW50YWdlJywgc2xpcHBhZ2VQZXJjZW50YWdlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgcXVvdGVVbmlxdWVJZCAmJiByZXN1bHQuYXBwZW5kKCdxdW90ZVVuaXF1ZUlkJywgcXVvdGVVbmlxdWVJZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHN0b3BUaW1lciAmJiBzdG9wVGltZXIoeyBzdWNjZXNzOiAnZmFsc2UnIH0pO1xyXG4gICAgICAgIHJldHVybiBoYW5kbGVRdW90ZUVycm9yKGUsIHBhcmFtcywgbm9MaXF1aWRpdHlMb2dnZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0b3BUaW1lciAmJiBzdG9wVGltZXIoeyBzdWNjZXNzOiAndHJ1ZScgfSk7XHJcblxyXG4gICAgY29uc3QgeyBidXlBbW91bnQsIGJ1eVRva2VuQWRkcmVzcywgZ2FzLCBwcmljZSwgc2VsbEFtb3VudCwgc2VsbFRva2VuQWRkcmVzcyB9ID0gcmVzcG9uc2UuZGF0YTtcclxuXHJcbiAgICAvLyBBIGZ1biB0aGluZyBoZXJlIGlzIHRoYXQgdGhlIHJldHVybiBmcm9tIHRoZSBBUEksIEAweC90eXBlczpFeGNoYW5nZVByb3h5TWV0YVRyYW5zYWN0aW9uXHJcbiAgICAvLyBkb2VzIG5vdCBtYXRjaCBAMHgvcHJvdG9jb2wtdXRpbHM6TWV0YVRyYW5zYWN0aW9uLiBTbywgd2UgcHVsbCB0aGUgZG9tYWluIGluZm9ybWF0aW9uIG91dFxyXG4gICAgLy8gYW5kIHB1dCBpdCBhdCB0aGUgdG9wIGxldmVsIG9mIHRoZSBjb25zdHJ1Y3RvciBwYXJhbWV0ZXJzXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG1ldGFUcmFuc2FjdGlvbjogbmV3IE1ldGFUcmFuc2FjdGlvbih7XHJcbiAgICAgICAgICAgIC4uLnJlc3BvbnNlLmRhdGEubWV0YVRyYW5zYWN0aW9uLFxyXG4gICAgICAgICAgICBjaGFpbklkOiByZXNwb25zZS5kYXRhLm1ldGFUcmFuc2FjdGlvbi5kb21haW4uY2hhaW5JZCxcclxuICAgICAgICAgICAgdmVyaWZ5aW5nQ29udHJhY3Q6IHJlc3BvbnNlLmRhdGEubWV0YVRyYW5zYWN0aW9uLmRvbWFpbi52ZXJpZnlpbmdDb250cmFjdCxcclxuICAgICAgICB9KSxcclxuICAgICAgICBwcmljZTogeyBidXlBbW91bnQsIGJ1eVRva2VuQWRkcmVzcywgZ2FzLCBwcmljZSwgc2VsbEFtb3VudCwgc2VsbFRva2VuQWRkcmVzcyB9LFxyXG4gICAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFF1ZXJpZXMgdGhlIG1ldGEtdHJhbnNhY3Rpb24gdjIgc2VydmljZSBmb3IgYSBtZXRhLXRyYW5zYWN0aW9uIHF1b3RlIHdyYXBwZWQgaW4gYVxyXG4gKiBtZXRhLXRyYW5zYWN0aW9uLlxyXG4gKlxyXG4gKiBJZiBubyBsaXF1aWRpdHkgaXMgYXZhaWxhYmxlLCByZXR1cm5zIGBudWxsYC5cclxuICpcclxuICogSWYgYSBwcm9tZXRoZXVzICdTdW1tYXJ5JyBpcyBwcm92aWRlZCB0byB0aGUgYHJlcXVlc3REdXJhdGlvblN1bW1hcnlgXHJcbiAqIHBhcmFtZXRlciwgdGhlIGZ1bmN0aW9uIHdpbGwgY2FsbCBpdHMgYG9ic2VydmVgIG1ldGhvZCB3aXRoIHRoZSByZXF1ZXN0XHJcbiAqIGR1cmF0aW9uIGluIG1zLlxyXG4gKlxyXG4gKiBAdGhyb3dzIGBBeGlvc0Vycm9yYFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFYyUXVvdGVBc3luYyhcclxuICAgIGF4aW9zSW5zdGFuY2U6IEF4aW9zSW5zdGFuY2UsXHJcbiAgICB1cmw6IFVSTCxcclxuICAgIHBhcmFtczogUXVvdGVQYXJhbXMsXHJcbiAgICBtZXRlcj86IHsgcmVxdWVzdER1cmF0aW9uU3VtbWFyeTogU3VtbWFyeTwnY2hhaW5JZCcgfCAnc3VjY2Vzcyc+OyBjaGFpbklkOiBudW1iZXIgfSxcclxuICAgIG5vTGlxdWlkaXR5TG9nZ2VyPzogcGluby5Mb2dGbixcclxuKTogUHJvbWlzZTx7XHJcbiAgICBtZXRhVHJhbnNhY3Rpb246IE1ldGFUcmFuc2FjdGlvblYyO1xyXG4gICAgcHJpY2U6IEZldGNoSW5kaWNhdGl2ZVF1b3RlUmVzcG9uc2U7XHJcbiAgICBzb3VyY2VzOiBMaXF1aWRpdHlTb3VyY2VbXTtcclxuICAgIGZlZXM/OiBGZWVzO1xyXG59IHwgbnVsbD4ge1xyXG4gICAgY29uc3Qgc3RvcFRpbWVyID0gbWV0ZXI/LnJlcXVlc3REdXJhdGlvblN1bW1hcnkuc3RhcnRUaW1lcih7IGNoYWluSWQ6IG1ldGVyLmNoYWluSWQgfSk7XHJcblxyXG4gICAgbGV0IHJlc3BvbnNlOiBBeGlvc1Jlc3BvbnNlPEdldE1ldGFUcmFuc2FjdGlvblYyUXVvdGVSZXNwb25zZT47XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgYXhpb3NJbnN0YW5jZS5wb3N0PEdldE1ldGFUcmFuc2FjdGlvblYyUXVvdGVSZXNwb25zZT4odXJsLnRvU3RyaW5nKCksIHBhcmFtcyk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgc3RvcFRpbWVyICYmIHN0b3BUaW1lcih7IHN1Y2Nlc3M6ICdmYWxzZScgfSk7XHJcbiAgICAgICAgcmV0dXJuIGhhbmRsZVF1b3RlRXJyb3IoZSwgcGFyYW1zLCBub0xpcXVpZGl0eUxvZ2dlcik7XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcFRpbWVyICYmIHN0b3BUaW1lcih7IHN1Y2Nlc3M6ICd0cnVlJyB9KTtcclxuXHJcbiAgICBjb25zdCB7IGJ1eUFtb3VudCwgYnV5VG9rZW5BZGRyZXNzLCBnYXMsIHByaWNlLCBzZWxsQW1vdW50LCBzZWxsVG9rZW5BZGRyZXNzIH0gPSByZXNwb25zZS5kYXRhO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgLy8gVE9ETzogVGhpcyBuZWVkcyB0byBiZSB1cGRhdGVkIHRvIHRoZSBuZXcgbWV0YS10cmFuc2FjdGlvbiB0eXBlIHdoZW4gc21hcnQgY29udHJhY3QgY2hhbmdlcyBhcmUgZmluaXNoZWQgYW5kIGNvcnJlc3BvbmRpbmcgdHlwZXMgYXJlIHB1Ymxpc2hlZCBpbiBwYWNrYWdlc1xyXG4gICAgICAgIG1ldGFUcmFuc2FjdGlvbjogbmV3IE1ldGFUcmFuc2FjdGlvblYyKFxyXG4gICAgICAgICAgICBzdHJpbmdzVG9NZXRhVHJhbnNhY3Rpb25GaWVsZHMoe1xyXG4gICAgICAgICAgICAgICAgLi4ucmVzcG9uc2UuZGF0YS5tZXRhVHJhbnNhY3Rpb24sXHJcbiAgICAgICAgICAgICAgICBjaGFpbklkOiByZXNwb25zZS5kYXRhLm1ldGFUcmFuc2FjdGlvbi5kb21haW4uY2hhaW5JZCxcclxuICAgICAgICAgICAgICAgIHZlcmlmeWluZ0NvbnRyYWN0OiByZXNwb25zZS5kYXRhLm1ldGFUcmFuc2FjdGlvbi5kb21haW4udmVyaWZ5aW5nQ29udHJhY3QsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICksXHJcbiAgICAgICAgcHJpY2U6IHtcclxuICAgICAgICAgICAgYnV5QW1vdW50OiBuZXcgQmlnTnVtYmVyKGJ1eUFtb3VudCksXHJcbiAgICAgICAgICAgIGJ1eVRva2VuQWRkcmVzcyxcclxuICAgICAgICAgICAgZ2FzOiBuZXcgQmlnTnVtYmVyKGdhcyksXHJcbiAgICAgICAgICAgIHByaWNlOiBuZXcgQmlnTnVtYmVyKHByaWNlKSxcclxuICAgICAgICAgICAgc2VsbEFtb3VudDogbmV3IEJpZ051bWJlcihzZWxsQW1vdW50KSxcclxuICAgICAgICAgICAgc2VsbFRva2VuQWRkcmVzcyxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNvdXJjZXM6IHJlc3BvbnNlLmRhdGEuc291cmNlc1xyXG4gICAgICAgICAgICAubWFwKChzb3VyY2UpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgLi4uc291cmNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3BvcnRpb246IG5ldyBCaWdOdW1iZXIoc291cmNlLnByb3BvcnRpb24pLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZpbHRlcigoc291cmNlKSA9PiBzb3VyY2UucHJvcG9ydGlvbi5ndChaRVJPKSksXHJcbiAgICAgICAgZmVlczogcmF3RmVlc1RvRmVlcyhyZXNwb25zZS5kYXRhLmZlZXMpLFxyXG4gICAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEludGVybmFsIGZ1bmN0aW9uIHRvIGhhbmRsZSBtZXRhLXRyYW5zYWN0aW9uIHF1b3RlIHJlc3BvbnNlcy5cclxuICpcclxuICogQHJldHVybnMgTnVsbCBpZiBpdCdzIG5vIGxpcXVpZHR5IGVycm9yLlxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlUXVvdGVFcnJvcihcclxuICAgIGU6IGFueSwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgICBwYXJhbXM6IFF1b3RlUGFyYW1zLFxyXG4gICAgbm9MaXF1aWRpdHlMb2dnZXI/OiBwaW5vLkxvZ0ZuLFxyXG4pOiBudWxsIHtcclxuICAgIGlmIChlLnJlc3BvbnNlPy5kYXRhKSB7XHJcbiAgICAgICAgY29uc3QgYXhpb3NFcnJvciA9IGUgYXMgQXhpb3NFcnJvcjx7XHJcbiAgICAgICAgICAgIGNvZGU6IG51bWJlcjtcclxuICAgICAgICAgICAgcmVhc29uOiBzdHJpbmc7XHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnM/OiBWYWxpZGF0aW9uRXJyb3JJdGVtW107XHJcbiAgICAgICAgfT47XHJcbiAgICAgICAgLy8gIFRoZSByZXNwb25zZSBmb3Igbm8gbGlxdWlkaXR5IGlzIGEgNDAwIHN0YXR1cyB3aXRoIGEgYm9keSBsaWtlOlxyXG4gICAgICAgIC8vICB7XHJcbiAgICAgICAgLy8gICAgIFwiY29kZVwiOiAxMDAsXHJcbiAgICAgICAgLy8gICAgIFwicmVhc29uXCI6IFwiVmFsaWRhdGlvbiBGYWlsZWRcIixcclxuICAgICAgICAvLyAgICAgXCJ2YWxpZGF0aW9uRXJyb3JzXCI6IFtcclxuICAgICAgICAvLyAgICAgICB7XHJcbiAgICAgICAgLy8gICAgICAgICBcImZpZWxkXCI6IFwic2VsbEFtb3VudFwiLFxyXG4gICAgICAgIC8vICAgICAgICAgXCJjb2RlXCI6IDEwMDQsXHJcbiAgICAgICAgLy8gICAgICAgICBcInJlYXNvblwiOiBcIklOU1VGRklDSUVOVF9BU1NFVF9MSVFVSURJVFlcIlxyXG4gICAgICAgIC8vICAgICAgIH1cclxuICAgICAgICAvLyAgICAgXVxyXG4gICAgICAgIC8vICAgfVxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgYXhpb3NFcnJvci5yZXNwb25zZT8uc3RhdHVzID09PSBCQURfUkVRVUVTVCAmJlxyXG4gICAgICAgICAgICBheGlvc0Vycm9yLnJlc3BvbnNlPy5kYXRhPy52YWxpZGF0aW9uRXJyb3JzPy5sZW5ndGggPT09IDEgJiZcclxuICAgICAgICAgICAgYXhpb3NFcnJvci5yZXNwb25zZT8uZGF0YT8udmFsaWRhdGlvbkVycm9yc1xyXG4gICAgICAgICAgICAgICAgPy5tYXAoKHYpID0+IHYucmVhc29uKVxyXG4gICAgICAgICAgICAgICAgLmluY2x1ZGVzKFN3YXBRdW90ZXJFcnJvci5JbnN1ZmZpY2llbnRBc3NldExpcXVpZGl0eSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgLy8gTG9va3MgbGlrZSB0aGVyZSBpcyBubyBsaXF1aWRpdHkgZm9yIHRoZSBxdW90ZS4uLlxyXG4gICAgICAgICAgICBub0xpcXVpZGl0eUxvZ2dlciAmJlxyXG4gICAgICAgICAgICAgICAgbm9MaXF1aWRpdHlMb2dnZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgeyBhbW1RdW90ZVJlcXVlc3RQYXJhbXM6IHBhcmFtcyB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGBbTWV0YVRyYW5zYWN0aW9uQ2xpZW50XSBObyBsaXF1aWRpdHkgcmV0dXJuZWQgZm9yIHBhaXJgLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUaGUgcmVzcG9uc2UgZm9yIGluc3VmZmljaWVudCBmdW5kIGVycm9yIChwcmltYXJpbHkgY2F1c2VkIGJ5IHRyYWRpbmcgYW1vdW50IGlzIGxlc3MgdGhhbiB0aGUgZmVlKVxyXG4gICAgICAgIC8vIGlzIGEgNDAwIHN0YXR1cyBhbmQgd2l0aCBhIGJvZHkgbGlrZTpcclxuICAgICAgICAvLyB7XHJcbiAgICAgICAgLy8gICAgICBcImNvZGVcIjogMTA5LFxyXG4gICAgICAgIC8vICAgICAgXCJyZWFzb25cIjogXCJJbnN1ZmZpY2llbnQgZnVuZHMgZm9yIHRyYW5zYWN0aW9uXCJcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBheGlvc0Vycm9yLnJlc3BvbnNlPy5zdGF0dXMgPT09IEJBRF9SRVFVRVNUICYmXHJcbiAgICAgICAgICAgIGF4aW9zRXJyb3IucmVzcG9uc2U/LmRhdGE/LmNvZGUgPT09IEFQSUVycm9yQ29kZXMuSW5zdWZmaWNpZW50RnVuZHNFcnJvclxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBpZiAocGFyYW1zLnNlbGxBbW91bnQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdzZWxsQW1vdW50JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogVmFsaWRhdGlvbkVycm9yQ29kZXMuRmllbGRJbnZhbGlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFzb246ICdzZWxsQW1vdW50IHRvbyBzbWFsbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIF0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2J1eUFtb3VudCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29kZTogVmFsaWRhdGlvbkVycm9yQ29kZXMuRmllbGRJbnZhbGlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlYXNvbjogJ2J1eUFtb3VudCB0b28gc21hbGwnLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gVGhpcyBlcnJvciBpcyBuZWl0aGVyIHRoZSBzdGFuZGFyZCBubyBsaXF1aWRpdHkgZXJyb3Igbm9yIHRoZSBpbnN1ZmZpY2llbnQgZnVuZCBlcnJvclxyXG4gICAgdGhyb3cgZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFF1ZXJpZXMgdGhlIE1ldGFUcmFuc2FjdGlvbiBSUEMgc2VydmljZSBmb3IgYW4gQU1NIHF1b3RlIHdyYXBwZWQgaW4gYVxyXG4gKiBNZXRhVHJhbnNhY3Rpb24uXHJcbiAqIElmIG5vIEFNTSBsaXF1aWRpdHkgaXMgYXZhaWxhYmxlLCByZXR1cm5zIGBudWxsYC5cclxuICpcclxuICogSWYgYSBwcm9tZXRoZXVzICdTdW1tYXJ5JyBpcyBwcm92aWRlZCB0byB0aGUgYHJlcXVlc3REdXJhdGlvblN1bW1hcnlgXHJcbiAqIHBhcmFtZXRlciwgdGhlIGZ1bmN0aW9uIHdpbGwgY2FsbCBpdHMgYG9ic2VydmVgIG1ldGhvZCB3aXRoIHRoZSByZXF1ZXN0XHJcbiAqIGR1cmF0aW9uIGluIG1zLlxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFF1b3RlUnBjKFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgICAgYWZmaWxpYXRlQWRkcmVzcz86IHN0cmluZztcclxuICAgICAgICBjaGFpbklkOiBudW1iZXI7XHJcbiAgICAgICAgYnV5QW1vdW50PzogQmlnTnVtYmVyO1xyXG4gICAgICAgIGJ1eVRva2VuOiBzdHJpbmc7XHJcbiAgICAgICAgaW50ZWdyYXRvcklkOiBzdHJpbmc7XHJcbiAgICAgICAgc2VsbEFtb3VudD86IEJpZ051bWJlcjtcclxuICAgICAgICBzZWxsVG9rZW46IHN0cmluZztcclxuICAgICAgICBzbGlwcGFnZVBlcmNlbnRhZ2U/OiBCaWdOdW1iZXI7XHJcbiAgICAgICAgdGFrZXJBZGRyZXNzOiBzdHJpbmc7XHJcbiAgICAgICAgcXVvdGVVbmlxdWVJZD86IHN0cmluZzsgLy8gSUQgdG8gdXNlIGZvciB0aGUgcXVvdGUgcmVwb3J0IGBkZWNvZGVkVW5pcXVlSWRgXHJcbiAgICB9LFxyXG4gICAgbWV0ZXI/OiB7IHJlcXVlc3REdXJhdGlvblN1bW1hcnk6IFN1bW1hcnk8J2NoYWluSWQnIHwgJ3N1Y2Nlc3MnPjsgY2hhaW5JZDogbnVtYmVyIH0sXHJcbiAgICBub0xpcXVpZGl0eUxvZ2dlcj86IHBpbm8uTG9nRm4sXHJcbik6IFByb21pc2U8eyBtZXRhVHJhbnNhY3Rpb246IE1ldGFUcmFuc2FjdGlvbjsgcHJpY2U6IEZldGNoSW5kaWNhdGl2ZVF1b3RlUmVzcG9uc2UgfSB8IG51bGw+IHtcclxuICAgIGNvbnN0IHN0b3BUaW1lciA9IG1ldGVyPy5yZXF1ZXN0RHVyYXRpb25TdW1tYXJ5LnN0YXJ0VGltZXIoeyBjaGFpbklkOiBtZXRlci5jaGFpbklkIH0pO1xyXG5cclxuICAgIGxldCByZXNwb25zZTogR2V0UXVvdGVSZXNwb25zZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gVE9ETyAocmhpbm9kYXZpZCk6IEZpZ3VyZSBvdXQgaG93IHRvIHNldCBhIHRpbWVvdXRcclxuICAgICAgICByZXNwb25zZSA9IGF3YWl0IEdldFF1b3RlKFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhZmZpbGlhdGVBZGRyZXNzOiBwYXJhbXMuYWZmaWxpYXRlQWRkcmVzcyxcclxuICAgICAgICAgICAgICAgIGJ1eUFtb3VudDogcGFyYW1zLmJ1eUFtb3VudCA/IGJpZ051bWJlclRvUHJvdG8ocGFyYW1zLmJ1eUFtb3VudCkgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBidXlUb2tlbkFkZHJlc3M6IHBhcmFtcy5idXlUb2tlbixcclxuICAgICAgICAgICAgICAgIGNoYWluSWQ6IHBhcmFtcy5jaGFpbklkLFxyXG4gICAgICAgICAgICAgICAgaW50ZWdyYXRvcklkOiBwYXJhbXMuaW50ZWdyYXRvcklkLFxyXG4gICAgICAgICAgICAgICAgcXVvdGVVbmlxdWVJZDogcGFyYW1zLnF1b3RlVW5pcXVlSWQsXHJcbiAgICAgICAgICAgICAgICBzZWxsQW1vdW50OiBwYXJhbXMuc2VsbEFtb3VudCA/IGJpZ051bWJlclRvUHJvdG8ocGFyYW1zLnNlbGxBbW91bnQpIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgc2VsbFRva2VuQWRkcmVzczogcGFyYW1zLnNlbGxUb2tlbixcclxuICAgICAgICAgICAgICAgIHNsaXBwYWdlUGVyY2VudGFnZTogcGFyYW1zLnNsaXBwYWdlUGVyY2VudGFnZSA/IGJpZ051bWJlclRvUHJvdG8ocGFyYW1zLnNsaXBwYWdlUGVyY2VudGFnZSkgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICB0YWtlckFkZHJlc3M6IHBhcmFtcy50YWtlckFkZHJlc3MsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgYmFzZVVSTDogTUVUQV9UUkFOU0FDVElPTl9TRVJWSUNFX1JQQ19VUkwgfSxcclxuICAgICAgICApO1xyXG4gICAgfSBjYXRjaCAoX2UpIHtcclxuICAgICAgICBzdG9wVGltZXIgJiYgc3RvcFRpbWVyKHsgc3VjY2VzczogJ2ZhbHNlJyB9KTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRXJyb3IgaGFuZGxpbmc6XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBUd2lycCB0aHJvd3MgYW4gZXJyb3Igb2YgdGhlIGZvbGxvd2luZyB0eXBlOlxyXG4gICAgICAgICAqIGV4cG9ydCBpbnRlcmZhY2UgVHdpcnBFcnJvciB7XHJcbiAgICAgICAgICogICBjb2RlOiBFcnJvckNvZGU7XHJcbiAgICAgICAgICogICBtc2c6IHN0cmluZztcclxuICAgICAgICAgKiAgIG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xyXG4gICAgICAgICAqIH1cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIFRvIHN1cHBvcnQgdGhlIGN1cnJlbnQgZXJyb3IgY29kZXMsIHdlIHR5cGUgYG1ldGFgIGFzOlxyXG4gICAgICAgICAqICBtZXRhOiB7XHJcbiAgICAgICAgICogICAgIHplcm9leEVycm9yQ29kZT86IEFQSUVycm9yQ29kZXMsXHJcbiAgICAgICAgICogICAgIHZhbGlkYXRpb25FcnJvcnM6IEpTT04uc3RyaW5naWZ5KFZhbGlkYXRpb25FcnJvckl0ZW1bXSlcclxuICAgICAgICAgKiAgfVxyXG4gICAgICAgICAqL1xyXG5cclxuICAgICAgICBjb25zdCBlID0gX2UgYXMgVHdpcnBFcnJvcjtcclxuICAgICAgICBjb25zdCB6ZXJvZXhFcnJvckNvZGUgPSBOdW1iZXIuaXNOYU4ocGFyc2VJbnQoZS5tZXRhPy56ZXJvZXhFcnJvckNvZGUgPz8gJycpKVxyXG4gICAgICAgICAgICA/IG51bGxcclxuICAgICAgICAgICAgOiBwYXJzZUludChlLm1ldGE/Lnplcm9leEVycm9yQ29kZSA/PyAnJyk7XHJcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbkVycm9yczogVmFsaWRhdGlvbkVycm9ySXRlbVtdID0gSlNPTi5wYXJzZShlLm1ldGE/LnZhbGlkYXRpb25FcnJvcnMgPz8gJ1tdJyk7XHJcblxyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgdmFsaWRhdGlvbkVycm9ycz8ubGVuZ3RoID09PSAxICYmXHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnM/Lm1hcCgodikgPT4gdi5yZWFzb24pLmluY2x1ZGVzKFN3YXBRdW90ZXJFcnJvci5JbnN1ZmZpY2llbnRBc3NldExpcXVpZGl0eSlcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgLy8gTG9va3MgbGlrZSB0aGVyZSBpcyBubyBsaXF1aWRpdHkgZm9yIHRoZSBxdW90ZS4uLlxyXG4gICAgICAgICAgICBub0xpcXVpZGl0eUxvZ2dlciAmJlxyXG4gICAgICAgICAgICAgICAgbm9MaXF1aWRpdHlMb2dnZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgeyBhbW1RdW90ZVJlcXVlc3RQYXJhbXM6IHBhcmFtcyB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGBbTWV0YVRyYW5zYWN0aW9uQ2xpZW50XSBObyBsaXF1aWRpdHkgcmV0dXJuZWQgZm9yIHBhaXJgLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUaGUgcmVzcG9uc2UgZm9yIGluc3VmZmljaWVudCBmdW5kIGVycm9yIChwcmltYXJpbHkgY2F1c2VkIGJ5IHRyYWRpbmcgYW1vdW50IGlzIGxlc3MgdGhhbiB0aGUgZmVlKVxyXG4gICAgICAgIC8vIGlzIGEgemVyb2V4R2VuZXJhbEVycm9yQ29kZSBgSW5zdWZmaWNpZW50RnVuZHNFcnJvcmBcclxuXHJcbiAgICAgICAgaWYgKHplcm9leEVycm9yQ29kZSA9PT0gQVBJRXJyb3JDb2Rlcy5JbnN1ZmZpY2llbnRGdW5kc0Vycm9yKSB7XHJcbiAgICAgICAgICAgIGlmIChwYXJhbXMuc2VsbEFtb3VudCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3NlbGxBbW91bnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBWYWxpZGF0aW9uRXJyb3JDb2Rlcy5GaWVsZEludmFsaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbjogJ3NlbGxBbW91bnQgdG9vIHNtYWxsJyxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnYnV5QW1vdW50JyxcclxuICAgICAgICAgICAgICAgICAgICBjb2RlOiBWYWxpZGF0aW9uRXJyb3JDb2Rlcy5GaWVsZEludmFsaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnYnV5QW1vdW50IHRvbyBzbWFsbCcsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVGhpcyBlcnJvciBpcyBuZWl0aGVyIHRoZSBzdGFuZGFyZCBubyBsaXF1aWRpdHkgZXJyb3Igbm9yIHRoZSBpbnN1ZmZpY2llbnQgZnVuZCBlcnJvclxyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcblxyXG4gICAgc3RvcFRpbWVyICYmIHN0b3BUaW1lcih7IHN1Y2Nlc3M6ICd0cnVlJyB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG1ldGFUcmFuc2FjdGlvbjogbmV3IE1ldGFUcmFuc2FjdGlvbih7XHJcbiAgICAgICAgICAgIHNpZ25lcjogcmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLnNpZ25lckFkZHJlc3MsXHJcbiAgICAgICAgICAgIHNlbmRlcjogcmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLnNlbmRlckFkZHJlc3MsXHJcbiAgICAgICAgICAgIG1pbkdhc1ByaWNlOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5taW5HYXNQcmljZSksXHJcbiAgICAgICAgICAgIG1heEdhc1ByaWNlOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5tYXhHYXNQcmljZSksXHJcbiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lU2Vjb25kczogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uZXhwaXJhdGlvblRpbWVTZWNvbmRzKSxcclxuICAgICAgICAgICAgc2FsdDogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uc2FsdCksXHJcbiAgICAgICAgICAgIGNhbGxEYXRhOiByZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uY2FsbERhdGEsXHJcbiAgICAgICAgICAgIHZhbHVlOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi52YWx1ZSksXHJcbiAgICAgICAgICAgIGZlZVRva2VuOiByZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uZmVlVG9rZW5BZGRyZXNzLFxyXG4gICAgICAgICAgICBmZWVBbW91bnQ6IHByb3RvVG9CaWdOdW1iZXIocmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLmZlZUFtb3VudCksXHJcbiAgICAgICAgICAgIGNoYWluSWQ6IHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5jaGFpbklkLFxyXG4gICAgICAgICAgICB2ZXJpZnlpbmdDb250cmFjdDogcmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLnZlcmlmeWluZ0NvbnRyYWN0LFxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIHByaWNlOiB7XHJcbiAgICAgICAgICAgIGJ1eUFtb3VudDogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5xdW90ZS5idXlBbW91bnQpLFxyXG4gICAgICAgICAgICBidXlUb2tlbkFkZHJlc3M6IHJlc3BvbnNlLnF1b3RlLmJ1eVRva2VuQWRkcmVzcyxcclxuICAgICAgICAgICAgZ2FzOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLnF1b3RlLmdhcyksXHJcbiAgICAgICAgICAgIHByaWNlOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLnF1b3RlLnByaWNlKSxcclxuICAgICAgICAgICAgc2VsbEFtb3VudDogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5xdW90ZS5zZWxsQW1vdW50KSxcclxuICAgICAgICAgICAgc2VsbFRva2VuQWRkcmVzczogcmVzcG9uc2UucXVvdGUuc2VsbFRva2VuQWRkcmVzcyxcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=