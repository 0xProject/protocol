{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/entities/TransactionEntity.ts","mappings":";;;;;;;;;;;;;AAAA,uCAAoC;AACpC,qCAAsC;AACtC,qCAA4F;AAE5F,sCAA8D;AAC9D,iDAAwD;AAExD,iDAAyE;AAGzE,IAAK,iBAoBJ;AApBD,WAAK,iBAAiB;IAClB,0EAA0E;IAC1E,gDAA2B,CAAA;IAC3B,iDAAiD;IACjD,4CAAuB,CAAA;IACvB,+CAA+C;IAC/C,wCAAmB,CAAA;IACnB,uDAAuD;IACvD,oCAAe,CAAA;IACf,8BAA8B;IAC9B,0CAAqB,CAAA;IACrB,4BAA4B;IAC5B,4CAAuB,CAAA;IACvB,2CAA2C;IAC3C,wCAAmB,CAAA;IACnB,uEAAuE;IACvE,wBAAwB;IACxB,wCAAmB,CAAA;IACnB,wDAAwD;IACxD,4CAAuB,CAAA;AAC3B,CAAC,EApBI,iBAAiB,KAAjB,iBAAiB,QAoBrB;AAGD,IAAa,iBAAiB,yBAA9B,MAAa,iBAAiB;IA+E1B,0EAA0E;IAC1E,kEAAkE;IAClE,4EAA4E;IAC5E,kEAAkE;IAClE,+DAA+D;IAC/D,YACI,OAA8B;QAC1B,OAAO,EAAE,EAAE;QACX,MAAM,EAAE,EAAE;QACV,EAAE,EAAE,EAAE;QACN,IAAI,EAAE,EAAE;QACR,MAAM,EAAE,EAAE;QACV,YAAY,EAAE,EAAE;QAChB,MAAM,EAAE,EAAE;QACV,kBAAkB,EAAE,0CAAiC;QACrD,KAAK,EAAE,CAAC;QACR,QAAQ,EAAE,gBAAI;QACd,KAAK,EAAE,gBAAI;QACX,IAAI,EAAE,EAAE;QACR,GAAG,EAAE,IAAI;QACT,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,IAAI;KACjB;QAED,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACtC,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;QAClB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;QACtB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC;QAClD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QACxB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC9B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QACxB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QACpC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;QACtB,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;QACpB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC9B,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;QACvB,IAAI,CAAC,UAAU,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,kBAAkB,GAAG,yBAAa,CAAC,CAAC;IACxF,CAAC;IA5DM,MAAM,CAAC,IAAI,CAAC,IAA2B;QAC1C,eAAM,CAAC,WAAW,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAC5C,IAAI,IAAI,CAAC,MAAM,KAAK,SAAS,EAAE;YAC3B,eAAM,CAAC,WAAW,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;SAC7C;QACD,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS,EAAE;YACzB,eAAM,CAAC,eAAe,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;SAC7C;QACD,eAAM,CAAC,sBAAsB,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,EAAE,iBAAiB,CAAC,CAAC;QACxE,IAAI,IAAI,CAAC,KAAK,KAAK,SAAS,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,EAAE;YAC9E,MAAM,IAAI,KAAK,CAAC,yDAAyD,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;SAC1F;QACD,IAAI,IAAI,CAAC,WAAW,KAAK,SAAS,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,EAAE;YAChG,MAAM,IAAI,KAAK,CAAC,+DAA+D,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;SACtG;QACD,OAAO,IAAI,mBAAiB,CAAC,IAAI,CAAC,CAAC;IACvC,CAAC;CA6CJ,CAAA;AArHG;IAJC,IAAA,uBAAa,EAAC,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC;;kDAI9B;AAGvB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;+CACrC;AAGrB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC;;6CACrB;AAGnB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;iDACpD;AAGvB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC;;iDACtB;AAGtB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,eAAe,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;uDACtC;AAG7B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC;;6DACpB;AAGnC;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,mCAAoB,EAAE,CAAC;8BAC/E,iBAAS;mDAAC;AAG5B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,mCAAoB,EAAE,CAAC;8BAC9E,iBAAS;gDAAC;AAGzB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;8CAC1B;AAG3B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;+CACrC;AAGrB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,gCAAiB,EAAE,CAAC;;gDACpE;AAGtB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;kDAC3B;AAG/B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,cAAc,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,gCAAiB,EAAE,CAAC;;sDACrE;AAG5B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;mDAC3B;AAGhC;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;iDACtC;AAGvB;IADC,IAAA,0BAAgB,EAAC,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC;8BAC3C,IAAI;oDAAC;AAGxB;IADC,IAAA,0BAAgB,EAAC,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC;8BAC3C,IAAI;oDAAC;AAGxB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC;8BAClC,IAAI;qDAAC;AA3Df,iBAAiB;IAD7B,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,cAAc,EAAE,CAAC;;GACpB,iBAAiB,CA0H7B;AA1HY,8CAAiB","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/entities/TransactionEntity.ts"],"sourcesContent":["import { assert } from '@0x/assert';\r\nimport { BigNumber } from '@0x/utils';\r\nimport { Column, CreateDateColumn, Entity, PrimaryColumn, UpdateDateColumn } from 'typeorm';\r\n\r\nimport { META_TXN_RELAY_EXPECTED_MINED_SEC } from '../config';\r\nimport { ONE_SECOND_MS, ZERO } from '../core/constants';\r\n\r\nimport { BigIntTransformer, BigNumberTransformer } from './transformers';\r\nimport { TransactionEntityOpts } from './types';\r\n\r\nenum TransactionStates {\r\n    // transaction has been constructed, but not yet submitted to the network.\r\n    Unsubmitted = 'unsubmitted',\r\n    // transaction has been submitted to the network.\r\n    Submitted = 'submitted',\r\n    // transaction has been spotted in the mempool.\r\n    Mempool = 'mempool',\r\n    // transaction has not been mined in the expected time.\r\n    Stuck = 'stuck',\r\n    // transaction has been mined.\r\n    Included = 'included',\r\n    // transaction is confirmed.\r\n    Confirmed = 'confirmed',\r\n    // transaction is no longer in the mempool.\r\n    Dropped = 'dropped',\r\n    // transaction has been aborted because a new transaction with the same\r\n    // nonce has been mined.\r\n    Aborted = 'aborted',\r\n    // transaction was in an unsubmitted state for too long.\r\n    Cancelled = 'cancelled',\r\n}\r\n\r\n@Entity({ name: 'transactions' })\r\nexport class TransactionEntity {\r\n    @PrimaryColumn({ name: 'ref_hash', type: 'varchar' })\r\n    // reference hash can be either be the zeroExTransaction hash or the actual\r\n    // txHash depending on whether we are submitting a meta-transaction or an\r\n    // unsticking ethereum transaction.\r\n    public refHash: string;\r\n\r\n    @Column({ name: 'data', type: 'varchar', nullable: true })\r\n    public data?: string;\r\n\r\n    @Column({ name: 'to', type: 'varchar' })\r\n    public to?: string;\r\n\r\n    @Column({ name: 'tx_hash', type: 'varchar', unique: true, nullable: true })\r\n    public txHash?: string;\r\n\r\n    @Column({ name: 'status', type: 'varchar' })\r\n    public status: string;\r\n\r\n    @Column({ name: 'taker_address', type: 'varchar', nullable: true })\r\n    public takerAddress?: string;\r\n\r\n    @Column({ name: 'expected_mined_in_sec', type: 'int' })\r\n    public expectedMinedInSec?: number;\r\n\r\n    @Column({ name: 'gas_price', type: 'bigint', nullable: true, transformer: BigNumberTransformer })\r\n    public gasPrice?: BigNumber;\r\n\r\n    @Column({ name: 'value', type: 'bigint', nullable: true, transformer: BigNumberTransformer })\r\n    public value?: BigNumber;\r\n\r\n    @Column({ name: 'gas', type: 'int', nullable: true })\r\n    public gas?: number | null;\r\n\r\n    @Column({ name: 'from', type: 'varchar', nullable: true })\r\n    public from?: string;\r\n\r\n    @Column({ name: 'nonce', type: 'bigint', nullable: true, transformer: BigIntTransformer })\r\n    public nonce?: number;\r\n\r\n    @Column({ name: 'gas_used', type: 'int', nullable: true })\r\n    public gasUsed?: number | null;\r\n\r\n    @Column({ name: 'block_number', type: 'bigint', nullable: true, transformer: BigIntTransformer })\r\n    public blockNumber?: number;\r\n\r\n    @Column({ name: 'tx_status', type: 'int', nullable: true })\r\n    public txStatus?: number | null;\r\n\r\n    @Column({ name: 'api_key', type: 'varchar', nullable: true })\r\n    public apiKey?: string;\r\n\r\n    @CreateDateColumn({ name: 'created_at', type: 'timestamptz' })\r\n    public createdAt?: Date;\r\n\r\n    @UpdateDateColumn({ name: 'updated_at', type: 'timestamptz' })\r\n    public updatedAt?: Date;\r\n\r\n    @Column({ name: 'expected_at', type: 'timestamptz' })\r\n    public expectedAt: Date;\r\n\r\n    public static make(opts: TransactionEntityOpts): TransactionEntity {\r\n        assert.isHexString('refHash', opts.refHash);\r\n        if (opts.txHash !== undefined) {\r\n            assert.isHexString('txHash', opts.txHash);\r\n        }\r\n        if (opts.from !== undefined) {\r\n            assert.isETHAddressHex('from', opts.from);\r\n        }\r\n        assert.doesBelongToStringEnum('status', opts.status, TransactionStates);\r\n        if (opts.nonce !== undefined && !Number.isInteger(opts.nonce) && opts.nonce <= 0) {\r\n            throw new Error(`Expected nonce to be a positive integer, encountered: ${opts.nonce}`);\r\n        }\r\n        if (opts.blockNumber !== undefined && !Number.isInteger(opts.blockNumber) && opts.blockNumber <= 0) {\r\n            throw new Error(`Expected blockNumber to be a positive integer, encountered: ${opts.blockNumber}`);\r\n        }\r\n        return new TransactionEntity(opts);\r\n    }\r\n\r\n    // HACK(oskar) we want all fields to be set and valid, otherwise we should\r\n    // not accept a transaction entity, however because of this issue:\r\n    // https://github.com/typeorm/typeorm/issues/1772 we cannot accept undefined\r\n    // as an argument to the constructor, to not break migrations with\r\n    // serialize. Please use the public static make method instead.\r\n    private constructor(\r\n        opts: TransactionEntityOpts = {\r\n            refHash: '',\r\n            txHash: '',\r\n            to: '',\r\n            data: '',\r\n            apiKey: '',\r\n            takerAddress: '',\r\n            status: '',\r\n            expectedMinedInSec: META_TXN_RELAY_EXPECTED_MINED_SEC,\r\n            nonce: 0,\r\n            gasPrice: ZERO,\r\n            value: ZERO,\r\n            from: '',\r\n            gas: null,\r\n            gasUsed: null,\r\n            txStatus: null,\r\n        },\r\n    ) {\r\n        this.refHash = opts.refHash;\r\n        this.txHash = opts.txHash;\r\n        this.takerAddress = opts.takerAddress;\r\n        this.to = opts.to;\r\n        this.data = opts.data;\r\n        this.apiKey = opts.apiKey;\r\n        this.status = opts.status;\r\n        this.expectedMinedInSec = opts.expectedMinedInSec;\r\n        this.nonce = opts.nonce;\r\n        this.gasPrice = opts.gasPrice;\r\n        this.value = opts.value;\r\n        this.blockNumber = opts.blockNumber;\r\n        this.from = opts.from;\r\n        this.gas = opts.gas;\r\n        this.gasUsed = opts.gasUsed;\r\n        this.txStatus = opts.txStatus;\r\n        const now = new Date();\r\n        this.expectedAt = new Date(now.getTime() + this.expectedMinedInSec * ONE_SECOND_MS);\r\n    }\r\n}\r\n"],"version":3}