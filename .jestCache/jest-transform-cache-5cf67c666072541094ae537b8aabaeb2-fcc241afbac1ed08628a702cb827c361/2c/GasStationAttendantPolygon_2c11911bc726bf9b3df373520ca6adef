383e3b03d0ee4b3246066592a606ac94
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GasStationAttendantPolygon = void 0;
const utils_1 = require("@0x/utils");
const constants_1 = require("../core/constants");
const logger_1 = require("../logger");
// The total minimum bid recommended by the post here:
// https://forum.matic.network/t/recommended-min-gas-price-setting/2531
// Expect bids lower than this to be rejected by the RPC node.
const MINIMUM_BID_WEI = 30000000000;
// The maximum tip we're willing to pay, based on p99 historical data
// Increase multiplier for tip with each resubmission cycle
const TEN_PERCENT_INCREASE = 1.1;
/**
 * An implementation of `GasStationAttendant` designed for Polygon.
 *
 * Currently, the 0x Gas Oracle does not provide pricing for Polygon
 * in EIP-1559 format. Therefore, we'll use the 'fast' gas as a
 * `maxPriorityFeePerGas` estimate. This actually works out okay because
 * the Polygon base fee is always essentially zero as of April 2022.
 */
class GasStationAttendantPolygon {
    constructor(gasOracleType0) {
        this._gasOracleType0 = gasOracleType0;
    }
    /**
     * The Safe Balance For Trade is from the p95 data shown here:
     * https://0xproject.slack.com/archives/CQG0ZGBFS/p1649708977452469
     */
    // tslint:disable-next-line: prefer-function-over-method
    async getSafeBalanceForTradeAsync() {
        const p95PriorityFeeGwei = 261;
        // Base fee is essentially zero
        // TODO (rhinodavid): Make this smarter as we have more historical data
        const gasEstimate = constants_1.RFQM_TX_OTC_ORDER_GAS_ESTIMATE;
        // 0.0261 MATIC
        return new utils_1.BigNumber(p95PriorityFeeGwei).shiftedBy(constants_1.GWEI_DECIMALS).times(gasEstimate);
    }
    /**
     * Uses the current fast gas price as the `maxPriorityFeePerGas`
     * estimate. Plans for 3 resubmits at a 10% tip increase. Assumes
     * no base fee.
     *
     * Uses a fixed value of 110,000 for the transaction gas amount
     * estimate.
     */
    async getWorkerBalanceForTradeAsync() {
        // TODO (rhinodavid): Once the 0x gas oracle can give EIP-1559 data for Polygon
        // use that instead of the legacy fast gas price.
        const gasPriceEstimateWei = await this._gasOracleType0.getGasWeiAsync('fast');
        logger_1.logger.info({ gasPriceEstimateWei: gasPriceEstimateWei.toString() }, 'Polygon fast gas price estimate (wei)');
        // Since the base fee is basically nothing, use this for our initial max priority fee
        const maxPriorityFeePerGas = gasPriceEstimateWei;
        // Pad the tip for 3 10% increases
        const maxPriorityFeePad = Math.pow(TEN_PERCENT_INCREASE, 3); // tslint:disable-line: custom-no-magic-numbers
        const paddedMaxPriorityFeePerGas = maxPriorityFeePerGas.times(maxPriorityFeePad);
        const gasRateWei = utils_1.BigNumber.max(paddedMaxPriorityFeePerGas.plus(0), MINIMUM_BID_WEI); // Amortizing the base fee to 0
        // Pad a little until we get a better idea of token-specific costs
        const padding = 1.1;
        const gasEstimate = constants_1.RFQM_TX_OTC_ORDER_GAS_ESTIMATE * padding;
        return gasRateWei.times(gasEstimate);
    }
    /**
     * Calculated using a similar methodology to `getWorkerBalanceForTradeAsync`,
     * but assumes we submit and average 1.5 transactions per trade, which is
     * what we see on Ethereum.
     *
     * TODO (rhinodavid): Update this once we have more historical data
     */
    async getExpectedTransactionGasRateAsync() {
        const gasPriceEstimateWei = await this._gasOracleType0.getGasWeiAsync('fast');
        logger_1.logger.info({ gasPriceEstimateWei: gasPriceEstimateWei.toString() }, 'Polygon fast gas price estimate (wei)');
        // Since the base fee is basically nothing, use this for our initial max priority fee
        const maxPriorityFeePerGas = gasPriceEstimateWei;
        // Pad the tip for 1.5 10% increases
        const baseFeePad = Math.pow(TEN_PERCENT_INCREASE, 1.5); // tslint:disable-line: custom-no-magic-numbers
        const paddedMaxPriorityFeePerGas = maxPriorityFeePerGas.times(baseFeePad);
        const gasRateWei = paddedMaxPriorityFeePerGas.plus(0); // Amortizing the base fee to 0
        logger_1.logger.info({
            gasPriceEstimateWei,
            maxPriorityFeePerGas,
            baseFeePad,
            paddedMaxPriorityFeePerGas,
            gasRateWei,
        }, 'Gas variables in Ploygon `getExpectedTransactionGasRateAsync`');
        return gasRateWei.integerValue(utils_1.BigNumber.ROUND_CEIL);
    }
}
exports.GasStationAttendantPolygon = GasStationAttendantPolygon;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9HYXNTdGF0aW9uQXR0ZW5kYW50UG9seWdvbi50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxxQ0FBc0M7QUFFdEMsaURBQWtGO0FBQ2xGLHNDQUFtQztBQUtuQyxzREFBc0Q7QUFDdEQsdUVBQXVFO0FBQ3ZFLDhEQUE4RDtBQUM5RCxNQUFNLGVBQWUsR0FBRyxXQUFXLENBQUM7QUFFcEMscUVBQXFFO0FBRXJFLDJEQUEyRDtBQUMzRCxNQUFNLG9CQUFvQixHQUFHLEdBQUcsQ0FBQztBQUVqQzs7Ozs7OztHQU9HO0FBQ0gsTUFBYSwwQkFBMEI7SUFHbkMsWUFBWSxjQUE4QjtRQUN0QyxJQUFJLENBQUMsZUFBZSxHQUFHLGNBQWMsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsd0RBQXdEO0lBQ2pELEtBQUssQ0FBQywyQkFBMkI7UUFDcEMsTUFBTSxrQkFBa0IsR0FBRyxHQUFHLENBQUM7UUFDL0IsK0JBQStCO1FBQy9CLHVFQUF1RTtRQUN2RSxNQUFNLFdBQVcsR0FBRywwQ0FBOEIsQ0FBQztRQUNuRCxlQUFlO1FBQ2YsT0FBTyxJQUFJLGlCQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxTQUFTLENBQUMseUJBQWEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN6RixDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLEtBQUssQ0FBQyw2QkFBNkI7UUFDdEMsK0VBQStFO1FBQy9FLGlEQUFpRDtRQUNqRCxNQUFNLG1CQUFtQixHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUUsZUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsdUNBQXVDLENBQUMsQ0FBQztRQUU5RyxxRkFBcUY7UUFDckYsTUFBTSxvQkFBb0IsR0FBRyxtQkFBbUIsQ0FBQztRQUVqRCxrQ0FBa0M7UUFDbEMsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsK0NBQStDO1FBQzVHLE1BQU0sMEJBQTBCLEdBQUcsb0JBQW9CLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDakYsTUFBTSxVQUFVLEdBQUcsaUJBQVMsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMsK0JBQStCO1FBRXRILGtFQUFrRTtRQUNsRSxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFDcEIsTUFBTSxXQUFXLEdBQUcsMENBQThCLEdBQUcsT0FBTyxDQUFDO1FBRTdELE9BQU8sVUFBVSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksS0FBSyxDQUFDLGtDQUFrQztRQUMzQyxNQUFNLG1CQUFtQixHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUUsZUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsdUNBQXVDLENBQUMsQ0FBQztRQUU5RyxxRkFBcUY7UUFDckYsTUFBTSxvQkFBb0IsR0FBRyxtQkFBbUIsQ0FBQztRQUVqRCxvQ0FBb0M7UUFDcEMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLCtDQUErQztRQUN2RyxNQUFNLDBCQUEwQixHQUFHLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMxRSxNQUFNLFVBQVUsR0FBRywwQkFBMEIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQywrQkFBK0I7UUFFdEYsZUFBTSxDQUFDLElBQUksQ0FDUDtZQUNJLG1CQUFtQjtZQUNuQixvQkFBb0I7WUFDcEIsVUFBVTtZQUNWLDBCQUEwQjtZQUMxQixVQUFVO1NBQ2IsRUFDRCwrREFBK0QsQ0FDbEUsQ0FBQztRQUVGLE9BQU8sVUFBVSxDQUFDLFlBQVksQ0FBQyxpQkFBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3pELENBQUM7Q0FDSjtBQWxGRCxnRUFrRkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9HYXNTdGF0aW9uQXR0ZW5kYW50UG9seWdvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdAMHgvdXRpbHMnO1xuXG5pbXBvcnQgeyBHV0VJX0RFQ0lNQUxTLCBSRlFNX1RYX09UQ19PUkRFUl9HQVNfRVNUSU1BVEUgfSBmcm9tICcuLi9jb3JlL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IHsgR2FzT3JhY2xlVHlwZTAgfSBmcm9tICcuL0dhc09yYWNsZVR5cGUwJztcblxuaW1wb3J0IHsgR2FzU3RhdGlvbkF0dGVuZGFudCwgV2VpLCBXZWlQZXJHYXMgfSBmcm9tICcuL0dhc1N0YXRpb25BdHRlbmRhbnQnO1xuXG4vLyBUaGUgdG90YWwgbWluaW11bSBiaWQgcmVjb21tZW5kZWQgYnkgdGhlIHBvc3QgaGVyZTpcbi8vIGh0dHBzOi8vZm9ydW0ubWF0aWMubmV0d29yay90L3JlY29tbWVuZGVkLW1pbi1nYXMtcHJpY2Utc2V0dGluZy8yNTMxXG4vLyBFeHBlY3QgYmlkcyBsb3dlciB0aGFuIHRoaXMgdG8gYmUgcmVqZWN0ZWQgYnkgdGhlIFJQQyBub2RlLlxuY29uc3QgTUlOSU1VTV9CSURfV0VJID0gMzAwMDAwMDAwMDA7XG5cbi8vIFRoZSBtYXhpbXVtIHRpcCB3ZSdyZSB3aWxsaW5nIHRvIHBheSwgYmFzZWQgb24gcDk5IGhpc3RvcmljYWwgZGF0YVxuXG4vLyBJbmNyZWFzZSBtdWx0aXBsaWVyIGZvciB0aXAgd2l0aCBlYWNoIHJlc3VibWlzc2lvbiBjeWNsZVxuY29uc3QgVEVOX1BFUkNFTlRfSU5DUkVBU0UgPSAxLjE7XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgYEdhc1N0YXRpb25BdHRlbmRhbnRgIGRlc2lnbmVkIGZvciBQb2x5Z29uLlxuICpcbiAqIEN1cnJlbnRseSwgdGhlIDB4IEdhcyBPcmFjbGUgZG9lcyBub3QgcHJvdmlkZSBwcmljaW5nIGZvciBQb2x5Z29uXG4gKiBpbiBFSVAtMTU1OSBmb3JtYXQuIFRoZXJlZm9yZSwgd2UnbGwgdXNlIHRoZSAnZmFzdCcgZ2FzIGFzIGFcbiAqIGBtYXhQcmlvcml0eUZlZVBlckdhc2AgZXN0aW1hdGUuIFRoaXMgYWN0dWFsbHkgd29ya3Mgb3V0IG9rYXkgYmVjYXVzZVxuICogdGhlIFBvbHlnb24gYmFzZSBmZWUgaXMgYWx3YXlzIGVzc2VudGlhbGx5IHplcm8gYXMgb2YgQXByaWwgMjAyMi5cbiAqL1xuZXhwb3J0IGNsYXNzIEdhc1N0YXRpb25BdHRlbmRhbnRQb2x5Z29uIGltcGxlbWVudHMgR2FzU3RhdGlvbkF0dGVuZGFudCB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfZ2FzT3JhY2xlVHlwZTA6IEdhc09yYWNsZVR5cGUwO1xuXG4gICAgY29uc3RydWN0b3IoZ2FzT3JhY2xlVHlwZTA6IEdhc09yYWNsZVR5cGUwKSB7XG4gICAgICAgIHRoaXMuX2dhc09yYWNsZVR5cGUwID0gZ2FzT3JhY2xlVHlwZTA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGhlIFNhZmUgQmFsYW5jZSBGb3IgVHJhZGUgaXMgZnJvbSB0aGUgcDk1IGRhdGEgc2hvd24gaGVyZTpcbiAgICAgKiBodHRwczovLzB4cHJvamVjdC5zbGFjay5jb20vYXJjaGl2ZXMvQ1FHMFpHQkZTL3AxNjQ5NzA4OTc3NDUyNDY5XG4gICAgICovXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBwcmVmZXItZnVuY3Rpb24tb3Zlci1tZXRob2RcbiAgICBwdWJsaWMgYXN5bmMgZ2V0U2FmZUJhbGFuY2VGb3JUcmFkZUFzeW5jKCk6IFByb21pc2U8V2VpPiB7XG4gICAgICAgIGNvbnN0IHA5NVByaW9yaXR5RmVlR3dlaSA9IDI2MTtcbiAgICAgICAgLy8gQmFzZSBmZWUgaXMgZXNzZW50aWFsbHkgemVyb1xuICAgICAgICAvLyBUT0RPIChyaGlub2RhdmlkKTogTWFrZSB0aGlzIHNtYXJ0ZXIgYXMgd2UgaGF2ZSBtb3JlIGhpc3RvcmljYWwgZGF0YVxuICAgICAgICBjb25zdCBnYXNFc3RpbWF0ZSA9IFJGUU1fVFhfT1RDX09SREVSX0dBU19FU1RJTUFURTtcbiAgICAgICAgLy8gMC4wMjYxIE1BVElDXG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKHA5NVByaW9yaXR5RmVlR3dlaSkuc2hpZnRlZEJ5KEdXRUlfREVDSU1BTFMpLnRpbWVzKGdhc0VzdGltYXRlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2VzIHRoZSBjdXJyZW50IGZhc3QgZ2FzIHByaWNlIGFzIHRoZSBgbWF4UHJpb3JpdHlGZWVQZXJHYXNgXG4gICAgICogZXN0aW1hdGUuIFBsYW5zIGZvciAzIHJlc3VibWl0cyBhdCBhIDEwJSB0aXAgaW5jcmVhc2UuIEFzc3VtZXNcbiAgICAgKiBubyBiYXNlIGZlZS5cbiAgICAgKlxuICAgICAqIFVzZXMgYSBmaXhlZCB2YWx1ZSBvZiAxMTAsMDAwIGZvciB0aGUgdHJhbnNhY3Rpb24gZ2FzIGFtb3VudFxuICAgICAqIGVzdGltYXRlLlxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRXb3JrZXJCYWxhbmNlRm9yVHJhZGVBc3luYygpOiBQcm9taXNlPFdlaVBlckdhcz4ge1xuICAgICAgICAvLyBUT0RPIChyaGlub2RhdmlkKTogT25jZSB0aGUgMHggZ2FzIG9yYWNsZSBjYW4gZ2l2ZSBFSVAtMTU1OSBkYXRhIGZvciBQb2x5Z29uXG4gICAgICAgIC8vIHVzZSB0aGF0IGluc3RlYWQgb2YgdGhlIGxlZ2FjeSBmYXN0IGdhcyBwcmljZS5cbiAgICAgICAgY29uc3QgZ2FzUHJpY2VFc3RpbWF0ZVdlaSA9IGF3YWl0IHRoaXMuX2dhc09yYWNsZVR5cGUwLmdldEdhc1dlaUFzeW5jKCdmYXN0Jyk7XG4gICAgICAgIGxvZ2dlci5pbmZvKHsgZ2FzUHJpY2VFc3RpbWF0ZVdlaTogZ2FzUHJpY2VFc3RpbWF0ZVdlaS50b1N0cmluZygpIH0sICdQb2x5Z29uIGZhc3QgZ2FzIHByaWNlIGVzdGltYXRlICh3ZWkpJyk7XG5cbiAgICAgICAgLy8gU2luY2UgdGhlIGJhc2UgZmVlIGlzIGJhc2ljYWxseSBub3RoaW5nLCB1c2UgdGhpcyBmb3Igb3VyIGluaXRpYWwgbWF4IHByaW9yaXR5IGZlZVxuICAgICAgICBjb25zdCBtYXhQcmlvcml0eUZlZVBlckdhcyA9IGdhc1ByaWNlRXN0aW1hdGVXZWk7XG5cbiAgICAgICAgLy8gUGFkIHRoZSB0aXAgZm9yIDMgMTAlIGluY3JlYXNlc1xuICAgICAgICBjb25zdCBtYXhQcmlvcml0eUZlZVBhZCA9IE1hdGgucG93KFRFTl9QRVJDRU5UX0lOQ1JFQVNFLCAzKTsgLy8gdHNsaW50OmRpc2FibGUtbGluZTogY3VzdG9tLW5vLW1hZ2ljLW51bWJlcnNcbiAgICAgICAgY29uc3QgcGFkZGVkTWF4UHJpb3JpdHlGZWVQZXJHYXMgPSBtYXhQcmlvcml0eUZlZVBlckdhcy50aW1lcyhtYXhQcmlvcml0eUZlZVBhZCk7XG4gICAgICAgIGNvbnN0IGdhc1JhdGVXZWkgPSBCaWdOdW1iZXIubWF4KHBhZGRlZE1heFByaW9yaXR5RmVlUGVyR2FzLnBsdXMoMCksIE1JTklNVU1fQklEX1dFSSk7IC8vIEFtb3J0aXppbmcgdGhlIGJhc2UgZmVlIHRvIDBcblxuICAgICAgICAvLyBQYWQgYSBsaXR0bGUgdW50aWwgd2UgZ2V0IGEgYmV0dGVyIGlkZWEgb2YgdG9rZW4tc3BlY2lmaWMgY29zdHNcbiAgICAgICAgY29uc3QgcGFkZGluZyA9IDEuMTtcbiAgICAgICAgY29uc3QgZ2FzRXN0aW1hdGUgPSBSRlFNX1RYX09UQ19PUkRFUl9HQVNfRVNUSU1BVEUgKiBwYWRkaW5nO1xuXG4gICAgICAgIHJldHVybiBnYXNSYXRlV2VpLnRpbWVzKGdhc0VzdGltYXRlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGVkIHVzaW5nIGEgc2ltaWxhciBtZXRob2RvbG9neSB0byBgZ2V0V29ya2VyQmFsYW5jZUZvclRyYWRlQXN5bmNgLFxuICAgICAqIGJ1dCBhc3N1bWVzIHdlIHN1Ym1pdCBhbmQgYXZlcmFnZSAxLjUgdHJhbnNhY3Rpb25zIHBlciB0cmFkZSwgd2hpY2ggaXNcbiAgICAgKiB3aGF0IHdlIHNlZSBvbiBFdGhlcmV1bS5cbiAgICAgKlxuICAgICAqIFRPRE8gKHJoaW5vZGF2aWQpOiBVcGRhdGUgdGhpcyBvbmNlIHdlIGhhdmUgbW9yZSBoaXN0b3JpY2FsIGRhdGFcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgZ2V0RXhwZWN0ZWRUcmFuc2FjdGlvbkdhc1JhdGVBc3luYygpOiBQcm9taXNlPFdlaVBlckdhcz4ge1xuICAgICAgICBjb25zdCBnYXNQcmljZUVzdGltYXRlV2VpID0gYXdhaXQgdGhpcy5fZ2FzT3JhY2xlVHlwZTAuZ2V0R2FzV2VpQXN5bmMoJ2Zhc3QnKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oeyBnYXNQcmljZUVzdGltYXRlV2VpOiBnYXNQcmljZUVzdGltYXRlV2VpLnRvU3RyaW5nKCkgfSwgJ1BvbHlnb24gZmFzdCBnYXMgcHJpY2UgZXN0aW1hdGUgKHdlaSknKTtcblxuICAgICAgICAvLyBTaW5jZSB0aGUgYmFzZSBmZWUgaXMgYmFzaWNhbGx5IG5vdGhpbmcsIHVzZSB0aGlzIGZvciBvdXIgaW5pdGlhbCBtYXggcHJpb3JpdHkgZmVlXG4gICAgICAgIGNvbnN0IG1heFByaW9yaXR5RmVlUGVyR2FzID0gZ2FzUHJpY2VFc3RpbWF0ZVdlaTtcblxuICAgICAgICAvLyBQYWQgdGhlIHRpcCBmb3IgMS41IDEwJSBpbmNyZWFzZXNcbiAgICAgICAgY29uc3QgYmFzZUZlZVBhZCA9IE1hdGgucG93KFRFTl9QRVJDRU5UX0lOQ1JFQVNFLCAxLjUpOyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOiBjdXN0b20tbm8tbWFnaWMtbnVtYmVyc1xuICAgICAgICBjb25zdCBwYWRkZWRNYXhQcmlvcml0eUZlZVBlckdhcyA9IG1heFByaW9yaXR5RmVlUGVyR2FzLnRpbWVzKGJhc2VGZWVQYWQpO1xuICAgICAgICBjb25zdCBnYXNSYXRlV2VpID0gcGFkZGVkTWF4UHJpb3JpdHlGZWVQZXJHYXMucGx1cygwKTsgLy8gQW1vcnRpemluZyB0aGUgYmFzZSBmZWUgdG8gMFxuXG4gICAgICAgIGxvZ2dlci5pbmZvKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGdhc1ByaWNlRXN0aW1hdGVXZWksXG4gICAgICAgICAgICAgICAgbWF4UHJpb3JpdHlGZWVQZXJHYXMsXG4gICAgICAgICAgICAgICAgYmFzZUZlZVBhZCxcbiAgICAgICAgICAgICAgICBwYWRkZWRNYXhQcmlvcml0eUZlZVBlckdhcyxcbiAgICAgICAgICAgICAgICBnYXNSYXRlV2VpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdHYXMgdmFyaWFibGVzIGluIFBsb3lnb24gYGdldEV4cGVjdGVkVHJhbnNhY3Rpb25HYXNSYXRlQXN5bmNgJyxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gZ2FzUmF0ZVdlaS5pbnRlZ2VyVmFsdWUoQmlnTnVtYmVyLlJPVU5EX0NFSUwpO1xuICAgIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==