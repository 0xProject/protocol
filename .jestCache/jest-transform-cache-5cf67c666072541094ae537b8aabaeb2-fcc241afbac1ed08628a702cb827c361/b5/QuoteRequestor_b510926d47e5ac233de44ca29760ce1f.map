{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/quoteRequestor/QuoteRequestor.ts","mappings":"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","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/quoteRequestor/QuoteRequestor.ts"],"sourcesContent":["// tslint:disable: max-file-line-count\nimport { schemas, SchemaValidator } from '@0x/json-schemas';\nimport { FillQuoteTransformerOrderType, Signature } from '@0x/protocol-utils';\nimport { MarketOperation } from '@0x/types';\nimport { BigNumber, NULL_ADDRESS } from '@0x/utils';\nimport axios, { AxiosInstance } from 'axios';\n\nimport { Integrator, RFQ_PRICE_ENDPOINT_TIMEOUT_MS } from '../config';\nimport { ONE_SECOND_MS } from '../core/constants';\nimport { toPairString } from '../core/pair_utils';\nimport { Fee, SignedNativeOrder } from '../core/types';\nimport { logger } from '../logger';\nimport {\n    TakerRequestQueryParamsUnnested,\n    V4RFQFirmQuote,\n    V4SignedRfqOrder,\n    V4RFQIndicativeQuote,\n} from '../quote-server/types';\nimport { RfqMakerAssetOfferings } from '../utils/rfq_maker_manager';\n\nimport { returnQuoteFromAltMMAsync } from './altMmImplementaionUtils';\nimport { AltQuoteModel, AltRfqMakerAssetOfferings } from './altMmTypes';\nimport { RfqMakerBlacklist } from './rfqMakerBlacklist';\n\n// Matches value at\n// https://github.com/0xProject/protocol/blob/d3d4a08f917a084f72b649fc1b0b322c22f98129/packages/asset-swapper/src/constants.ts#L34\nconst EXPIRY_BUFFER_MS = 120000;\nconst MAKER_TIMEOUT_STREAK_LENGTH = 10;\nconst MAKER_TIMEOUT_BLACKLIST_DURATION_MINUTES = 10;\nconst FILL_RATIO_WARNING_LEVEL = 0.99;\nconst rfqMakerBlacklist = new RfqMakerBlacklist(MAKER_TIMEOUT_STREAK_LENGTH, MAKER_TIMEOUT_BLACKLIST_DURATION_MINUTES);\n\n// Stables\nconst USDC = '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48';\nconst USDT = '0xdac17f958d2ee523a2206206994597c13d831ec7';\nconst DAI = '0x6b175474e89094c44da98b954eedeac495271d0f';\nconst BUSD = '0x4fabb145d64652a948d72533023f6e7a623c7c53';\nconst TUSD = '0x0000000000085d4780b73119b644ae5ecd22b376';\n\n// Other assets\nconst WETH = '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2';\nconst WBTC = '0x2260fac5e5542a773aa44fbcfedf7c193bc2c599';\nconst MATIC = '0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0';\nconst DISABLED_RFQT_V1_TOKENS = [USDC, USDT, DAI, BUSD, TUSD, WETH, WBTC, MATIC];\nconst DISABLED_RFQT_V1_PAIRS_SET = new Set(\n    DISABLED_RFQT_V1_TOKENS.flatMap((token) =>\n        DISABLED_RFQT_V1_TOKENS.filter((t) => t !== token).map((otherToken) => toPairString(token, otherToken)),\n    ),\n);\n\nenum RfqPairType {\n    Standard = 'standard',\n    Alt = 'alt',\n}\n\ninterface TypedMakerUrl {\n    url: string;\n    pairType: RfqPairType;\n}\n\nexport interface RfqRequestOpts {\n    takerAddress: string;\n    txOrigin: string;\n    integrator: Integrator;\n    intentOnFilling: boolean;\n    isIndicative?: boolean;\n    makerEndpointMaxResponseTimeMs?: number;\n    nativeExclusivelyRFQ?: boolean;\n    altRfqAssetOfferings?: AltRfqMakerAssetOfferings;\n    isLastLook?: boolean;\n    fee?: Fee;\n}\n\ninterface RfqQuote<T> {\n    response: T;\n    makerUri: string;\n}\n\nexport interface V4RFQIndicativeQuoteMM extends V4RFQIndicativeQuote {\n    makerUri: string;\n}\n\nexport type SignedNativeOrderMM = SignedNativeOrder & { makerUri?: string };\n\nexport interface MetricsProxy {\n    /**\n     * Increments a counter that is tracking valid Firm Quotes that are dropped due to low expiration.\n     * @param isLastLook mark if call is coming from RFQM\n     * @param maker the maker address\n     */\n    incrementExpirationToSoonCounter(isLastLook: boolean, maker: string): void;\n\n    /**\n     * Keeps track of summary statistics for expiration on Firm Quotes.\n     * @param isLastLook mark if call is coming from RFQM\n     * @param maker the maker address\n     * @param expirationTimeSeconds the expiration time in seconds\n     */\n    measureExpirationForValidOrder(isLastLook: boolean, maker: string, expirationTimeSeconds: BigNumber): void;\n\n    /**\n     * Increments a counter that tracks when an order is not fully fillable.\n     * @param isLastLook mark if call is coming from RFQM\n     * @param maker the maker address\n     * @param expirationTimeSeconds the expiration time in seconds\n     */\n    incrementFillRatioWarningCounter(isLastLook: boolean, maker: string): void;\n\n    /**\n     * Logs the outcome of a network (HTTP) interaction with a market maker.\n     *\n     * @param interaction.isLastLook true if the request is RFQM\n     * @param interaction.integrator the integrator that is requesting the RFQ quote\n     * @param interaction.url the URL of the market maker\n     * @param interaction.quoteType indicative or firm quote\n     * @param interaction.statusCode the statusCode returned by a market maker\n     * @param interaction.latencyMs the latency of the HTTP request (in ms)\n     * @param interaction.included if a firm quote that was returned got included in the next step of processing.\n     *                             NOTE: this does not mean that the request returned a valid fillable order. It just\n     *                             means that the network response was successful.\n     */\n    logRfqMakerNetworkInteraction(interaction: {\n        isLastLook: boolean;\n        integrator: Integrator;\n        url: string;\n        quoteType: 'firm' | 'indicative';\n        statusCode: number | undefined;\n        latencyMs: number;\n        included: boolean;\n        sellTokenAddress: string;\n        buyTokenAddress: string;\n    }): void;\n}\n\n/**\n * Request quotes from RFQ-T providers\n */\n\nfunction hasExpectedAddresses(comparisons: [string, string][]): boolean {\n    return comparisons.every((c) => c[0].toLowerCase() === c[1].toLowerCase());\n}\n\n// $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction convertIfAxiosError(error: any): Error | object /* axios' .d.ts has AxiosError.toJSON() returning object */ {\n    // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n    // eslint-disable-next-line no-prototype-builtins\n    if (error.hasOwnProperty('isAxiosError') && error.isAxiosError) {\n        const { message, name, config } = error;\n        const { headers, timeout, httpsAgent } = config;\n        const { keepAlive, keepAliveMsecs, sockets } = httpsAgent;\n\n        const socketCounts: { [key: string]: number } = {};\n        for (const socket of Object.keys(sockets)) {\n            socketCounts[socket] = sockets[socket].length;\n        }\n\n        return {\n            message,\n            name,\n            config: {\n                headers,\n                timeout,\n                httpsAgent: {\n                    keepAlive,\n                    keepAliveMsecs,\n                    socketCounts,\n                },\n            },\n        };\n    } else {\n        return error;\n    }\n}\n\nfunction nativeDataToId(data: { signature: Signature }): string {\n    const { v, r, s } = data.signature;\n    return `${v}${r}${s}`;\n}\n\nexport class QuoteRequestor {\n    private readonly _schemaValidator: SchemaValidator = new SchemaValidator();\n    private readonly _orderSignatureToMakerUri: { [signature: string]: string } = {};\n\n    public static makeQueryParameters(\n        txOrigin: string,\n        takerAddress: string,\n        marketOperation: MarketOperation,\n        buyTokenAddress: string, // maker token\n        sellTokenAddress: string, // taker token\n        assetFillAmount: BigNumber,\n        comparisonPrice?: BigNumber,\n        isLastLook?: boolean | undefined,\n        fee?: Fee | undefined,\n    ): TakerRequestQueryParamsUnnested {\n        const { buyAmountBaseUnits, sellAmountBaseUnits } =\n            marketOperation === MarketOperation.Buy\n                ? {\n                      buyAmountBaseUnits: assetFillAmount,\n                      sellAmountBaseUnits: undefined,\n                  }\n                : {\n                      sellAmountBaseUnits: assetFillAmount,\n                      buyAmountBaseUnits: undefined,\n                  };\n\n        const requestParamsWithBigNumbers: Pick<\n            TakerRequestQueryParamsUnnested,\n            | 'txOrigin'\n            | 'takerAddress'\n            | 'buyTokenAddress'\n            | 'sellTokenAddress'\n            | 'comparisonPrice'\n            | 'isLastLook'\n            | 'protocolVersion'\n            | 'feeAmount'\n            | 'feeToken'\n            | 'feeType'\n        > = {\n            txOrigin,\n            takerAddress,\n            buyTokenAddress,\n            sellTokenAddress,\n            comparisonPrice: comparisonPrice === undefined ? undefined : comparisonPrice.toString(),\n            protocolVersion: '4',\n        };\n        if (isLastLook) {\n            if (fee === undefined) {\n                throw new Error(`isLastLook cannot be passed without a fee parameter`);\n            }\n            requestParamsWithBigNumbers.isLastLook = isLastLook.toString();\n            requestParamsWithBigNumbers.feeAmount = fee.amount.toString();\n            requestParamsWithBigNumbers.feeToken = fee.token;\n            requestParamsWithBigNumbers.feeType = fee.type;\n        }\n\n        // convert BigNumbers to strings\n        // so they are digestible by axios\n        if (sellAmountBaseUnits) {\n            return {\n                ...requestParamsWithBigNumbers,\n                sellAmountBaseUnits: sellAmountBaseUnits.toString(),\n            };\n        } else if (buyAmountBaseUnits) {\n            return {\n                ...requestParamsWithBigNumbers,\n                buyAmountBaseUnits: buyAmountBaseUnits.toString(),\n            };\n        } else {\n            throw new Error('Neither \"buyAmountBaseUnits\" or \"sellAmountBaseUnits\" were defined');\n        }\n    }\n\n    /**\n     * Gets both standard RFQ makers and \"alternative\" RFQ makers and combines them together\n     * in a single configuration map. If an integration key whitelist is present, it will be used\n     * to filter a specific makers.\n     *\n     * @param options the RfqmRequestOptions passed in\n     * @param assetOfferings the RFQM or RFQT maker offerings\n     * @returns a list of TypedMakerUrl instances\n     */\n    public static getTypedMakerUrlsAndWhitelist(\n        options: { integrator: Integrator; altRfqAssetOfferings?: AltRfqMakerAssetOfferings },\n        assetOfferings: RfqMakerAssetOfferings,\n    ): TypedMakerUrl[] {\n        const standardUrls = Object.keys(assetOfferings).map((mm: string): TypedMakerUrl => {\n            return { pairType: RfqPairType.Standard, url: mm };\n        });\n        const altUrls = options.altRfqAssetOfferings\n            ? Object.keys(options.altRfqAssetOfferings).map((mm: string): TypedMakerUrl => {\n                  return { pairType: RfqPairType.Alt, url: mm };\n              })\n            : [];\n\n        let typedMakerUrls = standardUrls.concat(altUrls);\n\n        // If there is a whitelist, only allow approved maker URLs\n        if (options.integrator.whitelistIntegratorUrls !== undefined) {\n            const whitelist = new Set(options.integrator.whitelistIntegratorUrls.map((key) => key.toLowerCase()));\n            typedMakerUrls = typedMakerUrls.filter((makerUrl) => whitelist.has(makerUrl.url.toLowerCase()));\n        }\n        return typedMakerUrls;\n    }\n\n    public static getDurationUntilExpirationMs(expirationTimeSeconds: BigNumber): BigNumber {\n        const expirationTimeMs = expirationTimeSeconds.times(ONE_SECOND_MS);\n        const currentTimeMs = new BigNumber(Date.now());\n        return BigNumber.max(expirationTimeMs.minus(currentTimeMs), 0);\n    }\n\n    private static _makerSupportsPair(\n        typedMakerUrl: TypedMakerUrl,\n        makerToken: string,\n        takerToken: string,\n        altMakerAssetOfferings: AltRfqMakerAssetOfferings | undefined,\n        assetOfferings: RfqMakerAssetOfferings | undefined,\n    ): boolean {\n        // Turn off RFQt v1 for these pairs\n        if (DISABLED_RFQT_V1_PAIRS_SET.has(toPairString(makerToken, takerToken))) {\n            return false;\n        }\n        if (typedMakerUrl.pairType === RfqPairType.Standard && assetOfferings) {\n            for (const assetPair of assetOfferings[typedMakerUrl.url]) {\n                if (\n                    (assetPair[0] === makerToken && assetPair[1] === takerToken) ||\n                    (assetPair[0] === takerToken && assetPair[1] === makerToken)\n                ) {\n                    return true;\n                }\n            }\n        } else if (typedMakerUrl.pairType === RfqPairType.Alt && altMakerAssetOfferings) {\n            for (const altAssetPair of altMakerAssetOfferings[typedMakerUrl.url]) {\n                if (\n                    (altAssetPair.baseAsset === makerToken && altAssetPair.quoteAsset === takerToken) ||\n                    (altAssetPair.baseAsset === takerToken && altAssetPair.quoteAsset === makerToken)\n                ) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    constructor(\n        private readonly _rfqtAssetOfferings: RfqMakerAssetOfferings,\n        private readonly _quoteRequestorHttpClient: AxiosInstance,\n        private readonly _altRfqCreds?: { altRfqApiKey: string; altRfqProfile: string },\n        private readonly _expiryBufferMs: number = EXPIRY_BUFFER_MS,\n        private readonly _metrics?: MetricsProxy,\n    ) {}\n\n    public async requestRfqtFirmQuotesAsync(\n        makerToken: string, // maker token\n        takerToken: string, // taker token\n        assetFillAmount: BigNumber,\n        marketOperation: MarketOperation,\n        comparisonPrice: BigNumber | undefined,\n        options: RfqRequestOpts,\n    ): Promise<SignedNativeOrder[]> {\n        const _opts: RfqRequestOpts = { makerEndpointMaxResponseTimeMs: RFQ_PRICE_ENDPOINT_TIMEOUT_MS, ...options };\n        if (!_opts.txOrigin || [undefined, '', '0x', NULL_ADDRESS].includes(_opts.txOrigin)) {\n            throw new Error('RFQ-T firm quotes require the presence of a tx origin');\n        }\n\n        return this._fetchAndValidateFirmQuotesAsync(\n            makerToken,\n            takerToken,\n            assetFillAmount,\n            marketOperation,\n            comparisonPrice,\n            _opts,\n            this._rfqtAssetOfferings,\n        );\n    }\n\n    public async requestRfqtIndicativeQuotesAsync(\n        makerToken: string,\n        takerToken: string,\n        assetFillAmount: BigNumber,\n        marketOperation: MarketOperation,\n        comparisonPrice: BigNumber | undefined,\n        options: RfqRequestOpts,\n    ): Promise<V4RFQIndicativeQuoteMM[]> {\n        const _opts: RfqRequestOpts = { makerEndpointMaxResponseTimeMs: RFQ_PRICE_ENDPOINT_TIMEOUT_MS, ...options };\n        // Originally a takerAddress was required for indicative quotes, but\n        // now we've eliminated that requirement.  @0x/quote-server, however,\n        // is still coded to expect a takerAddress.  So if the client didn't\n        // send one, just use the null address to satisfy the quote server's\n        // expectations.\n        if (!_opts.takerAddress) {\n            _opts.takerAddress = NULL_ADDRESS;\n        }\n        if (!_opts.txOrigin) {\n            _opts.txOrigin = NULL_ADDRESS;\n        }\n        return this._fetchAndValidateIndicativeQuotesAsync(\n            makerToken,\n            takerToken,\n            assetFillAmount,\n            marketOperation,\n            comparisonPrice,\n            _opts,\n            this._rfqtAssetOfferings,\n        );\n    }\n\n    /**\n     * Given an order signature, returns the makerUri that the order originated from\n     */\n    public getMakerUriForSignature(signature: Signature): string | undefined {\n        return this._orderSignatureToMakerUri[nativeDataToId({ signature })];\n    }\n\n    private _isValidRfqtIndicativeQuoteResponse(response: V4RFQIndicativeQuoteMM): boolean {\n        const requiredKeys: (keyof V4RFQIndicativeQuoteMM)[] = [\n            'makerAmount',\n            'takerAmount',\n            'makerToken',\n            'takerToken',\n            'expiry',\n        ];\n\n        for (const k of requiredKeys) {\n            if (response[k] === undefined) {\n                return false;\n            }\n        }\n        // TODO (jacob): I have a feeling checking 5 schemas is slower then checking one\n        const hasValidMakerAssetAmount = this._schemaValidator.isValid(response.makerAmount, schemas.wholeNumberSchema);\n        const hasValidTakerAssetAmount = this._schemaValidator.isValid(response.takerAmount, schemas.wholeNumberSchema);\n        const hasValidMakerToken = this._schemaValidator.isValid(response.makerToken, schemas.hexSchema);\n        const hasValidTakerToken = this._schemaValidator.isValid(response.takerToken, schemas.hexSchema);\n        const hasValidExpirationTimeSeconds = this._schemaValidator.isValid(response.expiry, schemas.wholeNumberSchema);\n        if (\n            !hasValidMakerAssetAmount ||\n            !hasValidTakerAssetAmount ||\n            !hasValidMakerToken ||\n            !hasValidTakerToken ||\n            !hasValidExpirationTimeSeconds\n        ) {\n            return false;\n        }\n        return true;\n    }\n\n    private async _getQuotesAsync<ResponseT>(\n        makerToken: string,\n        takerToken: string,\n        assetFillAmount: BigNumber,\n        marketOperation: MarketOperation,\n        comparisonPrice: BigNumber | undefined,\n        options: RfqRequestOpts,\n        quoteType: 'firm' | 'indicative',\n        assetOfferings: RfqMakerAssetOfferings,\n    ): Promise<RfqQuote<ResponseT>[]> {\n        const requestParams = QuoteRequestor.makeQueryParameters(\n            options.txOrigin,\n            options.takerAddress,\n            marketOperation,\n            makerToken,\n            takerToken,\n            assetFillAmount,\n            comparisonPrice,\n            options.isLastLook,\n            options.fee,\n        );\n\n        const quotePath = (() => {\n            switch (quoteType) {\n                case 'firm':\n                    return 'quote';\n                case 'indicative':\n                    return 'price';\n                default:\n                    throw new Error(`Unexpected quote type ${quoteType}`);\n            }\n        })();\n\n        const timeoutMs = options.makerEndpointMaxResponseTimeMs || RFQ_PRICE_ENDPOINT_TIMEOUT_MS;\n        const bufferMs = 20;\n\n        // Set Timeout on CancelToken\n        const cancelTokenSource = axios.CancelToken.source();\n        setTimeout(() => {\n            cancelTokenSource.cancel('timeout via cancel token');\n        }, timeoutMs + bufferMs);\n\n        const typedMakerUrls = QuoteRequestor.getTypedMakerUrlsAndWhitelist(options, assetOfferings);\n        const quotePromises = typedMakerUrls.map(async (typedMakerUrl) => {\n            // filter out requests to skip\n            const isBlacklisted = rfqMakerBlacklist.isMakerBlacklisted(typedMakerUrl.url);\n            const partialLogEntry = { url: typedMakerUrl.url, quoteType, requestParams, isBlacklisted };\n            const { isLastLook, integrator } = options;\n            const { sellTokenAddress, buyTokenAddress } = requestParams;\n            if (isBlacklisted) {\n                this._metrics?.logRfqMakerNetworkInteraction({\n                    isLastLook: false,\n                    url: typedMakerUrl.url,\n                    quoteType,\n                    statusCode: undefined,\n                    sellTokenAddress,\n                    buyTokenAddress,\n                    latencyMs: 0,\n                    included: false,\n                    integrator,\n                });\n                logger.info({ rfqtMakerInteraction: { ...partialLogEntry } });\n                return;\n            } else if (\n                !QuoteRequestor._makerSupportsPair(\n                    typedMakerUrl,\n                    makerToken,\n                    takerToken,\n                    options.altRfqAssetOfferings,\n                    assetOfferings,\n                )\n            ) {\n                return;\n            } else {\n                // make request to MM\n                const timeBeforeAwait = Date.now();\n                try {\n                    if (typedMakerUrl.pairType === RfqPairType.Standard) {\n                        const response = await this._quoteRequestorHttpClient.get(`${typedMakerUrl.url}/${quotePath}`, {\n                            headers: {\n                                '0x-api-key': options.integrator.integratorId,\n                                '0x-integrator-id': options.integrator.integratorId,\n                            },\n                            params: requestParams,\n                            timeout: timeoutMs,\n                            cancelToken: cancelTokenSource.token,\n                        });\n                        const latencyMs = Date.now() - timeBeforeAwait;\n                        this._metrics?.logRfqMakerNetworkInteraction({\n                            isLastLook: isLastLook || false,\n                            url: typedMakerUrl.url,\n                            quoteType,\n                            statusCode: response.status,\n                            sellTokenAddress,\n                            buyTokenAddress,\n                            latencyMs,\n                            included: true,\n                            integrator,\n                        });\n                        logger.info({\n                            rfqtMakerInteraction: {\n                                ...partialLogEntry,\n                                response: {\n                                    included: true,\n                                    apiKey: options.integrator.integratorId,\n                                    takerAddress: requestParams.takerAddress,\n                                    txOrigin: requestParams.txOrigin,\n                                    statusCode: response.status,\n                                    latencyMs,\n                                },\n                            },\n                        });\n                        rfqMakerBlacklist.logTimeoutOrLackThereof(typedMakerUrl.url, latencyMs >= timeoutMs);\n                        return {\n                            response: { ...response.data, makerUri: typedMakerUrl.url },\n                            makerUri: typedMakerUrl.url,\n                        };\n                    } else {\n                        if (this._altRfqCreds === undefined) {\n                            throw new Error(`don't have credentials for alt MM`);\n                        }\n                        const quote = await returnQuoteFromAltMMAsync<ResponseT>(\n                            typedMakerUrl.url,\n                            this._altRfqCreds.altRfqApiKey,\n                            this._altRfqCreds.altRfqProfile,\n                            options.integrator.integratorId,\n                            quoteType === 'firm' ? AltQuoteModel.Firm : AltQuoteModel.Indicative,\n                            makerToken,\n                            takerToken,\n                            timeoutMs,\n                            options.altRfqAssetOfferings || {},\n                            requestParams,\n                            this._quoteRequestorHttpClient,\n                            cancelTokenSource.token,\n                        );\n\n                        const latencyMs = Date.now() - timeBeforeAwait;\n                        this._metrics?.logRfqMakerNetworkInteraction({\n                            isLastLook: isLastLook || false,\n                            url: typedMakerUrl.url,\n                            quoteType,\n                            statusCode: quote.status,\n                            sellTokenAddress,\n                            buyTokenAddress,\n                            latencyMs,\n                            included: true,\n                            integrator,\n                        });\n                        logger.info({\n                            rfqtMakerInteraction: {\n                                ...partialLogEntry,\n                                response: {\n                                    included: true,\n                                    apiKey: options.integrator.integratorId,\n                                    takerAddress: requestParams.takerAddress,\n                                    txOrigin: requestParams.txOrigin,\n                                    statusCode: quote.status,\n                                    latencyMs,\n                                },\n                            },\n                        });\n                        rfqMakerBlacklist.logTimeoutOrLackThereof(typedMakerUrl.url, latencyMs >= timeoutMs);\n                        return { response: quote.data, makerUri: typedMakerUrl.url };\n                    }\n                } catch (err) {\n                    // log error if any\n                    const latencyMs = Date.now() - timeBeforeAwait;\n                    this._metrics?.logRfqMakerNetworkInteraction({\n                        isLastLook: isLastLook || false,\n                        url: typedMakerUrl.url,\n                        quoteType,\n                        statusCode: err.response?.status,\n                        sellTokenAddress,\n                        buyTokenAddress,\n                        latencyMs,\n                        included: false,\n                        integrator,\n                    });\n                    logger.info({\n                        rfqtMakerInteraction: {\n                            ...partialLogEntry,\n                            response: {\n                                included: false,\n                                apiKey: options.integrator.integratorId,\n                                takerAddress: requestParams.takerAddress,\n                                txOrigin: requestParams.txOrigin,\n                                statusCode: err.response ? err.response.status : undefined,\n                                latencyMs,\n                            },\n                        },\n                    });\n                    rfqMakerBlacklist.logTimeoutOrLackThereof(typedMakerUrl.url, latencyMs >= timeoutMs);\n                    logger.warn(\n                        convertIfAxiosError(err),\n                        `Failed to get RFQ-T ${quoteType} quote from market maker endpoint ${typedMakerUrl.url} for integrator ${options.integrator.integratorId} (${options.integrator.label}) for taker address ${options.takerAddress} and tx origin ${options.txOrigin}`,\n                    );\n                    return;\n                }\n            }\n        });\n\n        const results = (await Promise.all(quotePromises)).filter((x) => x !== undefined);\n        return results as RfqQuote<ResponseT>[];\n    }\n    private async _fetchAndValidateFirmQuotesAsync(\n        makerToken: string,\n        takerToken: string,\n        assetFillAmount: BigNumber,\n        marketOperation: MarketOperation,\n        comparisonPrice: BigNumber | undefined,\n        options: RfqRequestOpts,\n        assetOfferings: RfqMakerAssetOfferings,\n    ): Promise<SignedNativeOrder[]> {\n        const quotesRaw = await this._getQuotesAsync<V4RFQFirmQuote>(\n            makerToken,\n            takerToken,\n            assetFillAmount,\n            marketOperation,\n            comparisonPrice,\n            options,\n            'firm',\n            assetOfferings,\n        );\n        const quotes = quotesRaw.map((result) => ({ ...result, response: result.response.signedOrder }));\n\n        // validate\n        const validationFunction = (o: V4SignedRfqOrder) => {\n            try {\n                // Handle the validate throwing, i.e if it isn't an object or json response\n                return this._schemaValidator.isValid(o, schemas.v4RfqSignedOrderSchema);\n            } catch (e) {\n                return false;\n            }\n        };\n        const validQuotes = quotes.filter((result) => {\n            const order = result.response;\n            if (!validationFunction(order)) {\n                logger.warn(result, 'Invalid RFQ-T firm quote received, filtering out');\n                return false;\n            }\n            if (\n                !hasExpectedAddresses([\n                    [makerToken, order.makerToken],\n                    [takerToken, order.takerToken],\n                    [options.takerAddress, order.taker],\n                    [options.txOrigin, order.txOrigin],\n                ])\n            ) {\n                logger.warn(order, 'Unexpected token, tx origin or taker address in RFQ-T order, filtering out');\n                return false;\n            }\n            const isLastLook = Boolean(options.isLastLook);\n            const msRemainingUntilExpiration = QuoteRequestor.getDurationUntilExpirationMs(new BigNumber(order.expiry));\n            const isExpirationTooSoon = msRemainingUntilExpiration.lt(this._expiryBufferMs);\n            if (isExpirationTooSoon) {\n                logger.warn(order, 'Expiry too soon in RFQ-T firm quote, filtering out');\n                this._metrics?.incrementExpirationToSoonCounter(isLastLook, order.maker);\n                return false;\n            } else {\n                const secondsRemaining = msRemainingUntilExpiration.div(ONE_SECOND_MS);\n                this._metrics?.measureExpirationForValidOrder(isLastLook, order.maker, secondsRemaining);\n                const takerAmount = new BigNumber(order.takerAmount);\n                const fillRatio = takerAmount.div(assetFillAmount);\n                if (fillRatio.lt(1) && fillRatio.gte(FILL_RATIO_WARNING_LEVEL)) {\n                    logger.warn(\n                        {\n                            makerUri: result.makerUri,\n                            fillRatio,\n                            assetFillAmount,\n                            takerToken,\n                            makerToken,\n                            takerAmount: order.takerAmount,\n                            makerAmount: order.makerAmount,\n                        },\n                        'Fill ratio in warning range',\n                    );\n                    this._metrics?.incrementFillRatioWarningCounter(isLastLook, order.maker);\n                }\n                return true;\n            }\n        });\n\n        // Save the maker URI for later and return just the order\n        const rfqQuotes = validQuotes.map((result) => {\n            const { signature, ...rest } = result.response;\n            const order: SignedNativeOrder = {\n                order: {\n                    ...rest,\n                    makerAmount: new BigNumber(result.response.makerAmount),\n                    takerAmount: new BigNumber(result.response.takerAmount),\n                    expiry: new BigNumber(result.response.expiry),\n                    salt: new BigNumber(result.response.salt),\n                },\n                type: FillQuoteTransformerOrderType.Rfq,\n                signature,\n            };\n            this._orderSignatureToMakerUri[nativeDataToId(result.response)] = result.makerUri;\n            return order;\n        });\n        return rfqQuotes;\n    }\n\n    private async _fetchAndValidateIndicativeQuotesAsync(\n        makerToken: string,\n        takerToken: string,\n        assetFillAmount: BigNumber,\n        marketOperation: MarketOperation,\n        comparisonPrice: BigNumber | undefined,\n        options: RfqRequestOpts,\n        assetOfferings: RfqMakerAssetOfferings,\n    ): Promise<V4RFQIndicativeQuoteMM[]> {\n        // fetch quotes\n        const rawQuotes = await this._getQuotesAsync<V4RFQIndicativeQuoteMM>(\n            makerToken,\n            takerToken,\n            assetFillAmount,\n            marketOperation,\n            comparisonPrice,\n            options,\n            'indicative',\n            assetOfferings,\n        );\n\n        // validate\n        const validationFunction = (o: V4RFQIndicativeQuoteMM) => this._isValidRfqtIndicativeQuoteResponse(o);\n        const validQuotes = rawQuotes.filter((result) => {\n            const order = result.response;\n            if (!validationFunction(order)) {\n                logger.warn(result, 'Invalid RFQ indicative quote received, filtering out');\n                return false;\n            }\n            if (\n                !hasExpectedAddresses([\n                    [makerToken, order.makerToken],\n                    [takerToken, order.takerToken],\n                ])\n            ) {\n                logger.warn(order, 'Unexpected token or taker address in RFQ order, filtering out');\n                return false;\n            }\n            const msRemainingUntilExpiration = QuoteRequestor.getDurationUntilExpirationMs(new BigNumber(order.expiry));\n            const isExpirationTooSoon = msRemainingUntilExpiration.lt(this._expiryBufferMs);\n            if (isExpirationTooSoon) {\n                logger.warn(order, 'Expiry too soon in RFQ indicative quote, filtering out');\n                return false;\n            } else {\n                return true;\n            }\n        });\n        const quotes = validQuotes.map((r) => r.response);\n        quotes.forEach((q) => {\n            q.makerAmount = new BigNumber(q.makerAmount);\n            q.takerAmount = new BigNumber(q.takerAmount);\n            q.expiry = new BigNumber(q.expiry);\n        });\n        return quotes;\n    }\n}\n"],"version":3}