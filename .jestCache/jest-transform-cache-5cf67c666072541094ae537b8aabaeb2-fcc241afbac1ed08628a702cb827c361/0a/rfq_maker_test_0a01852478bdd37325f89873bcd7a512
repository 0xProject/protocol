f7693f9083de9a5c5aba19895a478a14
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// tslint:disable:custom-no-magic-numbers
// tslint:disable:no-empty
// tslint:disable:max-file-line-count
const chai_1 = require("chai");
const HttpStatus = require("http-status-codes");
const request = require("supertest");
const ts_mockito_1 = require("ts-mockito");
const typeorm_1 = require("typeorm");
const config = require("../src/config");
const constants_1 = require("../src/core/constants");
const entities_1 = require("../src/entities");
const http_rfqm_service_runner_1 = require("../src/runners/http_rfqm_service_runner");
const rfqm_service_1 = require("../src/services/rfqm_service");
const rfq_admin_service_1 = require("../src/services/rfq_admin_service");
const rfq_maker_service_1 = require("../src/services/rfq_maker_service");
const config_manager_1 = require("../src/utils/config_manager");
describe('RFQ maker API tests', () => {
    const makerApiKey = '111222333';
    const unknownMakerApiKey = '111222334';
    const makerId = '11';
    const chainId = 56;
    const invalidChainId = 57;
    const pairs = [
        ['0x374a16f5e686c09b0cc9e8bc3466b3b645c74aa7', '0xf84830b73b2ed3c7267e7638f500110ea47fdf30'],
    ];
    const invalidPairs = [['0x374a16f5e686c09b0cc9e8bc3466b3b645c74aa7', '123']];
    const rfqMaker = new entities_1.RfqMaker({ makerId, chainId, updatedAt: null, pairs, rfqtUri: null, rfqmUri: null });
    let app;
    let server;
    let mockRfqMakerService;
    beforeAll(async () => {
        const connection = (0, ts_mockito_1.mock)(typeorm_1.Connection);
        const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
        const mockRfqmService = (0, ts_mockito_1.mock)(rfqm_service_1.RfqmService);
        const mockRfqAdminService = (0, ts_mockito_1.mock)(rfq_admin_service_1.RfqAdminService);
        mockRfqMakerService = (0, ts_mockito_1.mock)(rfq_maker_service_1.RfqMakerService);
        (0, ts_mockito_1.when)(mockRfqMakerService.mapMakerApiKeyToId(makerApiKey)).thenReturn(makerId);
        (0, ts_mockito_1.when)(mockRfqMakerService.getRfqMakerAsync(makerId, chainId)).thenResolve(rfqMaker);
        (0, ts_mockito_1.when)(mockRfqMakerService.createOrUpdateRfqMakerAsync(makerId, chainId, (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenResolve(rfqMaker);
        const mockRfqmServices = new Map([[chainId, mockRfqmService]]);
        // Start the server
        const res = await (0, http_rfqm_service_runner_1.runHttpRfqmServiceAsync)(mockRfqmServices, new Map(), mockRfqAdminService, (0, ts_mockito_1.instance)(mockRfqMakerService), configManagerMock, config.defaultHttpServiceConfig, connection, false);
        app = res.app;
        server = res.server;
    });
    beforeEach(() => {
        (0, ts_mockito_1.resetCalls)(mockRfqMakerService);
    });
    afterAll(async () => {
        await new Promise((resolve, reject) => {
            server.close((err) => {
                if (err) {
                    reject(err);
                }
                resolve();
            });
        });
    });
    describe('GET /maker/v1/chain-id/:chainId', () => {
        it('should return a 401 UNAUTHORIZED without maker api key', async () => {
            const response = await request(app)
                .get(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .expect(HttpStatus.UNAUTHORIZED)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('Invalid api key.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(undefined)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 401 UNAUTHORIZED with an unknown maker api key', async () => {
            const response = await request(app)
                .get(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, unknownMakerApiKey)
                .expect(HttpStatus.UNAUTHORIZED)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('Invalid api key.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(unknownMakerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 400 BAD_REQUEST with an invalid chainId', async () => {
            const response = await request(app)
                .get(`${constants_1.RFQ_MAKER_PATH}/chain-id/${invalidChainId}`)
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, makerApiKey)
                .expect(HttpStatus.BAD_REQUEST)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('Invalid chainId.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(makerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 200 OK with active pairs', async () => {
            const response = await request(app)
                .get(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, makerApiKey)
                .expect(HttpStatus.OK)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.makerId).to.be.eq(makerId);
            (0, chai_1.expect)(response.body.chainId).to.be.eq(chainId);
            (0, chai_1.expect)(response.body.pairs).to.deep.equal(pairs);
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(makerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync(makerId, chainId)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
    });
    describe('PUT /maker/v1/chain-id/:chainId', () => {
        it('should return a 401 UNAUTHORIZED without maker api key', async () => {
            const response = await request(app)
                .put(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .send({ pairs, rfqtUri: null, rfqmUri: null })
                .expect(HttpStatus.UNAUTHORIZED)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('Invalid api key.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(undefined)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 401 UNAUTHORIZED with an unknown maker api key', async () => {
            const response = await request(app)
                .put(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .send({ pairs, rfqtUri: null, rfqmUri: null })
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, unknownMakerApiKey)
                .expect(HttpStatus.UNAUTHORIZED)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('Invalid api key.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(unknownMakerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 400 BAD_REQUEST with an invalid chainId', async () => {
            const response = await request(app)
                .put(`${constants_1.RFQ_MAKER_PATH}/chain-id/${invalidChainId}`)
                .send({ pairs, rfqtUri: null, rfqmUri: null })
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, makerApiKey)
                .expect(HttpStatus.BAD_REQUEST)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('Invalid chainId.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(makerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 400 BAD_REQUEST with an invalid pairs payload', async () => {
            const response = await request(app)
                .put(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .send({ pairs: invalidPairs, rfqtUri: null, rfqmUri: null })
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, makerApiKey)
                .expect(HttpStatus.BAD_REQUEST)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.error).to.be.eq('address of second token for pair 0 is invalid.');
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(makerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
        });
        it('should return a 201 CREATED on a valid PUT', async () => {
            const response = await request(app)
                .put(`${constants_1.RFQ_MAKER_PATH}/chain-id/${chainId}`)
                .send({ pairs, rfqtUri: null, rfqmUri: null })
                .set(constants_1.RFQ_MAKER_API_KEY_HEADER, makerApiKey)
                .expect(HttpStatus.CREATED)
                .expect('Content-Type', /json/);
            (0, chai_1.expect)(response.body.makerId).to.be.eq(makerId);
            (0, chai_1.expect)(response.body.chainId).to.be.eq(chainId);
            (0, chai_1.expect)(response.body.pairs).to.deep.equal(pairs);
            (0, ts_mockito_1.verify)(mockRfqMakerService.mapMakerApiKeyToId(makerApiKey)).once();
            (0, ts_mockito_1.verify)(mockRfqMakerService.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).never();
            (0, ts_mockito_1.verify)(mockRfqMakerService.createOrUpdateRfqMakerAsync(makerId, chainId, (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).once();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvcmZxX21ha2VyX3Rlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx5Q0FBeUM7QUFDekMsMEJBQTBCO0FBQzFCLHFDQUFxQztBQUVyQywrQkFBOEI7QUFFOUIsZ0RBQWdEO0FBQ2hELHFDQUFxQztBQUNyQywyQ0FBZ0Y7QUFDaEYscUNBQXFDO0FBRXJDLHdDQUF3QztBQUN4QyxxREFBaUY7QUFDakYsOENBQTJDO0FBQzNDLHNGQUFrRjtBQUNsRiwrREFBMkQ7QUFDM0QseUVBQW9FO0FBQ3BFLHlFQUFvRTtBQUNwRSxnRUFBNEQ7QUFFNUQsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUM7SUFDaEMsTUFBTSxrQkFBa0IsR0FBRyxXQUFXLENBQUM7SUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztJQUNuQixNQUFNLGNBQWMsR0FBRyxFQUFFLENBQUM7SUFDMUIsTUFBTSxLQUFLLEdBQXVCO1FBQzlCLENBQUMsNENBQTRDLEVBQUUsNENBQTRDLENBQUM7S0FDL0YsQ0FBQztJQUNGLE1BQU0sWUFBWSxHQUF1QixDQUFDLENBQUMsNENBQTRDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNqRyxNQUFNLFFBQVEsR0FBRyxJQUFJLG1CQUFRLENBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFFMUcsSUFBSSxHQUF3QixDQUFDO0lBQzdCLElBQUksTUFBYyxDQUFDO0lBQ25CLElBQUksbUJBQW9DLENBQUM7SUFFekMsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2pCLE1BQU0sVUFBVSxHQUFHLElBQUEsaUJBQUksRUFBQyxvQkFB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LENBQUM7aUJBQzFCLE1BQU0sQ0FBQyxjQUFjLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFFcEMsSUFBQSxhQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoRCxJQUFBLGFBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2hELElBQUEsYUFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakQsSUFBQSxtQkFBTSxFQUFDLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDbkUsSUFBQSxtQkFBTSxFQUFDLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLElBQUEscUJBQVEsR0FBRSxFQUFFLElBQUEscUJBQVEsR0FBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUM3RSxJQUFBLG1CQUFNLEVBQ0YsbUJBQW1CLENBQUMsMkJBQTJCLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFBLHFCQUFRLEdBQUUsRUFBRSxJQUFBLHFCQUFRLEdBQUUsRUFBRSxJQUFBLHFCQUFRLEdBQUUsQ0FBQyxDQUN4RyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS90ZXN0L3JmcV9tYWtlcl90ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlOmN1c3RvbS1uby1tYWdpYy1udW1iZXJzXHJcbi8vIHRzbGludDpkaXNhYmxlOm5vLWVtcHR5XHJcbi8vIHRzbGludDpkaXNhYmxlOm1heC1maWxlLWxpbmUtY291bnRcclxuXHJcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gJ2NoYWknO1xyXG5pbXBvcnQgeyBTZXJ2ZXIgfSBmcm9tICdodHRwJztcclxuaW1wb3J0ICogYXMgSHR0cFN0YXR1cyBmcm9tICdodHRwLXN0YXR1cy1jb2Rlcyc7XHJcbmltcG9ydCAqIGFzIHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcclxuaW1wb3J0IHsgYW55dGhpbmcsIGluc3RhbmNlLCBtb2NrLCByZXNldENhbGxzLCB2ZXJpZnksIHdoZW4gfSBmcm9tICd0cy1tb2NraXRvJztcclxuaW1wb3J0IHsgQ29ubmVjdGlvbiB9IGZyb20gJ3R5cGVvcm0nO1xyXG5cclxuaW1wb3J0ICogYXMgY29uZmlnIGZyb20gJy4uL3NyYy9jb25maWcnO1xyXG5pbXBvcnQgeyBSRlFfTUFLRVJfQVBJX0tFWV9IRUFERVIsIFJGUV9NQUtFUl9QQVRIIH0gZnJvbSAnLi4vc3JjL2NvcmUvY29uc3RhbnRzJztcclxuaW1wb3J0IHsgUmZxTWFrZXIgfSBmcm9tICcuLi9zcmMvZW50aXRpZXMnO1xyXG5pbXBvcnQgeyBydW5IdHRwUmZxbVNlcnZpY2VBc3luYyB9IGZyb20gJy4uL3NyYy9ydW5uZXJzL2h0dHBfcmZxbV9zZXJ2aWNlX3J1bm5lcic7XHJcbmltcG9ydCB7IFJmcW1TZXJ2aWNlIH0gZnJvbSAnLi4vc3JjL3NlcnZpY2VzL3JmcW1fc2VydmljZSc7XHJcbmltcG9ydCB7IFJmcUFkbWluU2VydmljZSB9IGZyb20gJy4uL3NyYy9zZXJ2aWNlcy9yZnFfYWRtaW5fc2VydmljZSc7XHJcbmltcG9ydCB7IFJmcU1ha2VyU2VydmljZSB9IGZyb20gJy4uL3NyYy9zZXJ2aWNlcy9yZnFfbWFrZXJfc2VydmljZSc7XHJcbmltcG9ydCB7IENvbmZpZ01hbmFnZXIgfSBmcm9tICcuLi9zcmMvdXRpbHMvY29uZmlnX21hbmFnZXInO1xyXG5cclxuZGVzY3JpYmUoJ1JGUSBtYWtlciBBUEkgdGVzdHMnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBtYWtlckFwaUtleSA9ICcxMTEyMjIzMzMnO1xyXG4gICAgY29uc3QgdW5rbm93bk1ha2VyQXBpS2V5ID0gJzExMTIyMjMzNCc7XHJcbiAgICBjb25zdCBtYWtlcklkID0gJzExJztcclxuICAgIGNvbnN0IGNoYWluSWQgPSA1NjtcclxuICAgIGNvbnN0IGludmFsaWRDaGFpbklkID0gNTc7XHJcbiAgICBjb25zdCBwYWlyczogW3N0cmluZywgc3RyaW5nXVtdID0gW1xyXG4gICAgICAgIFsnMHgzNzRhMTZmNWU2ODZjMDliMGNjOWU4YmMzNDY2YjNiNjQ1Yzc0YWE3JywgJzB4Zjg0ODMwYjczYjJlZDNjNzI2N2U3NjM4ZjUwMDExMGVhNDdmZGYzMCddLFxyXG4gICAgXTtcclxuICAgIGNvbnN0IGludmFsaWRQYWlyczogW3N0cmluZywgc3RyaW5nXVtdID0gW1snMHgzNzRhMTZmNWU2ODZjMDliMGNjOWU4YmMzNDY2YjNiNjQ1Yzc0YWE3JywgJzEyMyddXTtcclxuICAgIGNvbnN0IHJmcU1ha2VyID0gbmV3IFJmcU1ha2VyKHsgbWFrZXJJZCwgY2hhaW5JZCwgdXBkYXRlZEF0OiBudWxsLCBwYWlycywgcmZxdFVyaTogbnVsbCwgcmZxbVVyaTogbnVsbCB9KTtcclxuXHJcbiAgICBsZXQgYXBwOiBFeHByZXNzLkFwcGxpY2F0aW9uO1xyXG4gICAgbGV0IHNlcnZlcjogU2VydmVyO1xyXG4gICAgbGV0IG1vY2tSZnFNYWtlclNlcnZpY2U6IFJmcU1ha2VyU2VydmljZTtcclxuXHJcbiAgICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBtb2NrKENvbm5lY3Rpb24pO1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXJNb2NrID0gbW9jayhDb25maWdNYW5hZ2VyKTtcclxuICAgICAgICBjb25zdCBtb2NrUmZxbVNlcnZpY2UgPSBtb2NrKFJmcW1TZXJ2aWNlKTtcclxuICAgICAgICBjb25zdCBtb2NrUmZxQWRtaW5TZXJ2aWNlID0gbW9jayhSZnFBZG1pblNlcnZpY2UpO1xyXG5cclxuICAgICAgICBtb2NrUmZxTWFrZXJTZXJ2aWNlID0gbW9jayhSZnFNYWtlclNlcnZpY2UpO1xyXG4gICAgICAgIHdoZW4obW9ja1JmcU1ha2VyU2VydmljZS5tYXBNYWtlckFwaUtleVRvSWQobWFrZXJBcGlLZXkpKS50aGVuUmV0dXJuKG1ha2VySWQpO1xyXG4gICAgICAgIHdoZW4obW9ja1JmcU1ha2VyU2VydmljZS5nZXRSZnFNYWtlckFzeW5jKG1ha2VySWQsIGNoYWluSWQpKS50aGVuUmVzb2x2ZShyZnFNYWtlcik7XHJcbiAgICAgICAgd2hlbihcclxuICAgICAgICAgICAgbW9ja1JmcU1ha2VyU2VydmljZS5jcmVhdGVPclVwZGF0ZVJmcU1ha2VyQXN5bmMobWFrZXJJZCwgY2hhaW5JZCwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSwgYW55dGhpbmcoKSksXHJcbiAgICAgICAgKS50aGVuUmVzb2x2ZShyZnFNYWtlcik7XHJcblxyXG4gICAgICAgIGNvbnN0IG1vY2tSZnFtU2VydmljZXMgPSBuZXcgTWFwPG51bWJlciwgUmZxbVNlcnZpY2U+KFtbY2hhaW5JZCwgbW9ja1JmcW1TZXJ2aWNlXV0pO1xyXG5cclxuICAgICAgICAvLyBTdGFydCB0aGUgc2VydmVyXHJcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcnVuSHR0cFJmcW1TZXJ2aWNlQXN5bmMoXHJcbiAgICAgICAgICAgIG1vY2tSZnFtU2VydmljZXMsXHJcbiAgICAgICAgICAgIG5ldyBNYXAoKSxcclxuICAgICAgICAgICAgbW9ja1JmcUFkbWluU2VydmljZSxcclxuICAgICAgICAgICAgaW5zdGFuY2UobW9ja1JmcU1ha2VyU2VydmljZSksXHJcbiAgICAgICAgICAgIGNvbmZpZ01hbmFnZXJNb2NrLFxyXG4gICAgICAgICAgICBjb25maWcuZGVmYXVsdEh0dHBTZXJ2aWNlQ29uZmlnLFxyXG4gICAgICAgICAgICBjb25uZWN0aW9uLFxyXG4gICAgICAgICAgICBmYWxzZSxcclxuICAgICAgICApO1xyXG4gICAgICAgIGFwcCA9IHJlcy5hcHA7XHJcbiAgICAgICAgc2VydmVyID0gcmVzLnNlcnZlcjtcclxuICAgIH0pO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIHJlc2V0Q2FsbHMobW9ja1JmcU1ha2VyU2VydmljZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhZnRlckFsbChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBzZXJ2ZXIuY2xvc2UoKGVycj86IEVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0dFVCAvbWFrZXIvdjEvY2hhaW4taWQvOmNoYWluSWQnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSA0MDEgVU5BVVRIT1JJWkVEIHdpdGhvdXQgbWFrZXIgYXBpIGtleScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5nZXQoYCR7UkZRX01BS0VSX1BBVEh9L2NoYWluLWlkLyR7Y2hhaW5JZH1gKVxyXG4gICAgICAgICAgICAgICAgLmV4cGVjdChIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRClcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoJ0NvbnRlbnQtVHlwZScsIC9qc29uLyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG8uYmUuZXEoJ0ludmFsaWQgYXBpIGtleS4nKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UubWFwTWFrZXJBcGlLZXlUb0lkKHVuZGVmaW5lZCkpLm9uY2UoKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UuZ2V0UmZxTWFrZXJBc3luYyhhbnl0aGluZygpLCBhbnl0aGluZygpKSkubmV2ZXIoKTtcclxuICAgICAgICAgICAgdmVyaWZ5KFxyXG4gICAgICAgICAgICAgICAgbW9ja1JmcU1ha2VyU2VydmljZS5jcmVhdGVPclVwZGF0ZVJmcU1ha2VyQXN5bmMoXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgKS5uZXZlcigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhIDQwMSBVTkFVVEhPUklaRUQgd2l0aCBhbiB1bmtub3duIG1ha2VyIGFwaSBrZXknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAuZ2V0KGAke1JGUV9NQUtFUl9QQVRIfS9jaGFpbi1pZC8ke2NoYWluSWR9YClcclxuICAgICAgICAgICAgICAgIC5zZXQoUkZRX01BS0VSX0FQSV9LRVlfSEVBREVSLCB1bmtub3duTWFrZXJBcGlLZXkpXHJcbiAgICAgICAgICAgICAgICAuZXhwZWN0KEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVEKVxyXG4gICAgICAgICAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL2pzb24vKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50by5iZS5lcSgnSW52YWxpZCBhcGkga2V5LicpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5tYXBNYWtlckFwaUtleVRvSWQodW5rbm93bk1ha2VyQXBpS2V5KSkub25jZSgpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5nZXRSZnFNYWtlckFzeW5jKGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS5uZXZlcigpO1xyXG4gICAgICAgICAgICB2ZXJpZnkoXHJcbiAgICAgICAgICAgICAgICBtb2NrUmZxTWFrZXJTZXJ2aWNlLmNyZWF0ZU9yVXBkYXRlUmZxTWFrZXJBc3luYyhcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICApLm5ldmVyKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgNDAwIEJBRF9SRVFVRVNUIHdpdGggYW4gaW52YWxpZCBjaGFpbklkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLmdldChgJHtSRlFfTUFLRVJfUEFUSH0vY2hhaW4taWQvJHtpbnZhbGlkQ2hhaW5JZH1gKVxyXG4gICAgICAgICAgICAgICAgLnNldChSRlFfTUFLRVJfQVBJX0tFWV9IRUFERVIsIG1ha2VyQXBpS2V5KVxyXG4gICAgICAgICAgICAgICAgLmV4cGVjdChIdHRwU3RhdHVzLkJBRF9SRVFVRVNUKVxyXG4gICAgICAgICAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL2pzb24vKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50by5iZS5lcSgnSW52YWxpZCBjaGFpbklkLicpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5tYXBNYWtlckFwaUtleVRvSWQobWFrZXJBcGlLZXkpKS5vbmNlKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShtb2NrUmZxTWFrZXJTZXJ2aWNlLmdldFJmcU1ha2VyQXN5bmMoYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLm5ldmVyKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShcclxuICAgICAgICAgICAgICAgIG1vY2tSZnFNYWtlclNlcnZpY2UuY3JlYXRlT3JVcGRhdGVSZnFNYWtlckFzeW5jKFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICkubmV2ZXIoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSAyMDAgT0sgd2l0aCBhY3RpdmUgcGFpcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAuZ2V0KGAke1JGUV9NQUtFUl9QQVRIfS9jaGFpbi1pZC8ke2NoYWluSWR9YClcclxuICAgICAgICAgICAgICAgIC5zZXQoUkZRX01BS0VSX0FQSV9LRVlfSEVBREVSLCBtYWtlckFwaUtleSlcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoSHR0cFN0YXR1cy5PSylcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoJ0NvbnRlbnQtVHlwZScsIC9qc29uLyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tYWtlcklkKS50by5iZS5lcShtYWtlcklkKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuY2hhaW5JZCkudG8uYmUuZXEoY2hhaW5JZCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnBhaXJzKS50by5kZWVwLmVxdWFsKHBhaXJzKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UubWFwTWFrZXJBcGlLZXlUb0lkKG1ha2VyQXBpS2V5KSkub25jZSgpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5nZXRSZnFNYWtlckFzeW5jKG1ha2VySWQsIGNoYWluSWQpKS5vbmNlKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShcclxuICAgICAgICAgICAgICAgIG1vY2tSZnFNYWtlclNlcnZpY2UuY3JlYXRlT3JVcGRhdGVSZnFNYWtlckFzeW5jKFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICkubmV2ZXIoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdQVVQgL21ha2VyL3YxL2NoYWluLWlkLzpjaGFpbklkJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgNDAxIFVOQVVUSE9SSVpFRCB3aXRob3V0IG1ha2VyIGFwaSBrZXknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucHV0KGAke1JGUV9NQUtFUl9QQVRIfS9jaGFpbi1pZC8ke2NoYWluSWR9YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHsgcGFpcnMsIHJmcXRVcmk6IG51bGwsIHJmcW1Vcmk6IG51bGwgfSlcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQpXHJcbiAgICAgICAgICAgICAgICAuZXhwZWN0KCdDb250ZW50LVR5cGUnLCAvanNvbi8pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvLmJlLmVxKCdJbnZhbGlkIGFwaSBrZXkuJyk7XHJcbiAgICAgICAgICAgIHZlcmlmeShtb2NrUmZxTWFrZXJTZXJ2aWNlLm1hcE1ha2VyQXBpS2V5VG9JZCh1bmRlZmluZWQpKS5vbmNlKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShtb2NrUmZxTWFrZXJTZXJ2aWNlLmdldFJmcU1ha2VyQXN5bmMoYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLm5ldmVyKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShcclxuICAgICAgICAgICAgICAgIG1vY2tSZnFNYWtlclNlcnZpY2UuY3JlYXRlT3JVcGRhdGVSZnFNYWtlckFzeW5jKFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICkubmV2ZXIoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSA0MDEgVU5BVVRIT1JJWkVEIHdpdGggYW4gdW5rbm93biBtYWtlciBhcGkga2V5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnB1dChgJHtSRlFfTUFLRVJfUEFUSH0vY2hhaW4taWQvJHtjaGFpbklkfWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7IHBhaXJzLCByZnF0VXJpOiBudWxsLCByZnFtVXJpOiBudWxsIH0pXHJcbiAgICAgICAgICAgICAgICAuc2V0KFJGUV9NQUtFUl9BUElfS0VZX0hFQURFUiwgdW5rbm93bk1ha2VyQXBpS2V5KVxyXG4gICAgICAgICAgICAgICAgLmV4cGVjdChIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRClcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoJ0NvbnRlbnQtVHlwZScsIC9qc29uLyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG8uYmUuZXEoJ0ludmFsaWQgYXBpIGtleS4nKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UubWFwTWFrZXJBcGlLZXlUb0lkKHVua25vd25NYWtlckFwaUtleSkpLm9uY2UoKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UuZ2V0UmZxTWFrZXJBc3luYyhhbnl0aGluZygpLCBhbnl0aGluZygpKSkubmV2ZXIoKTtcclxuICAgICAgICAgICAgdmVyaWZ5KFxyXG4gICAgICAgICAgICAgICAgbW9ja1JmcU1ha2VyU2VydmljZS5jcmVhdGVPclVwZGF0ZVJmcU1ha2VyQXN5bmMoXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgKSxcclxuICAgICAgICAgICAgKS5uZXZlcigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhIDQwMCBCQURfUkVRVUVTVCB3aXRoIGFuIGludmFsaWQgY2hhaW5JZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wdXQoYCR7UkZRX01BS0VSX1BBVEh9L2NoYWluLWlkLyR7aW52YWxpZENoYWluSWR9YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHsgcGFpcnMsIHJmcXRVcmk6IG51bGwsIHJmcW1Vcmk6IG51bGwgfSlcclxuICAgICAgICAgICAgICAgIC5zZXQoUkZRX01BS0VSX0FQSV9LRVlfSEVBREVSLCBtYWtlckFwaUtleSlcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoSHR0cFN0YXR1cy5CQURfUkVRVUVTVClcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoJ0NvbnRlbnQtVHlwZScsIC9qc29uLyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG8uYmUuZXEoJ0ludmFsaWQgY2hhaW5JZC4nKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UubWFwTWFrZXJBcGlLZXlUb0lkKG1ha2VyQXBpS2V5KSkub25jZSgpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5nZXRSZnFNYWtlckFzeW5jKGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS5uZXZlcigpO1xyXG4gICAgICAgICAgICB2ZXJpZnkoXHJcbiAgICAgICAgICAgICAgICBtb2NrUmZxTWFrZXJTZXJ2aWNlLmNyZWF0ZU9yVXBkYXRlUmZxTWFrZXJBc3luYyhcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICApLm5ldmVyKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgNDAwIEJBRF9SRVFVRVNUIHdpdGggYW4gaW52YWxpZCBwYWlycyBwYXlsb2FkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnB1dChgJHtSRlFfTUFLRVJfUEFUSH0vY2hhaW4taWQvJHtjaGFpbklkfWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7IHBhaXJzOiBpbnZhbGlkUGFpcnMsIHJmcXRVcmk6IG51bGwsIHJmcW1Vcmk6IG51bGwgfSlcclxuICAgICAgICAgICAgICAgIC5zZXQoUkZRX01BS0VSX0FQSV9LRVlfSEVBREVSLCBtYWtlckFwaUtleSlcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoSHR0cFN0YXR1cy5CQURfUkVRVUVTVClcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoJ0NvbnRlbnQtVHlwZScsIC9qc29uLyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG8uYmUuZXEoJ2FkZHJlc3Mgb2Ygc2Vjb25kIHRva2VuIGZvciBwYWlyIDAgaXMgaW52YWxpZC4nKTtcclxuICAgICAgICAgICAgdmVyaWZ5KG1vY2tSZnFNYWtlclNlcnZpY2UubWFwTWFrZXJBcGlLZXlUb0lkKG1ha2VyQXBpS2V5KSkub25jZSgpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5nZXRSZnFNYWtlckFzeW5jKGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS5uZXZlcigpO1xyXG4gICAgICAgICAgICB2ZXJpZnkoXHJcbiAgICAgICAgICAgICAgICBtb2NrUmZxTWFrZXJTZXJ2aWNlLmNyZWF0ZU9yVXBkYXRlUmZxTWFrZXJBc3luYyhcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYW55dGhpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXHJcbiAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICApLm5ldmVyKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgMjAxIENSRUFURUQgb24gYSB2YWxpZCBQVVQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucHV0KGAke1JGUV9NQUtFUl9QQVRIfS9jaGFpbi1pZC8ke2NoYWluSWR9YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHsgcGFpcnMsIHJmcXRVcmk6IG51bGwsIHJmcW1Vcmk6IG51bGwgfSlcclxuICAgICAgICAgICAgICAgIC5zZXQoUkZRX01BS0VSX0FQSV9LRVlfSEVBREVSLCBtYWtlckFwaUtleSlcclxuICAgICAgICAgICAgICAgIC5leHBlY3QoSHR0cFN0YXR1cy5DUkVBVEVEKVxyXG4gICAgICAgICAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL2pzb24vKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1ha2VySWQpLnRvLmJlLmVxKG1ha2VySWQpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5jaGFpbklkKS50by5iZS5lcShjaGFpbklkKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkucGFpcnMpLnRvLmRlZXAuZXF1YWwocGFpcnMpO1xyXG4gICAgICAgICAgICB2ZXJpZnkobW9ja1JmcU1ha2VyU2VydmljZS5tYXBNYWtlckFwaUtleVRvSWQobWFrZXJBcGlLZXkpKS5vbmNlKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShtb2NrUmZxTWFrZXJTZXJ2aWNlLmdldFJmcU1ha2VyQXN5bmMoYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLm5ldmVyKCk7XHJcbiAgICAgICAgICAgIHZlcmlmeShcclxuICAgICAgICAgICAgICAgIG1vY2tSZnFNYWtlclNlcnZpY2UuY3JlYXRlT3JVcGRhdGVSZnFNYWtlckFzeW5jKG1ha2VySWQsIGNoYWluSWQsIGFueXRoaW5nKCksIGFueXRoaW5nKCksIGFueXRoaW5nKCkpLFxyXG4gICAgICAgICAgICApLm9uY2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9