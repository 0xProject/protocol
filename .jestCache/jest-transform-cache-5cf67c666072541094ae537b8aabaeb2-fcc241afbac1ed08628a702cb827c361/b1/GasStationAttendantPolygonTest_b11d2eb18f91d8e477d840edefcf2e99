db8199c8e46ae79dbe5a9ddec216d608
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const asset_swapper_1 = require("@0x/asset-swapper");
const utils_1 = require("@0x/utils");
const chai_1 = require("chai");
const ts_mockito_1 = require("ts-mockito");
const constants_1 = require("../../src/core/constants");
const RfqmV2TransactionSubmissionEntity_1 = require("../../src/entities/RfqmV2TransactionSubmissionEntity");
const types_1 = require("../../src/entities/types");
const GasStationAttendantPolygon_1 = require("../../src/utils/GasStationAttendantPolygon");
const rfq_blockchain_utils_1 = require("../../src/utils/rfq_blockchain_utils");
const SubmissionContext_1 = require("../../src/utils/SubmissionContext");
let protocolFeeUtilsMock;
describe('GasStationAttendantPolygon', () => {
    beforeAll(() => {
        protocolFeeUtilsMock = (0, ts_mockito_1.mock)(asset_swapper_1.ProtocolFeeUtils);
    });
    describe('getWorkerBalanceForTradeAsync', () => {
        it('gets the balance to trade', async () => {
            (0, ts_mockito_1.when)(protocolFeeUtilsMock.getGasPriceEstimationOrThrowAsync()).thenResolve(new utils_1.BigNumber(1000).shiftedBy(constants_1.GWEI_DECIMALS));
            const attendant = new GasStationAttendantPolygon_1.GasStationAttendantPolygon((0, ts_mockito_1.instance)(protocolFeeUtilsMock));
            const workerGasToTrade = await attendant.getWorkerBalanceForTradeAsync();
            // 1000 GWEI * (1.1^3) = 1331
            // Gas estimate = 100,000 * 1.1 = 110,000
            // Totol = 1331 * 110,000 = 146,410,000 GWEI
            (0, chai_1.expect)(workerGasToTrade.toPrecision(2).toString()).to.equal(
            // tslint:disable-next-line: custom-no-magic-numbers
            new utils_1.BigNumber(146410000).times(Math.pow(10, constants_1.GWEI_DECIMALS)).toPrecision(2).toString());
        });
    });
    describe('getExpectedTransactionGasRateAsync', () => {
        it('estimates the transaction gas rate', async () => {
            (0, ts_mockito_1.when)(protocolFeeUtilsMock.getGasPriceEstimationOrThrowAsync()).thenResolve(new utils_1.BigNumber(666).shiftedBy(constants_1.GWEI_DECIMALS));
            const attendant = new GasStationAttendantPolygon_1.GasStationAttendantPolygon((0, ts_mockito_1.instance)(protocolFeeUtilsMock));
            const gasRate = await attendant.getExpectedTransactionGasRateAsync();
            // 666 * 1.1^1.5 = 768.35736217 GWEI
            (0, chai_1.expect)(gasRate.toString()).to.equal(
            // tslint:disable-next-line: custom-no-magic-numbers
            new utils_1.BigNumber(768.35736217)
                .times(Math.pow(10, constants_1.GWEI_DECIMALS))
                .integerValue(utils_1.BigNumber.ROUND_CEIL)
                .toString());
        });
    });
    describe('getNextBidAsync', () => {
        it('gets an initial minimum bid (30 GWEi)', async () => {
            var _a, _b;
            (0, ts_mockito_1.when)(protocolFeeUtilsMock.getGasPriceEstimationOrThrowAsync()).thenResolve(new utils_1.BigNumber(0));
            const attendant = new GasStationAttendantPolygon_1.GasStationAttendantPolygon((0, ts_mockito_1.instance)(protocolFeeUtilsMock));
            const gasRate = await attendant.getNextBidAsync(null);
            (0, chai_1.expect)((_a = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxPriorityFeePerGas) === null || _a === void 0 ? void 0 : _a.toString()).to.equal(new utils_1.BigNumber(0).toString());
            (0, chai_1.expect)((_b = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxFeePerGas) === null || _b === void 0 ? void 0 : _b.toString()).to.equal(new utils_1.BigNumber(30).times(Math.pow(10, constants_1.GWEI_DECIMALS)).toString());
        });
        it('gets an initial bid when there are no existing transactions', async () => {
            var _a, _b;
            (0, ts_mockito_1.when)(protocolFeeUtilsMock.getGasPriceEstimationOrThrowAsync()).thenResolve(new utils_1.BigNumber(212).shiftedBy(constants_1.GWEI_DECIMALS));
            const attendant = new GasStationAttendantPolygon_1.GasStationAttendantPolygon((0, ts_mockito_1.instance)(protocolFeeUtilsMock));
            const gasRate = await attendant.getNextBidAsync(null);
            const initialMaxPriorityFeePerGasWei = new utils_1.BigNumber(212).times(Math.pow(10, constants_1.GWEI_DECIMALS));
            const initialMaxFeePerGasWei = new utils_1.BigNumber(/* base fee */ 1)
                .times(Math.pow(10, constants_1.GWEI_DECIMALS))
                .plus(initialMaxPriorityFeePerGasWei);
            (0, chai_1.expect)((_a = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxPriorityFeePerGas) === null || _a === void 0 ? void 0 : _a.toString()).to.equal(initialMaxPriorityFeePerGasWei.toString());
            (0, chai_1.expect)((_b = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxFeePerGas) === null || _b === void 0 ? void 0 : _b.toString()).to.equal(initialMaxFeePerGasWei.toString());
        });
        it('calculates a resubmit bid when the fast gas rises', async () => {
            var _a, _b;
            (0, ts_mockito_1.when)(protocolFeeUtilsMock.getGasPriceEstimationOrThrowAsync()).thenResolve(new utils_1.BigNumber(212).shiftedBy(constants_1.GWEI_DECIMALS));
            const transaction1 = new RfqmV2TransactionSubmissionEntity_1.RfqmV2TransactionSubmissionEntity({
                transactionHash: '0x1',
                from: '0xfrom',
                to: '0xto',
                orderHash: '0xOrderhash',
                nonce: 0,
                maxFeePerGas: new utils_1.BigNumber(3),
                maxPriorityFeePerGas: new utils_1.BigNumber(2),
                type: types_1.RfqmTransactionSubmissionType.Trade,
            });
            const submissionContext = new SubmissionContext_1.SubmissionContext((0, ts_mockito_1.instance)((0, ts_mockito_1.mock)(rfq_blockchain_utils_1.RfqBlockchainUtils)), [transaction1]);
            const attendant = new GasStationAttendantPolygon_1.GasStationAttendantPolygon((0, ts_mockito_1.instance)(protocolFeeUtilsMock));
            const gasRate = await attendant.getNextBidAsync(submissionContext);
            // Previous submission gas prices were 2 tip, 3 max
            // new tip = 212 GWEI
            // base fee = 1 GWEI
            // total = 213 GWEI
            (0, chai_1.expect)((_a = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxPriorityFeePerGas) === null || _a === void 0 ? void 0 : _a.toString()).to.equal(new utils_1.BigNumber(212).times(Math.pow(10, constants_1.GWEI_DECIMALS)).toString());
            (0, chai_1.expect)((_b = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxFeePerGas) === null || _b === void 0 ? void 0 : _b.toString()).to.equal(new utils_1.BigNumber(213).times(Math.pow(10, constants_1.GWEI_DECIMALS)).toString());
        });
        it('calculates a resubmit bid with the minimum max fee per gas increase', async () => {
            var _a, _b;
            (0, ts_mockito_1.when)(protocolFeeUtilsMock.getGasPriceEstimationOrThrowAsync()).thenResolve(new utils_1.BigNumber(0));
            const transaction1 = new RfqmV2TransactionSubmissionEntity_1.RfqmV2TransactionSubmissionEntity({
                transactionHash: '0x1',
                from: '0xfrom',
                to: '0xto',
                orderHash: '0xOrderhash',
                nonce: 0,
                maxFeePerGas: new utils_1.BigNumber(101).times(Math.pow(10, constants_1.GWEI_DECIMALS)),
                maxPriorityFeePerGas: new utils_1.BigNumber(100).times(Math.pow(10, constants_1.GWEI_DECIMALS)),
                type: types_1.RfqmTransactionSubmissionType.Trade,
            });
            const submissionContext = new SubmissionContext_1.SubmissionContext((0, ts_mockito_1.instance)((0, ts_mockito_1.mock)(rfq_blockchain_utils_1.RfqBlockchainUtils)), [transaction1]);
            const attendant = new GasStationAttendantPolygon_1.GasStationAttendantPolygon((0, ts_mockito_1.instance)(protocolFeeUtilsMock));
            const gasRate = await attendant.getNextBidAsync(submissionContext);
            // Previous submission gas prices were 100 tip, 101 toatl (GWEI)
            // new tip = 100 * 1.1 = 110 GWEI
            // Base Fee is always 1 GWEI
            // Max fee per gas = 110 + 1 = 111 GWEI
            //
            // BUT needs at least a 10% increase so 111.1
            (0, chai_1.expect)((_a = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxPriorityFeePerGas) === null || _a === void 0 ? void 0 : _a.toString()).to.equal(new utils_1.BigNumber(110).times(Math.pow(10, constants_1.GWEI_DECIMALS)).toString());
            (0, chai_1.expect)((_b = gasRate === null || gasRate === void 0 ? void 0 : gasRate.maxFeePerGas) === null || _b === void 0 ? void 0 : _b.toString()).to.equal(new utils_1.BigNumber(111.1).times(Math.pow(10, constants_1.GWEI_DECIMALS)).toString());
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvdXRpbHMvR2FzU3RhdGlvbkF0dGVuZGFudFBvbHlnb25UZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEscURBQXFEO0FBQ3JELHFDQUFzQztBQUN0QywrQkFBOEI7QUFDOUIsMkNBQWtEO0FBRWxELHdEQUF5RDtBQUN6RCw0R0FBeUc7QUFDekcsb0RBQXlFO0FBQ3pFLDJGQUF3RjtBQUN4RiwrRUFBMEU7QUFDMUUseUVBQXNFO0FBRXRFLElBQUksb0JBQXNDLENBQUM7QUFFM0MsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtJQUN4QyxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ1gsb0JBQW9CLEdBQUcsSUFBQSxpQkFBSSxFQUFDLGdDQUFnQixDQUFDLENBQUM7SUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1FBQzNDLEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2QyxJQUFBLGlCQUFJLEVBQUMsb0JBQW9CLENBQUMsaUNBQWlDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FDdEUsSUFBSSxpQkFBUyxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyx5QkFBYSxDQUFDLENBQy9DLENBQUM7WUFFRixNQUFNLFNBQVMsR0FBRyxJQUFJLHVEQUEwQixDQUFDLElBQUEscUJBQVEsRUFBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFFakYsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLFNBQVMsQ0FBQyw2QkFBNkIsRUFBRSxDQUFDO1lBRXpFLDZCQUE2QjtZQUM3Qix5Q0FBeUM7WUFDekMsNENBQTRDO1lBRTVDLElBQUEsYUFBTSxFQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLO1lBQ3ZELG9EQUFvRDtZQUNwRCxJQUFJLGlCQUFTLENB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O1lBQ0YsNkNBQTZDO1lBQzdDLElBQUEsYUFBTSxFQUFDLE1BQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLG9CQUFvQiwwQ0FBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQ3RELElBQUksaUJBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUseUJBQWEsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQ25FLENBQUM7WUFDRixJQUFBLGFBQU0sRUFBQyxNQUFBLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxZQUFZLDBDQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FDOUMsSUFBSSxpQkFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSx5QkFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FDckUsQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZGF2aWR3YWxzaC9jb2RlLWxvY2FsLzB4LXJmcS1hcGkvdGVzdC91dGlscy9HYXNTdGF0aW9uQXR0ZW5kYW50UG9seWdvblRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJvdG9jb2xGZWVVdGlscyB9IGZyb20gJ0AweC9hc3NldC1zd2FwcGVyJztcclxuaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnQDB4L3V0aWxzJztcclxuaW1wb3J0IHsgZXhwZWN0IH0gZnJvbSAnY2hhaSc7XHJcbmltcG9ydCB7IGluc3RhbmNlLCBtb2NrLCB3aGVuIH0gZnJvbSAndHMtbW9ja2l0byc7XHJcblxyXG5pbXBvcnQgeyBHV0VJX0RFQ0lNQUxTIH0gZnJvbSAnLi4vLi4vc3JjL2NvcmUvY29uc3RhbnRzJztcclxuaW1wb3J0IHsgUmZxbVYyVHJhbnNhY3Rpb25TdWJtaXNzaW9uRW50aXR5IH0gZnJvbSAnLi4vLi4vc3JjL2VudGl0aWVzL1JmcW1WMlRyYW5zYWN0aW9uU3VibWlzc2lvbkVudGl0eSc7XHJcbmltcG9ydCB7IFJmcW1UcmFuc2FjdGlvblN1Ym1pc3Npb25UeXBlIH0gZnJvbSAnLi4vLi4vc3JjL2VudGl0aWVzL3R5cGVzJztcclxuaW1wb3J0IHsgR2FzU3RhdGlvbkF0dGVuZGFudFBvbHlnb24gfSBmcm9tICcuLi8uLi9zcmMvdXRpbHMvR2FzU3RhdGlvbkF0dGVuZGFudFBvbHlnb24nO1xyXG5pbXBvcnQgeyBSZnFCbG9ja2NoYWluVXRpbHMgfSBmcm9tICcuLi8uLi9zcmMvdXRpbHMvcmZxX2Jsb2NrY2hhaW5fdXRpbHMnO1xyXG5pbXBvcnQgeyBTdWJtaXNzaW9uQ29udGV4dCB9IGZyb20gJy4uLy4uL3NyYy91dGlscy9TdWJtaXNzaW9uQ29udGV4dCc7XHJcblxyXG5sZXQgcHJvdG9jb2xGZWVVdGlsc01vY2s6IFByb3RvY29sRmVlVXRpbHM7XHJcblxyXG5kZXNjcmliZSgnR2FzU3RhdGlvbkF0dGVuZGFudFBvbHlnb24nLCAoKSA9PiB7XHJcbiAgICBiZWZvcmVBbGwoKCkgPT4ge1xyXG4gICAgICAgIHByb3RvY29sRmVlVXRpbHNNb2NrID0gbW9jayhQcm90b2NvbEZlZVV0aWxzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRXb3JrZXJCYWxhbmNlRm9yVHJhZGVBc3luYycsICgpID0+IHtcclxuICAgICAgICBpdCgnZ2V0cyB0aGUgYmFsYW5jZSB0byB0cmFkZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgd2hlbihwcm90b2NvbEZlZVV0aWxzTW9jay5nZXRHYXNQcmljZUVzdGltYXRpb25PclRocm93QXN5bmMoKSkudGhlblJlc29sdmUoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDEwMDApLnNoaWZ0ZWRCeShHV0VJX0RFQ0lNQUxTKSxcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGF0dGVuZGFudCA9IG5ldyBHYXNTdGF0aW9uQXR0ZW5kYW50UG9seWdvbihpbnN0YW5jZShwcm90b2NvbEZlZVV0aWxzTW9jaykpO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgd29ya2VyR2FzVG9UcmFkZSA9IGF3YWl0IGF0dGVuZGFudC5nZXRXb3JrZXJCYWxhbmNlRm9yVHJhZGVBc3luYygpO1xyXG5cclxuICAgICAgICAgICAgLy8gMTAwMCBHV0VJICogKDEuMV4zKSA9IDEzMzFcclxuICAgICAgICAgICAgLy8gR2FzIGVzdGltYXRlID0gMTAwLDAwMCAqIDEuMSA9IDExMCwwMDBcclxuICAgICAgICAgICAgLy8gVG90b2wgPSAxMzMxICogMTEwLDAwMCA9IDE0Niw0MTAsMDAwIEdXRUlcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdCh3b3JrZXJHYXNUb1RyYWRlLnRvUHJlY2lzaW9uKDIpLnRvU3RyaW5nKCkpLnRvLmVxdWFsKFxyXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBjdXN0b20tbm8tbWFnaWMtbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgbmV3IEJpZ051bWJlcigxNDZfNDEwXzAwMCkudGltZXMoTWF0aC5wb3coMTAsIEdXRUlfREVDSU1BTFMpKS50b1ByZWNpc2lvbigyKS50b1N0cmluZygpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldEV4cGVjdGVkVHJhbnNhY3Rpb25HYXNSYXRlQXN5bmMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ2VzdGltYXRlcyB0aGUgdHJhbnNhY3Rpb24gZ2FzIHJhdGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIHdoZW4ocHJvdG9jb2xGZWVVdGlsc01vY2suZ2V0R2FzUHJpY2VFc3RpbWF0aW9uT3JUaHJvd0FzeW5jKCkpLnRoZW5SZXNvbHZlKFxyXG4gICAgICAgICAgICAgICAgbmV3IEJpZ051bWJlcig2NjYpLnNoaWZ0ZWRCeShHV0VJX0RFQ0lNQUxTKSxcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGF0dGVuZGFudCA9IG5ldyBHYXNTdGF0aW9uQXR0ZW5kYW50UG9seWdvbihpbnN0YW5jZShwcm90b2NvbEZlZVV0aWxzTW9jaykpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZ2FzUmF0ZSA9IGF3YWl0IGF0dGVuZGFudC5nZXRFeHBlY3RlZFRyYW5zYWN0aW9uR2FzUmF0ZUFzeW5jKCk7XHJcblxyXG4gICAgICAgICAgICAvLyA2NjYgKiAxLjFeMS41ID0gNzY4LjM1NzM2MjE3IEdXRUlcclxuICAgICAgICAgICAgZXhwZWN0KGdhc1JhdGUudG9TdHJpbmcoKSkudG8uZXF1YWwoXHJcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGN1c3RvbS1uby1tYWdpYy1udW1iZXJzXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDc2OC4zNTczNjIxNylcclxuICAgICAgICAgICAgICAgICAgICAudGltZXMoTWF0aC5wb3coMTAsIEdXRUlfREVDSU1BTFMpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5pbnRlZ2VyVmFsdWUoQmlnTnVtYmVyLlJPVU5EX0NFSUwpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0TmV4dEJpZEFzeW5jJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdnZXRzIGFuIGluaXRpYWwgbWluaW11bSBiaWQgKDMwIEdXRWkpJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICB3aGVuKHByb3RvY29sRmVlVXRpbHNNb2NrLmdldEdhc1ByaWNlRXN0aW1hdGlvbk9yVGhyb3dBc3luYygpKS50aGVuUmVzb2x2ZShuZXcgQmlnTnVtYmVyKDApKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGF0dGVuZGFudCA9IG5ldyBHYXNTdGF0aW9uQXR0ZW5kYW50UG9seWdvbihpbnN0YW5jZShwcm90b2NvbEZlZVV0aWxzTW9jaykpO1xyXG4gICAgICAgICAgICBjb25zdCBnYXNSYXRlID0gYXdhaXQgYXR0ZW5kYW50LmdldE5leHRCaWRBc3luYyhudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChnYXNSYXRlPy5tYXhQcmlvcml0eUZlZVBlckdhcz8udG9TdHJpbmcoKSkudG8uZXF1YWwobmV3IEJpZ051bWJlcigwKS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgZXhwZWN0KGdhc1JhdGU/Lm1heEZlZVBlckdhcz8udG9TdHJpbmcoKSkudG8uZXF1YWwoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDMwKS50aW1lcyhNYXRoLnBvdygxMCwgR1dFSV9ERUNJTUFMUykpLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdnZXRzIGFuIGluaXRpYWwgYmlkIHdoZW4gdGhlcmUgYXJlIG5vIGV4aXN0aW5nIHRyYW5zYWN0aW9ucycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgd2hlbihwcm90b2NvbEZlZVV0aWxzTW9jay5nZXRHYXNQcmljZUVzdGltYXRpb25PclRocm93QXN5bmMoKSkudGhlblJlc29sdmUoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDIxMikuc2hpZnRlZEJ5KEdXRUlfREVDSU1BTFMpLFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYXR0ZW5kYW50ID0gbmV3IEdhc1N0YXRpb25BdHRlbmRhbnRQb2x5Z29uKGluc3RhbmNlKHByb3RvY29sRmVlVXRpbHNNb2NrKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGdhc1JhdGUgPSBhd2FpdCBhdHRlbmRhbnQuZ2V0TmV4dEJpZEFzeW5jKG51bGwpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgaW5pdGlhbE1heFByaW9yaXR5RmVlUGVyR2FzV2VpID0gbmV3IEJpZ051bWJlcigyMTIpLnRpbWVzKE1hdGgucG93KDEwLCBHV0VJX0RFQ0lNQUxTKSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxNYXhGZWVQZXJHYXNXZWkgPSBuZXcgQmlnTnVtYmVyKC8qIGJhc2UgZmVlICovIDEpXHJcbiAgICAgICAgICAgICAgICAudGltZXMoTWF0aC5wb3coMTAsIEdXRUlfREVDSU1BTFMpKVxyXG4gICAgICAgICAgICAgICAgLnBsdXMoaW5pdGlhbE1heFByaW9yaXR5RmVlUGVyR2FzV2VpKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChnYXNSYXRlPy5tYXhQcmlvcml0eUZlZVBlckdhcz8udG9TdHJpbmcoKSkudG8uZXF1YWwoaW5pdGlhbE1heFByaW9yaXR5RmVlUGVyR2FzV2VpLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICBleHBlY3QoZ2FzUmF0ZT8ubWF4RmVlUGVyR2FzPy50b1N0cmluZygpKS50by5lcXVhbChpbml0aWFsTWF4RmVlUGVyR2FzV2VpLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnY2FsY3VsYXRlcyBhIHJlc3VibWl0IGJpZCB3aGVuIHRoZSBmYXN0IGdhcyByaXNlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgd2hlbihwcm90b2NvbEZlZVV0aWxzTW9jay5nZXRHYXNQcmljZUVzdGltYXRpb25PclRocm93QXN5bmMoKSkudGhlblJlc29sdmUoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDIxMikuc2hpZnRlZEJ5KEdXRUlfREVDSU1BTFMpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbjEgPSBuZXcgUmZxbVYyVHJhbnNhY3Rpb25TdWJtaXNzaW9uRW50aXR5KHtcclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSGFzaDogJzB4MScsXHJcbiAgICAgICAgICAgICAgICBmcm9tOiAnMHhmcm9tJyxcclxuICAgICAgICAgICAgICAgIHRvOiAnMHh0bycsXHJcbiAgICAgICAgICAgICAgICBvcmRlckhhc2g6ICcweE9yZGVyaGFzaCcsXHJcbiAgICAgICAgICAgICAgICBub25jZTogMCxcclxuICAgICAgICAgICAgICAgIG1heEZlZVBlckdhczogbmV3IEJpZ051bWJlcigzKSxcclxuICAgICAgICAgICAgICAgIG1heFByaW9yaXR5RmVlUGVyR2FzOiBuZXcgQmlnTnVtYmVyKDIpLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogUmZxbVRyYW5zYWN0aW9uU3VibWlzc2lvblR5cGUuVHJhZGUsXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbkNvbnRleHQgPSBuZXcgU3VibWlzc2lvbkNvbnRleHQoaW5zdGFuY2UobW9jayhSZnFCbG9ja2NoYWluVXRpbHMpKSwgW3RyYW5zYWN0aW9uMV0pO1xyXG4gICAgICAgICAgICBjb25zdCBhdHRlbmRhbnQgPSBuZXcgR2FzU3RhdGlvbkF0dGVuZGFudFBvbHlnb24oaW5zdGFuY2UocHJvdG9jb2xGZWVVdGlsc01vY2spKTtcclxuICAgICAgICAgICAgY29uc3QgZ2FzUmF0ZSA9IGF3YWl0IGF0dGVuZGFudC5nZXROZXh0QmlkQXN5bmMoc3VibWlzc2lvbkNvbnRleHQpO1xyXG5cclxuICAgICAgICAgICAgLy8gUHJldmlvdXMgc3VibWlzc2lvbiBnYXMgcHJpY2VzIHdlcmUgMiB0aXAsIDMgbWF4XHJcbiAgICAgICAgICAgIC8vIG5ldyB0aXAgPSAyMTIgR1dFSVxyXG4gICAgICAgICAgICAvLyBiYXNlIGZlZSA9IDEgR1dFSVxyXG4gICAgICAgICAgICAvLyB0b3RhbCA9IDIxMyBHV0VJXHJcbiAgICAgICAgICAgIGV4cGVjdChnYXNSYXRlPy5tYXhQcmlvcml0eUZlZVBlckdhcz8udG9TdHJpbmcoKSkudG8uZXF1YWwoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDIxMikudGltZXMoTWF0aC5wb3coMTAsIEdXRUlfREVDSU1BTFMpKS50b1N0cmluZygpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBleHBlY3QoZ2FzUmF0ZT8ubWF4RmVlUGVyR2FzPy50b1N0cmluZygpKS50by5lcXVhbChcclxuICAgICAgICAgICAgICAgIG5ldyBCaWdOdW1iZXIoMjEzKS50aW1lcyhNYXRoLnBvdygxMCwgR1dFSV9ERUNJTUFMUykpLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdjYWxjdWxhdGVzIGEgcmVzdWJtaXQgYmlkIHdpdGggdGhlIG1pbmltdW0gbWF4IGZlZSBwZXIgZ2FzIGluY3JlYXNlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICB3aGVuKHByb3RvY29sRmVlVXRpbHNNb2NrLmdldEdhc1ByaWNlRXN0aW1hdGlvbk9yVGhyb3dBc3luYygpKS50aGVuUmVzb2x2ZShuZXcgQmlnTnVtYmVyKDApKTtcclxuICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24xID0gbmV3IFJmcW1WMlRyYW5zYWN0aW9uU3VibWlzc2lvbkVudGl0eSh7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbkhhc2g6ICcweDEnLFxyXG4gICAgICAgICAgICAgICAgZnJvbTogJzB4ZnJvbScsXHJcbiAgICAgICAgICAgICAgICB0bzogJzB4dG8nLFxyXG4gICAgICAgICAgICAgICAgb3JkZXJIYXNoOiAnMHhPcmRlcmhhc2gnLFxyXG4gICAgICAgICAgICAgICAgbm9uY2U6IDAsXHJcbiAgICAgICAgICAgICAgICBtYXhGZWVQZXJHYXM6IG5ldyBCaWdOdW1iZXIoMTAxKS50aW1lcyhNYXRoLnBvdygxMCwgR1dFSV9ERUNJTUFMUykpLFxyXG4gICAgICAgICAgICAgICAgbWF4UHJpb3JpdHlGZWVQZXJHYXM6IG5ldyBCaWdOdW1iZXIoMTAwKS50aW1lcyhNYXRoLnBvdygxMCwgR1dFSV9ERUNJTUFMUykpLFxyXG4gICAgICAgICAgICAgICAgdHlwZTogUmZxbVRyYW5zYWN0aW9uU3VibWlzc2lvblR5cGUuVHJhZGUsXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbkNvbnRleHQgPSBuZXcgU3VibWlzc2lvbkNvbnRleHQoaW5zdGFuY2UobW9jayhSZnFCbG9ja2NoYWluVXRpbHMpKSwgW3RyYW5zYWN0aW9uMV0pO1xyXG4gICAgICAgICAgICBjb25zdCBhdHRlbmRhbnQgPSBuZXcgR2FzU3RhdGlvbkF0dGVuZGFudFBvbHlnb24oaW5zdGFuY2UocHJvdG9jb2xGZWVVdGlsc01vY2spKTtcclxuICAgICAgICAgICAgY29uc3QgZ2FzUmF0ZSA9IGF3YWl0IGF0dGVuZGFudC5nZXROZXh0QmlkQXN5bmMoc3VibWlzc2lvbkNvbnRleHQpO1xyXG5cclxuICAgICAgICAgICAgLy8gUHJldmlvdXMgc3VibWlzc2lvbiBnYXMgcHJpY2VzIHdlcmUgMTAwIHRpcCwgMTAxIHRvYXRsIChHV0VJKVxyXG4gICAgICAgICAgICAvLyBuZXcgdGlwID0gMTAwICogMS4xID0gMTEwIEdXRUlcclxuICAgICAgICAgICAgLy8gQmFzZSBGZWUgaXMgYWx3YXlzIDEgR1dFSVxyXG4gICAgICAgICAgICAvLyBNYXggZmVlIHBlciBnYXMgPSAxMTAgKyAxID0gMTExIEdXRUlcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy8gQlVUIG5lZWRzIGF0IGxlYXN0IGEgMTAlIGluY3JlYXNlIHNvIDExMS4xXHJcbiAgICAgICAgICAgIGV4cGVjdChnYXNSYXRlPy5tYXhQcmlvcml0eUZlZVBlckdhcz8udG9TdHJpbmcoKSkudG8uZXF1YWwoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmlnTnVtYmVyKDExMCkudGltZXMoTWF0aC5wb3coMTAsIEdXRUlfREVDSU1BTFMpKS50b1N0cmluZygpLFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBleHBlY3QoZ2FzUmF0ZT8ubWF4RmVlUGVyR2FzPy50b1N0cmluZygpKS50by5lcXVhbChcclxuICAgICAgICAgICAgICAgIG5ldyBCaWdOdW1iZXIoMTExLjEpLnRpbWVzKE1hdGgucG93KDEwLCBHV0VJX0RFQ0lNQUxTKSkudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9