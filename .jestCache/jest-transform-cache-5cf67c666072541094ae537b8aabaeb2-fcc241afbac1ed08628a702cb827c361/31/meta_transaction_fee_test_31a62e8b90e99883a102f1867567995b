c194a30c677e3c207516fac3a71af0ae
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_1 = require("@0x/utils");
const meta_transaction_fee_utils_1 = require("../../src/core/meta_transaction_fee_utils");
const FEE_TOKEN = '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174';
const FEE_RECIPIENT = '0x5fb652150AcE5303c82f0d1D491041e042f2ad22';
describe('meta_transaction_fee_utils', () => {
    describe('rawFeesToFees', () => {
        it('returns undefined if `rawFees` is undefined', () => {
            expect((0, meta_transaction_fee_utils_1.rawFeesToFees)(undefined)).toBeUndefined();
        });
        describe('integrator fee', () => {
            it('returns integrator fee as undefined if integrator fee is not provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    zeroExFee: {
                        type: 'integrator_share',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        integratorSharePercentage: '10',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.integratorFee).toBeUndefined();
            });
            it('returns the correct integrator fee if integrator fee is provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    integratorFee: {
                        type: 'volume',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        volumePercentage: '10',
                    },
                    zeroExFee: {
                        type: 'integrator_share',
                        feeToken: FEE_TOKEN,
                        feeAmount: '100000',
                        feeRecipient: FEE_RECIPIENT,
                        integratorSharePercentage: '1',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.integratorFee).toEqual({
                    type: 'volume',
                    feeToken: FEE_TOKEN,
                    feeAmount: new utils_1.BigNumber(1000),
                    feeRecipient: FEE_RECIPIENT,
                    volumePercentage: new utils_1.BigNumber(10),
                });
            });
        });
        describe('0x fee', () => {
            it('returns 0x fee as undefined if 0x fee is not provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    integratorFee: {
                        type: 'volume',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        volumePercentage: '10',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.zeroExFee).toBeUndefined();
            });
            it('returns the correct 0x fee volume fee if 0x fee is provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    integratorFee: {
                        type: 'volume',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        volumePercentage: '10',
                    },
                    zeroExFee: {
                        type: 'volume',
                        feeToken: FEE_TOKEN,
                        feeAmount: '100000',
                        feeRecipient: null,
                        volumePercentage: '1',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.zeroExFee).toEqual({
                    type: 'volume',
                    feeToken: FEE_TOKEN,
                    feeAmount: new utils_1.BigNumber(100000),
                    feeRecipient: null,
                    volumePercentage: new utils_1.BigNumber(1),
                });
            });
            it('returns the correct 0x fee integrator share fee if 0x fee is provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    integratorFee: {
                        type: 'volume',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        volumePercentage: '10',
                    },
                    zeroExFee: {
                        type: 'integrator_share',
                        feeToken: FEE_TOKEN,
                        feeAmount: '100000',
                        feeRecipient: FEE_RECIPIENT,
                        integratorSharePercentage: '1',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.zeroExFee).toEqual({
                    type: 'integrator_share',
                    feeToken: FEE_TOKEN,
                    feeAmount: new utils_1.BigNumber(100000),
                    feeRecipient: FEE_RECIPIENT,
                    integratorSharePercentage: new utils_1.BigNumber(1),
                });
            });
        });
        describe('gas fee', () => {
            it('returns gas fee as undefined if gas fee is not provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    zeroExFee: {
                        type: 'integrator_share',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        integratorSharePercentage: '10',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.gasFee).toBeUndefined();
            });
            it('returns the correct gas fee if gas is provided', () => {
                const fees = (0, meta_transaction_fee_utils_1.rawFeesToFees)({
                    integratorFee: {
                        type: 'volume',
                        feeToken: FEE_TOKEN,
                        feeAmount: '1000',
                        feeRecipient: FEE_RECIPIENT,
                        volumePercentage: '10',
                    },
                    zeroExFee: {
                        type: 'integrator_share',
                        feeToken: FEE_TOKEN,
                        feeAmount: '100000',
                        feeRecipient: FEE_RECIPIENT,
                        integratorSharePercentage: '1',
                    },
                    gasFee: {
                        type: 'gas',
                        feeToken: FEE_TOKEN,
                        feeAmount: '10',
                        feeRecipient: FEE_RECIPIENT,
                        gasPrice: '123',
                        estimatedGas: '200000',
                        feeTokenAmountPerBaseUnitNativeToken: '0.0001',
                    },
                });
                expect(fees).toBeTruthy();
                expect(fees === null || fees === void 0 ? void 0 : fees.gasFee).toEqual({
                    type: 'gas',
                    feeToken: FEE_TOKEN,
                    feeAmount: new utils_1.BigNumber(10),
                    feeRecipient: FEE_RECIPIENT,
                    gasPrice: new utils_1.BigNumber(123),
                    estimatedGas: new utils_1.BigNumber(200000),
                    feeTokenAmountPerBaseUnitNativeToken: new utils_1.BigNumber(0.0001),
                });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvdXRpbHMvbWV0YV90cmFuc2FjdGlvbl9mZWVfdGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHFDQUFzQztBQUN0QywwRkFBMEU7QUFFMUUsTUFBTSxTQUFTLEdBQUcsNENBQTRDLENBQUM7QUFDL0QsTUFBTSxhQUFhLEdBQUcsNENBQTRDLENBQUM7QUFFbkUsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtJQUN4QyxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1lBQ25ELE1BQU0sQ0FBQyxJQUFBLDBDQUFhLEVBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyRCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7WUFDNUIsRUFBRSxDQUFDLHVFQUF1RSxFQUFFLEdBQUcsRUFBRTtnQkFDN0UsTUFBTSxJQUFJLEdBQUcsSUFBQSwwQ0FBYSxFQUFDO29CQUN2QixTQUFTLEVBQUU7d0JBQ1AsSUFBSSxFQUFFLGtCQUFrQjt3QkFDeEIsUUFBUSxFQUFFLFNBQVM7d0JBQ25CLFNBQVMsRUFBRSxNQUFNO3dCQUNqQixZQUFZLEVBQUUsYUFBYTt3QkFDM0IseUJBQXlCLEVBQUUsSUFBSTtxQkFDbEM7aUJBQ0osQ0FBQyxDQUFDO2dCQUNILE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDMUIsTUFBTSxDQUFDLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxhQUFhLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNoRCxDQUFDLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxrRUFBa0UsRUFBRSxHQUFHLEVBQUU7Z0JBQ3hFLE1BQU0sSUFBSSxHQUFHLElBQUEsMENBQWEsRUFBQztvQkFDdkIsYUFBYSxFQUFFO3dC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QkFBUyxDQUFDLE1BQU0sQ0FBQztvQkFDbkMsb0NBQW9DLEVBQUUsSUFBSSxpQkFBUyxDQUFDLE1BQU0sQ0FBQztpQkFDOUQsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvdXRpbHMvbWV0YV90cmFuc2FjdGlvbl9mZWVfdGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdAMHgvdXRpbHMnO1xyXG5pbXBvcnQgeyByYXdGZWVzVG9GZWVzIH0gZnJvbSAnLi4vLi4vc3JjL2NvcmUvbWV0YV90cmFuc2FjdGlvbl9mZWVfdXRpbHMnO1xyXG5cclxuY29uc3QgRkVFX1RPS0VOID0gJzB4Mjc5MUJjYTFmMmRlNDY2MUVEODhBMzBDOTlBN2E5NDQ5QWE4NDE3NCc7XHJcbmNvbnN0IEZFRV9SRUNJUElFTlQgPSAnMHg1ZmI2NTIxNTBBY0U1MzAzYzgyZjBkMUQ0OTEwNDFlMDQyZjJhZDIyJztcclxuXHJcbmRlc2NyaWJlKCdtZXRhX3RyYW5zYWN0aW9uX2ZlZV91dGlscycsICgpID0+IHtcclxuICAgIGRlc2NyaWJlKCdyYXdGZWVzVG9GZWVzJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdyZXR1cm5zIHVuZGVmaW5lZCBpZiBgcmF3RmVlc2AgaXMgdW5kZWZpbmVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QocmF3RmVlc1RvRmVlcyh1bmRlZmluZWQpKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRlc2NyaWJlKCdpbnRlZ3JhdG9yIGZlZScsICgpID0+IHtcclxuICAgICAgICAgICAgaXQoJ3JldHVybnMgaW50ZWdyYXRvciBmZWUgYXMgdW5kZWZpbmVkIGlmIGludGVncmF0b3IgZmVlIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZlZXMgPSByYXdGZWVzVG9GZWVzKHtcclxuICAgICAgICAgICAgICAgICAgICB6ZXJvRXhGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVncmF0b3Jfc2hhcmUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogRkVFX1RPS0VOLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMDAwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlUmVjaXBpZW50OiBGRUVfUkVDSVBJRU5ULFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlZ3JhdG9yU2hhcmVQZXJjZW50YWdlOiAnMTAnLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChmZWVzKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QoZmVlcz8uaW50ZWdyYXRvckZlZSkudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGl0KCdyZXR1cm5zIHRoZSBjb3JyZWN0IGludGVncmF0b3IgZmVlIGlmIGludGVncmF0b3IgZmVlIGlzIHByb3ZpZGVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmVlcyA9IHJhd0ZlZXNUb0ZlZXMoe1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3ZvbHVtZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVSZWNpcGllbnQ6IEZFRV9SRUNJUElFTlQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZVBlcmNlbnRhZ2U6ICcxMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB6ZXJvRXhGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVncmF0b3Jfc2hhcmUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogRkVFX1RPS0VOLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMDAwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVSZWNpcGllbnQ6IEZFRV9SRUNJUElFTlQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JTaGFyZVBlcmNlbnRhZ2U6ICcxJyxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QoZmVlcykudG9CZVRydXRoeSgpO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KGZlZXM/LmludGVncmF0b3JGZWUpLnRvRXF1YWwoe1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd2b2x1bWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiBuZXcgQmlnTnVtYmVyKDEwMDApLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlZVJlY2lwaWVudDogRkVFX1JFQ0lQSUVOVCxcclxuICAgICAgICAgICAgICAgICAgICB2b2x1bWVQZXJjZW50YWdlOiBuZXcgQmlnTnVtYmVyKDEwKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZGVzY3JpYmUoJzB4IGZlZScsICgpID0+IHtcclxuICAgICAgICAgICAgaXQoJ3JldHVybnMgMHggZmVlIGFzIHVuZGVmaW5lZCBpZiAweCBmZWUgaXMgbm90IHByb3ZpZGVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmVlcyA9IHJhd0ZlZXNUb0ZlZXMoe1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3ZvbHVtZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVSZWNpcGllbnQ6IEZFRV9SRUNJUElFTlQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZVBlcmNlbnRhZ2U6ICcxMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KGZlZXMpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChmZWVzPy56ZXJvRXhGZWUpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpdCgncmV0dXJucyB0aGUgY29ycmVjdCAweCBmZWUgdm9sdW1lIGZlZSBpZiAweCBmZWUgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmZWVzID0gcmF3RmVlc1RvRmVlcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50ZWdyYXRvckZlZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndm9sdW1lJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW46IEZFRV9UT0tFTixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiAnMTAwMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVJlY2lwaWVudDogRkVFX1JFQ0lQSUVOVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lUGVyY2VudGFnZTogJzEwJyxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHplcm9FeEZlZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndm9sdW1lJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW46IEZFRV9UT0tFTixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiAnMTAwMDAwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlUmVjaXBpZW50OiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWVQZXJjZW50YWdlOiAnMScsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KGZlZXMpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChmZWVzPy56ZXJvRXhGZWUpLnRvRXF1YWwoe1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd2b2x1bWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiBuZXcgQmlnTnVtYmVyKDEwMDAwMCksXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlUmVjaXBpZW50OiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHZvbHVtZVBlcmNlbnRhZ2U6IG5ldyBCaWdOdW1iZXIoMSksXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpdCgncmV0dXJucyB0aGUgY29ycmVjdCAweCBmZWUgaW50ZWdyYXRvciBzaGFyZSBmZWUgaWYgMHggZmVlIGlzIHByb3ZpZGVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmVlcyA9IHJhd0ZlZXNUb0ZlZXMoe1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3ZvbHVtZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVSZWNpcGllbnQ6IEZFRV9SRUNJUElFTlQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZvbHVtZVBlcmNlbnRhZ2U6ICcxMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB6ZXJvRXhGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVncmF0b3Jfc2hhcmUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogRkVFX1RPS0VOLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMDAwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVSZWNpcGllbnQ6IEZFRV9SRUNJUElFTlQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JTaGFyZVBlcmNlbnRhZ2U6ICcxJyxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QoZmVlcykudG9CZVRydXRoeSgpO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KGZlZXM/Lnplcm9FeEZlZSkudG9FcXVhbCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVncmF0b3Jfc2hhcmUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiBuZXcgQmlnTnVtYmVyKDEwMDAwMCksXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlUmVjaXBpZW50OiBGRUVfUkVDSVBJRU5ULFxyXG4gICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JTaGFyZVBlcmNlbnRhZ2U6IG5ldyBCaWdOdW1iZXIoMSksXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRlc2NyaWJlKCdnYXMgZmVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBpdCgncmV0dXJucyBnYXMgZmVlIGFzIHVuZGVmaW5lZCBpZiBnYXMgZmVlIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZlZXMgPSByYXdGZWVzVG9GZWVzKHtcclxuICAgICAgICAgICAgICAgICAgICB6ZXJvRXhGZWU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVncmF0b3Jfc2hhcmUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogRkVFX1RPS0VOLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMDAwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlUmVjaXBpZW50OiBGRUVfUkVDSVBJRU5ULFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlZ3JhdG9yU2hhcmVQZXJjZW50YWdlOiAnMTAnLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChmZWVzKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QoZmVlcz8uZ2FzRmVlKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaXQoJ3JldHVybnMgdGhlIGNvcnJlY3QgZ2FzIGZlZSBpZiBnYXMgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmZWVzID0gcmF3RmVlc1RvRmVlcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50ZWdyYXRvckZlZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndm9sdW1lJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW46IEZFRV9UT0tFTixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiAnMTAwMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVJlY2lwaWVudDogRkVFX1JFQ0lQSUVOVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lUGVyY2VudGFnZTogJzEwJyxcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHplcm9FeEZlZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW50ZWdyYXRvcl9zaGFyZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBGRUVfVE9LRU4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwMDAwMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVJlY2lwaWVudDogRkVFX1JFQ0lQSUVOVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZWdyYXRvclNoYXJlUGVyY2VudGFnZTogJzEnLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZ2FzRmVlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdnYXMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogRkVFX1RPS0VOLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZVJlY2lwaWVudDogRkVFX1JFQ0lQSUVOVCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2FzUHJpY2U6ICcxMjMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlc3RpbWF0ZWRHYXM6ICcyMDAwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbkFtb3VudFBlckJhc2VVbml0TmF0aXZlVG9rZW46ICcwLjAwMDEnLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChmZWVzKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QoZmVlcz8uZ2FzRmVlKS50b0VxdWFsKHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2FzJyxcclxuICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogRkVFX1RPS0VOLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogbmV3IEJpZ051bWJlcigxMCksXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlUmVjaXBpZW50OiBGRUVfUkVDSVBJRU5ULFxyXG4gICAgICAgICAgICAgICAgICAgIGdhc1ByaWNlOiBuZXcgQmlnTnVtYmVyKDEyMyksXHJcbiAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVkR2FzOiBuZXcgQmlnTnVtYmVyKDIwMDAwMCksXHJcbiAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW5BbW91bnRQZXJCYXNlVW5pdE5hdGl2ZVRva2VuOiBuZXcgQmlnTnVtYmVyKDAuMDAwMSksXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==