{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/quoteRequestor/__tests__/testHelpers.ts","mappings":"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","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/quoteRequestor/__tests__/testHelpers.ts"],"sourcesContent":["import { InsufficientAssetLiquidityError, MockedRfqQuoteResponse } from '@0x/asset-swapper';\nimport { AltMockedRfqQuoteResponse } from '@0x/asset-swapper/lib/src/types';\nimport { BigNumber } from '@0x/utils';\nimport axios, { AxiosInstance } from 'axios';\nimport AxiosMockAdapter from 'axios-mock-adapter';\nimport * as _ from 'lodash';\n\nexport enum RfqQuoteEndpoint {\n    Indicative = 'price',\n    Firm = 'quote',\n}\n\nexport const testHelpers = {\n    expectInsufficientLiquidityErrorAsync: async (\n        expect: Chai.ExpectStatic,\n        functionWhichTriggersErrorAsync: () => Promise<void>,\n        expectedAmountAvailableToFill: BigNumber,\n    ): Promise<void> => {\n        let wasErrorThrown = false;\n        try {\n            await functionWhichTriggersErrorAsync();\n        } catch (e) {\n            wasErrorThrown = true;\n            expect(e).to.be.instanceOf(InsufficientAssetLiquidityError);\n            if (expectedAmountAvailableToFill) {\n                expect(e.amountAvailableToFill).to.be.bignumber.equal(expectedAmountAvailableToFill);\n            } else {\n                expect(e.amountAvailableToFill).to.equal(undefined);\n            }\n        }\n\n        expect(wasErrorThrown).to.equal(true);\n    },\n    /**\n     * A helper utility for testing which mocks out\n     * requests to RFQ-T/M providers\n     */\n    withMockedRfqQuotes: async (\n        standardMockedResponses: MockedRfqQuoteResponse[],\n        altMockedResponses: AltMockedRfqQuoteResponse[],\n        quoteType: RfqQuoteEndpoint,\n        afterResponseCallback: () => Promise<void>,\n        axiosClient: AxiosInstance = axios,\n    ): Promise<void> => {\n        // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const mockedAxios = new AxiosMockAdapter(axiosClient, { onNoMatch: 'throwException' } as any);\n        try {\n            // Mock out Standard RFQ-T/M responses\n            for (const mockedResponse of standardMockedResponses) {\n                const { endpoint, requestApiKey, requestParams, responseData, responseCode } = mockedResponse;\n                const requestHeaders = {\n                    Accept: 'application/json, text/plain, */*',\n                    '0x-api-key': requestApiKey,\n                    '0x-integrator-id': requestApiKey,\n                };\n                if (mockedResponse.callback !== undefined) {\n                    mockedAxios\n                        .onGet(`${endpoint}/${quoteType}`, { params: requestParams }, requestHeaders)\n                        .reply(mockedResponse.callback);\n                } else {\n                    mockedAxios\n                        .onGet(`${endpoint}/${quoteType}`, { params: requestParams }, requestHeaders)\n                        .replyOnce(responseCode, responseData);\n                }\n            }\n            // Mock out Alt RFQ-T/M responses\n            for (const mockedResponse of altMockedResponses) {\n                const { endpoint, /* mmApiKey, */ requestData, responseData, responseCode } = mockedResponse;\n                // Commented out during copy-paste\n                // const requestHeaders = {\n                //     Accept: 'application/json, text/plain, */*',\n                //     'Content-Type': 'application/json;charset=utf-8',\n                //     Authorization: `Bearer ${mmApiKey}`,\n                // };\n                mockedAxios\n                    .onPost(\n                        `${endpoint}/quotes`,\n                        // hack to get AxiosMockAdapter to recognize the match\n                        // b/t the mock data and the request data\n                        {\n                            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                            asymmetricMatch: (x: any) => {\n                                return _.isEqual(requestData, x);\n                            },\n                        },\n                        // commented out to avoid over-specifying what the mock will match on.\n                        // requestHeaders,\n                    )\n                    .replyOnce(responseCode, responseData);\n            }\n            // Perform the callback function, e.g. a test validation\n            await afterResponseCallback();\n        } finally {\n            // Ensure we always restore axios afterwards\n            mockedAxios.restore();\n        }\n    },\n};\n"],"version":3}