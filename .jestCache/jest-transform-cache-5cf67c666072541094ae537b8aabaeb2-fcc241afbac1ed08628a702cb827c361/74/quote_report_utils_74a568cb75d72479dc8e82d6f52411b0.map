{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/utils/quote_report_utils.ts","mappings":"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","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/utils/quote_report_utils.ts"],"sourcesContent":["import { ERC20BridgeSource, FillData, NativeFillData, RfqOrderFields } from '@0x/asset-swapper';\r\nimport { BigNumber } from '@0x/utils';\r\nimport { Producer } from 'kafkajs';\r\n\r\nimport { logger } from '../logger';\r\nimport { FirmOtcQuote, IndicativeQuote, RfqtV2Quote, StoredFee } from '../core/types';\r\n\r\nimport { numberUtils } from './number_utils';\r\n\r\n/** Migrated from @0x/asset-swapper */\r\n\r\nexport interface ExtendedQuoteReport {\r\n    quoteId?: string;\r\n    taker?: string;\r\n    timestamp: number;\r\n    firmQuoteReport: boolean;\r\n    submissionBy: 'taker' | 'metaTxn' | 'rfqm' | 'gaslessSwapRfq' | 'gaslessSwapAmm';\r\n    buyAmount?: string;\r\n    sellAmount?: string;\r\n    buyTokenAddress: string;\r\n    sellTokenAddress: string;\r\n    integratorId?: string;\r\n    slippageBips?: number;\r\n    zeroExTransactionHash?: string;\r\n    decodedUniqueId?: string;\r\n    sourcesConsidered: ExtendedQuoteReportIndexedEntryOutbound[];\r\n    sourcesDelivered: ExtendedQuoteReportIndexedEntryOutbound[] | undefined;\r\n}\r\n\r\nexport interface QuoteReportEntryBase {\r\n    liquiditySource: ERC20BridgeSource;\r\n    makerAmount: BigNumber;\r\n    takerAmount: BigNumber;\r\n    fillData: FillData;\r\n}\r\nexport interface BridgeQuoteReportEntry extends QuoteReportEntryBase {\r\n    liquiditySource: Exclude<ERC20BridgeSource, ERC20BridgeSource.Native>;\r\n}\r\nexport interface MultiHopQuoteReportEntry extends QuoteReportEntryBase {\r\n    liquiditySource: ERC20BridgeSource.MultiHop;\r\n    hopSources: ERC20BridgeSource[];\r\n}\r\nexport interface NativeLimitOrderQuoteReportEntry extends QuoteReportEntryBase {\r\n    liquiditySource: ERC20BridgeSource.Native;\r\n    fillData: NativeFillData;\r\n    fillableTakerAmount: BigNumber;\r\n    isRFQ: false;\r\n}\r\nexport interface NativeRfqOrderQuoteReportEntry extends QuoteReportEntryBase {\r\n    liquiditySource: ERC20BridgeSource.Native;\r\n    fillData: NativeFillData;\r\n    fillableTakerAmount: BigNumber;\r\n    isRFQ: true;\r\n    nativeOrder: RfqOrderFields;\r\n    makerUri: string;\r\n    comparisonPrice?: number;\r\n}\r\nexport interface IndicativeRfqOrderQuoteReportEntry extends QuoteReportEntryBase {\r\n    liquiditySource: ERC20BridgeSource.Native;\r\n    fillableTakerAmount: BigNumber;\r\n    isRFQ: true;\r\n    makerUri?: string;\r\n    comparisonPrice?: number;\r\n}\r\n\r\nexport declare type ExtendedQuoteReportEntry =\r\n    | BridgeQuoteReportEntry\r\n    | MultiHopQuoteReportEntry\r\n    | NativeLimitOrderQuoteReportEntry\r\n    | NativeRfqOrderQuoteReportEntry\r\n    | IndicativeRfqOrderQuoteReportEntry;\r\n\r\nexport type ExtendedQuoteReportIndexedEntry = ExtendedQuoteReportEntry & {\r\n    quoteEntryIndex: number;\r\n    isDelivered: boolean;\r\n};\r\n\r\nexport type ExtendedQuoteReportIndexedEntryOutbound = Omit<ExtendedQuoteReportIndexedEntry, 'fillData'> & {\r\n    fillData?: string;\r\n};\r\n\r\n/************************************/\r\n\r\ntype ExtendedQuoteReportEntryWithIntermediateQuote = ExtendedQuoteReportIndexedEntryOutbound & {\r\n    isIntermediate: boolean;\r\n};\r\n\r\ntype ExtendedQuoteReportWithIntermediateQuote = Omit<ExtendedQuoteReport, 'sourcesConsidered'> & {\r\n    sourcesConsidered: ExtendedQuoteReportEntryWithIntermediateQuote[];\r\n};\r\n\r\ntype ExtendedQuoteReportWithFee = ExtendedQuoteReportWithIntermediateQuote & {\r\n    fee: StoredFee;\r\n    ammQuoteUniqueId?: string;\r\n    isLiquidityAvailable?: boolean;\r\n};\r\n\r\ninterface ExtendedQuoteReportForRFQMLogOptions {\r\n    isFirmQuote: boolean;\r\n    sellAmount?: BigNumber;\r\n    buyAmount?: BigNumber;\r\n    buyTokenAddress: string;\r\n    sellTokenAddress: string;\r\n    integratorId?: string;\r\n    taker?: string;\r\n    finalQuotes: IndicativeQuote[] | FirmOtcQuote[];\r\n    intermediateQuotes: IndicativeQuote[];\r\n    bestQuote: IndicativeQuote | FirmOtcQuote | null;\r\n    fee: StoredFee;\r\n    ammQuoteUniqueId?: string;\r\n    isLiquidityAvailable?: boolean;\r\n}\r\n/**\r\n * RFQt V2 Fee Event Interfaces\r\n */\r\ninterface RfqtV2FeeEventLogOptions {\r\n    requestedBuyAmount: BigNumber | null;\r\n    requestedSellAmount: BigNumber | null;\r\n    requestedTakerAddress: string;\r\n    buyTokenAddress: string;\r\n    sellTokenAddress: string;\r\n    integratorId: string;\r\n    blockNumber?: number;\r\n    quotes: RfqtV2Quote[];\r\n    fee: StoredFee;\r\n}\r\n\r\ninterface RfqtV2FeeEvent {\r\n    createdAt: number;\r\n    orderHash: string;\r\n    requestedBuyAmount: BigNumber | null;\r\n    requestedSellAmount: BigNumber | null;\r\n    requestedTakerAddress: string;\r\n    fillableBuyAmount: BigNumber;\r\n    fillableSellAmount: BigNumber;\r\n    buyTokenAddress: string;\r\n    sellTokenAddress: string;\r\n    fee: StoredFee;\r\n    integratorId: string;\r\n    makerId?: string;\r\n    makerUri?: string;\r\n    expiry: BigNumber;\r\n    blockNumber?: number;\r\n}\r\n\r\nexport const quoteReportUtils = {\r\n    async publishRFQMQuoteReportAsync(\r\n        logOpts: ExtendedQuoteReportForRFQMLogOptions,\r\n        kafkaProducer: Producer,\r\n        quoteReportTopic?: string,\r\n        extendedQuoteReportSubmissionBy: ExtendedQuoteReport['submissionBy'] = 'rfqm',\r\n    ): Promise</* quoteId */ string | null> {\r\n        if (kafkaProducer && quoteReportTopic) {\r\n            const quoteId = numberUtils.randomHexNumberOfLength(10);\r\n            logger.info(`Generating and pushing RFQm Quote Report for: ${quoteId}`);\r\n\r\n            let orderHash: string | undefined;\r\n            if (logOpts.bestQuote && isFirmQuote(logOpts.bestQuote)) {\r\n                orderHash = logOpts.bestQuote.order.getHash();\r\n            }\r\n\r\n            const finalQuotes = logOpts.finalQuotes.map(\r\n                (quote, index): ExtendedQuoteReportEntryWithIntermediateQuote => {\r\n                    return {\r\n                        ...jsonifyFillData({\r\n                            quoteEntryIndex: index,\r\n                            isDelivered: false,\r\n                            liquiditySource: ERC20BridgeSource.Native,\r\n                            makerAmount: isFirmQuote(quote) ? quote.order.makerAmount : quote.makerAmount,\r\n                            takerAmount: isFirmQuote(quote) ? quote.order.takerAmount : quote.takerAmount,\r\n                            fillableTakerAmount: isFirmQuote(quote) ? quote.order.takerAmount : quote.takerAmount,\r\n                            isRFQ: true,\r\n                            makerUri: quote.makerUri,\r\n                            fillData: isFirmQuote(quote) ? quote.order : {},\r\n                        }),\r\n                        isIntermediate: false,\r\n                    };\r\n                },\r\n            );\r\n\r\n            const intermediateQuotes = logOpts.intermediateQuotes.map(\r\n                (quote, index): ExtendedQuoteReportEntryWithIntermediateQuote => {\r\n                    return {\r\n                        ...jsonifyFillData({\r\n                            quoteEntryIndex: index,\r\n                            isDelivered: false,\r\n                            liquiditySource: ERC20BridgeSource.Native,\r\n                            makerAmount: isFirmQuote(quote) ? quote.order.makerAmount : quote.makerAmount,\r\n                            takerAmount: isFirmQuote(quote) ? quote.order.takerAmount : quote.takerAmount,\r\n                            fillableTakerAmount: isFirmQuote(quote) ? quote.order.takerAmount : quote.takerAmount,\r\n                            isRFQ: true,\r\n                            makerUri: quote.makerUri,\r\n                            fillData: isFirmQuote(quote) ? quote.order : {},\r\n                        }),\r\n                        isIntermediate: true,\r\n                    };\r\n                },\r\n            );\r\n\r\n            const sourcesDelivered: ExtendedQuoteReportIndexedEntryOutbound[] | undefined = logOpts.bestQuote\r\n                ? [\r\n                      jsonifyFillData({\r\n                          quoteEntryIndex: 0,\r\n                          isDelivered: true,\r\n                          liquiditySource: ERC20BridgeSource.Native,\r\n                          makerAmount: isFirmQuote(logOpts.bestQuote)\r\n                              ? logOpts.bestQuote?.order.makerAmount\r\n                              : logOpts.bestQuote?.makerAmount,\r\n                          takerAmount: isFirmQuote(logOpts.bestQuote)\r\n                              ? logOpts.bestQuote?.order.takerAmount\r\n                              : logOpts.bestQuote?.takerAmount,\r\n                          fillableTakerAmount: isFirmQuote(logOpts.bestQuote)\r\n                              ? logOpts.bestQuote?.order.takerAmount\r\n                              : logOpts.bestQuote?.takerAmount,\r\n                          isRFQ: true,\r\n                          makerUri: logOpts.bestQuote?.makerUri,\r\n                          fillData: isFirmQuote(logOpts.bestQuote) ? logOpts.bestQuote?.order : {},\r\n                      }),\r\n                  ]\r\n                : undefined;\r\n            const extendedQuoteReport: ExtendedQuoteReportWithFee = {\r\n                quoteId,\r\n                taker: logOpts.taker,\r\n                timestamp: Date.now(),\r\n                firmQuoteReport: logOpts.isFirmQuote,\r\n                submissionBy: extendedQuoteReportSubmissionBy,\r\n                buyAmount: logOpts.buyAmount ? logOpts.buyAmount.toString() : undefined,\r\n                sellAmount: logOpts.sellAmount ? logOpts.sellAmount.toString() : undefined,\r\n                buyTokenAddress: logOpts.buyTokenAddress,\r\n                sellTokenAddress: logOpts.sellTokenAddress,\r\n                integratorId: logOpts.integratorId,\r\n                slippageBips: undefined,\r\n                zeroExTransactionHash: orderHash,\r\n                sourcesConsidered: finalQuotes.concat(intermediateQuotes),\r\n                sourcesDelivered,\r\n                fee: logOpts.fee,\r\n                ammQuoteUniqueId: logOpts.ammQuoteUniqueId,\r\n                isLiquidityAvailable: logOpts.isLiquidityAvailable,\r\n            };\r\n            kafkaProducer.send({\r\n                topic: quoteReportTopic,\r\n                messages: [\r\n                    {\r\n                        value: JSON.stringify(extendedQuoteReport),\r\n                    },\r\n                ],\r\n            });\r\n            return quoteId;\r\n        }\r\n        return null;\r\n    },\r\n    async publishRfqtV2FeeEvent(logOpts: RfqtV2FeeEventLogOptions, kafkaProducer: Producer, feeEventTopic?: string) {\r\n        if (kafkaProducer && feeEventTopic) {\r\n            const createdAt = Date.now();\r\n            logger.info(`Generating and pushing RFQt V2 Quote Report`);\r\n\r\n            logOpts.quotes.map((quote) => {\r\n                const quoteReport: RfqtV2FeeEvent = {\r\n                    createdAt,\r\n                    orderHash: quote.order.getHash(),\r\n                    requestedBuyAmount: logOpts.requestedBuyAmount,\r\n                    requestedSellAmount: logOpts.requestedSellAmount,\r\n                    requestedTakerAddress: logOpts.requestedTakerAddress,\r\n                    fillableBuyAmount: quote.fillableMakerAmount,\r\n                    fillableSellAmount: quote.fillableTakerAmount,\r\n                    buyTokenAddress: logOpts.buyTokenAddress,\r\n                    sellTokenAddress: logOpts.sellTokenAddress,\r\n                    fee: logOpts.fee,\r\n                    integratorId: logOpts.integratorId,\r\n                    makerId: quote.makerId,\r\n                    makerUri: quote.makerUri,\r\n                    expiry: quote.order.expiry,\r\n                    blockNumber: logOpts.blockNumber,\r\n                };\r\n\r\n                kafkaProducer.send({\r\n                    topic: feeEventTopic,\r\n                    messages: [\r\n                        {\r\n                            value: JSON.stringify(quoteReport),\r\n                        },\r\n                    ],\r\n                });\r\n            });\r\n        }\r\n    },\r\n};\r\n\r\nfunction isFirmQuote(quote: FirmOtcQuote | IndicativeQuote): quote is FirmOtcQuote {\r\n    return (quote as FirmOtcQuote).order !== undefined;\r\n}\r\n\r\n/**\r\n * Migrated from @0x/asset-swapper\r\n */\r\nexport function jsonifyFillData(source: ExtendedQuoteReportIndexedEntry): ExtendedQuoteReportIndexedEntryOutbound {\r\n    return {\r\n        ...source,\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        fillData: JSON.stringify(source.fillData, (key: string, value: any) => {\r\n            if (key === '_samplerContract') {\r\n                return {};\r\n            } else {\r\n                return value;\r\n            }\r\n        }),\r\n    };\r\n}\r\n"],"version":3}