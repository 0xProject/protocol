76759ff9f2b3c5a5d85ed01647bf97b0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Scheduler = void 0;
const node_schedule_1 = require("node-schedule");
const logger_1 = require("./logger");
class Scheduler {
    constructor(jobs) {
        this.jobs = jobs;
    }
    /**
     * Shutdown the scheduler.
     */
    static async shutdownAsync() {
        try {
            await (0, node_schedule_1.gracefulShutdown)();
        }
        catch (error) {
            logger_1.logger.error({ errorMessage: error.message, stack: error.stack }, 'Error shuting down job scheduler');
            throw error;
        }
    }
    /**
     * Schedule all background jobs.
     */
    start() {
        for (const job of this.jobs) {
            try {
                logger_1.logger.info({ schedule: job.schedule }, 'Scheduling background job');
                // Schedule the job the invoke immediately
                (0, node_schedule_1.scheduleJob)(job.schedule, job.func).invoke();
            }
            catch (error) {
                logger_1.logger.error({ schedule: job.schedule, errorMessage: error.message, stack: error.stack }, 'Error scheduling background job');
                throw error;
            }
        }
    }
}
exports.Scheduler = Scheduler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy9zY2hlZHVsZXIudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaURBQThEO0FBRTlELHFDQUFrQztBQU9sQyxNQUFhLFNBQVM7SUFZbEIsWUFBNkIsSUFBOEI7UUFBOUIsU0FBSSxHQUFKLElBQUksQ0FBMEI7SUFBRyxDQUFDO0lBWC9EOztPQUVHO0lBQ0ksTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhO1FBQzdCLElBQUk7WUFDQSxNQUFNLElBQUEsZ0NBQWdCLEdBQUUsQ0FBQztTQUM1QjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ1osZUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVksRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsa0NBQWtDLENBQUMsQ0FBQztZQUN0RyxNQUFNLEtBQUssQ0FBQztTQUNmO0lBQ0wsQ0FBQztJQUdEOztPQUVHO0lBQ0ksS0FBSztRQUNSLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUN6QixJQUFJO2dCQUNBLGVBQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFLDJCQUEyQixDQUFDLENBQUM7Z0JBQ3JFLDBDQUEwQztnQkFDMUMsSUFBQSwyQkFBVyxFQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQ2hEO1lBQUMsT0FBTyxLQUFLLEVBQUU7Z0JBQ1osZUFBTSxDQUFDLEtBQUssQ0FDUixFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsUUFBUSxFQUFFLFlBQVksRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQzNFLGlDQUFpQyxDQUNwQyxDQUFDO2dCQUNGLE1BQU0sS0FBSyxDQUFDO2FBQ2Y7U0FDSjtJQUNMLENBQUM7Q0FDSjtBQWhDRCw4QkFnQ0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy9zY2hlZHVsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ3JhY2VmdWxTaHV0ZG93biwgc2NoZWR1bGVKb2IgfSBmcm9tICdub2RlLXNjaGVkdWxlJztcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNjaGVkdWxlZEJhY2tncm91bmRKb2Ige1xuICAgIHNjaGVkdWxlOiBzdHJpbmc7IC8vIGNyb24gc3R5bGUgc3RyaW5nIHRvIGluZGljYXRlIHNjaGVkdWxpbmcgZnJlcXVlbmN5XG4gICAgZnVuYzogKCkgPT4gUHJvbWlzZTx2b2lkPjsgLy8gZnVuY3Rpb24gdG8gYmUgc2NoZWR1bGVkXG59XG5cbmV4cG9ydCBjbGFzcyBTY2hlZHVsZXIge1xuICAgIC8qKlxuICAgICAqIFNodXRkb3duIHRoZSBzY2hlZHVsZXIuXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBzaHV0ZG93bkFzeW5jKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgZ3JhY2VmdWxTaHV0ZG93bigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHsgZXJyb3JNZXNzYWdlOiBlcnJvci5tZXNzYWdlLCBzdGFjazogZXJyb3Iuc3RhY2sgfSwgJ0Vycm9yIHNodXRpbmcgZG93biBqb2Igc2NoZWR1bGVyJyk7XG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGpvYnM6IFNjaGVkdWxlZEJhY2tncm91bmRKb2JbXSkge31cblxuICAgIC8qKlxuICAgICAqIFNjaGVkdWxlIGFsbCBiYWNrZ3JvdW5kIGpvYnMuXG4gICAgICovXG4gICAgcHVibGljIHN0YXJ0KCk6IHZvaWQge1xuICAgICAgICBmb3IgKGNvbnN0IGpvYiBvZiB0aGlzLmpvYnMpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oeyBzY2hlZHVsZTogam9iLnNjaGVkdWxlIH0sICdTY2hlZHVsaW5nIGJhY2tncm91bmQgam9iJyk7XG4gICAgICAgICAgICAgICAgLy8gU2NoZWR1bGUgdGhlIGpvYiB0aGUgaW52b2tlIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICAgICAgc2NoZWR1bGVKb2Ioam9iLnNjaGVkdWxlLCBqb2IuZnVuYykuaW52b2tlKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgICAgICAgICAgeyBzY2hlZHVsZTogam9iLnNjaGVkdWxlLCBlcnJvck1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsIHN0YWNrOiBlcnJvci5zdGFjayB9LFxuICAgICAgICAgICAgICAgICAgICAnRXJyb3Igc2NoZWR1bGluZyBiYWNrZ3JvdW5kIGpvYicsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==