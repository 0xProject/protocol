{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/utils/rfq_blockchain_utils.ts","mappings":";;;AAAA,qCAAqC;AAErC,+DAAiD;AAEjD,6DAAwD;AACxD,uDAAoF;AACpF,mDAAsG;AACtG,qCAAiE;AACjE,kDAA+C;AAG/C,mCAAqG;AACrG,4CAAqD;AAErD,kCAA+B;AAC/B,iDAS2B;AAC3B,sDAAqD;AACrD,sCAAmC;AACnC,yCAMuB;AAEvB,mDAAiD;AAEjD,+CAAwD;AACxD,2EAAwE;AACxE,mDAA+C;AAC/C,+DAA2D;AAE3D,mDAAmD;AACnD,MAAM,aAAa,GAAG,IAAI,iBAAS,CAAC,CAAC,CAAC,CAAC;AACvC,WAAW;AACX,MAAM,aAAa,GAAG,IAAI,iBAAS,CAAC,IAAI,CAAC,CAAC;AAC1C,MAAM,6BAA6B,GAAG,oEAAoE,CAAC;AAC3G,MAAM,6BAA6B,GAAG,oEAAoE,CAAC;AAC3G,MAAM,sBAAsB,GAAG;IAC3B;QACI,SAAS,EAAE,KAAK;QAChB,MAAM,EAAE;YACJ,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,SAAS,EAAE;YAC/E,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE;YAC3E,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE;YAC3E,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,SAAS,EAAE;YAChF,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,SAAS,EAAE;YAChF,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,wBAAwB,EAAE,IAAI,EAAE,SAAS,EAAE;YAC5F,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,wBAAwB,EAAE,IAAI,EAAE,SAAS,EAAE;YAC5F,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE;SAC7E;QACD,IAAI,EAAE,gBAAgB;QACtB,IAAI,EAAE,OAAO;KAChB;IACD;QACI,SAAS,EAAE,KAAK;QAChB,MAAM,EAAE;YACJ,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,SAAS,EAAE;YAC/E,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE;YAC3E,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE;YAC3E,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,SAAS,EAAE;YAChF,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,SAAS,EAAE;YAChF,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,wBAAwB,EAAE,IAAI,EAAE,SAAS,EAAE;YAC5F,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE,SAAS,EAAE,IAAI,EAAE,wBAAwB,EAAE,IAAI,EAAE,SAAS,EAAE;SAC/F;QACD,IAAI,EAAE,gBAAgB;QACtB,IAAI,EAAE,OAAO;KAChB;CACJ,CAAC;AAEF,SAAS,WAAW,CAAC,eAAgC;IACjD,OAAO,IAAI,iBAAS,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC,CAAC;AACrD,CAAC;AAED,MAAa,kBAAkB;IA2C3B,YACI,QAA2B,EACV,qBAA6B,EAC9C,cAA8B,EAC9B,cAAyC,EACzC,YAAqB;QAHJ,0BAAqB,GAArB,qBAAqB,CAAQ;QAK9C,IAAI,CAAC,WAAW,GAAG,IAAI,kBAAU,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC;QAC5D,IAAI,CAAC,iBAAiB,GAAG,IAAI,oBAAoB,CAAC,cAAc,EAAE,qBAAqB,CAAC,CAAC;QACzF,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;QACtC,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;QAClC,IAAI,CAAC,cAAc,GAAG,IAAI,mCAAe,CAAC,IAAI,CAAC,qBAAqB,EAAE,QAAQ,CAAC,CAAC;IACpF,CAAC;IA7CM,MAAM,CAAC,+BAA+B,CAAC,QAAgB,EAAE,KAAa;QACzE,MAAM,MAAM,GAAG,eAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC;QAErF,gBAAgB;QAChB,OAAO,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;IAC1C,CAAC;IAEM,MAAM,CAAC,4BAA4B,CAAC,QAAgB,EAAE,KAAa;QACtE,MAAM,MAAM,GAAG,eAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC;QAErF,OAAO,MAAM,CAAC,OAAO,CAAC;IAC1B,CAAC;IAEM,MAAM,CAAC,wBAAwB,CAClC,WAA8B,EAC9B,wBAAqD;QAErD,MAAM,cAAc,GAAG,IAAI,iCAAkB,EAAE,CAAC;QAChD,cAAc,CAAC,WAAW,CAAC,wBAAwB,CAAC,CAAC;QACrD,cAAc,CAAC,WAAW,CAAC,IAAI,wCAAkB,CAAC,WAAW,CAAC,CAAC,CAAC;QAChE,qBAAa,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;QAClD,OAAO,cAAc,CAAC;IAC1B,CAAC;IAED,uDAAuD;IAC/C,MAAM,CAAC,eAAe,CAAC,KAAa;QACxC,+BAA+B;QAC/B,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;YAC1C,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;SACpC;QACD,OAAO,iBAAiB,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;IACnD,CAAC;IAgBD;;;OAGG;IACI,KAAK,CAAC,kCAAkC,CAAC,WAAsC;QAClF,OAAO,IAAI,CAAC,iBAAiB,CAAC,kCAAkC,CAAC,WAAW,CAAC,CAAC;IAClF,CAAC;IAED;;;OAGG;IACI,KAAK,CAAC,qBAAqB,CAAC,WAAsC;QACrE,OAAO,IAAI,CAAC,iBAAiB,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC;IACrE,CAAC;IAED,4EAA4E;IACrE,uBAAuB,CAC1B,QAAkB,EAClB,SAAoB,EACpB,KAAa,EACb,WAAsB,EACtB,OAAgB;QAEhB,sCAAsC;QACtC,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc;aAC/B,YAAY,CAAC,QAAQ,EAAE,SAAS,EAAE,WAAW,CAAC;aAC9C,4BAA4B,EAAE,CAAC;QAEpC,OAAO,IAAI,gCAAe,CAAC;YACvB,MAAM,EAAE,KAAK;YACb,MAAM,EAAE,wBAAY;YACpB,WAAW,EAAE,aAAa;YAC1B,WAAW,EAAE,aAAa;YAC1B,qBAAqB,EAAE,QAAQ,CAAC,MAAM;YACtC,IAAI,EAAE,IAAI,iBAAS,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;YAC/B,QAAQ;YACR,KAAK,EAAE,gBAAI;YACX,QAAQ,EAAE,wBAAY;YACtB,SAAS,EAAE,gBAAI;YACf,OAAO;YACP,iBAAiB,EAAE,IAAI,CAAC,cAAc,CAAC,OAAO;SACjD,CAAC,CAAC;IACP,CAAC;IAEM,KAAK,CAAC,6CAA6C,CACtD,QAAgB,EAChB,MAAc,EACd,SAA6B;QAE7B,6DAA6D;QAC7D,8DAA8D;QAC9D,MAAM,WAAW,GAAQ,IAAI,CAAC,cAAc,CAAC,4BAA4B,CAAC,wBAAwB,EAAE,QAAQ,CAAC,CAAC;QAC9G,OAAO,IAAI,CAAC,mCAAmC,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,SAAS,CAAC,CAAC;IACvG,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,mCAAmC,CAC5C,MAAuB,EACvB,SAAoB,EACpB,MAAc,EACd,SAA6B;QAE7B,IAAI;YACA,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc;iBACpC,sBAAsB,CAAC,MAAM,EAAE,SAAS,CAAC;iBACzC,SAAS,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,SAAS,EAAE,CAAC,CAAC;YAC/C,MAAM,oBAAoB,GAAG,qDAAqD;;YAC9E,uDAAuD;YAEnD,IAAI,CAAC,cAAc,CAAC,4BAA4B,CAAC,cAAc,EAAE,MAAM,CAAC,QAAQ,CACnF,CAAC,sDAAsD,CAAC,CAAC,CAAC,CAAC;YAChE,MAAM,cAAc,GAA2B,IAAI,CAAC,cAAc,CAAC,uBAAuB,CACtF,cAAc,EACd,OAAO,CACV,CAAC;YACF,IAAI,cAAc,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,oBAAoB,CAAC,EAAE;gBACpD,eAAM,CAAC,KAAK,CAAC,4EAA4E,CAAC,CAAC;gBAC3F,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;aACvE;YACD,OAAO,cAAc,CAAC;SACzB;QAAC,OAAO,GAAG,EAAE;YACV,eAAM,CAAC,KAAK,CAAC,EAAE,YAAY,EAAE,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,OAAO,EAAE,EAAE,uDAAuD,CAAC,CAAC;YACtG,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;SACxB;IACL,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,wBAAwB,CAAC,EAAU,EAAE,QAAgB;QAC9D,IAAI;YACA,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC;gBAC5B,EAAE;gBACF,IAAI,EAAE,QAAQ;aACjB,CAAC,CAAC;SACN;QAAC,OAAO,CAAC,EAAE;YACR,IAAI,CAAC,YAAY,KAAK,EAAE;gBACpB,CAAC,CAAC,OAAO,GAAG,6BAA6B,CAAC,CAAC,OAAO,EAAE,CAAC;aACxD;YACD,MAAM,CAAC,CAAC;SACX;IACL,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,0CAA0C,CACnD,KAAe,EACf,cAAyB,EACzB,cAAyB,EACzB,MAAc,EACd,QAAiB;QAEjB,IAAI;YACA,IAAI,QAAQ,EAAE;gBACV,OAAO,MAAM,IAAI,CAAC,cAAc;qBAC3B,6BAA6B,CAAC,KAAK,EAAE,cAAc,EAAE,cAAc,CAAC;qBACpE,gBAAgB,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;aAC3C;iBAAM;gBACH,OAAO,MAAM,IAAI,CAAC,cAAc;qBAC3B,uBAAuB,CAAC,KAAK,EAAE,cAAc,EAAE,cAAc,CAAC;qBAC9D,gBAAgB,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;aAC3C;SACJ;QAAC,OAAO,GAAG,EAAE;YACV,eAAM,CAAC,KAAK,CACR;gBACI,SAAS,EAAE,KAAK,CAAC,OAAO,EAAE;gBAC1B,KAAK,EAAE,KAAK,CAAC,KAAK;gBAClB,KAAK,EAAE,KAAK,CAAC,KAAK;gBAClB,QAAQ;gBACR,YAAY,EAAE,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,OAAO;aAC7B,EACD,6CAA6C,CAChD,CAAC;YACF,MAAM,GAAG,CAAC;SACb;IACL,CAAC;IAED;;OAEG;IACI,mCAAmC,CACtC,KAAe,EACf,cAAyB,EACzB,cAAyB,EACzB,QAAiB,EACjB,gBAA+B;QAE/B,MAAM,QAAQ,GAAG,QAAQ;YACrB,CAAC,CAAC,IAAI,CAAC,cAAc;iBACd,6BAA6B,CAAC,KAAK,EAAE,cAAc,EAAE,cAAc,CAAC;iBACpE,4BAA4B,EAAE;YACrC,CAAC,CAAC,IAAI,CAAC,cAAc;iBACd,uBAAuB,CAAC,KAAK,EAAE,cAAc,EAAE,cAAc,CAAC;iBAC9D,4BAA4B,EAAE,CAAC;QAC1C,OAAO,4BAAY,CAAC,iBAAiB,CAAC,QAAQ,EAAE,gBAAgB,CAAC,CAAC,cAAc,CAAC;IACrF,CAAC;IAEM,+BAA+B,CAClC,MAAuB,EACvB,SAAoB,EACpB,gBAA+B;QAE/B,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC,4BAA4B,EAAE,CAAC;QAC9G,OAAO,4BAAY,CAAC,iBAAiB,CAAC,QAAQ,EAAE,gBAAgB,CAAC,CAAC,cAAc,CAAC;IACrF,CAAC;IAEM,KAAK,CAAC,aAAa,CAAC,aAAqB;QAC5C,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,aAAa,CAAC,CAAC;IACnE,CAAC;IAEM,uBAAuB;QAC1B,OAAO,IAAI,CAAC,qBAAqB,CAAC;IACtC,CAAC;IAED;;;OAGG;IACI,KAAK,CAAC,gBAAgB,CAAC,iBAA2B;QACrD,OAAO,OAAO,CAAC,GAAG,CACd,iBAAiB,CAAC,GAAG,CAAC,KAAK,EAAE,eAAe,EAAE,EAAE,CAC5C,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAAC,eAAe,CAAC,CAC9D,CACJ,CAAC;IACN,CAAC;IAEM,KAAK,CAAC,oBAAoB;QAC7B,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,CAAC;IACjD,CAAC;IAED,sDAAsD;IAC/C,KAAK,CAAC,aAAa,CAAC,SAA6B;QACpD,OAAO,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IACpD,CAAC;IAED;;;;;;;;;OASG;IACI,KAAK,CAAC,mBAAmB,CAAC,eAAuB;QACpD,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;IAChE,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,mBAAmB,CAAC,kBAAgD;QAC7E,IAAI;YACA,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,kBAAkB,CAAC,CAAC;YAC/E,OAAO,WAAW,CAAC,QAAQ,EAAE,CAAC;SACjC;QAAC,OAAO,CAAC,EAAE;YACR,IAAI,CAAC,YAAY,KAAK,EAAE;gBACpB,CAAC,CAAC,OAAO,GAAG,wBAAwB,CAAC,CAAC,OAAO,EAAE,CAAC;aACnD;YACD,MAAM,CAAC,CAAC;SACX;IACL,CAAC;IAED;;;;;;;;;;;;OAYG;IACI,KAAK,CAAC,wBAAwB,CACjC,kBAAgD;QAEhD,IAAI;YACA,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAChG,MAAM,UAAU,GAAe,SAAS,CAAC,UAAU,CAAC;YACpD,MAAM,OAAO,GAAW,SAAS,CAAC,OAAO,CAAC;YAE1C,OAAO;gBACH,sGAAsG;gBACtG,wHAAwH;gBACxH,2HAA2H;gBAC3H,UAAU,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC,CAAe,EAAE,CAA6C,EAAE,EAAE;oBAC7F,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;oBAClC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,WAAW,IAAI,EAAE,CAAC,CAAC,CAAC;oBAC5C,OAAO,CAAC,CAAC;gBACb,CAAC,EAAE,EAAE,CAAC;gBACN,WAAW,EAAE,IAAI,iBAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE;aACjD,CAAC;SACL;QAAC,OAAO,CAAC,EAAE;YACR,IAAI,CAAC,YAAY,KAAK,EAAE;gBACpB,CAAC,CAAC,OAAO,GAAG,6BAA6B,CAAC,CAAC,OAAO,EAAE,CAAC;aACxD;YAED,MAAM,CAAC,CAAC;SACX;IACL,CAAC;IAEM,sCAAsC,CACzC,IAAgB;QAEhB,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;YACpB,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,6BAA6B,EAAE;gBACjD,OAAO,IAAI,CAAC,WAAW,CAAC,oBAAoB,CAAC,GAAG,CAAuD,CAAC;aAC3G;SACJ;QACD,MAAM,IAAI,KAAK,CACX,+FAA+F,CAClG,CAAC;IACN,CAAC;IAED;;OAEG;IACI,sCAAsC,CACzC,IAAgB;QAEhB,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE;YACpB,IAAI,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,6BAA6B,EAAE;gBACjD,OAAO,IAAI,CAAC,WAAW,CAAC,oBAAoB,CAAC,GAAG,CAAuD,CAAC;aAC3G;SACJ;QACD,MAAM,IAAI,KAAK,CACX,+FAA+F,CAClG,CAAC;IACN,CAAC;IAED;;;;;OAKG;IACI,KAAK,CAAC,4BAA4B,CAAC,iBAAyB;QAC/D,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC;QAC/E,OAAO,QAAQ,CAAC,IAAI,CAAC;IACzB,CAAC;IAEM,KAAK,CAAC,sBAAsB,CAAC,cAAsB;QACtD,OAAO,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;IACvF,CAAC;IAED;;;;;;;;;;OAUG;IACI,KAAK,CAAC,kBAAkB,CAC3B,OAAgB,EAChB,aAAqB,EACrB,OAAkB,EAClB,QAAmB;QAEnB,IAAI,WAAW,CAAC;QAChB,QAAQ,OAAO,EAAE;YACb,KAAK,4BAAO,CAAC,OAAO;gBAChB,WAAW,GAAG,qCAAyB,CAAC;gBACxC,MAAM;YACV;gBACI,WAAW,GAAG,gCAAoB,CAAC;gBACnC,MAAM;SACb;QAED,OAAO,IAAA,qDAAyB,EAAC,IAAI,CAAC,eAAe,EAAE,aAAa,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;IAC1G,CAAC;IAED;;;;;;;OAOG;IACI,mCAAmC,CACtC,SAA0B,EAC1B,OAAiB,EACjB,QAA0B;QAE1B,MAAM,WAAW,GAAG;YAChB,OAAO;YACP,IAAI,EAAE,QAAQ;YACd,IAAI,EAAE,SAAS,CAAC,IAAI;YACpB,sDAAsD;YACtD,QAAQ,EAAE,SAAS,CAAC,GAAG,YAAY,iBAAS,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG;YAC/F,KAAK,EAAE,SAAS,CAAC,KAAK;YACtB,EAAE,EAAE,SAAS,CAAC,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO;YAC/C,KAAK,EAAE,SAAS,CAAC,KAAK,YAAY,iBAAS,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK;SAC7F,CAAC;QAEF,4BAA4B;QAC5B,IAAI,SAAS,CAAC,QAAQ,EAAE;YACpB,OAAO;gBACH,GAAG,WAAW;gBACd,IAAI,EAAE,CAAC;gBACP,QAAQ,EAAE,SAAS,CAAC,QAAQ,YAAY,iBAAS,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ;aACzG,CAAC;SACL;QAED,8BAA8B;QAC9B,OAAO;YACH,GAAG,WAAW;YACd,IAAI,EAAE,CAAC;YACP,YAAY,EACR,SAAS,CAAC,YAAY,YAAY,iBAAS;gBACvC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;gBAC3C,CAAC,CAAC,SAAS,CAAC,YAAY;YAChC,oBAAoB,EAChB,SAAS,CAAC,oBAAoB,YAAY,iBAAS;gBAC/C,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,oBAAoB,CAAC,QAAQ,EAAE,CAAC;gBACnD,CAAC,CAAC,SAAS,CAAC,oBAAoB;SAC3C,CAAC;IACN,CAAC;IAED;;;;OAIG;IACI,KAAK,CAAC,oBAAoB,CAC7B,WAAyC;QAEzC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACrB,MAAM,IAAI,KAAK,CACX,qHAAqH,CACxH,CAAC;SACL;QAED,MAAM,cAAc,GAAG,MAAM,IAAA,yBAAiB,EAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,CAAC;QACjG,MAAM,iBAAiB,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACnF,MAAM,IAAI,GAAG,cAAK,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QAChD,OAAO,EAAE,iBAAiB,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC;IACxD,CAAC;IAEM,KAAK,CAAC,qBAAqB,CAAC,YAAoB;QACnD,MAAM,gBAAgB,GAAG;;;;;;;;;;;;;WAatB,CAAC;QACJ,MAAM,aAAa,GAAG,IAAI,iBAAQ,CAAC,YAAY,EAAE,gBAAgB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACzF,MAAM,QAAQ,GAAG,MAAM,aAAa,CAAC,QAAQ,EAAE,CAAC;QAChD,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;YAC9B,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;SAChD;QACD,OAAO,QAAQ,CAAC;IACpB,CAAC;IAED;;OAEG;IACI,KAAK,CAAC,+BAA+B,CACxC,IAAY,EACZ,aAAqB,EACrB,SAAkB;QAElB,0CAA0C;QAC1C,MAAM,IAAI,CAAC,cAAc;aACpB,0BAA0B,CAAC,aAAa,EAAE,SAAS,CAAC;aACpD,4BAA4B,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;IAChD,CAAC;IAED;;OAEG;IACI,KAAK,CAAC,uBAAuB,CAAC,YAAoB,EAAE,aAAqB;QAC5E,OAAO,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,YAAY,EAAE,aAAa,CAAC,CAAC,SAAS,EAAE,CAAC;IAC3F,CAAC;IAED;;;;;;;;;OASG;IACI,KAAK,CAAC,uBAAuB,CAChC,OAAe,EACf,KAAa,EACb,YAAoB,EACpB,QAAgB,IAAI,CAAC,GAAG,EAAE;QAE1B,iEAAiE;QACjE,6DAA6D;QAC7D,iDAAiD;QACjD,IAAI,CAAC,iCAAgB,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,iCAAgB,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YAC/F,OAAO,IAAI,CAAC;SACf;QAED,MAAM,WAAW,GAAG,iCAAgB,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC;QACrD,MAAM,gBAAgB,GAAG,IAAA,qCAAuB,EAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QACrE,QAAQ,WAAW,CAAC,IAAI,EAAE;YACtB,KAAK,4BAAoB,CAAC,sBAAsB,CAAC,CAAC;gBAC9C,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,4BAA4B,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;gBAC3E,qEAAqE;gBACrE,MAAM,KAAK,GAAG,IAAI,iBAAQ,CAAC,KAAK,EAAE,WAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBAClF,MAAM,EAAE,IAAI,EAAE,eAAe,EAAE,GAAG,MAAM,KAAK,CAAC,mBAAmB,CAAC,OAAO,CACrE,IAAI,CAAC,qBAAqB,EAC1B,kBAAS,CAAC,UAAU,CACvB,CAAC;gBAEF,MAAM,8BAA8B,GAAmC;oBACnE,IAAI,EAAE,4BAAoB,CAAC,sBAAsB;oBACjD,MAAM,EAAE;wBACJ,KAAK,EAAE;4BACH,GAAG,gBAAgB;4BACnB,GAAG,kDAAsC;yBAC5C;wBACD,WAAW,EAAE,iBAAiB;wBAC9B,MAAM,EAAE,WAAW,CAAC,MAAM;wBAC1B,OAAO,EAAE;4BACL,KAAK,EAAE,KAAK,CAAC,QAAQ,EAAE;4BACvB,IAAI,EAAE,YAAY;4BAClB,6DAA6D;4BAC7D,oEAAoE;4BACpE,iBAAiB,EAAE,eAAgB;yBACtC;qBACJ;iBACJ,CAAC;gBAEF,OAAO,8BAA8B,CAAC;aACzC;YACD,KAAK,4BAAoB,CAAC,MAAM,CAAC,CAAC;gBAC9B,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;gBAClE,MAAM,mBAAmB,GAAG,IAAI,iBAAS,CAAC,KAAK,GAAG,yBAAa,GAAG,EAAE,CAAC,CAAC,GAAG,CAAC,yBAAa,CAAC,CAAC,YAAY,EAAE,CAAC;gBACxG,MAAM,cAAc,GAAmB;oBACnC,IAAI,EAAE,4BAAoB,CAAC,MAAM;oBACjC,MAAM,EAAE;wBACJ,KAAK,EAAE;4BACH,GAAG,gBAAgB;4BACnB,GAAG,gCAAoB;yBAC1B;wBACD,WAAW,EAAE,QAAQ;wBACrB,MAAM,EAAE,WAAW,CAAC,MAAM;wBAC1B,OAAO,EAAE;4BACL,KAAK,EAAE,YAAY;4BACnB,OAAO,EAAE,IAAI,CAAC,qBAAqB;4BACnC,KAAK,EAAE,kBAAS,CAAC,UAAU,CAAC,QAAQ,EAAE;4BACtC,KAAK,EAAE,KAAK,CAAC,QAAQ,EAAE;4BACvB,QAAQ,EAAE,mBAAmB,CAAC,QAAQ,EAAE;yBAC3C;qBACJ;iBACJ,CAAC;gBAEF,OAAO,cAAc,CAAC;aACzB;YACD;gBACI,MAAM,IAAI,KAAK,CAAC,yBAAyB,WAAW,CAAC,IAAI,yBAAyB,CAAC,CAAC;SAC3F;IACL,CAAC;IAED;;;;;;;;OAQG;IACI,KAAK,CAAC,iBAAiB,CAAC,KAAa,EAAE,KAAa,EAAE,OAAe;QACxE,MAAM,KAAK,GAAG,IAAI,iBAAQ,CAAC,KAAK,EAAE,WAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QAClF,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACxD,OAAO,IAAI,iBAAS,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC/C,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,4BAA4B,CAAC,KAAa,EAAE,YAAoB;QACzE,MAAM,KAAK,GAAG,IAAI,iBAAQ,CAAC,KAAK,EAAE,WAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QAClF,MAAM,KAAK,GAAG,MAAM,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;QACjD,OAAO,IAAI,iBAAS,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC3C,CAAC;IAED;;;;;;OAMG;IACI,KAAK,CAAC,mBAAmB,CAAC,KAAa,EAAE,YAAoB;QAChE,MAAM,KAAK,GAAG,IAAI,iBAAQ,CAAC,KAAK,EAAE,WAAI,CAAC,WAAW,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QAC1E,MAAM,KAAK,GAAG,MAAM,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QAC/C,OAAO,IAAI,iBAAS,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC3C,CAAC;IAED;;;;;;;OAOG;IACI,KAAK,CAAC,6BAA6B,CACtC,KAAa,EACb,QAAkB,EAClB,SAAoB;QAEpB,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC;QAClC,QAAQ,IAAI,EAAE;YACV,KAAK,4BAAoB,CAAC,sBAAsB,CAAC,CAAC;gBAC9C,MAAM,KAAK,GAAG,IAAI,iBAAQ,CAAC,KAAK,EAAE,WAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBAClF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,CAAC,mBAAmB,CAAC,sBAAsB,CACnE,MAAM,CAAC,OAAO,CAAC,IAAI,EACnB,MAAM,CAAC,OAAO,CAAC,iBAAiB,EAChC,SAAS,CAAC,CAAC,EACX,SAAS,CAAC,CAAC,EACX,SAAS,CAAC,CAAC,CACd,CAAC;gBACF,IAAI,CAAC,IAAI,EAAE;oBACP,MAAM,IAAI,KAAK,CAAC,oDAAoD,IAAI,EAAE,CAAC,CAAC;iBAC/E;gBACD,OAAO,IAAI,CAAC;aACf;YACD,KAAK,4BAAoB,CAAC,MAAM,CAAC,CAAC;gBAC9B,MAAM,KAAK,GAAG,IAAI,iBAAQ,CAAC,KAAK,EAAE,WAAI,CAAC,WAAW,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;gBAC1E,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,CAAC,mBAAmB,CAAC,MAAM,CACnD,MAAM,CAAC,OAAO,CAAC,KAAK,EACpB,MAAM,CAAC,OAAO,CAAC,OAAO,EACtB,MAAM,CAAC,OAAO,CAAC,KAAK,EACpB,MAAM,CAAC,OAAO,CAAC,QAAQ,EACvB,SAAS,CAAC,CAAC,EACX,SAAS,CAAC,CAAC,EACX,SAAS,CAAC,CAAC,CACd,CAAC;gBACF,IAAI,CAAC,IAAI,EAAE;oBACP,MAAM,IAAI,KAAK,CAAC,oDAAoD,IAAI,EAAE,CAAC,CAAC;iBAC/E;gBACD,OAAO,IAAI,CAAC;aACf;YACD;gBACI,MAAM,IAAI,KAAK,CAAC,yBAAyB,IAAI,yBAAyB,CAAC,CAAC;SAC/E;IACL,CAAC;CACJ;AA7rBD,gDA6rBC;AAED,MAAa,oBAAoB;IAC7B,YAA6B,eAA+B,EAAmB,qBAA6B;QAA/E,oBAAe,GAAf,eAAe,CAAgB;QAAmB,0BAAqB,GAArB,qBAAqB,CAAQ;IAAG,CAAC;IAEhH;;;OAGG;IACI,KAAK,CAAC,kCAAkC,CAAC,WAAsC;QAClF,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,8BAAc,EAAC,WAAW,CAAC,CAAC;QACvD,OAAO,IAAI,CAAC,eAAe,CAAC,kCAAkC,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;IAC/G,CAAC;IAED;;;OAGG;IACI,KAAK,CAAC,qBAAqB,CAAC,WAAsC;QACrE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,8BAAc,EAAC,WAAW,CAAC,CAAC;QACvD,OAAO,IAAI,CAAC,eAAe,CAAC,qBAAqB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;IACtE,CAAC;CACJ;AApBD,oDAoBC","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/utils/rfq_blockchain_utils.ts"],"sourcesContent":["// tslint:disable:max-file-line-count\n\nimport { ChainId } from '@0x/contract-addresses';\nimport { IZeroExOtcOrderFilledEventArgs, IZeroExRfqOrderFilledEventArgs } from '@0x/contract-wrappers';\nimport { IZeroExContract } from '@0x/contracts-zero-ex';\nimport { MetaTransaction, OtcOrder, RfqOrder, Signature } from '@0x/protocol-utils';\nimport { PrivateKeyWalletSubprovider, SupportedProvider, Web3ProviderEngine } from '@0x/subproviders';\nimport { AbiDecoder, BigNumber, providerUtils } from '@0x/utils';\nimport { HDNode } from '@ethersproject/hdnode';\nimport { AccessList } from '@ethersproject/transactions';\nimport { CallData, LogEntry, LogWithDecodedArgs, TxAccessList, TxData } from 'ethereum-types';\nimport { BigNumber as EthersBigNumber, constants, Contract, providers, utils, Wallet } from 'ethers';\nimport { resolveProperties } from 'ethers/lib/utils';\n\nimport { abis } from '../abis';\nimport {\n    EXECUTE_META_TRANSACTION_EIP_712_TYPES,\n    NULL_ADDRESS,\n    ONE_MINUTE_MS,\n    ONE_SECOND_MS,\n    PERMIT_EIP_712_TYPES,\n    RFQM_TX_GAS_ESTIMATE,\n    ZERO,\n    ZEROG_METATX_GAS_ESTIMATE,\n} from '../core/constants';\nimport { EIP_712_REGISTRY } from '../eip712registry';\nimport { logger } from '../logger';\nimport {\n    Approval,\n    ERC20Owner,\n    ExecuteMetaTransactionApproval,\n    GaslessApprovalTypes,\n    PermitApproval,\n} from '../core/types';\n\nimport { splitAddresses } from './address_utils';\nimport { BalanceChecker } from './balance_checker';\nimport { extractEIP712DomainType } from './Eip712Utils';\nimport { isWorkerReadyAndAbleAsync } from './rfqm_worker_balance_utils';\nimport { serviceUtils } from './service_utils';\nimport { SubproviderAdapter } from './subprovider_adapter';\n\n// allow a wide range for gas price for flexibility\nconst MIN_GAS_PRICE = new BigNumber(0);\n// 10K Gwei\nconst MAX_GAS_PRICE = new BigNumber(1e13);\nconst RFQ_ORDER_FILLED_EVENT_TOPIC0 = '0x829fa99d94dc4636925b38632e625736a614c154d55006b7ab6bea979c210c32';\nconst OTC_ORDER_FILLED_EVENT_TOPIC0 = '0xac75f773e3a92f1a02b12134d65e1f47f8a14eabe4eaf1e24624918e6a8b269f';\nconst ZERO_EX_FILL_EVENT_ABI = [\n    {\n        anonymous: false,\n        inputs: [\n            { indexed: false, internalType: 'bytes32', name: 'orderHash', type: 'bytes32' },\n            { indexed: false, internalType: 'address', name: 'maker', type: 'address' },\n            { indexed: false, internalType: 'address', name: 'taker', type: 'address' },\n            { indexed: false, internalType: 'address', name: 'makerToken', type: 'address' },\n            { indexed: false, internalType: 'address', name: 'takerToken', type: 'address' },\n            { indexed: false, internalType: 'uint128', name: 'takerTokenFilledAmount', type: 'uint128' },\n            { indexed: false, internalType: 'uint128', name: 'makerTokenFilledAmount', type: 'uint128' },\n            { indexed: false, internalType: 'bytes32', name: 'pool', type: 'bytes32' },\n        ],\n        name: 'RfqOrderFilled',\n        type: 'event',\n    },\n    {\n        anonymous: false,\n        inputs: [\n            { indexed: false, internalType: 'bytes32', name: 'orderHash', type: 'bytes32' },\n            { indexed: false, internalType: 'address', name: 'maker', type: 'address' },\n            { indexed: false, internalType: 'address', name: 'taker', type: 'address' },\n            { indexed: false, internalType: 'address', name: 'makerToken', type: 'address' },\n            { indexed: false, internalType: 'address', name: 'takerToken', type: 'address' },\n            { indexed: false, internalType: 'uint128', name: 'makerTokenFilledAmount', type: 'uint128' },\n            { indexed: false, internalType: 'uint128', name: 'takerTokenFilledAmount', type: 'uint128' },\n        ],\n        name: 'OtcOrderFilled',\n        type: 'event',\n    },\n];\n\nfunction toBigNumber(ethersBigNumber: EthersBigNumber): BigNumber {\n    return new BigNumber(ethersBigNumber.toString());\n}\n\nexport class RfqBlockchainUtils {\n    public readonly balanceCheckUtils: RfqBalanceCheckUtils;\n\n    private readonly _exchangeProxy: IZeroExContract;\n    private readonly _abiDecoder: AbiDecoder;\n    // An ethers.js provider.\n    private readonly _ethersProvider: providers.JsonRpcProvider;\n    // An ethers.js Wallet. Must be populated for RfqBlockchainUtils instances used by RFQM Workers.\n    private readonly _ethersWallet: Wallet | undefined;\n\n    public static getPrivateKeyFromIndexAndPhrase(mnemonic: string, index: number): string {\n        const hdNode = HDNode.fromMnemonic(mnemonic).derivePath(this._getPathByIndex(index));\n\n        // take '0x' off\n        return hdNode.privateKey.substring(2);\n    }\n\n    public static getAddressFromIndexAndPhrase(mnemonic: string, index: number): string {\n        const hdNode = HDNode.fromMnemonic(mnemonic).derivePath(this._getPathByIndex(index));\n\n        return hdNode.address;\n    }\n\n    public static createPrivateKeyProvider(\n        rpcProvider: SupportedProvider,\n        privateWalletSubprovider: PrivateKeyWalletSubprovider,\n    ): SupportedProvider {\n        const providerEngine = new Web3ProviderEngine();\n        providerEngine.addProvider(privateWalletSubprovider);\n        providerEngine.addProvider(new SubproviderAdapter(rpcProvider));\n        providerUtils.startProviderEngine(providerEngine);\n        return providerEngine;\n    }\n\n    // tslint:disable-next-line:prefer-function-over-method\n    private static _getPathByIndex(index: number): string {\n        // ensure index is a 0+ integer\n        if (index < 0 || index !== Math.floor(index)) {\n            throw new Error(`invalid index`);\n        }\n        return `m/44'/60'/0'/0/`.concat(String(index));\n    }\n\n    constructor(\n        provider: SupportedProvider,\n        private readonly _exchangeProxyAddress: string,\n        balanceChecker: BalanceChecker,\n        ethersProvider: providers.JsonRpcProvider,\n        ethersWallet?: Wallet,\n    ) {\n        this._abiDecoder = new AbiDecoder([ZERO_EX_FILL_EVENT_ABI]);\n        this.balanceCheckUtils = new RfqBalanceCheckUtils(balanceChecker, _exchangeProxyAddress);\n        this._ethersProvider = ethersProvider;\n        this._ethersWallet = ethersWallet;\n        this._exchangeProxy = new IZeroExContract(this._exchangeProxyAddress, provider);\n    }\n\n    /**\n     * Fetches min value between balance for a list of addresses against the specified tokens. The index of\n     * an address in `addresses` must correspond with the index of a token in `tokens`.\n     */\n    public async getMinOfBalancesAndAllowancesAsync(erc20Owners: ERC20Owner | ERC20Owner[]): Promise<BigNumber[]> {\n        return this.balanceCheckUtils.getMinOfBalancesAndAllowancesAsync(erc20Owners);\n    }\n\n    /**\n     * Fetches the balances for a list of addresses against the specified tokens. The index of\n     * an address in `addresses` must correspond with the index of a token in `tokens`.\n     */\n    public async getTokenBalancesAsync(erc20Owners: ERC20Owner | ERC20Owner[]): Promise<BigNumber[]> {\n        return this.balanceCheckUtils.getTokenBalancesAsync(erc20Owners);\n    }\n\n    // for use when 0x API operator submits an order on-chain on behalf of taker\n    public generateMetaTransaction(\n        rfqOrder: RfqOrder,\n        signature: Signature,\n        taker: string,\n        takerAmount: BigNumber,\n        chainId: ChainId,\n    ): MetaTransaction {\n        // generate call data for fillRfqOrder\n        const callData = this._exchangeProxy\n            .fillRfqOrder(rfqOrder, signature, takerAmount)\n            .getABIEncodedTransactionData();\n\n        return new MetaTransaction({\n            signer: taker,\n            sender: NULL_ADDRESS,\n            minGasPrice: MIN_GAS_PRICE,\n            maxGasPrice: MAX_GAS_PRICE,\n            expirationTimeSeconds: rfqOrder.expiry,\n            salt: new BigNumber(Date.now()),\n            callData,\n            value: ZERO,\n            feeToken: NULL_ADDRESS,\n            feeAmount: ZERO,\n            chainId,\n            verifyingContract: this._exchangeProxy.address,\n        });\n    }\n\n    public async decodeMetaTransactionCallDataAndValidateAsync(\n        calldata: string,\n        sender: string,\n        txOptions?: Partial<CallData>,\n    ): Promise<[BigNumber, BigNumber]> {\n        // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const metaTxInput: any = this._exchangeProxy.getABIDecodedTransactionData('executeMetaTransaction', calldata);\n        return this.validateMetaTransactionOrThrowAsync(metaTxInput[0], metaTxInput[1], sender, txOptions);\n    }\n\n    /**\n     * Validates a metatransaction and its signature for a given sender\n     *\n     * @returns a Promise of [takerTokenFilledAmount, makerTokenFilledAmount]\n     * @throws an error if the metatransaction is not valid\n     */\n    public async validateMetaTransactionOrThrowAsync(\n        metaTx: MetaTransaction,\n        metaTxSig: Signature,\n        sender: string,\n        txOptions?: Partial<CallData>,\n    ): Promise<[BigNumber, BigNumber]> {\n        try {\n            const results = await this._exchangeProxy\n                .executeMetaTransaction(metaTx, metaTxSig)\n                .callAsync({ from: sender, ...txOptions });\n            const takerTokenFillAmount = // $eslint-fix-me github.com/rhinodavid/eslint-fix-me\n                /* eslint-disable @typescript-eslint/no-explicit-any */\n                (\n                    this._exchangeProxy.getABIDecodedTransactionData('fillRfqOrder', metaTx.callData) as any\n                ) /* eslint-enable @typescript-eslint/no-explicit-any */[2];\n            const decodedResults: [BigNumber, BigNumber] = this._exchangeProxy.getABIDecodedReturnData(\n                'fillRfqOrder',\n                results,\n            );\n            if (decodedResults[0].isLessThan(takerTokenFillAmount)) {\n                logger.error('validation failed because filled amount is less than requested fill amount');\n                throw new Error(`filled amount is less than requested fill amount`);\n            }\n            return decodedResults;\n        } catch (err) {\n            logger.error({ errorMessage: err?.message }, 'eth_call validation failed for executeMetaTransaction');\n            throw new Error(err);\n        }\n    }\n\n    /**\n     * Simulate the transaction with calldata.\n     *\n     * NOTE: In ethers.js, provider.call and provider.send('eth_call', ...) might not throw exception.\n     *       The behavior might be dependent on providers. Revisit this later.\n     */\n    public async simulateTransactionAsync(to: string, calldata: string): Promise<void> {\n        try {\n            await this._ethersProvider.call({\n                to,\n                data: calldata,\n            });\n        } catch (e) {\n            if (e instanceof Error) {\n                e.message = `simulateTransactionAsync: ${e.message}`;\n            }\n            throw e;\n        }\n    }\n\n    /**\n     * Estimate the gas for fillTakerSignedOtcOrder and fillTakerSignedOtcOrderForEth\n     * NOTE: can also be used for validation\n     *\n     * @returns a Promise of the gas estimate\n     * @throws an error if transaction will revert\n     */\n    public async estimateGasForFillTakerSignedOtcOrderAsync(\n        order: OtcOrder,\n        makerSignature: Signature,\n        takerSignature: Signature,\n        sender: string,\n        isUnwrap: boolean,\n    ): Promise<number> {\n        try {\n            if (isUnwrap) {\n                return await this._exchangeProxy\n                    .fillTakerSignedOtcOrderForEth(order, makerSignature, takerSignature)\n                    .estimateGasAsync({ from: sender });\n            } else {\n                return await this._exchangeProxy\n                    .fillTakerSignedOtcOrder(order, makerSignature, takerSignature)\n                    .estimateGasAsync({ from: sender });\n            }\n        } catch (err) {\n            logger.error(\n                {\n                    orderHash: order.getHash(),\n                    maker: order.maker,\n                    taker: order.taker,\n                    isUnwrap,\n                    errorMessage: err?.message,\n                },\n                'validation failed for taker signed OtcOrder',\n            );\n            throw err;\n        }\n    }\n\n    /**\n     * Generates calldata for Taker Signed OtcOrder settlement\n     */\n    public generateTakerSignedOtcOrderCallData(\n        order: OtcOrder,\n        makerSignature: Signature,\n        takerSignature: Signature,\n        isUnwrap: boolean,\n        affiliateAddress: string | null,\n    ): string {\n        const callData = isUnwrap\n            ? this._exchangeProxy\n                  .fillTakerSignedOtcOrderForEth(order, makerSignature, takerSignature)\n                  .getABIEncodedTransactionData()\n            : this._exchangeProxy\n                  .fillTakerSignedOtcOrder(order, makerSignature, takerSignature)\n                  .getABIEncodedTransactionData();\n        return serviceUtils.attributeCallData(callData, affiliateAddress).affiliatedData;\n    }\n\n    public generateMetaTransactionCallData(\n        metaTx: MetaTransaction,\n        metaTxSig: Signature,\n        affiliateAddress: string | null,\n    ): string {\n        const callData = this._exchangeProxy.executeMetaTransaction(metaTx, metaTxSig).getABIEncodedTransactionData();\n        return serviceUtils.attributeCallData(callData, affiliateAddress).affiliatedData;\n    }\n\n    public async getNonceAsync(workerAddress: string): Promise<number> {\n        return this._ethersProvider.getTransactionCount(workerAddress);\n    }\n\n    public getExchangeProxyAddress(): string {\n        return this._exchangeProxyAddress;\n    }\n\n    /**\n     * Returns the transaction receipts for the given transaction hashes.\n     * If a receipt does not exist, returns `undefined`.\n     */\n    public async getReceiptsAsync(transactionHashes: string[]): Promise<(providers.TransactionReceipt | undefined)[]> {\n        return Promise.all(\n            transactionHashes.map(async (transactionHash) =>\n                this._ethersProvider.getTransactionReceipt(transactionHash),\n            ),\n        );\n    }\n\n    public async getCurrentBlockAsync(): Promise<number> {\n        return this._ethersProvider.getBlockNumber();\n    }\n\n    // Fetches a block from the block number or block hash\n    public async getBlockAsync(blockHash: providers.BlockTag): Promise<providers.Block> {\n        return this._ethersProvider.getBlock(blockHash);\n    }\n\n    /**\n     * Passthrough to the ethers `getTransaction` function\n     * https://docs.ethers.io/v5/api/providers/provider/#Provider-getTransaction:\n     *\n     * Returns the transaction with hash or null if the transaction is unknown.\n     * If a transaction has not been mined, this method will search the transaction pool.\n     * Various backends may have more restrictive transaction pool access\n     * (e.g. if the gas price is too low or the transaction was only recently sent and not yet indexed)\n     * in which case this method may also return null.\n     */\n    public async getTransactionAsync(transactionHash: string): Promise<providers.TransactionResponse | null> {\n        return this._ethersProvider.getTransaction(transactionHash);\n    }\n\n    /**\n     * Estimate gas (in wei) given a transaction request using `eth_estimateGas` JSON RPC method.\n     * The transaction request contains information related to the transaction (from, to, data, etc.).\n     *\n     * @param transactionRequest Transaction request object which contains information about the transaction.\n     * @returns The gas estimate for the transaction in wei.\n     */\n    public async estimateGasForAsync(transactionRequest: providers.TransactionRequest): Promise<number> {\n        try {\n            const gasEstimate = await this._ethersProvider.estimateGas(transactionRequest);\n            return gasEstimate.toNumber();\n        } catch (e) {\n            if (e instanceof Error) {\n                e.message = `estimateGasForAsync: ${e.message}`;\n            }\n            throw e;\n        }\n    }\n\n    /**\n     * Get the access list and the gas estimation given a transaction request. Uses the provider\n     * to call the `eth_createAccessList` JSON RPC method.\n     *\n     * The transaction request contains information related to the transaction (from, to, data, etc.).\n     * Note that the implementation is similar to the one in @0x/web3-wrapper. This repo is\n     * migrating away from web3-wrapper in favor of ethers. The original implementation in\n     * web3-wrapper:\n     * https://github.com/0xProject/tools/blob/development/web3-wrapper/src/web3_wrapper.ts#L591\n     *\n     * @param transactionRequest Transaction request object which contains information about the transaction.\n     * @returns A TxAccessListWithGas object which contains access list and gas estimation for the transaction.\n     */\n    public async createAccessListForAsync(\n        transactionRequest: providers.TransactionRequest,\n    ): Promise<{ accessList: TxAccessList; gasEstimate: number }> {\n        try {\n            const rawResult = await this._ethersProvider.send('eth_createAccessList', [transactionRequest]);\n            const accessList: AccessList = rawResult.accessList;\n            const gasUsed: string = rawResult.gasUsed;\n\n            return {\n                // The type for `accessList` is `AccessList` (Array<{ address: string, storageKeys: Array<string> }>).\n                // The reduce operation is used to transform the array into type `TxAccessList` ([address: string]: string[]) whose keys\n                // are addresses and values are corresponding storage keys. This is useful if we need to remove an address from the object.\n                accessList: accessList.reduce((o: TxAccessList, v: { address: string; storageKeys: string[] }) => {\n                    o[v.address] = o[v.address] || [];\n                    o[v.address].push(...(v.storageKeys || []));\n                    return o;\n                }, {}),\n                gasEstimate: new BigNumber(gasUsed).toNumber(),\n            };\n        } catch (e) {\n            if (e instanceof Error) {\n                e.message = `createAccessListForAsync: ${e.message}`;\n            }\n\n            throw e;\n        }\n    }\n\n    public getDecodedRfqOrderFillEventLogFromLogs(\n        logs: LogEntry[],\n    ): LogWithDecodedArgs<IZeroExRfqOrderFilledEventArgs> {\n        for (const log of logs) {\n            if (log.topics[0] === RFQ_ORDER_FILLED_EVENT_TOPIC0) {\n                return this._abiDecoder.tryToDecodeLogOrNoop(log) as LogWithDecodedArgs<IZeroExRfqOrderFilledEventArgs>;\n            }\n        }\n        throw new Error(\n            `no RfqOrderFilledEvent logs among the logs passed into getDecodedRfqOrderFillEventLogFromLogs`,\n        );\n    }\n\n    /**\n     * Decode the OtcOrder Filled Event\n     */\n    public getDecodedOtcOrderFillEventLogFromLogs(\n        logs: LogEntry[],\n    ): LogWithDecodedArgs<IZeroExOtcOrderFilledEventArgs> {\n        for (const log of logs) {\n            if (log.topics[0] === OTC_ORDER_FILLED_EVENT_TOPIC0) {\n                return this._abiDecoder.tryToDecodeLogOrNoop(log) as LogWithDecodedArgs<IZeroExRfqOrderFilledEventArgs>;\n            }\n        }\n        throw new Error(\n            `no OtcOrderFilledEvent logs among the logs passed into getDecodedOtcOrderFillEventLogFromLogs`,\n        );\n    }\n\n    /**\n     * Broadcasts a raw transaction via the `eth_sendRawTransaction` JSON RPC method.\n     * The transaction must be signed by this point, otherwise submission will fail.\n     *\n     * @returns The transaction hash returned by the RPC provider.\n     */\n    public async submitSignedTransactionAsync(signedTransaction: string): Promise<string> {\n        const response = await this._ethersProvider.sendTransaction(signedTransaction);\n        return response.hash;\n    }\n\n    public async getAccountBalanceAsync(accountAddress: string): Promise<BigNumber> {\n        return this._ethersProvider.getBalance(accountAddress).then((r) => toBigNumber(r));\n    }\n\n    /**\n     * Check if a worker is ready to pick up a new job:\n     * - the worker has enough balance\n     * - the worker has no pending transactions\n     *\n     * @param chainId Id of the chain.\n     * @param workerAddress Address of the worker to check.\n     * @param balance Balance of the worker to check.\n     * @param gasPrice Current gas price.\n     * @returns True if a worker is ready to pick up a new job and false otherwise.\n     */\n    public async isWorkerReadyAsync(\n        chainId: ChainId,\n        workerAddress: string,\n        balance: BigNumber,\n        gasPrice: BigNumber,\n    ): Promise<boolean> {\n        let gasEstimate;\n        switch (chainId) {\n            case ChainId.Polygon:\n                gasEstimate = ZEROG_METATX_GAS_ESTIMATE;\n                break;\n            default:\n                gasEstimate = RFQM_TX_GAS_ESTIMATE;\n                break;\n        }\n\n        return isWorkerReadyAndAbleAsync(this._ethersProvider, workerAddress, balance, gasPrice, gasEstimate);\n    }\n\n    /**\n     * Converts a @0x/web3-wrapper `TxData` object into an Ethers `TransactionRequest`.\n     *\n     * If the `from` address is not present in the `TxData`, the function uses the address\n     * of the Ethers Wallet passed to `rfqBlockchainUtils`\n     *\n     * If the `to` address is not present, the function uses the exchange proxy address.\n     */\n    public transformTxDataToTransactionRequest(\n        txOptions: Partial<TxData>,\n        chainId?: ChainId,\n        callData?: utils.BytesLike,\n    ): providers.TransactionRequest {\n        const baseRequest = {\n            chainId,\n            data: callData,\n            from: txOptions.from,\n            // web3wrappers \"gas\" field -> ethers \"gasLimit\" field\n            gasLimit: txOptions.gas instanceof BigNumber ? BigInt(txOptions.gas.toString()) : txOptions.gas,\n            nonce: txOptions.nonce,\n            to: txOptions.to || this._exchangeProxy.address,\n            value: txOptions.value instanceof BigNumber ? txOptions.value.toString() : txOptions.value,\n        };\n\n        // Handle Type 0 (Legacy) Tx\n        if (txOptions.gasPrice) {\n            return {\n                ...baseRequest,\n                type: 0,\n                gasPrice: txOptions.gasPrice instanceof BigNumber ? txOptions.gasPrice.toString() : txOptions.gasPrice,\n            };\n        }\n\n        // Handle Type 2 (EIP-1559) Tx\n        return {\n            ...baseRequest,\n            type: 2,\n            maxFeePerGas:\n                txOptions.maxFeePerGas instanceof BigNumber\n                    ? BigInt(txOptions.maxFeePerGas.toString())\n                    : txOptions.maxFeePerGas,\n            maxPriorityFeePerGas:\n                txOptions.maxPriorityFeePerGas instanceof BigNumber\n                    ? BigInt(txOptions.maxPriorityFeePerGas.toString())\n                    : txOptions.maxPriorityFeePerGas,\n        };\n    }\n\n    /**\n     * Uses the Ethers Wallet to sign a transaction. Returns both the signed transaction and its hash.\n     *\n     * If the containing class has been initialized without a wallet, the function throws.\n     */\n    public async signTransactionAsync(\n        transaction: providers.TransactionRequest,\n    ): Promise<{ signedTransaction: string; transactionHash: string }> {\n        if (!this._ethersWallet) {\n            throw new Error(\n                'RFQ Blockchain Utils must be initialized with an Ethers Wallet in order to get transaction hashes before submitting',\n            );\n        }\n\n        const checkedRequest = await resolveProperties(this._ethersWallet.checkTransaction(transaction));\n        const signedTransaction = await this._ethersWallet.signTransaction(checkedRequest);\n        const hash = utils.keccak256(signedTransaction);\n        return { signedTransaction, transactionHash: hash };\n    }\n\n    public async getTokenDecimalsAsync(tokenAddress: string): Promise<number> {\n        const erc20AbiDecimals = `[{\n            \"constant\": true,\n            \"inputs\": [],\n            \"name\": \"decimals\",\n            \"outputs\": [\n                {\n                    \"name\": \"\",\n                    \"type\": \"uint8\"\n                }\n            ],\n            \"payable\": false,\n            \"stateMutability\": \"view\",\n            \"type\": \"function\"\n        }]`;\n        const tokenContract = new Contract(tokenAddress, erc20AbiDecimals, this._ethersProvider);\n        const decimals = await tokenContract.decimals();\n        if (typeof decimals !== 'number') {\n            throw new Error('Decimals was not a number');\n        }\n        return decimals;\n    }\n\n    /**\n     * Calls the 0x Exchange Proxy to add an address to the list of allowed order signers for the msg's sender.\n     */\n    public async registerAllowedOrderSignerAsync(\n        from: string,\n        signerAddress: string,\n        isAllowed: boolean,\n    ): Promise<void> {\n        // tslint:disable-next-line: await-promise\n        await this._exchangeProxy\n            .registerAllowedOrderSigner(signerAddress, isAllowed)\n            .awaitTransactionSuccessAsync({ from });\n    }\n\n    /**\n     * Returns whether the signer address is an allowed order signer of the maker.\n     */\n    public async isValidOrderSignerAsync(makerAddress: string, signerAddress: string): Promise<boolean> {\n        return this._exchangeProxy.isValidOrderSigner(makerAddress, signerAddress).callAsync();\n    }\n\n    /**\n     * Get the gasless approval object which encapsulates the EIP-712 context that would be signed by the `takerAddress`\n     * for gasless approval. The two main schemes for gasless approvals are `executeMetaTransaction` and `permit`.\n     *\n     * @param chainId Id of the chain.\n     * @param token The address of the token.\n     * @param takerAddress The address of the taker.\n     * @param nowMs optional - the current timestamp in milliseconds\n     * @returns The corresponding gasless approval oject or null if the token does not support gasless approval (does not exist in our EIP-712 token registry).\n     */\n    public async getGaslessApprovalAsync(\n        chainId: number,\n        token: string,\n        takerAddress: string,\n        nowMs: number = Date.now(),\n    ): Promise<Approval | null> {\n        // If the token does not exist in the token registry, return null\n        // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n        // eslint-disable-next-line no-prototype-builtins\n        if (!EIP_712_REGISTRY.hasOwnProperty(chainId) || !EIP_712_REGISTRY[chainId].hasOwnProperty(token)) {\n            return null;\n        }\n\n        const tokenEIP712 = EIP_712_REGISTRY[chainId][token];\n        const eip712DomainType = extractEIP712DomainType(tokenEIP712.domain);\n        switch (tokenEIP712.kind) {\n            case GaslessApprovalTypes.ExecuteMetaTransaction: {\n                const nonce = await this.getMetaTransactionNonceAsync(token, takerAddress);\n                // generate calldata for approve with max number of uint256 as amount\n                const erc20 = new Contract(token, abis.polygonBridgedERC20, this._ethersProvider);\n                const { data: approveCalldata } = await erc20.populateTransaction.approve(\n                    this._exchangeProxyAddress,\n                    constants.MaxUint256,\n                );\n\n                const executeMetaTransactionApproval: ExecuteMetaTransactionApproval = {\n                    kind: GaslessApprovalTypes.ExecuteMetaTransaction,\n                    eip712: {\n                        types: {\n                            ...eip712DomainType,\n                            ...EXECUTE_META_TRANSACTION_EIP_712_TYPES,\n                        },\n                        primaryType: 'MetaTransaction',\n                        domain: tokenEIP712.domain,\n                        message: {\n                            nonce: nonce.toNumber(),\n                            from: takerAddress,\n                            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\n                            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                            functionSignature: approveCalldata!,\n                        },\n                    },\n                };\n\n                return executeMetaTransactionApproval;\n            }\n            case GaslessApprovalTypes.Permit: {\n                const nonce = await this.getPermitNonceAsync(token, takerAddress);\n                const tenMinutesAfterNowS = new BigNumber(nowMs + ONE_MINUTE_MS * 10).div(ONE_SECOND_MS).integerValue();\n                const permitApproval: PermitApproval = {\n                    kind: GaslessApprovalTypes.Permit,\n                    eip712: {\n                        types: {\n                            ...eip712DomainType,\n                            ...PERMIT_EIP_712_TYPES,\n                        },\n                        primaryType: 'Permit',\n                        domain: tokenEIP712.domain,\n                        message: {\n                            owner: takerAddress,\n                            spender: this._exchangeProxyAddress,\n                            value: constants.MaxUint256.toString(),\n                            nonce: nonce.toNumber(),\n                            deadline: tenMinutesAfterNowS.toString(),\n                        },\n                    },\n                };\n\n                return permitApproval;\n            }\n            default:\n                throw new Error(`Gasless approval kind ${tokenEIP712.kind} is not implemented yet`);\n        }\n    }\n\n    /**\n     * Get the amount (in base unit) of `token` `spender` will be allowed to spend on behalf on `owner` (the allowance). Note that\n     * base unit means 10 ** decimals (decimals of the token).\n     *\n     * @param token The address of the token.\n     * @param owner The address that owns certain amount of `token`.\n     * @param spender The address that would like to spend token on behalf of `owner`.\n     * @returns The amount (in base unit) of tokens spender is allowed to spend.\n     */\n    public async getAllowanceAsync(token: string, owner: string, spender: string): Promise<BigNumber> {\n        const erc20 = new Contract(token, abis.polygonBridgedERC20, this._ethersProvider);\n        const allowance = await erc20.allowance(owner, spender);\n        return new BigNumber(allowance.toString());\n    }\n\n    /**\n     * Get nonce for meta transaction. This is used by contracts that support Biconomy's `executeMetaTransaction` which includes bridged tokens on Polygon.\n     *\n     * @param token The address of the token.\n     * @param takerAddress The address of the taker.\n     * @returns Nonce.\n     */\n    public async getMetaTransactionNonceAsync(token: string, takerAddress: string): Promise<BigNumber> {\n        const erc20 = new Contract(token, abis.polygonBridgedERC20, this._ethersProvider);\n        const nonce = await erc20.getNonce(takerAddress);\n        return new BigNumber(nonce.toString());\n    }\n\n    /**\n     * Get permit nonce, which is used by contracts that support EIP-2612 standards.\n     *\n     * @param token The address of the token.\n     * @param takerAddress The address of the taker.\n     * @returns Nonce.\n     */\n    public async getPermitNonceAsync(token: string, takerAddress: string): Promise<BigNumber> {\n        const erc20 = new Contract(token, abis.permitERC20, this._ethersProvider);\n        const nonce = await erc20.nonces(takerAddress);\n        return new BigNumber(nonce.toString());\n    }\n\n    /**\n     * Generates calldata for gasless approval submission.\n     *\n     * @param token The address of the token.\n     * @param approval The Approval object, which consists of 'kind' and eip712 object.\n     * @param signature The gasless approval transaction signed by taker.\n     * @returns Generated calldata.\n     */\n    public async generateApprovalCalldataAsync(\n        token: string,\n        approval: Approval,\n        signature: Signature,\n    ): Promise<string> {\n        const { kind, eip712 } = approval;\n        switch (kind) {\n            case GaslessApprovalTypes.ExecuteMetaTransaction: {\n                const erc20 = new Contract(token, abis.polygonBridgedERC20, this._ethersProvider);\n                const { data } = await erc20.populateTransaction.executeMetaTransaction(\n                    eip712.message.from,\n                    eip712.message.functionSignature,\n                    signature.r,\n                    signature.s,\n                    signature.v,\n                );\n                if (!data) {\n                    throw new Error(`Cannot generate approval submission calldata for ${kind}`);\n                }\n                return data;\n            }\n            case GaslessApprovalTypes.Permit: {\n                const erc20 = new Contract(token, abis.permitERC20, this._ethersProvider);\n                const { data } = await erc20.populateTransaction.permit(\n                    eip712.message.owner,\n                    eip712.message.spender,\n                    eip712.message.value,\n                    eip712.message.deadline,\n                    signature.v,\n                    signature.r,\n                    signature.s,\n                );\n                if (!data) {\n                    throw new Error(`Cannot generate approval submission calldata for ${kind}`);\n                }\n                return data;\n            }\n            default:\n                throw new Error(`Gasless approval kind ${kind} is not implemented yet`);\n        }\n    }\n}\n\nexport class RfqBalanceCheckUtils {\n    constructor(private readonly _balanceChecker: BalanceChecker, private readonly _exchangeProxyAddress: string) {}\n\n    /**\n     * Fetches min value between balance for a list of addresses against the specified tokens. The index of\n     * an address in `addresses` must correspond with the index of a token in `tokens`.\n     */\n    public async getMinOfBalancesAndAllowancesAsync(erc20Owners: ERC20Owner | ERC20Owner[]): Promise<BigNumber[]> {\n        const { owners, tokens } = splitAddresses(erc20Owners);\n        return this._balanceChecker.getMinOfBalancesAndAllowancesAsync(owners, tokens, this._exchangeProxyAddress);\n    }\n\n    /**\n     * Fetches the balances for a list of addresses against the specified tokens. The index of\n     * an address in `addresses` must correspond with the index of a token in `tokens`.\n     */\n    public async getTokenBalancesAsync(erc20Owners: ERC20Owner | ERC20Owner[]): Promise<BigNumber[]> {\n        const { owners, tokens } = splitAddresses(erc20Owners);\n        return this._balanceChecker.getTokenBalancesAsync(owners, tokens);\n    }\n}\n"],"version":3}