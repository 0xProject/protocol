0c868b28c1b35368483c5d599ebb0aa6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// tslint:disable:custom-no-magic-numbers
// tslint:disable:no-empty
// tslint:disable:max-file-line-count
const chai_1 = require("chai");
const config_1 = require("../../src/config");
const config_manager_1 = require("../../src/utils/config_manager");
describe('ConfigManager', () => {
    describe('getRfqMakerIdForApiKey', () => {
        it('should return correct maker Ids', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            // Facts defined in test_env file
            const apiKeyToMakerIds = [
                {
                    apiKey: 'd2ed029a-a8a6-48af-9934-bcf3ce07cddf',
                    makerId: 'degen-trading',
                },
                {
                    apiKey: '03da31bd-cbd9-4167-932d-11b054d02832',
                    makerId: 'tradfi-finance',
                },
                {
                    apiKey: '16a35054-d41f-46b0-83bb-166015aaf86e',
                    makerId: 'i-love-rfqorder',
                },
            ];
            apiKeyToMakerIds.forEach((apiKeyIdPair) => {
                // When
                const makerId = configManager.getRfqMakerIdForApiKey(apiKeyIdPair.apiKey);
                // Then
                (0, chai_1.expect)(makerId).to.be.eq(apiKeyIdPair.makerId);
            });
        });
        it('should ignore conflict api key', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            // Facts defined in test_env file
            const conflictApiKey = 'bc5dfd4c-580f-475f-aa7e-611cbb6d70cd';
            // When
            const makerIdForConflictKey = configManager.getRfqMakerIdForApiKey(conflictApiKey);
            // Then
            (0, chai_1.expect)(makerIdForConflictKey).to.be.eq(undefined);
        });
        it('should ignore unknown api key', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            const unknownApiKey = '7825fbc1-9b7d-4ba7-9237-2f1ec971cf20';
            // When
            const makerIdForUnknownKey = configManager.getRfqMakerIdForApiKey(unknownApiKey);
            // Then
            (0, chai_1.expect)(makerIdForUnknownKey).to.be.eq(undefined);
        });
    });
    describe('getFeeModelConfiguration', () => {
        const chainId = 1;
        const tokenA = '0x374a16f5e686c09b0cc9e8bc3466b3b645c74aa7';
        const tokenB = '0xf84830b73b2ed3c7267e7638f500110ea47fdf30';
        const unknownToken = '0xf84830b73b2ed3c7267e7638f500110ea47fdf31';
        const marginRakeRatio = 0.4;
        const tradeSizeBps = 5;
        it('should find fee model config for given pairs', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            // When
            const feeModelConfig = configManager.getFeeModelConfiguration(chainId, tokenA, tokenB);
            // Then
            (0, chai_1.expect)(feeModelConfig.marginRakeRatio).to.be.eq(marginRakeRatio);
            (0, chai_1.expect)(feeModelConfig.tradeSizeBps).to.be.eq(tradeSizeBps);
        });
        it('should ignore tokens order when looking for fee model config', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            // When
            const feeModelConfig = configManager.getFeeModelConfiguration(chainId, tokenB, tokenA);
            // Then
            (0, chai_1.expect)(feeModelConfig.marginRakeRatio).to.be.eq(marginRakeRatio);
            (0, chai_1.expect)(feeModelConfig.tradeSizeBps).to.be.eq(tradeSizeBps);
        });
        it('should return default fee model config when chainId is not found', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            // When
            const feeModelConfig = configManager.getFeeModelConfiguration(137, tokenA, tokenB);
            // Then
            (0, chai_1.expect)(feeModelConfig.marginRakeRatio).to.be.eq(config_1.DEFAULT_FEE_MODEL_CONFIGURATION.marginRakeRatio);
            (0, chai_1.expect)(feeModelConfig.tradeSizeBps).to.be.eq(config_1.DEFAULT_FEE_MODEL_CONFIGURATION.tradeSizeBps);
        });
        it('should return default fee model config when chainId is not found', () => {
            // Given
            const configManager = new config_manager_1.ConfigManager();
            // When
            const feeModelConfig = configManager.getFeeModelConfiguration(chainId, tokenA, unknownToken);
            // Then
            (0, chai_1.expect)(feeModelConfig.marginRakeRatio).to.be.eq(config_1.DEFAULT_FEE_MODEL_CONFIGURATION.marginRakeRatio);
            (0, chai_1.expect)(feeModelConfig.tradeSizeBps).to.be.eq(config_1.DEFAULT_FEE_MODEL_CONFIGURATION.tradeSizeBps);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvdXRpbHMvY29uZmlnX21hbmFnZXJfdGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHlDQUF5QztBQUN6QywwQkFBMEI7QUFDMUIscUNBQXFDO0FBRXJDLCtCQUE4QjtBQUU5Qiw2Q0FBbUU7QUFDbkUsbUVBQStEO0FBRS9ELFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzNCLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7UUFDcEMsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtZQUN2QyxRQUFRO1lBQ1IsTUFBTSxhQUFhLEdBQUcsSUFBSSw4QkFBYSxFQUFFLENBQUM7WUFDMUMsaUNBQWlDO1lBQ2pDLE1BQU0sZ0JBQWdCLEdBQUc7Z0JBQ3JCO29CQUNJLE1BQU0sRUFBRSxzQ0FBc0M7b0JBQzlDLE9BQU8sRUFBRSxlQUFlO2lCQUMzQjtnQkFDRDtvQkFDSSxNQUFNLEVBQUUsc0NBQXNDO29CQUM5QyxPQUFPLEVBQUUsZ0JBQWdCO2lCQUM1QjtnQkFDRDtvQkFDSSxNQUFNLEVBQUUsc0NBQXNDO29CQUM5QyxPQUFPLEVBQUUsaUJBQWlCO2lCQUM3QjthQUNKLENBQUM7WUFFRixnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRTtnQkFDdEMsT0FBTztnQkFDUCxNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsc0JBQXNCLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUUxRSxPQUFPO2dCQUNQLElBQUEsYUFBTSxFQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNuRCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtZQUN0QyxRQUFRO1lBQ1IsTUFBTSxhQUFhLEdB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QWMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyx3Q0FBK0IsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNqRyxJQUFBLGFBQU0sRUFBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsd0NBQStCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0YsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0VBQWtFLEVBQUUsR0FBRyxFQUFFO1lBQ3hFLFFBQVE7WUFDUixNQUFNLGFBQWEsR0FBRyxJQUFJLDhCQUFhLEVBQUUsQ0FBQztZQUUxQyxPQUFPO1lBQ1AsTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDLHdCQUF3QixDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFFN0YsT0FBTztZQUNQLElBQUEsYUFBTSxFQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyx3Q0FBK0IsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNqRyxJQUFBLGFBQU0sRUFBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsd0NBQStCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0YsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS90ZXN0L3V0aWxzL2NvbmZpZ19tYW5hZ2VyX3Rlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gdHNsaW50OmRpc2FibGU6Y3VzdG9tLW5vLW1hZ2ljLW51bWJlcnNcbi8vIHRzbGludDpkaXNhYmxlOm5vLWVtcHR5XG4vLyB0c2xpbnQ6ZGlzYWJsZTptYXgtZmlsZS1saW5lLWNvdW50XG5cbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gJ2NoYWknO1xuXG5pbXBvcnQgeyBERUZBVUxUX0ZFRV9NT0RFTF9DT05GSUdVUkFUSU9OIH0gZnJvbSAnLi4vLi4vc3JjL2NvbmZpZyc7XG5pbXBvcnQgeyBDb25maWdNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vc3JjL3V0aWxzL2NvbmZpZ19tYW5hZ2VyJztcblxuZGVzY3JpYmUoJ0NvbmZpZ01hbmFnZXInLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2dldFJmcU1ha2VySWRGb3JBcGlLZXknLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgbWFrZXIgSWRzJywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gR2l2ZW5cbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXIgPSBuZXcgQ29uZmlnTWFuYWdlcigpO1xuICAgICAgICAgICAgLy8gRmFjdHMgZGVmaW5lZCBpbiB0ZXN0X2VudiBmaWxlXG4gICAgICAgICAgICBjb25zdCBhcGlLZXlUb01ha2VySWRzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYXBpS2V5OiAnZDJlZDAyOWEtYThhNi00OGFmLTk5MzQtYmNmM2NlMDdjZGRmJyxcbiAgICAgICAgICAgICAgICAgICAgbWFrZXJJZDogJ2RlZ2VuLXRyYWRpbmcnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhcGlLZXk6ICcwM2RhMzFiZC1jYmQ5LTQxNjctOTMyZC0xMWIwNTRkMDI4MzInLFxuICAgICAgICAgICAgICAgICAgICBtYWtlcklkOiAndHJhZGZpLWZpbmFuY2UnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhcGlLZXk6ICcxNmEzNTA1NC1kNDFmLTQ2YjAtODNiYi0xNjYwMTVhYWY4NmUnLFxuICAgICAgICAgICAgICAgICAgICBtYWtlcklkOiAnaS1sb3ZlLXJmcW9yZGVyJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgYXBpS2V5VG9NYWtlcklkcy5mb3JFYWNoKChhcGlLZXlJZFBhaXIpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICAgICAgY29uc3QgbWFrZXJJZCA9IGNvbmZpZ01hbmFnZXIuZ2V0UmZxTWFrZXJJZEZvckFwaUtleShhcGlLZXlJZFBhaXIuYXBpS2V5KTtcblxuICAgICAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgICAgICBleHBlY3QobWFrZXJJZCkudG8uYmUuZXEoYXBpS2V5SWRQYWlyLm1ha2VySWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaWdub3JlIGNvbmZsaWN0IGFwaSBrZXknLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlciA9IG5ldyBDb25maWdNYW5hZ2VyKCk7XG4gICAgICAgICAgICAvLyBGYWN0cyBkZWZpbmVkIGluIHRlc3RfZW52IGZpbGVcbiAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0QXBpS2V5ID0gJ2JjNWRmZDRjLTU4MGYtNDc1Zi1hYTdlLTYxMWNiYjZkNzBjZCc7XG5cbiAgICAgICAgICAgIC8vIFdoZW5cbiAgICAgICAgICAgIGNvbnN0IG1ha2VySWRGb3JDb25mbGljdEtleSA9IGNvbmZpZ01hbmFnZXIuZ2V0UmZxTWFrZXJJZEZvckFwaUtleShjb25mbGljdEFwaUtleSk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChtYWtlcklkRm9yQ29uZmxpY3RLZXkpLnRvLmJlLmVxKHVuZGVmaW5lZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaWdub3JlIHVua25vd24gYXBpIGtleScsICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gbmV3IENvbmZpZ01hbmFnZXIoKTtcbiAgICAgICAgICAgIGNvbnN0IHVua25vd25BcGlLZXkgPSAnNzgyNWZiYzEtOWI3ZC00YmE3LTkyMzctMmYxZWM5NzFjZjIwJztcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgbWFrZXJJZEZvclVua25vd25LZXkgPSBjb25maWdNYW5hZ2VyLmdldFJmcU1ha2VySWRGb3JBcGlLZXkodW5rbm93bkFwaUtleSk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChtYWtlcklkRm9yVW5rbm93bktleSkudG8uYmUuZXEodW5kZWZpbmVkKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgZGVzY3JpYmUoJ2dldEZlZU1vZGVsQ29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgICAgY29uc3QgY2hhaW5JZCA9IDE7XG4gICAgICAgIGNvbnN0IHRva2VuQSA9ICcweDM3NGExNmY1ZTY4NmMwOWIwY2M5ZThiYzM0NjZiM2I2NDVjNzRhYTcnO1xuICAgICAgICBjb25zdCB0b2tlbkIgPSAnMHhmODQ4MzBiNzNiMmVkM2M3MjY3ZTc2MzhmNTAwMTEwZWE0N2ZkZjMwJztcbiAgICAgICAgY29uc3QgdW5rbm93blRva2VuID0gJzB4Zjg0ODMwYjczYjJlZDNjNzI2N2U3NjM4ZjUwMDExMGVhNDdmZGYzMSc7XG4gICAgICAgIGNvbnN0IG1hcmdpblJha2VSYXRpbyA9IDAuNDtcbiAgICAgICAgY29uc3QgdHJhZGVTaXplQnBzID0gNTtcblxuICAgICAgICBpdCgnc2hvdWxkIGZpbmQgZmVlIG1vZGVsIGNvbmZpZyBmb3IgZ2l2ZW4gcGFpcnMnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlciA9IG5ldyBDb25maWdNYW5hZ2VyKCk7XG5cbiAgICAgICAgICAgIC8vIFdoZW5cbiAgICAgICAgICAgIGNvbnN0IGZlZU1vZGVsQ29uZmlnID0gY29uZmlnTWFuYWdlci5nZXRGZWVNb2RlbENvbmZpZ3VyYXRpb24oY2hhaW5JZCwgdG9rZW5BLCB0b2tlbkIpO1xuXG4gICAgICAgICAgICAvLyBUaGVuXG4gICAgICAgICAgICBleHBlY3QoZmVlTW9kZWxDb25maWcubWFyZ2luUmFrZVJhdGlvKS50by5iZS5lcShtYXJnaW5SYWtlUmF0aW8pO1xuICAgICAgICAgICAgZXhwZWN0KGZlZU1vZGVsQ29uZmlnLnRyYWRlU2l6ZUJwcykudG8uYmUuZXEodHJhZGVTaXplQnBzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBpZ25vcmUgdG9rZW5zIG9yZGVyIHdoZW4gbG9va2luZyBmb3IgZmVlIG1vZGVsIGNvbmZpZycsICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gbmV3IENvbmZpZ01hbmFnZXIoKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgZmVlTW9kZWxDb25maWcgPSBjb25maWdNYW5hZ2VyLmdldEZlZU1vZGVsQ29uZmlndXJhdGlvbihjaGFpbklkLCB0b2tlbkIsIHRva2VuQSk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChmZWVNb2RlbENvbmZpZy5tYXJnaW5SYWtlUmF0aW8pLnRvLmJlLmVxKG1hcmdpblJha2VSYXRpbyk7XG4gICAgICAgICAgICBleHBlY3QoZmVlTW9kZWxDb25maWcudHJhZGVTaXplQnBzKS50by5iZS5lcSh0cmFkZVNpemVCcHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IGZlZSBtb2RlbCBjb25maWcgd2hlbiBjaGFpbklkIGlzIG5vdCBmb3VuZCcsICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gbmV3IENvbmZpZ01hbmFnZXIoKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgZmVlTW9kZWxDb25maWcgPSBjb25maWdNYW5hZ2VyLmdldEZlZU1vZGVsQ29uZmlndXJhdGlvbigxMzcsIHRva2VuQSwgdG9rZW5CKTtcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KGZlZU1vZGVsQ29uZmlnLm1hcmdpblJha2VSYXRpbykudG8uYmUuZXEoREVGQVVMVF9GRUVfTU9ERUxfQ09ORklHVVJBVElPTi5tYXJnaW5SYWtlUmF0aW8pO1xuICAgICAgICAgICAgZXhwZWN0KGZlZU1vZGVsQ29uZmlnLnRyYWRlU2l6ZUJwcykudG8uYmUuZXEoREVGQVVMVF9GRUVfTU9ERUxfQ09ORklHVVJBVElPTi50cmFkZVNpemVCcHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IGZlZSBtb2RlbCBjb25maWcgd2hlbiBjaGFpbklkIGlzIG5vdCBmb3VuZCcsICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyID0gbmV3IENvbmZpZ01hbmFnZXIoKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgZmVlTW9kZWxDb25maWcgPSBjb25maWdNYW5hZ2VyLmdldEZlZU1vZGVsQ29uZmlndXJhdGlvbihjaGFpbklkLCB0b2tlbkEsIHVua25vd25Ub2tlbik7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChmZWVNb2RlbENvbmZpZy5tYXJnaW5SYWtlUmF0aW8pLnRvLmJlLmVxKERFRkFVTFRfRkVFX01PREVMX0NPTkZJR1VSQVRJT04ubWFyZ2luUmFrZVJhdGlvKTtcbiAgICAgICAgICAgIGV4cGVjdChmZWVNb2RlbENvbmZpZy50cmFkZVNpemVCcHMpLnRvLmJlLmVxKERFRkFVTFRfRkVFX01PREVMX0NPTkZJR1VSQVRJT04udHJhZGVTaXplQnBzKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==