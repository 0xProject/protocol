5a5d4b8a0320d89fc618a7170678b3e8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.METRICS_PROXY = void 0;
const utils_1 = require("@0x/utils");
const prom_client_1 = require("prom-client");
const ORDER_EXPIRED_TOO_SOON = new prom_client_1.Counter({
    name: 'rfq_order_expired_too_soon',
    help: 'RFQ Order expired too soon',
    labelNames: ['maker', 'isLastLook'],
});
const EXPIRATION_FOR_VALID_ORDER_SECONDS = new prom_client_1.Histogram({
    name: 'rfq_expiration_for_valid_order',
    help: 'Order expiration in seconds for ',
    labelNames: ['maker', 'isLastLook'],
    // Buckets go from 30 seconds all the way to 5 minutes
    // tslint:disable-next-line: custom-no-magic-numbers
    buckets: [0, 30, 45, 60, 75, 90, 105, 120, 135, 150, 165, 180, 195, 210, 225, 240, 255, 270, 285, 300],
});
const ORDER_FILL_RATIO_WARNING_RANGE = new prom_client_1.Counter({
    name: 'rfq_fill_ratio_warning',
    help: 'Fill ratio is in warning range (99%) usually due to a bug',
    labelNames: ['maker', 'isLastLook'],
});
const RFQ_MAKER_NETWORK_INTERACTION_COUNTER = new prom_client_1.Counter({
    name: 'rfq_maker_network_interaction_counter',
    help: 'Provides stats around market maker network interactions',
    labelNames: ['isLastLook', 'integratorLabel', 'url', 'quoteType', 'included', 'statusCode', 'market'],
});
const RFQ_MAKER_NETWORK_INTERACTION_SUMMARY = new prom_client_1.Summary({
    name: 'rfq_maker_network_interaction_summary',
    help: 'Provides stats around market maker network interactions',
    labelNames: ['isLastLook', 'integratorLabel', 'url', 'quoteType', 'included', 'statusCode', 'market'],
});
// NOTE: Do not use this map for anything sensitive. This is only used for
// metrics/datavis purposes.
const KNOWN_TOKENS = {
    '0x6b175474e89094c44da98b954eedeac495271d0f': 'DAI',
    '0xdac17f958d2ee523a2206206994597c13d831ec7': 'USDT',
    '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48': 'USDC',
    '0x2260fac5e5542a773aa44fbcfedf7c193bc2c599': 'WBTC',
    '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2': 'WETH',
};
/**
 * Returns a human-readible label for Prometheus counters. Only popular most relevant pairs
 * should be displayed in Prometheus (since it overload the service) and any other market that does
 * not contain popular pairs will simply return "Other".
 *
 * @param tokenSold the token being sold
 * @param tokenPurchased the token being purchased
 * @returns a market like "WETH-DAI", or "Other" is a pair is unknown
 */
function getMarketLabel(tokenSold, tokenPurchased) {
    const items = [tokenSold.toLowerCase(), tokenPurchased.toLowerCase()];
    items.sort();
    const tokenA = KNOWN_TOKENS[items[0]];
    const tokenB = KNOWN_TOKENS[items[1]];
    if (!tokenA || !tokenB) {
        return 'Other';
    }
    return `${tokenA}-${tokenB}`;
}
exports.METRICS_PROXY = {
    incrementExpirationToSoonCounter: (isLastLook, maker) => {
        ORDER_EXPIRED_TOO_SOON.labels(maker, isLastLook.toString()).inc();
    },
    measureExpirationForValidOrder: (isLastLook, maker, expirationTimeSeconds) => {
        EXPIRATION_FOR_VALID_ORDER_SECONDS.labels(maker, isLastLook.toString()).observe(new utils_1.BigNumber(expirationTimeSeconds).toNumber());
    },
    incrementFillRatioWarningCounter: (isLastLook, maker) => {
        ORDER_FILL_RATIO_WARNING_RANGE.labels(maker, isLastLook.toString()).inc();
    },
    logRfqMakerNetworkInteraction: (interaction) => {
        const { isLastLook, integrator, url, quoteType, included: isIncluded, statusCode, sellTokenAddress, buyTokenAddress, latencyMs, } = interaction;
        const market = getMarketLabel(sellTokenAddress, buyTokenAddress);
        const payload = [
            isLastLook.toString(),
            integrator.label,
            url,
            quoteType,
            isIncluded.toString(),
            `${statusCode || 'N/A'}`,
            market,
        ];
        RFQ_MAKER_NETWORK_INTERACTION_COUNTER.labels(...payload).inc();
        RFQ_MAKER_NETWORK_INTERACTION_SUMMARY.labels(...payload).observe(latencyMs);
    },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy9xdW90ZVJlcXVlc3Rvci9NZXRyaWNzUHJveHlJbXBsLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLHFDQUFzQztBQUN0Qyw2Q0FBMEQ7QUFNMUQsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLHFCQUFPLENBQUM7SUFDdkMsSUFBSSxFQUFFLDRCQUE0QjtJQUNsQyxJQUFJLEVBQUUsNEJBQTRCO0lBQ2xDLFVBQVUsRUFBRSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUM7Q0FDdEMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxrQ0FBa0MsR0FBRyxJQUFJLHVCQUFTLENBQUM7SUFDckQsSUFBSSxFQUFFLGdDQUFnQztJQUN0QyxJQUFJLEVBQUUsa0NBQWtDO0lBQ3hDLFVBQVUsRUFBRSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUM7SUFDbkMsc0RBQXNEO0lBRXRELG9EQUFvRDtJQUNwRCxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ3pHLENBQUMsQ0FBQztBQUVILE1BQU0sOEJBQThCLEdBQUcsSUFBSSxxQkFBTyxDQUFDO0lBQy9DLElBQUksRUFBRSx3QkFBd0I7SUFDOUIsSUFBSSxFQUFFLDJEQUEyRDtJQUNqRSxVQUFVLEVBQUUsQ0FBQyxPQUFPLEVBQUUsWUFBWSxDQUFDO0NBQ3RDLENBQUMsQ0FBQztBQUVILE1BQU0scUNBQXFDLEdBQUcsSUFBSSxxQkFBTyxDQUFDO0lBQ3RELElBQUksRUFBRSx1Q0FBdUM7SUFDN0MsSUFBSSxFQUFFLHlEQUF5RDtJQUMvRCxVQUFVLEVBQUUs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QUcsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDL0QscUNBQXFDLENBQUMsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2hGLENBQUM7Q0FDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS9zcmMvcXVvdGVSZXF1ZXN0b3IvTWV0cmljc1Byb3h5SW1wbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdAMHgvdXRpbHMnO1xuaW1wb3J0IHsgQ291bnRlciwgSGlzdG9ncmFtLCBTdW1tYXJ5IH0gZnJvbSAncHJvbS1jbGllbnQnO1xuXG5pbXBvcnQgeyBJbnRlZ3JhdG9yIH0gZnJvbSAnLi4vY29uZmlnJztcblxuaW1wb3J0IHsgTWV0cmljc1Byb3h5IH0gZnJvbSAnLi9RdW90ZVJlcXVlc3Rvcic7XG5cbmNvbnN0IE9SREVSX0VYUElSRURfVE9PX1NPT04gPSBuZXcgQ291bnRlcih7XG4gICAgbmFtZTogJ3JmcV9vcmRlcl9leHBpcmVkX3Rvb19zb29uJyxcbiAgICBoZWxwOiAnUkZRIE9yZGVyIGV4cGlyZWQgdG9vIHNvb24nLFxuICAgIGxhYmVsTmFtZXM6IFsnbWFrZXInLCAnaXNMYXN0TG9vayddLFxufSk7XG5cbmNvbnN0IEVYUElSQVRJT05fRk9SX1ZBTElEX09SREVSX1NFQ09ORFMgPSBuZXcgSGlzdG9ncmFtKHtcbiAgICBuYW1lOiAncmZxX2V4cGlyYXRpb25fZm9yX3ZhbGlkX29yZGVyJyxcbiAgICBoZWxwOiAnT3JkZXIgZXhwaXJhdGlvbiBpbiBzZWNvbmRzIGZvciAnLFxuICAgIGxhYmVsTmFtZXM6IFsnbWFrZXInLCAnaXNMYXN0TG9vayddLFxuICAgIC8vIEJ1Y2tldHMgZ28gZnJvbSAzMCBzZWNvbmRzIGFsbCB0aGUgd2F5IHRvIDUgbWludXRlc1xuXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBjdXN0b20tbm8tbWFnaWMtbnVtYmVyc1xuICAgIGJ1Y2tldHM6IFswLCAzMCwgNDUsIDYwLCA3NSwgOTAsIDEwNSwgMTIwLCAxMzUsIDE1MCwgMTY1LCAxODAsIDE5NSwgMjEwLCAyMjUsIDI0MCwgMjU1LCAyNzAsIDI4NSwgMzAwXSxcbn0pO1xuXG5jb25zdCBPUkRFUl9GSUxMX1JBVElPX1dBUk5JTkdfUkFOR0UgPSBuZXcgQ291bnRlcih7XG4gICAgbmFtZTogJ3JmcV9maWxsX3JhdGlvX3dhcm5pbmcnLFxuICAgIGhlbHA6ICdGaWxsIHJhdGlvIGlzIGluIHdhcm5pbmcgcmFuZ2UgKDk5JSkgdXN1YWxseSBkdWUgdG8gYSBidWcnLFxuICAgIGxhYmVsTmFtZXM6IFsnbWFrZXInLCAnaXNMYXN0TG9vayddLFxufSk7XG5cbmNvbnN0IFJGUV9NQUtFUl9ORVRXT1JLX0lOVEVSQUNUSU9OX0NPVU5URVIgPSBuZXcgQ291bnRlcih7XG4gICAgbmFtZTogJ3JmcV9tYWtlcl9uZXR3b3JrX2ludGVyYWN0aW9uX2NvdW50ZXInLFxuICAgIGhlbHA6ICdQcm92aWRlcyBzdGF0cyBhcm91bmQgbWFya2V0IG1ha2VyIG5ldHdvcmsgaW50ZXJhY3Rpb25zJyxcbiAgICBsYWJlbE5hbWVzOiBbJ2lzTGFzdExvb2snLCAnaW50ZWdyYXRvckxhYmVsJywgJ3VybCcsICdxdW90ZVR5cGUnLCAnaW5jbHVkZWQnLCAnc3RhdHVzQ29kZScsICdtYXJrZXQnXSxcbn0pO1xuXG5jb25zdCBSRlFfTUFLRVJfTkVUV09SS19JTlRFUkFDVElPTl9TVU1NQVJZID0gbmV3IFN1bW1hcnkoe1xuICAgIG5hbWU6ICdyZnFfbWFrZXJfbmV0d29ya19pbnRlcmFjdGlvbl9zdW1tYXJ5JyxcbiAgICBoZWxwOiAnUHJvdmlkZXMgc3RhdHMgYXJvdW5kIG1hcmtldCBtYWtlciBuZXR3b3JrIGludGVyYWN0aW9ucycsXG4gICAgbGFiZWxOYW1lczogWydpc0xhc3RMb29rJywgJ2ludGVncmF0b3JMYWJlbCcsICd1cmwnLCAncXVvdGVUeXBlJywgJ2luY2x1ZGVkJywgJ3N0YXR1c0NvZGUnLCAnbWFya2V0J10sXG59KTtcblxuLy8gTk9URTogRG8gbm90IHVzZSB0aGlzIG1hcCBmb3IgYW55dGhpbmcgc2Vuc2l0aXZlLiBUaGlzIGlzIG9ubHkgdXNlZCBmb3Jcbi8vIG1ldHJpY3MvZGF0YXZpcyBwdXJwb3Nlcy5cbmNvbnN0IEtOT1dOX1RPS0VOUzogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgICAnMHg2YjE3NTQ3NGU4OTA5NGM0NGRhOThiOTU0ZWVkZWFjNDk1MjcxZDBmJzogJ0RBSScsXG4gICAgJzB4ZGFjMTdmOTU4ZDJlZTUyM2EyMjA2MjA2OTk0NTk3YzEzZDgzMWVjNyc6ICdVU0RUJyxcbiAgICAnMHhhMGI4Njk5MWM2MjE4YjM2YzFkMTlkNGEyZTllYjBjZTM2MDZlYjQ4JzogJ1VTREMnLFxuICAgICcweDIyNjBmYWM1ZTU1NDJhNzczYWE0NGZiY2ZlZGY3YzE5M2JjMmM1OTknOiAnV0JUQycsXG4gICAgJzB4YzAyYWFhMzliMjIzZmU4ZDBhMGU1YzRmMjdlYWQ5MDgzYzc1NmNjMic6ICdXRVRIJyxcbn07XG5cbi8qKlxuICogUmV0dXJucyBhIGh1bWFuLXJlYWRpYmxlIGxhYmVsIGZvciBQcm9tZXRoZXVzIGNvdW50ZXJzLiBPbmx5IHBvcHVsYXIgbW9zdCByZWxldmFudCBwYWlyc1xuICogc2hvdWxkIGJlIGRpc3BsYXllZCBpbiBQcm9tZXRoZXVzIChzaW5jZSBpdCBvdmVybG9hZCB0aGUgc2VydmljZSkgYW5kIGFueSBvdGhlciBtYXJrZXQgdGhhdCBkb2VzXG4gKiBub3QgY29udGFpbiBwb3B1bGFyIHBhaXJzIHdpbGwgc2ltcGx5IHJldHVybiBcIk90aGVyXCIuXG4gKlxuICogQHBhcmFtIHRva2VuU29sZCB0aGUgdG9rZW4gYmVpbmcgc29sZFxuICogQHBhcmFtIHRva2VuUHVyY2hhc2VkIHRoZSB0b2tlbiBiZWluZyBwdXJjaGFzZWRcbiAqIEByZXR1cm5zIGEgbWFya2V0IGxpa2UgXCJXRVRILURBSVwiLCBvciBcIk90aGVyXCIgaXMgYSBwYWlyIGlzIHVua25vd25cbiAqL1xuZnVuY3Rpb24gZ2V0TWFya2V0TGFiZWwodG9rZW5Tb2xkOiBzdHJpbmcsIHRva2VuUHVyY2hhc2VkOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGl0ZW1zID0gW3Rva2VuU29sZC50b0xvd2VyQ2FzZSgpLCB0b2tlblB1cmNoYXNlZC50b0xvd2VyQ2FzZSgpXTtcbiAgICBpdGVtcy5zb3J0KCk7XG5cbiAgICBjb25zdCB0b2tlbkE6IHN0cmluZyB8IHVuZGVmaW5lZCA9IEtOT1dOX1RPS0VOU1tpdGVtc1swXV07XG4gICAgY29uc3QgdG9rZW5COiBzdHJpbmcgfCB1bmRlZmluZWQgPSBLTk9XTl9UT0tFTlNbaXRlbXNbMV1dO1xuICAgIGlmICghdG9rZW5BIHx8ICF0b2tlbkIpIHtcbiAgICAgICAgcmV0dXJuICdPdGhlcic7XG4gICAgfVxuICAgIHJldHVybiBgJHt0b2tlbkF9LSR7dG9rZW5CfWA7XG59XG5cbmV4cG9ydCBjb25zdCBNRVRSSUNTX1BST1hZOiBNZXRyaWNzUHJveHkgPSB7XG4gICAgaW5jcmVtZW50RXhwaXJhdGlvblRvU29vbkNvdW50ZXI6IChpc0xhc3RMb29rOiBib29sZWFuLCBtYWtlcjogc3RyaW5nKSA9PiB7XG4gICAgICAgIE9SREVSX0VYUElSRURfVE9PX1NPT04ubGFiZWxzKG1ha2VyLCBpc0xhc3RMb29rLnRvU3RyaW5nKCkpLmluYygpO1xuICAgIH0sXG5cbiAgICBtZWFzdXJlRXhwaXJhdGlvbkZvclZhbGlkT3JkZXI6IChpc0xhc3RMb29rOiBib29sZWFuLCBtYWtlcjogc3RyaW5nLCBleHBpcmF0aW9uVGltZVNlY29uZHM6IEJpZ051bWJlciB8IG51bWJlcikgPT4ge1xuICAgICAgICBFWFBJUkFUSU9OX0ZPUl9WQUxJRF9PUkRFUl9TRUNPTkRTLmxhYmVscyhtYWtlciwgaXNMYXN0TG9vay50b1N0cmluZygpKS5vYnNlcnZlKFxuICAgICAgICAgICAgbmV3IEJpZ051bWJlcihleHBpcmF0aW9uVGltZVNlY29uZHMpLnRvTnVtYmVyKCksXG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIGluY3JlbWVudEZpbGxSYXRpb1dhcm5pbmdDb3VudGVyOiAoaXNMYXN0TG9vazogYm9vbGVhbiwgbWFrZXI6IHN0cmluZykgPT4ge1xuICAgICAgICBPUkRFUl9GSUxMX1JBVElPX1dBUk5JTkdfUkFOR0UubGFiZWxzKG1ha2VyLCBpc0xhc3RMb29rLnRvU3RyaW5nKCkpLmluYygpO1xuICAgIH0sXG5cbiAgICBsb2dSZnFNYWtlck5ldHdvcmtJbnRlcmFjdGlvbjogKGludGVyYWN0aW9uOiB7XG4gICAgICAgIGlzTGFzdExvb2s6IGJvb2xlYW47XG4gICAgICAgIGludGVncmF0b3I6IEludGVncmF0b3I7XG4gICAgICAgIHVybDogc3RyaW5nO1xuICAgICAgICBxdW90ZVR5cGU6ICdmaXJtJyB8ICdpbmRpY2F0aXZlJztcbiAgICAgICAgc3RhdHVzQ29kZTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgICAgICBsYXRlbmN5TXM6IG51bWJlcjtcbiAgICAgICAgaW5jbHVkZWQ6IGJvb2xlYW47XG4gICAgICAgIHNlbGxUb2tlbkFkZHJlc3M6IHN0cmluZztcbiAgICAgICAgYnV5VG9rZW5BZGRyZXNzOiBzdHJpbmc7XG4gICAgfSkgPT4ge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBpc0xhc3RMb29rLFxuICAgICAgICAgICAgaW50ZWdyYXRvcixcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIHF1b3RlVHlwZSxcbiAgICAgICAgICAgIGluY2x1ZGVkOiBpc0luY2x1ZGVkLFxuICAgICAgICAgICAgc3RhdHVzQ29kZSxcbiAgICAgICAgICAgIHNlbGxUb2tlbkFkZHJlc3MsXG4gICAgICAgICAgICBidXlUb2tlbkFkZHJlc3MsXG4gICAgICAgICAgICBsYXRlbmN5TXMsXG4gICAgICAgIH0gPSBpbnRlcmFjdGlvbjtcblxuICAgICAgICBjb25zdCBtYXJrZXQgPSBnZXRNYXJrZXRMYWJlbChzZWxsVG9rZW5BZGRyZXNzLCBidXlUb2tlbkFkZHJlc3MpO1xuICAgICAgICBjb25zdCBwYXlsb2FkID0gW1xuICAgICAgICAgICAgaXNMYXN0TG9vay50b1N0cmluZygpLFxuICAgICAgICAgICAgaW50ZWdyYXRvci5sYWJlbCxcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIHF1b3RlVHlwZSxcbiAgICAgICAgICAgIGlzSW5jbHVkZWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGAke3N0YXR1c0NvZGUgfHwgJ04vQSd9YCxcbiAgICAgICAgICAgIG1hcmtldCxcbiAgICAgICAgXTtcbiAgICAgICAgUkZRX01BS0VSX05FVFdPUktfSU5URVJBQ1RJT05fQ09VTlRFUi5sYWJlbHMoLi4ucGF5bG9hZCkuaW5jKCk7XG4gICAgICAgIFJGUV9NQUtFUl9ORVRXT1JLX0lOVEVSQUNUSU9OX1NVTU1BUlkubGFiZWxzKC4uLnBheWxvYWQpLm9ic2VydmUobGF0ZW5jeU1zKTtcbiAgICB9LFxufTtcbiJdLCJ2ZXJzaW9uIjozfQ==