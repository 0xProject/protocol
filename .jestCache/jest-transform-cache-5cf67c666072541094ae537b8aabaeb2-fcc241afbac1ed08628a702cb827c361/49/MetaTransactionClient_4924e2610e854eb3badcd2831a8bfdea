52677316cad2ba8e8de8d40b0d0eba34
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getQuoteRpc = exports.getV2QuoteAsync = exports.getV1QuoteAsync = void 0;
const api_utils_1 = require("@0x/api-utils");
const protocol_utils_1 = require("@0x/protocol-utils");
const utils_1 = require("@0x/utils");
const http_status_codes_1 = require("http-status-codes");
const config_1 = require("../config");
const constants_1 = require("../core/constants");
const errors_1 = require("../core/errors");
const meta_transaction_fee_utils_1 = require("../core/meta_transaction_fee_utils");
const types_1 = require("../core/types");
const meta_transaction_pb_1 = require("../proto-ts/meta_transaction.pb");
const ProtoUtils_1 = require("./ProtoUtils");
const rfqm_request_utils_1 = require("./rfqm_request_utils");
/**
 * Queries the MetaTransaction v1 endpoints for an AMM quote wrapped in a
 * MetaTransaction.
 * If no AMM liquidity is available, returns `null`.
 *
 * If a prometheus 'Summary' is provided to the `requestDurationSummary`
 * parameter, the function will call its `observe` method with the request
 * duration in ms.
 *
 * @throws `AxiosError`
 */
async function getV1QuoteAsync(axiosInstance, url, params, meter, noLiquidityLogger) {
    const stopTimer = meter === null || meter === void 0 ? void 0 : meter.requestDurationSummary.startTimer({ chainId: meter.chainId });
    let response;
    try {
        response = await axiosInstance.get(url.toString(), {
            params,
            // TODO (rhinodavid): Formalize this value once we have a good idea of the
            // actual numbers
            timeout: 10000,
            paramsSerializer: (data) => {
                const result = new URLSearchParams({
                    buyToken: data.buyToken,
                    sellToken: data.sellToken,
                    takerAddress: data.takerAddress,
                    integratorId: data.integratorId,
                    chainId: data.chainId.toString(),
                });
                const { affiliateAddress, buyAmount: buyAmountData, sellAmount: sellAmountData, slippagePercentage, quoteUniqueId, } = data;
                affiliateAddress && result.append('affiliateAddress', affiliateAddress);
                buyAmountData && result.append('buyAmount', buyAmountData.toString());
                sellAmountData && result.append('sellAmount', sellAmountData.toString());
                slippagePercentage && result.append('slippagePercentage', slippagePercentage.toString());
                quoteUniqueId && result.append('quoteUniqueId', quoteUniqueId);
                return result.toString();
            },
        });
    }
    catch (e) {
        stopTimer && stopTimer({ success: 'false' });
        return handleQuoteError(e, params, noLiquidityLogger);
    }
    stopTimer && stopTimer({ success: 'true' });
    const { buyAmount, buyTokenAddress, gas, price, sellAmount, sellTokenAddress, metaTransactionHash } = response.data;
    // A fun thing here is that the return from the API, @0x/types:ExchangeProxyMetaTransaction
    // does not match @0x/protocol-utils:MetaTransaction. So, we pull the domain information out
    // and put it at the top level of the constructor parameters
    const metaTransaction = new protocol_utils_1.MetaTransaction((0, rfqm_request_utils_1.stringsToMetaTransactionFields)({
        ...response.data.metaTransaction,
        chainId: response.data.metaTransaction.domain.chainId,
        verifyingContract: response.data.metaTransaction.domain.verifyingContract,
    }));
    const computedHash = metaTransaction.getHash();
    if (computedHash !== metaTransactionHash) {
        throw new Error(`Computered meta-transaction hash ${computedHash} is different from hash returned from meta-transaction endpoints ${metaTransactionHash}`);
    }
    return {
        trade: {
            kind: types_1.GaslessTypes.MetaTransaction,
            hash: metaTransaction.getHash(),
            metaTransaction,
        },
        price: {
            buyAmount: new utils_1.BigNumber(buyAmount),
            buyTokenAddress,
            gas: new utils_1.BigNumber(gas),
            price: new utils_1.BigNumber(price),
            sellAmount: new utils_1.BigNumber(sellAmount),
            sellTokenAddress,
        },
    };
}
exports.getV1QuoteAsync = getV1QuoteAsync;
/**
 * Queries the meta-transaction v2 endpoints for a meta-transaction quote wrapped in a
 * meta-transaction. The meta-transaction type returned could be either v1 or v2.
 *
 * If no liquidity is available, returns `null`.
 *
 * If a prometheus 'Summary' is provided to the `requestDurationSummary`
 * parameter, the function will call its `observe` method with the request
 * duration in ms.
 *
 * @throws `AxiosError`
 */
async function getV2QuoteAsync(axiosInstance, url, params, meter, noLiquidityLogger) {
    const stopTimer = meter === null || meter === void 0 ? void 0 : meter.requestDurationSummary.startTimer({ chainId: meter.chainId });
    let response;
    try {
        response = await axiosInstance.post(url.toString(), params);
    }
    catch (e) {
        stopTimer && stopTimer({ success: 'false' });
        return handleQuoteError(e, params, noLiquidityLogger);
    }
    stopTimer && stopTimer({ success: 'true' });
    const { buyAmount, buyTokenAddress, gas, price, sellAmount, sellTokenAddress, trade: rawTrade } = response.data;
    switch (rawTrade.kind) {
        case types_1.GaslessTypes.MetaTransaction: {
            const metaTransaction = new protocol_utils_1.MetaTransaction((0, rfqm_request_utils_1.stringsToMetaTransactionFields)({
                ...rawTrade.metaTransaction,
            }));
            const computedHash = metaTransaction.getHash();
            if (computedHash !== rawTrade.hash) {
                throw new Error(`Computered meta-transaction hash ${computedHash} is different from hash returned from meta-transaction endpoints ${rawTrade.hash}`);
            }
            return {
                trade: {
                    kind: types_1.GaslessTypes.MetaTransaction,
                    hash: rawTrade.hash,
                    metaTransaction,
                },
                price: {
                    buyAmount: new utils_1.BigNumber(buyAmount),
                    buyTokenAddress,
                    gas: new utils_1.BigNumber(gas),
                    price: new utils_1.BigNumber(price),
                    sellAmount: new utils_1.BigNumber(sellAmount),
                    sellTokenAddress,
                },
                sources: response.data.sources
                    .map((source) => {
                    return {
                        ...source,
                        proportion: new utils_1.BigNumber(source.proportion),
                    };
                })
                    .filter((source) => source.proportion.gt(constants_1.ZERO)),
                fees: (0, meta_transaction_fee_utils_1.rawFeesToFees)(response.data.fees),
            };
        }
        default:
            ((_x) => {
                throw new Error('unreachable');
            })(rawTrade.kind);
    }
}
exports.getV2QuoteAsync = getV2QuoteAsync;
/**
 * Internal function to handle meta-transaction quote responses.
 *
 * @returns Null if it's no liquidty error.
 */
function handleQuoteError(e, // eslint-disable-line @typescript-eslint/no-explicit-any
params, noLiquidityLogger) {
    var _a, _b, _c, _d, _f, _g, _h, _j, _k, _l, _m;
    if ((_a = e.response) === null || _a === void 0 ? void 0 : _a.data) {
        const axiosError = e;
        //  The response for no liquidity is a 400 status with a body like:
        //  {
        //     "code": 100,
        //     "reason": "Validation Failed",
        //     "validationErrors": [
        //       {
        //         "field": "sellAmount",
        //         "code": 1004,
        //         "reason": "INSUFFICIENT_ASSET_LIQUIDITY"
        //       }
        //     ]
        //   }
        if (((_b = axiosError.response) === null || _b === void 0 ? void 0 : _b.status) === http_status_codes_1.BAD_REQUEST &&
            ((_f = (_d = (_c = axiosError.response) === null || _c === void 0 ? void 0 : _c.data) === null || _d === void 0 ? void 0 : _d.validationErrors) === null || _f === void 0 ? void 0 : _f.length) === 1 &&
            ((_j = (_h = (_g = axiosError.response) === null || _g === void 0 ? void 0 : _g.data) === null || _h === void 0 ? void 0 : _h.validationErrors) === null || _j === void 0 ? void 0 : _j.map((v) => v.reason).includes(types_1.SwapQuoterError.InsufficientAssetLiquidity))) {
            // Looks like there is no liquidity for the quote...
            noLiquidityLogger &&
                noLiquidityLogger({ ammQuoteRequestParams: params }, `[MetaTransactionClient] No liquidity returned for pair`);
            return null;
        }
        // The response for insufficient fund error (primarily caused by trading amount is less than the fee)
        // is a 400 status and with a body like:
        // {
        //      "code": 109,
        //      "reason": "Insufficient funds for transaction"
        // }
        if (((_k = axiosError.response) === null || _k === void 0 ? void 0 : _k.status) === http_status_codes_1.BAD_REQUEST &&
            ((_m = (_l = axiosError.response) === null || _l === void 0 ? void 0 : _l.data) === null || _m === void 0 ? void 0 : _m.code) === errors_1.APIErrorCodes.InsufficientFundsError) {
            if (params.sellAmount) {
                throw new api_utils_1.ValidationError([
                    {
                        field: 'sellAmount',
                        code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                        reason: 'sellAmount too small',
                    },
                ]);
            }
            throw new api_utils_1.ValidationError([
                {
                    field: 'buyAmount',
                    code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                    reason: 'buyAmount too small',
                },
            ]);
        }
    }
    // This error is neither the standard no liquidity error nor the insufficient fund error
    throw e;
}
/**
 * Queries the MetaTransaction RPC service for an AMM quote wrapped in a
 * MetaTransaction.
 * If no AMM liquidity is available, returns `null`.
 *
 * If a prometheus 'Summary' is provided to the `requestDurationSummary`
 * parameter, the function will call its `observe` method with the request
 * duration in ms.
 */
async function getQuoteRpc(params, meter, noLiquidityLogger) {
    var _a, _b, _c, _d, _f, _g;
    const stopTimer = meter === null || meter === void 0 ? void 0 : meter.requestDurationSummary.startTimer({ chainId: meter.chainId });
    let response;
    try {
        // TODO (rhinodavid): Figure out how to set a timeout
        response = await (0, meta_transaction_pb_1.GetQuote)({
            affiliateAddress: params.affiliateAddress,
            buyAmount: params.buyAmount ? (0, ProtoUtils_1.bigNumberToProto)(params.buyAmount) : undefined,
            buyTokenAddress: params.buyToken,
            chainId: params.chainId,
            integratorId: params.integratorId,
            quoteUniqueId: params.quoteUniqueId,
            sellAmount: params.sellAmount ? (0, ProtoUtils_1.bigNumberToProto)(params.sellAmount) : undefined,
            sellTokenAddress: params.sellToken,
            slippagePercentage: params.slippagePercentage ? (0, ProtoUtils_1.bigNumberToProto)(params.slippagePercentage) : undefined,
            takerAddress: params.takerAddress,
        }, { baseURL: config_1.META_TRANSACTION_SERVICE_RPC_URL });
    }
    catch (_e) {
        stopTimer && stopTimer({ success: 'false' });
        /**
         * Error handling:
         *
         * Twirp throws an error of the following type:
         * export interface TwirpError {
         *   code: ErrorCode;
         *   msg: string;
         *   meta?: Record<string, string>;
         * }
         *
         * To support the current error codes, we type `meta` as:
         *  meta: {
         *     zeroexErrorCode?: APIErrorCodes,
         *     validationErrors: JSON.stringify(ValidationErrorItem[])
         *  }
         */
        const e = _e;
        const zeroexErrorCode = Number.isNaN(parseInt((_b = (_a = e.meta) === null || _a === void 0 ? void 0 : _a.zeroexErrorCode) !== null && _b !== void 0 ? _b : ''))
            ? null
            : parseInt((_d = (_c = e.meta) === null || _c === void 0 ? void 0 : _c.zeroexErrorCode) !== null && _d !== void 0 ? _d : '');
        const validationErrors = JSON.parse((_g = (_f = e.meta) === null || _f === void 0 ? void 0 : _f.validationErrors) !== null && _g !== void 0 ? _g : '[]');
        if ((validationErrors === null || validationErrors === void 0 ? void 0 : validationErrors.length) === 1 &&
            (validationErrors === null || validationErrors === void 0 ? void 0 : validationErrors.map((v) => v.reason).includes(types_1.SwapQuoterError.InsufficientAssetLiquidity))) {
            // Looks like there is no liquidity for the quote...
            noLiquidityLogger &&
                noLiquidityLogger({ ammQuoteRequestParams: params }, `[MetaTransactionClient] No liquidity returned for pair`);
            return null;
        }
        // The response for insufficient fund error (primarily caused by trading amount is less than the fee)
        // is a zeroexGeneralErrorCode `InsufficientFundsError`
        if (zeroexErrorCode === errors_1.APIErrorCodes.InsufficientFundsError) {
            if (params.sellAmount) {
                throw new api_utils_1.ValidationError([
                    {
                        field: 'sellAmount',
                        code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                        reason: 'sellAmount too small',
                    },
                ]);
            }
            throw new api_utils_1.ValidationError([
                {
                    field: 'buyAmount',
                    code: api_utils_1.ValidationErrorCodes.FieldInvalid,
                    reason: 'buyAmount too small',
                },
            ]);
        }
        // This error is neither the standard no liquidity error nor the insufficient fund error
        throw e;
    }
    stopTimer && stopTimer({ success: 'true' });
    return {
        metaTransaction: new protocol_utils_1.MetaTransaction({
            signer: response.metaTransaction.signerAddress,
            sender: response.metaTransaction.senderAddress,
            minGasPrice: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.minGasPrice),
            maxGasPrice: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.maxGasPrice),
            expirationTimeSeconds: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.expirationTimeSeconds),
            salt: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.salt),
            callData: response.metaTransaction.callData,
            value: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.value),
            feeToken: response.metaTransaction.feeTokenAddress,
            feeAmount: (0, ProtoUtils_1.protoToBigNumber)(response.metaTransaction.feeAmount),
            chainId: response.metaTransaction.chainId,
            verifyingContract: response.metaTransaction.verifyingContract,
        }),
        price: {
            buyAmount: (0, ProtoUtils_1.protoToBigNumber)(response.quote.buyAmount),
            buyTokenAddress: response.quote.buyTokenAddress,
            gas: (0, ProtoUtils_1.protoToBigNumber)(response.quote.gas),
            price: (0, ProtoUtils_1.protoToBigNumber)(response.quote.price),
            sellAmount: (0, ProtoUtils_1.protoToBigNumber)(response.quote.sellAmount),
            sellTokenAddress: response.quote.sellTokenAddress,
        },
    };
}
exports.getQuoteRpc = getQuoteRpc;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9NZXRhVHJhbnNhY3Rpb25DbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQWlHO0FBQ2pHLHVEQUE0RTtBQUU1RSxxQ0FBc0M7QUFFdEMseURBQWdEO0FBR2hELHNDQUE2RDtBQUM3RCxpREFBeUM7QUFDekMsMkNBQStDO0FBQy9DLG1GQUFtRTtBQUNuRSx5Q0FBOEQ7QUFFOUQseUVBQTZFO0FBRzdFLDZDQUFrRTtBQUNsRSw2REFBc0U7QUE0SHRFOzs7Ozs7Ozs7O0dBVUc7QUFDSSxLQUFLLFVBQVUsZUFBZSxDQUNqQyxhQUE0QixFQUM1QixHQUFRLEVBQ1IsTUFBbUIsRUFDbkIsS0FBbUYsRUFDbkYsaUJBQThCO0lBRTlCLE1BQU0sU0FBUyxHQUFHLEtBQUssYUFBTCxLQUFLLHVCQUFMLEtBQUssQ0FBRSxzQkFBc0IsQ0FBQyxVQUFVLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFFdkYsSUFBSSxRQUEwRCxDQUFDO0lBQy9ELElBQUk7UUFDQSxRQUFRLEdBQUcsTUFBTSxhQUFhLENBQUMsR0FBRyxDQUFvQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDbEYsTUFBTTtZQUNOLDBFQUEwRTtZQUMxRSxpQkFBaUI7WUFDakIsT0FBTyxFQUFFLEtBQUs7WUFDZCxnQkFBZ0IsRUFBRSxDQUFDLElBQW1CLEVBQUUsRUFBRTtnQkFDdEMsTUFBTSxNQUFNLEdBQUcsSUFBSSxlQUFlLENBQUM7b0JBQy9CLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtvQkFDdkIsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTO29CQUN6QixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7b0JBQy9CLFlBQVksRUFBRSxJQUFJLENBQUMsWUFBWTtvQkFDL0IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFO2lCQUNuQyxDQUFDLENBQUM7Z0JB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Q0FBQyxlQUFlLENBQUMscUJBQXFCLENBQUM7WUFDdkYsSUFBSSxFQUFFLElBQUEsNkJBQWdCLEVBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUM7WUFDckQsUUFBUSxFQUFFLFFBQVEsQ0FBQyxlQUFlLENBQUMsUUFBUTtZQUMzQyxLQUFLLEVBQUUsSUFBQSw2QkFBZ0IsRUFBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQztZQUN2RCxRQUFRLEVBQUUsUUFBUSxDQUFDLGVBQWUsQ0FBQyxlQUFlO1lBQ2xELFNBQVMsRUFBRSxJQUFBLDZCQUFnQixFQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDO1lBQy9ELE9BQU8sRUFBRSxRQUFRLENBQUMsZUFBZSxDQUFDLE9BQU87WUFDekMsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUI7U0FDaEUsQ0FBQztRQUNGLEtBQUssRUFBRTtZQUNILFNBQVMsRUFBRSxJQUFBLDZCQUFnQixFQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDO1lBQ3JELGVBQWUsRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLGVBQWU7WUFDL0MsR0FBRyxFQUFFLElBQUEsNkJBQWdCLEVBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7WUFDekMsS0FBSyxFQUFFLElBQUEsNkJBQWdCLEVBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7WUFDN0MsVUFBVSxFQUFFLElBQUEsNkJBQWdCLEVBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDdkQsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0I7U0FDcEQ7S0FDSixDQUFDO0FBQ04sQ0FBQztBQS9IRCxrQ0ErSEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9NZXRhVHJhbnNhY3Rpb25DbGllbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGlubywgVmFsaWRhdGlvbkVycm9yLCBWYWxpZGF0aW9uRXJyb3JDb2RlcywgVmFsaWRhdGlvbkVycm9ySXRlbSB9IGZyb20gJ0AweC9hcGktdXRpbHMnO1xuaW1wb3J0IHsgTWV0YVRyYW5zYWN0aW9uLCBNZXRhVHJhbnNhY3Rpb25GaWVsZHMgfSBmcm9tICdAMHgvcHJvdG9jb2wtdXRpbHMnO1xuaW1wb3J0IHsgRUlQNzEyRG9tYWluV2l0aERlZmF1bHRTY2hlbWEgfSBmcm9tICdAMHgvdHlwZXMnO1xuaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnQDB4L3V0aWxzJztcbmltcG9ydCB7IEF4aW9zRXJyb3IsIEF4aW9zSW5zdGFuY2UsIEF4aW9zUmVzcG9uc2UgfSBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBCQURfUkVRVUVTVCB9IGZyb20gJ2h0dHAtc3RhdHVzLWNvZGVzJztcbmltcG9ydCB7IFN1bW1hcnkgfSBmcm9tICdwcm9tLWNsaWVudCc7XG5pbXBvcnQgeyBUd2lycEVycm9yIH0gZnJvbSAndHdpcnBzY3JpcHQnO1xuaW1wb3J0IHsgTUVUQV9UUkFOU0FDVElPTl9TRVJWSUNFX1JQQ19VUkwgfSBmcm9tICcuLi9jb25maWcnO1xuaW1wb3J0IHsgWkVSTyB9IGZyb20gJy4uL2NvcmUvY29uc3RhbnRzJztcbmltcG9ydCB7IEFQSUVycm9yQ29kZXMgfSBmcm9tICcuLi9jb3JlL2Vycm9ycyc7XG5pbXBvcnQgeyByYXdGZWVzVG9GZWVzIH0gZnJvbSAnLi4vY29yZS9tZXRhX3RyYW5zYWN0aW9uX2ZlZV91dGlscyc7XG5pbXBvcnQgeyBHYXNsZXNzVHlwZXMsIFN3YXBRdW90ZXJFcnJvciB9IGZyb20gJy4uL2NvcmUvdHlwZXMnO1xuaW1wb3J0IHsgRmVlQ29uZmlncywgRmVlcywgUmF3RmVlcyB9IGZyb20gJy4uL2NvcmUvdHlwZXMvbWV0YV90cmFuc2FjdGlvbl9mZWVzJztcbmltcG9ydCB7IEdldFF1b3RlLCBHZXRRdW90ZVJlc3BvbnNlIH0gZnJvbSAnLi4vcHJvdG8tdHMvbWV0YV90cmFuc2FjdGlvbi5wYic7XG5cbmltcG9ydCB7IEZldGNoSW5kaWNhdGl2ZVF1b3RlUmVzcG9uc2UsIExpcXVpZGl0eVNvdXJjZSwgTWV0YVRyYW5zYWN0aW9uVHJhZGVSZXNwb25zZSB9IGZyb20gJy4uL3NlcnZpY2VzL3R5cGVzJztcbmltcG9ydCB7IGJpZ051bWJlclRvUHJvdG8sIHByb3RvVG9CaWdOdW1iZXIgfSBmcm9tICcuL1Byb3RvVXRpbHMnO1xuaW1wb3J0IHsgc3RyaW5nc1RvTWV0YVRyYW5zYWN0aW9uRmllbGRzIH0gZnJvbSAnLi9yZnFtX3JlcXVlc3RfdXRpbHMnO1xuXG5pbnRlcmZhY2UgUXVvdGVQYXJhbXMge1xuICAgIGFmZmlsaWF0ZUFkZHJlc3M/OiBzdHJpbmc7XG4gICAgY2hhaW5JZDogbnVtYmVyO1xuICAgIGJ1eUFtb3VudD86IEJpZ051bWJlcjtcbiAgICBidXlUb2tlbjogc3RyaW5nO1xuICAgIGludGVncmF0b3JJZDogc3RyaW5nO1xuICAgIHNlbGxBbW91bnQ/OiBCaWdOdW1iZXI7XG4gICAgc2VsbFRva2VuOiBzdHJpbmc7XG4gICAgc2xpcHBhZ2VQZXJjZW50YWdlPzogQmlnTnVtYmVyO1xuICAgIHRha2VyQWRkcmVzczogc3RyaW5nO1xuICAgIHF1b3RlVW5pcXVlSWQ/OiBzdHJpbmc7IC8vIElEIHRvIHVzZSBmb3IgdGhlIHF1b3RlIHJlcG9ydCBgZGVjb2RlZFVuaXF1ZUlkYFxuICAgIG1ldGFUcmFuc2FjdGlvblZlcnNpb24/OiAndjEnIHwgJ3YyJztcbiAgICBmZWVDb25maWdzPzogRmVlQ29uZmlncztcbn1cblxuLy8gVHlwZXNcbi8vXG4vLyBOT1RFOiBUaGVzZSB0eXBlcyBhcmUgY29waWVkIGhlcmUgZnJvbSAweCBBUEkuIE9uY2Ugd2UgaGF2ZVxuLy8gYSBzb2x1dGlvbiBmb3IgYSByZWFsIHNlcnZpY2UgYXJjaGl0ZWN0dXJlLCB0aGVzZSB0eXBlcyBzaG91bGRcbi8vIGJlY29tZSBwYXJ0IG9mIHRoZSBSUEMgaW50ZXJmYWNlIHB1Ymxpc2hlZCBieSBhIGZ1dHVyZVxuLy8gTWV0YVRyYW5zYWN0aW9uU2VydmljZS4gQWxzbyB3ZSB3aWxsIG1ha2UgaXQgTWV0YXRyYW5zYWN0aW9uU2VydmljZS5cblxuaW50ZXJmYWNlIFF1b3RlQmFzZSB7XG4gICAgY2hhaW5JZDogbnVtYmVyO1xuICAgIHByaWNlOiBCaWdOdW1iZXI7XG4gICAgYnV5QW1vdW50OiBCaWdOdW1iZXI7XG4gICAgc2VsbEFtb3VudDogQmlnTnVtYmVyO1xuICAgIHNvdXJjZXM6IExpcXVpZGl0eVNvdXJjZVtdO1xuICAgIGdhc1ByaWNlOiBCaWdOdW1iZXI7XG4gICAgZXN0aW1hdGVkR2FzOiBCaWdOdW1iZXI7XG4gICAgc2VsbFRva2VuVG9FdGhSYXRlOiBCaWdOdW1iZXI7XG4gICAgYnV5VG9rZW5Ub0V0aFJhdGU6IEJpZ051bWJlcjtcbiAgICBwcm90b2NvbEZlZTogQmlnTnVtYmVyO1xuICAgIG1pbmltdW1Qcm90b2NvbEZlZTogQmlnTnVtYmVyO1xuICAgIGFsbG93YW5jZVRhcmdldD86IHN0cmluZztcbiAgICAvLyBPdXIgY2FsY3VsYXRlZCBwcmljZSBpbXBhY3Qgb3IgbnVsbCBpZiB3ZSB3ZXJlIHVuYWJsZSB0b1xuICAgIC8vIHRvIGNhbGN1bGF0ZSBhbnkgcHJpY2UgaW1wYWN0XG4gICAgZXN0aW1hdGVkUHJpY2VJbXBhY3Q6IEJpZ051bWJlciB8IG51bGw7XG59XG5cbi8vIFJhdyB0eXBlIG9mIGBRdW90ZUJhc2VgIGFzIHRoZSBxdW90ZSByZXNwb25zZSBzZW50IGJ5IG1ldGEtdHJhbnNhY3Rpb24gZW5kcG9pbnRzIGlzIHNlcmlhbGl6ZWQuXG5pbnRlcmZhY2UgUmF3UXVvdGVCYXNlIHtcbiAgICBjaGFpbklkOiBudW1iZXI7XG4gICAgcHJpY2U6IHN0cmluZztcbiAgICBidXlBbW91bnQ6IHN0cmluZztcbiAgICBzZWxsQW1vdW50OiBzdHJpbmc7XG4gICAgc291cmNlczoge1xuICAgICAgICBuYW1lOiBzdHJpbmc7XG4gICAgICAgIHByb3BvcnRpb246IHN0cmluZztcbiAgICAgICAgaW50ZXJtZWRpYXRlVG9rZW4/OiBzdHJpbmc7XG4gICAgICAgIGhvcHM/OiBzdHJpbmdbXTtcbiAgICB9W107XG4gICAgZ2FzUHJpY2U6IHN0cmluZztcbiAgICBlc3RpbWF0ZWRHYXM6IHN0cmluZztcbiAgICBzZWxsVG9rZW5Ub0V0aFJhdGU6IHN0cmluZztcbiAgICBidXlUb2tlblRvRXRoUmF0ZTogc3RyaW5nO1xuICAgIHByb3RvY29sRmVlOiBzdHJpbmc7XG4gICAgbWluaW11bVByb3RvY29sRmVlOiBzdHJpbmc7XG4gICAgYWxsb3dhbmNlVGFyZ2V0Pzogc3RyaW5nO1xuICAgIC8vIE91ciBjYWxjdWxhdGVkIHByaWNlIGltcGFjdCBvciBudWxsIGlmIHdlIHdlcmUgdW5hYmxlIHRvXG4gICAgLy8gdG8gY2FsY3VsYXRlIGFueSBwcmljZSBpbXBhY3RcbiAgICBlc3RpbWF0ZWRQcmljZUltcGFjdDogc3RyaW5nIHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCYXNlUHJpY2VSZXNwb25zZSBleHRlbmRzIFF1b3RlQmFzZSB7XG4gICAgc2VsbFRva2VuQWRkcmVzczogc3RyaW5nO1xuICAgIGJ1eVRva2VuQWRkcmVzczogc3RyaW5nO1xuICAgIHZhbHVlOiBCaWdOdW1iZXI7XG4gICAgZ2FzOiBCaWdOdW1iZXI7XG59XG5cbi8vIFJhdyB0eXBlIG9mIGBCYXNlUHJpY2VSZXNwb25zZWAgYXMgdGhlIHF1b3RlIHJlc3BvbnNlIHNlbnQgYnkgbWV0YS10cmFuc2FjdGlvbiBlbmRwb2ludHMgaXMgc2VyaWFsaXplZC5cbmludGVyZmFjZSBSYXdCYXNlUHJpY2VSZXNwb25zZSBleHRlbmRzIFJhd1F1b3RlQmFzZSB7XG4gICAgc2VsbFRva2VuQWRkcmVzczogc3RyaW5nO1xuICAgIGJ1eVRva2VuQWRkcmVzczogc3RyaW5nO1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgZ2FzOiBzdHJpbmc7XG59XG5cbi8qKioqKiogVHlwZXMgZm9yIDB4LWFwaSBtZXRhLXRyYW5zYWN0aW9uIHYxIGVuZHBvaW50cyAqKioqKiovXG4vLyBSYXcgdHlwZSBvZiBgRXhjaGFuZ2VQcm94eU1ldGFUcmFuc2FjdGlvbmAgYXMgdGhlIHF1b3RlIHJlc3BvbnNlIHNlbnQgYnkgbWV0YS10cmFuc2FjdGlvbiBlbmRwb2ludHMgaXMgc2VyaWFsaXplZC5cbmludGVyZmFjZSBSYXdFeGNoYW5nZVByb3h5TWV0YVRyYW5zYWN0aW9uIHtcbiAgICBzaWduZXI6IHN0cmluZztcbiAgICBzZW5kZXI6IHN0cmluZztcbiAgICBtaW5HYXNQcmljZTogc3RyaW5nO1xuICAgIG1heEdhc1ByaWNlOiBzdHJpbmc7XG4gICAgZXhwaXJhdGlvblRpbWVTZWNvbmRzOiBzdHJpbmc7XG4gICAgc2FsdDogc3RyaW5nO1xuICAgIGNhbGxEYXRhOiBzdHJpbmc7XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBmZWVUb2tlbjogc3RyaW5nO1xuICAgIGZlZUFtb3VudDogc3RyaW5nO1xuICAgIGRvbWFpbjogRUlQNzEyRG9tYWluV2l0aERlZmF1bHRTY2hlbWE7XG59XG5cbmludGVyZmFjZSBHZXRNZXRhVHJhbnNhY3Rpb25WMVF1b3RlUmVzcG9uc2UgZXh0ZW5kcyBSYXdCYXNlUHJpY2VSZXNwb25zZSB7XG4gICAgbWV0YVRyYW5zYWN0aW9uSGFzaDogc3RyaW5nO1xuICAgIG1ldGFUcmFuc2FjdGlvbjogUmF3RXhjaGFuZ2VQcm94eU1ldGFUcmFuc2FjdGlvbjtcbn1cblxuLyoqKioqKiBUeXBlcyBmb3IgMHgtYXBpIG1ldGEtdHJhbnNhY3Rpb24gdjIgZW5kcG9pbnRzICoqKioqKi9cbnR5cGUgUmF3VHJhZGVSZXNwb25zZSA9IFJhd01ldGFUcmFuc2FjdGlvblYxVHJhZGVSZXNwb25zZSAvKiogYWRkIFJhd01ldGFUcmFuc2FjdGlvblYyVHJhZGVSZXNwb25zZSB3aGVuIGl0J3MgcmVhZHkgKi87XG5cbmludGVyZmFjZSBSYXdNZXRhVHJhbnNhY3Rpb25WMVRyYWRlUmVzcG9uc2Uge1xuICAgIGtpbmQ6IEdhc2xlc3NUeXBlcy5NZXRhVHJhbnNhY3Rpb247XG4gICAgaGFzaDogc3RyaW5nO1xuICAgIG1ldGFUcmFuc2FjdGlvbjogUmVjb3JkPGtleW9mIE9taXQ8TWV0YVRyYW5zYWN0aW9uRmllbGRzLCAnY2hhaW5JZCc+LCBzdHJpbmc+ICYgeyBjaGFpbklkOiBudW1iZXIgfTtcbn1cblxuLy8gUXVvdGUgcmVzcG9uc2Ugc2VudCBieSBtZXRhLXRyYW5zYWN0aW9uIHYyIC9xdW90ZSBlbmRwb2ludFxuaW50ZXJmYWNlIEdldE1ldGFUcmFuc2FjdGlvblYyUXVvdGVSZXNwb25zZSBleHRlbmRzIFJhd0Jhc2VQcmljZVJlc3BvbnNlIHtcbiAgICB0cmFkZTogUmF3VHJhZGVSZXNwb25zZTtcbiAgICBmZWVzPzogUmF3RmVlcztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZXRhVHJhbnNhY3Rpb25DbGllbnRRdW90ZVJlc3BvbnNlIHtcbiAgICB0cmFkZTogTWV0YVRyYW5zYWN0aW9uVHJhZGVSZXNwb25zZTtcbiAgICBwcmljZTogRmV0Y2hJbmRpY2F0aXZlUXVvdGVSZXNwb25zZTtcbiAgICBzb3VyY2VzPzogTGlxdWlkaXR5U291cmNlW107XG4gICAgZmVlcz86IEZlZXM7XG59XG5cbi8qKlxuICogUXVlcmllcyB0aGUgTWV0YVRyYW5zYWN0aW9uIHYxIGVuZHBvaW50cyBmb3IgYW4gQU1NIHF1b3RlIHdyYXBwZWQgaW4gYVxuICogTWV0YVRyYW5zYWN0aW9uLlxuICogSWYgbm8gQU1NIGxpcXVpZGl0eSBpcyBhdmFpbGFibGUsIHJldHVybnMgYG51bGxgLlxuICpcbiAqIElmIGEgcHJvbWV0aGV1cyAnU3VtbWFyeScgaXMgcHJvdmlkZWQgdG8gdGhlIGByZXF1ZXN0RHVyYXRpb25TdW1tYXJ5YFxuICogcGFyYW1ldGVyLCB0aGUgZnVuY3Rpb24gd2lsbCBjYWxsIGl0cyBgb2JzZXJ2ZWAgbWV0aG9kIHdpdGggdGhlIHJlcXVlc3RcbiAqIGR1cmF0aW9uIGluIG1zLlxuICpcbiAqIEB0aHJvd3MgYEF4aW9zRXJyb3JgXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWMVF1b3RlQXN5bmMoXG4gICAgYXhpb3NJbnN0YW5jZTogQXhpb3NJbnN0YW5jZSxcbiAgICB1cmw6IFVSTCxcbiAgICBwYXJhbXM6IFF1b3RlUGFyYW1zLFxuICAgIG1ldGVyPzogeyByZXF1ZXN0RHVyYXRpb25TdW1tYXJ5OiBTdW1tYXJ5PCdjaGFpbklkJyB8ICdzdWNjZXNzJz47IGNoYWluSWQ6IG51bWJlciB9LFxuICAgIG5vTGlxdWlkaXR5TG9nZ2VyPzogcGluby5Mb2dGbixcbik6IFByb21pc2U8TWV0YVRyYW5zYWN0aW9uQ2xpZW50UXVvdGVSZXNwb25zZSB8IG51bGw+IHtcbiAgICBjb25zdCBzdG9wVGltZXIgPSBtZXRlcj8ucmVxdWVzdER1cmF0aW9uU3VtbWFyeS5zdGFydFRpbWVyKHsgY2hhaW5JZDogbWV0ZXIuY2hhaW5JZCB9KTtcblxuICAgIGxldCByZXNwb25zZTogQXhpb3NSZXNwb25zZTxHZXRNZXRhVHJhbnNhY3Rpb25WMVF1b3RlUmVzcG9uc2U+O1xuICAgIHRyeSB7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgYXhpb3NJbnN0YW5jZS5nZXQ8R2V0TWV0YVRyYW5zYWN0aW9uVjFRdW90ZVJlc3BvbnNlPih1cmwudG9TdHJpbmcoKSwge1xuICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgLy8gVE9ETyAocmhpbm9kYXZpZCk6IEZvcm1hbGl6ZSB0aGlzIHZhbHVlIG9uY2Ugd2UgaGF2ZSBhIGdvb2QgaWRlYSBvZiB0aGVcbiAgICAgICAgICAgIC8vIGFjdHVhbCBudW1iZXJzXG4gICAgICAgICAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICAgICAgICAgIHBhcmFtc1NlcmlhbGl6ZXI6IChkYXRhOiB0eXBlb2YgcGFyYW1zKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgICAgICAgICAgICAgIGJ1eVRva2VuOiBkYXRhLmJ1eVRva2VuLFxuICAgICAgICAgICAgICAgICAgICBzZWxsVG9rZW46IGRhdGEuc2VsbFRva2VuLFxuICAgICAgICAgICAgICAgICAgICB0YWtlckFkZHJlc3M6IGRhdGEudGFrZXJBZGRyZXNzLFxuICAgICAgICAgICAgICAgICAgICBpbnRlZ3JhdG9ySWQ6IGRhdGEuaW50ZWdyYXRvcklkLFxuICAgICAgICAgICAgICAgICAgICBjaGFpbklkOiBkYXRhLmNoYWluSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgICAgICAgIGFmZmlsaWF0ZUFkZHJlc3MsXG4gICAgICAgICAgICAgICAgICAgIGJ1eUFtb3VudDogYnV5QW1vdW50RGF0YSxcbiAgICAgICAgICAgICAgICAgICAgc2VsbEFtb3VudDogc2VsbEFtb3VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIHNsaXBwYWdlUGVyY2VudGFnZSxcbiAgICAgICAgICAgICAgICAgICAgcXVvdGVVbmlxdWVJZCxcbiAgICAgICAgICAgICAgICB9ID0gZGF0YTtcblxuICAgICAgICAgICAgICAgIGFmZmlsaWF0ZUFkZHJlc3MgJiYgcmVzdWx0LmFwcGVuZCgnYWZmaWxpYXRlQWRkcmVzcycsIGFmZmlsaWF0ZUFkZHJlc3MpO1xuICAgICAgICAgICAgICAgIGJ1eUFtb3VudERhdGEgJiYgcmVzdWx0LmFwcGVuZCgnYnV5QW1vdW50JywgYnV5QW1vdW50RGF0YS50b1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICBzZWxsQW1vdW50RGF0YSAmJiByZXN1bHQuYXBwZW5kKCdzZWxsQW1vdW50Jywgc2VsbEFtb3VudERhdGEudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgc2xpcHBhZ2VQZXJjZW50YWdlICYmIHJlc3VsdC5hcHBlbmQoJ3NsaXBwYWdlUGVyY2VudGFnZScsIHNsaXBwYWdlUGVyY2VudGFnZS50b1N0cmluZygpKTtcbiAgICAgICAgICAgICAgICBxdW90ZVVuaXF1ZUlkICYmIHJlc3VsdC5hcHBlbmQoJ3F1b3RlVW5pcXVlSWQnLCBxdW90ZVVuaXF1ZUlkKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgc3RvcFRpbWVyICYmIHN0b3BUaW1lcih7IHN1Y2Nlc3M6ICdmYWxzZScgfSk7XG4gICAgICAgIHJldHVybiBoYW5kbGVRdW90ZUVycm9yKGUsIHBhcmFtcywgbm9MaXF1aWRpdHlMb2dnZXIpO1xuICAgIH1cblxuICAgIHN0b3BUaW1lciAmJiBzdG9wVGltZXIoeyBzdWNjZXNzOiAndHJ1ZScgfSk7XG5cbiAgICBjb25zdCB7IGJ1eUFtb3VudCwgYnV5VG9rZW5BZGRyZXNzLCBnYXMsIHByaWNlLCBzZWxsQW1vdW50LCBzZWxsVG9rZW5BZGRyZXNzLCBtZXRhVHJhbnNhY3Rpb25IYXNoIH0gPSByZXNwb25zZS5kYXRhO1xuXG4gICAgLy8gQSBmdW4gdGhpbmcgaGVyZSBpcyB0aGF0IHRoZSByZXR1cm4gZnJvbSB0aGUgQVBJLCBAMHgvdHlwZXM6RXhjaGFuZ2VQcm94eU1ldGFUcmFuc2FjdGlvblxuICAgIC8vIGRvZXMgbm90IG1hdGNoIEAweC9wcm90b2NvbC11dGlsczpNZXRhVHJhbnNhY3Rpb24uIFNvLCB3ZSBwdWxsIHRoZSBkb21haW4gaW5mb3JtYXRpb24gb3V0XG4gICAgLy8gYW5kIHB1dCBpdCBhdCB0aGUgdG9wIGxldmVsIG9mIHRoZSBjb25zdHJ1Y3RvciBwYXJhbWV0ZXJzXG4gICAgY29uc3QgbWV0YVRyYW5zYWN0aW9uID0gbmV3IE1ldGFUcmFuc2FjdGlvbihcbiAgICAgICAgc3RyaW5nc1RvTWV0YVRyYW5zYWN0aW9uRmllbGRzKHtcbiAgICAgICAgICAgIC4uLnJlc3BvbnNlLmRhdGEubWV0YVRyYW5zYWN0aW9uLFxuICAgICAgICAgICAgY2hhaW5JZDogcmVzcG9uc2UuZGF0YS5tZXRhVHJhbnNhY3Rpb24uZG9tYWluLmNoYWluSWQsXG4gICAgICAgICAgICB2ZXJpZnlpbmdDb250cmFjdDogcmVzcG9uc2UuZGF0YS5tZXRhVHJhbnNhY3Rpb24uZG9tYWluLnZlcmlmeWluZ0NvbnRyYWN0LFxuICAgICAgICB9KSxcbiAgICApO1xuXG4gICAgY29uc3QgY29tcHV0ZWRIYXNoID0gbWV0YVRyYW5zYWN0aW9uLmdldEhhc2goKTtcbiAgICBpZiAoY29tcHV0ZWRIYXNoICE9PSBtZXRhVHJhbnNhY3Rpb25IYXNoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBDb21wdXRlcmVkIG1ldGEtdHJhbnNhY3Rpb24gaGFzaCAke2NvbXB1dGVkSGFzaH0gaXMgZGlmZmVyZW50IGZyb20gaGFzaCByZXR1cm5lZCBmcm9tIG1ldGEtdHJhbnNhY3Rpb24gZW5kcG9pbnRzICR7bWV0YVRyYW5zYWN0aW9uSGFzaH1gLFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHRyYWRlOiB7XG4gICAgICAgICAgICBraW5kOiBHYXNsZXNzVHlwZXMuTWV0YVRyYW5zYWN0aW9uLFxuICAgICAgICAgICAgaGFzaDogbWV0YVRyYW5zYWN0aW9uLmdldEhhc2goKSxcbiAgICAgICAgICAgIG1ldGFUcmFuc2FjdGlvbixcbiAgICAgICAgfSxcbiAgICAgICAgcHJpY2U6IHtcbiAgICAgICAgICAgIGJ1eUFtb3VudDogbmV3IEJpZ051bWJlcihidXlBbW91bnQpLFxuICAgICAgICAgICAgYnV5VG9rZW5BZGRyZXNzLFxuICAgICAgICAgICAgZ2FzOiBuZXcgQmlnTnVtYmVyKGdhcyksXG4gICAgICAgICAgICBwcmljZTogbmV3IEJpZ051bWJlcihwcmljZSksXG4gICAgICAgICAgICBzZWxsQW1vdW50OiBuZXcgQmlnTnVtYmVyKHNlbGxBbW91bnQpLFxuICAgICAgICAgICAgc2VsbFRva2VuQWRkcmVzcyxcbiAgICAgICAgfSxcbiAgICB9O1xufVxuXG4vKipcbiAqIFF1ZXJpZXMgdGhlIG1ldGEtdHJhbnNhY3Rpb24gdjIgZW5kcG9pbnRzIGZvciBhIG1ldGEtdHJhbnNhY3Rpb24gcXVvdGUgd3JhcHBlZCBpbiBhXG4gKiBtZXRhLXRyYW5zYWN0aW9uLiBUaGUgbWV0YS10cmFuc2FjdGlvbiB0eXBlIHJldHVybmVkIGNvdWxkIGJlIGVpdGhlciB2MSBvciB2Mi5cbiAqXG4gKiBJZiBubyBsaXF1aWRpdHkgaXMgYXZhaWxhYmxlLCByZXR1cm5zIGBudWxsYC5cbiAqXG4gKiBJZiBhIHByb21ldGhldXMgJ1N1bW1hcnknIGlzIHByb3ZpZGVkIHRvIHRoZSBgcmVxdWVzdER1cmF0aW9uU3VtbWFyeWBcbiAqIHBhcmFtZXRlciwgdGhlIGZ1bmN0aW9uIHdpbGwgY2FsbCBpdHMgYG9ic2VydmVgIG1ldGhvZCB3aXRoIHRoZSByZXF1ZXN0XG4gKiBkdXJhdGlvbiBpbiBtcy5cbiAqXG4gKiBAdGhyb3dzIGBBeGlvc0Vycm9yYFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VjJRdW90ZUFzeW5jKFxuICAgIGF4aW9zSW5zdGFuY2U6IEF4aW9zSW5zdGFuY2UsXG4gICAgdXJsOiBVUkwsXG4gICAgcGFyYW1zOiBRdW90ZVBhcmFtcyxcbiAgICBtZXRlcj86IHsgcmVxdWVzdER1cmF0aW9uU3VtbWFyeTogU3VtbWFyeTwnY2hhaW5JZCcgfCAnc3VjY2Vzcyc+OyBjaGFpbklkOiBudW1iZXIgfSxcbiAgICBub0xpcXVpZGl0eUxvZ2dlcj86IHBpbm8uTG9nRm4sXG4pOiBQcm9taXNlPE1ldGFUcmFuc2FjdGlvbkNsaWVudFF1b3RlUmVzcG9uc2UgfCBudWxsPiB7XG4gICAgY29uc3Qgc3RvcFRpbWVyID0gbWV0ZXI/LnJlcXVlc3REdXJhdGlvblN1bW1hcnkuc3RhcnRUaW1lcih7IGNoYWluSWQ6IG1ldGVyLmNoYWluSWQgfSk7XG5cbiAgICBsZXQgcmVzcG9uc2U6IEF4aW9zUmVzcG9uc2U8R2V0TWV0YVRyYW5zYWN0aW9uVjJRdW90ZVJlc3BvbnNlPjtcbiAgICB0cnkge1xuICAgICAgICByZXNwb25zZSA9IGF3YWl0IGF4aW9zSW5zdGFuY2UucG9zdDxHZXRNZXRhVHJhbnNhY3Rpb25WMlF1b3RlUmVzcG9uc2U+KHVybC50b1N0cmluZygpLCBwYXJhbXMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgc3RvcFRpbWVyICYmIHN0b3BUaW1lcih7IHN1Y2Nlc3M6ICdmYWxzZScgfSk7XG4gICAgICAgIHJldHVybiBoYW5kbGVRdW90ZUVycm9yKGUsIHBhcmFtcywgbm9MaXF1aWRpdHlMb2dnZXIpO1xuICAgIH1cblxuICAgIHN0b3BUaW1lciAmJiBzdG9wVGltZXIoeyBzdWNjZXNzOiAndHJ1ZScgfSk7XG5cbiAgICBjb25zdCB7IGJ1eUFtb3VudCwgYnV5VG9rZW5BZGRyZXNzLCBnYXMsIHByaWNlLCBzZWxsQW1vdW50LCBzZWxsVG9rZW5BZGRyZXNzLCB0cmFkZTogcmF3VHJhZGUgfSA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICBzd2l0Y2ggKHJhd1RyYWRlLmtpbmQpIHtcbiAgICAgICAgY2FzZSBHYXNsZXNzVHlwZXMuTWV0YVRyYW5zYWN0aW9uOiB7XG4gICAgICAgICAgICBjb25zdCBtZXRhVHJhbnNhY3Rpb24gPSBuZXcgTWV0YVRyYW5zYWN0aW9uKFxuICAgICAgICAgICAgICAgIHN0cmluZ3NUb01ldGFUcmFuc2FjdGlvbkZpZWxkcyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLnJhd1RyYWRlLm1ldGFUcmFuc2FjdGlvbixcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbXB1dGVkSGFzaCA9IG1ldGFUcmFuc2FjdGlvbi5nZXRIYXNoKCk7XG4gICAgICAgICAgICBpZiAoY29tcHV0ZWRIYXNoICE9PSByYXdUcmFkZS5oYXNoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgICAgICBgQ29tcHV0ZXJlZCBtZXRhLXRyYW5zYWN0aW9uIGhhc2ggJHtjb21wdXRlZEhhc2h9IGlzIGRpZmZlcmVudCBmcm9tIGhhc2ggcmV0dXJuZWQgZnJvbSBtZXRhLXRyYW5zYWN0aW9uIGVuZHBvaW50cyAke3Jhd1RyYWRlLmhhc2h9YCxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRyYWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IEdhc2xlc3NUeXBlcy5NZXRhVHJhbnNhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGhhc2g6IHJhd1RyYWRlLmhhc2gsXG4gICAgICAgICAgICAgICAgICAgIG1ldGFUcmFuc2FjdGlvbixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHByaWNlOiB7XG4gICAgICAgICAgICAgICAgICAgIGJ1eUFtb3VudDogbmV3IEJpZ051bWJlcihidXlBbW91bnQpLFxuICAgICAgICAgICAgICAgICAgICBidXlUb2tlbkFkZHJlc3MsXG4gICAgICAgICAgICAgICAgICAgIGdhczogbmV3IEJpZ051bWJlcihnYXMpLFxuICAgICAgICAgICAgICAgICAgICBwcmljZTogbmV3IEJpZ051bWJlcihwcmljZSksXG4gICAgICAgICAgICAgICAgICAgIHNlbGxBbW91bnQ6IG5ldyBCaWdOdW1iZXIoc2VsbEFtb3VudCksXG4gICAgICAgICAgICAgICAgICAgIHNlbGxUb2tlbkFkZHJlc3MsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzb3VyY2VzOiByZXNwb25zZS5kYXRhLnNvdXJjZXNcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoc291cmNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wb3J0aW9uOiBuZXcgQmlnTnVtYmVyKHNvdXJjZS5wcm9wb3J0aW9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKHNvdXJjZSkgPT4gc291cmNlLnByb3BvcnRpb24uZ3QoWkVSTykpLFxuICAgICAgICAgICAgICAgIGZlZXM6IHJhd0ZlZXNUb0ZlZXMocmVzcG9uc2UuZGF0YS5mZWVzKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICgoX3g6IG5ldmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bnJlYWNoYWJsZScpO1xuICAgICAgICAgICAgfSkocmF3VHJhZGUua2luZCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEludGVybmFsIGZ1bmN0aW9uIHRvIGhhbmRsZSBtZXRhLXRyYW5zYWN0aW9uIHF1b3RlIHJlc3BvbnNlcy5cbiAqXG4gKiBAcmV0dXJucyBOdWxsIGlmIGl0J3Mgbm8gbGlxdWlkdHkgZXJyb3IuXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZVF1b3RlRXJyb3IoXG4gICAgZTogYW55LCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBwYXJhbXM6IFF1b3RlUGFyYW1zLFxuICAgIG5vTGlxdWlkaXR5TG9nZ2VyPzogcGluby5Mb2dGbixcbik6IG51bGwge1xuICAgIGlmIChlLnJlc3BvbnNlPy5kYXRhKSB7XG4gICAgICAgIGNvbnN0IGF4aW9zRXJyb3IgPSBlIGFzIEF4aW9zRXJyb3I8e1xuICAgICAgICAgICAgY29kZTogbnVtYmVyO1xuICAgICAgICAgICAgcmVhc29uOiBzdHJpbmc7XG4gICAgICAgICAgICB2YWxpZGF0aW9uRXJyb3JzPzogVmFsaWRhdGlvbkVycm9ySXRlbVtdO1xuICAgICAgICB9PjtcbiAgICAgICAgLy8gIFRoZSByZXNwb25zZSBmb3Igbm8gbGlxdWlkaXR5IGlzIGEgNDAwIHN0YXR1cyB3aXRoIGEgYm9keSBsaWtlOlxuICAgICAgICAvLyAge1xuICAgICAgICAvLyAgICAgXCJjb2RlXCI6IDEwMCxcbiAgICAgICAgLy8gICAgIFwicmVhc29uXCI6IFwiVmFsaWRhdGlvbiBGYWlsZWRcIixcbiAgICAgICAgLy8gICAgIFwidmFsaWRhdGlvbkVycm9yc1wiOiBbXG4gICAgICAgIC8vICAgICAgIHtcbiAgICAgICAgLy8gICAgICAgICBcImZpZWxkXCI6IFwic2VsbEFtb3VudFwiLFxuICAgICAgICAvLyAgICAgICAgIFwiY29kZVwiOiAxMDA0LFxuICAgICAgICAvLyAgICAgICAgIFwicmVhc29uXCI6IFwiSU5TVUZGSUNJRU5UX0FTU0VUX0xJUVVJRElUWVwiXG4gICAgICAgIC8vICAgICAgIH1cbiAgICAgICAgLy8gICAgIF1cbiAgICAgICAgLy8gICB9XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGF4aW9zRXJyb3IucmVzcG9uc2U/LnN0YXR1cyA9PT0gQkFEX1JFUVVFU1QgJiZcbiAgICAgICAgICAgIGF4aW9zRXJyb3IucmVzcG9uc2U/LmRhdGE/LnZhbGlkYXRpb25FcnJvcnM/Lmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICAgICAgYXhpb3NFcnJvci5yZXNwb25zZT8uZGF0YT8udmFsaWRhdGlvbkVycm9yc1xuICAgICAgICAgICAgICAgID8ubWFwKCh2KSA9PiB2LnJlYXNvbilcbiAgICAgICAgICAgICAgICAuaW5jbHVkZXMoU3dhcFF1b3RlckVycm9yLkluc3VmZmljaWVudEFzc2V0TGlxdWlkaXR5KVxuICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIExvb2tzIGxpa2UgdGhlcmUgaXMgbm8gbGlxdWlkaXR5IGZvciB0aGUgcXVvdGUuLi5cbiAgICAgICAgICAgIG5vTGlxdWlkaXR5TG9nZ2VyICYmXG4gICAgICAgICAgICAgICAgbm9MaXF1aWRpdHlMb2dnZXIoXG4gICAgICAgICAgICAgICAgICAgIHsgYW1tUXVvdGVSZXF1ZXN0UGFyYW1zOiBwYXJhbXMgfSxcbiAgICAgICAgICAgICAgICAgICAgYFtNZXRhVHJhbnNhY3Rpb25DbGllbnRdIE5vIGxpcXVpZGl0eSByZXR1cm5lZCBmb3IgcGFpcmAsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlIHJlc3BvbnNlIGZvciBpbnN1ZmZpY2llbnQgZnVuZCBlcnJvciAocHJpbWFyaWx5IGNhdXNlZCBieSB0cmFkaW5nIGFtb3VudCBpcyBsZXNzIHRoYW4gdGhlIGZlZSlcbiAgICAgICAgLy8gaXMgYSA0MDAgc3RhdHVzIGFuZCB3aXRoIGEgYm9keSBsaWtlOlxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgICAgXCJjb2RlXCI6IDEwOSxcbiAgICAgICAgLy8gICAgICBcInJlYXNvblwiOiBcIkluc3VmZmljaWVudCBmdW5kcyBmb3IgdHJhbnNhY3Rpb25cIlxuICAgICAgICAvLyB9XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGF4aW9zRXJyb3IucmVzcG9uc2U/LnN0YXR1cyA9PT0gQkFEX1JFUVVFU1QgJiZcbiAgICAgICAgICAgIGF4aW9zRXJyb3IucmVzcG9uc2U/LmRhdGE/LmNvZGUgPT09IEFQSUVycm9yQ29kZXMuSW5zdWZmaWNpZW50RnVuZHNFcnJvclxuICAgICAgICApIHtcbiAgICAgICAgICAgIGlmIChwYXJhbXMuc2VsbEFtb3VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3NlbGxBbW91bnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogVmFsaWRhdGlvbkVycm9yQ29kZXMuRmllbGRJbnZhbGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnc2VsbEFtb3VudCB0b28gc21hbGwnLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnYnV5QW1vdW50JyxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogVmFsaWRhdGlvbkVycm9yQ29kZXMuRmllbGRJbnZhbGlkLFxuICAgICAgICAgICAgICAgICAgICByZWFzb246ICdidXlBbW91bnQgdG9vIHNtYWxsJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gVGhpcyBlcnJvciBpcyBuZWl0aGVyIHRoZSBzdGFuZGFyZCBubyBsaXF1aWRpdHkgZXJyb3Igbm9yIHRoZSBpbnN1ZmZpY2llbnQgZnVuZCBlcnJvclxuICAgIHRocm93IGU7XG59XG5cbi8qKlxuICogUXVlcmllcyB0aGUgTWV0YVRyYW5zYWN0aW9uIFJQQyBzZXJ2aWNlIGZvciBhbiBBTU0gcXVvdGUgd3JhcHBlZCBpbiBhXG4gKiBNZXRhVHJhbnNhY3Rpb24uXG4gKiBJZiBubyBBTU0gbGlxdWlkaXR5IGlzIGF2YWlsYWJsZSwgcmV0dXJucyBgbnVsbGAuXG4gKlxuICogSWYgYSBwcm9tZXRoZXVzICdTdW1tYXJ5JyBpcyBwcm92aWRlZCB0byB0aGUgYHJlcXVlc3REdXJhdGlvblN1bW1hcnlgXG4gKiBwYXJhbWV0ZXIsIHRoZSBmdW5jdGlvbiB3aWxsIGNhbGwgaXRzIGBvYnNlcnZlYCBtZXRob2Qgd2l0aCB0aGUgcmVxdWVzdFxuICogZHVyYXRpb24gaW4gbXMuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRRdW90ZVJwYyhcbiAgICBwYXJhbXM6IHtcbiAgICAgICAgYWZmaWxpYXRlQWRkcmVzcz86IHN0cmluZztcbiAgICAgICAgY2hhaW5JZDogbnVtYmVyO1xuICAgICAgICBidXlBbW91bnQ/OiBCaWdOdW1iZXI7XG4gICAgICAgIGJ1eVRva2VuOiBzdHJpbmc7XG4gICAgICAgIGludGVncmF0b3JJZDogc3RyaW5nO1xuICAgICAgICBzZWxsQW1vdW50PzogQmlnTnVtYmVyO1xuICAgICAgICBzZWxsVG9rZW46IHN0cmluZztcbiAgICAgICAgc2xpcHBhZ2VQZXJjZW50YWdlPzogQmlnTnVtYmVyO1xuICAgICAgICB0YWtlckFkZHJlc3M6IHN0cmluZztcbiAgICAgICAgcXVvdGVVbmlxdWVJZD86IHN0cmluZzsgLy8gSUQgdG8gdXNlIGZvciB0aGUgcXVvdGUgcmVwb3J0IGBkZWNvZGVkVW5pcXVlSWRgXG4gICAgfSxcbiAgICBtZXRlcj86IHsgcmVxdWVzdER1cmF0aW9uU3VtbWFyeTogU3VtbWFyeTwnY2hhaW5JZCcgfCAnc3VjY2Vzcyc+OyBjaGFpbklkOiBudW1iZXIgfSxcbiAgICBub0xpcXVpZGl0eUxvZ2dlcj86IHBpbm8uTG9nRm4sXG4pOiBQcm9taXNlPHsgbWV0YVRyYW5zYWN0aW9uOiBNZXRhVHJhbnNhY3Rpb247IHByaWNlOiBGZXRjaEluZGljYXRpdmVRdW90ZVJlc3BvbnNlIH0gfCBudWxsPiB7XG4gICAgY29uc3Qgc3RvcFRpbWVyID0gbWV0ZXI/LnJlcXVlc3REdXJhdGlvblN1bW1hcnkuc3RhcnRUaW1lcih7IGNoYWluSWQ6IG1ldGVyLmNoYWluSWQgfSk7XG5cbiAgICBsZXQgcmVzcG9uc2U6IEdldFF1b3RlUmVzcG9uc2U7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gVE9ETyAocmhpbm9kYXZpZCk6IEZpZ3VyZSBvdXQgaG93IHRvIHNldCBhIHRpbWVvdXRcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBHZXRRdW90ZShcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhZmZpbGlhdGVBZGRyZXNzOiBwYXJhbXMuYWZmaWxpYXRlQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBidXlBbW91bnQ6IHBhcmFtcy5idXlBbW91bnQgPyBiaWdOdW1iZXJUb1Byb3RvKHBhcmFtcy5idXlBbW91bnQpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGJ1eVRva2VuQWRkcmVzczogcGFyYW1zLmJ1eVRva2VuLFxuICAgICAgICAgICAgICAgIGNoYWluSWQ6IHBhcmFtcy5jaGFpbklkLFxuICAgICAgICAgICAgICAgIGludGVncmF0b3JJZDogcGFyYW1zLmludGVncmF0b3JJZCxcbiAgICAgICAgICAgICAgICBxdW90ZVVuaXF1ZUlkOiBwYXJhbXMucXVvdGVVbmlxdWVJZCxcbiAgICAgICAgICAgICAgICBzZWxsQW1vdW50OiBwYXJhbXMuc2VsbEFtb3VudCA/IGJpZ051bWJlclRvUHJvdG8ocGFyYW1zLnNlbGxBbW91bnQpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHNlbGxUb2tlbkFkZHJlc3M6IHBhcmFtcy5zZWxsVG9rZW4sXG4gICAgICAgICAgICAgICAgc2xpcHBhZ2VQZXJjZW50YWdlOiBwYXJhbXMuc2xpcHBhZ2VQZXJjZW50YWdlID8gYmlnTnVtYmVyVG9Qcm90byhwYXJhbXMuc2xpcHBhZ2VQZXJjZW50YWdlKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0YWtlckFkZHJlc3M6IHBhcmFtcy50YWtlckFkZHJlc3MsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBiYXNlVVJMOiBNRVRBX1RSQU5TQUNUSU9OX1NFUlZJQ0VfUlBDX1VSTCB9LFxuICAgICAgICApO1xuICAgIH0gY2F0Y2ggKF9lKSB7XG4gICAgICAgIHN0b3BUaW1lciAmJiBzdG9wVGltZXIoeyBzdWNjZXNzOiAnZmFsc2UnIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFcnJvciBoYW5kbGluZzpcbiAgICAgICAgICpcbiAgICAgICAgICogVHdpcnAgdGhyb3dzIGFuIGVycm9yIG9mIHRoZSBmb2xsb3dpbmcgdHlwZTpcbiAgICAgICAgICogZXhwb3J0IGludGVyZmFjZSBUd2lycEVycm9yIHtcbiAgICAgICAgICogICBjb2RlOiBFcnJvckNvZGU7XG4gICAgICAgICAqICAgbXNnOiBzdHJpbmc7XG4gICAgICAgICAqICAgbWV0YT86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gICAgICAgICAqIH1cbiAgICAgICAgICpcbiAgICAgICAgICogVG8gc3VwcG9ydCB0aGUgY3VycmVudCBlcnJvciBjb2Rlcywgd2UgdHlwZSBgbWV0YWAgYXM6XG4gICAgICAgICAqICBtZXRhOiB7XG4gICAgICAgICAqICAgICB6ZXJvZXhFcnJvckNvZGU/OiBBUElFcnJvckNvZGVzLFxuICAgICAgICAgKiAgICAgdmFsaWRhdGlvbkVycm9yczogSlNPTi5zdHJpbmdpZnkoVmFsaWRhdGlvbkVycm9ySXRlbVtdKVxuICAgICAgICAgKiAgfVxuICAgICAgICAgKi9cblxuICAgICAgICBjb25zdCBlID0gX2UgYXMgVHdpcnBFcnJvcjtcbiAgICAgICAgY29uc3QgemVyb2V4RXJyb3JDb2RlID0gTnVtYmVyLmlzTmFOKHBhcnNlSW50KGUubWV0YT8uemVyb2V4RXJyb3JDb2RlID8/ICcnKSlcbiAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgOiBwYXJzZUludChlLm1ldGE/Lnplcm9leEVycm9yQ29kZSA/PyAnJyk7XG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvcnM6IFZhbGlkYXRpb25FcnJvckl0ZW1bXSA9IEpTT04ucGFyc2UoZS5tZXRhPy52YWxpZGF0aW9uRXJyb3JzID8/ICdbXScpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnM/Lmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICAgICAgdmFsaWRhdGlvbkVycm9ycz8ubWFwKCh2KSA9PiB2LnJlYXNvbikuaW5jbHVkZXMoU3dhcFF1b3RlckVycm9yLkluc3VmZmljaWVudEFzc2V0TGlxdWlkaXR5KVxuICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIExvb2tzIGxpa2UgdGhlcmUgaXMgbm8gbGlxdWlkaXR5IGZvciB0aGUgcXVvdGUuLi5cbiAgICAgICAgICAgIG5vTGlxdWlkaXR5TG9nZ2VyICYmXG4gICAgICAgICAgICAgICAgbm9MaXF1aWRpdHlMb2dnZXIoXG4gICAgICAgICAgICAgICAgICAgIHsgYW1tUXVvdGVSZXF1ZXN0UGFyYW1zOiBwYXJhbXMgfSxcbiAgICAgICAgICAgICAgICAgICAgYFtNZXRhVHJhbnNhY3Rpb25DbGllbnRdIE5vIGxpcXVpZGl0eSByZXR1cm5lZCBmb3IgcGFpcmAsXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlIHJlc3BvbnNlIGZvciBpbnN1ZmZpY2llbnQgZnVuZCBlcnJvciAocHJpbWFyaWx5IGNhdXNlZCBieSB0cmFkaW5nIGFtb3VudCBpcyBsZXNzIHRoYW4gdGhlIGZlZSlcbiAgICAgICAgLy8gaXMgYSB6ZXJvZXhHZW5lcmFsRXJyb3JDb2RlIGBJbnN1ZmZpY2llbnRGdW5kc0Vycm9yYFxuXG4gICAgICAgIGlmICh6ZXJvZXhFcnJvckNvZGUgPT09IEFQSUVycm9yQ29kZXMuSW5zdWZmaWNpZW50RnVuZHNFcnJvcikge1xuICAgICAgICAgICAgaWYgKHBhcmFtcy5zZWxsQW1vdW50KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnc2VsbEFtb3VudCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBWYWxpZGF0aW9uRXJyb3JDb2Rlcy5GaWVsZEludmFsaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFzb246ICdzZWxsQW1vdW50IHRvbyBzbWFsbCcsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdidXlBbW91bnQnLFxuICAgICAgICAgICAgICAgICAgICBjb2RlOiBWYWxpZGF0aW9uRXJyb3JDb2Rlcy5GaWVsZEludmFsaWQsXG4gICAgICAgICAgICAgICAgICAgIHJlYXNvbjogJ2J1eUFtb3VudCB0b28gc21hbGwnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGlzIGVycm9yIGlzIG5laXRoZXIgdGhlIHN0YW5kYXJkIG5vIGxpcXVpZGl0eSBlcnJvciBub3IgdGhlIGluc3VmZmljaWVudCBmdW5kIGVycm9yXG4gICAgICAgIHRocm93IGU7XG4gICAgfVxuXG4gICAgc3RvcFRpbWVyICYmIHN0b3BUaW1lcih7IHN1Y2Nlc3M6ICd0cnVlJyB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIG1ldGFUcmFuc2FjdGlvbjogbmV3IE1ldGFUcmFuc2FjdGlvbih7XG4gICAgICAgICAgICBzaWduZXI6IHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5zaWduZXJBZGRyZXNzLFxuICAgICAgICAgICAgc2VuZGVyOiByZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uc2VuZGVyQWRkcmVzcyxcbiAgICAgICAgICAgIG1pbkdhc1ByaWNlOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5taW5HYXNQcmljZSksXG4gICAgICAgICAgICBtYXhHYXNQcmljZTogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24ubWF4R2FzUHJpY2UpLFxuICAgICAgICAgICAgZXhwaXJhdGlvblRpbWVTZWNvbmRzOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5leHBpcmF0aW9uVGltZVNlY29uZHMpLFxuICAgICAgICAgICAgc2FsdDogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uc2FsdCksXG4gICAgICAgICAgICBjYWxsRGF0YTogcmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLmNhbGxEYXRhLFxuICAgICAgICAgICAgdmFsdWU6IHByb3RvVG9CaWdOdW1iZXIocmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLnZhbHVlKSxcbiAgICAgICAgICAgIGZlZVRva2VuOiByZXNwb25zZS5tZXRhVHJhbnNhY3Rpb24uZmVlVG9rZW5BZGRyZXNzLFxuICAgICAgICAgICAgZmVlQW1vdW50OiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLm1ldGFUcmFuc2FjdGlvbi5mZWVBbW91bnQpLFxuICAgICAgICAgICAgY2hhaW5JZDogcmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLmNoYWluSWQsXG4gICAgICAgICAgICB2ZXJpZnlpbmdDb250cmFjdDogcmVzcG9uc2UubWV0YVRyYW5zYWN0aW9uLnZlcmlmeWluZ0NvbnRyYWN0LFxuICAgICAgICB9KSxcbiAgICAgICAgcHJpY2U6IHtcbiAgICAgICAgICAgIGJ1eUFtb3VudDogcHJvdG9Ub0JpZ051bWJlcihyZXNwb25zZS5xdW90ZS5idXlBbW91bnQpLFxuICAgICAgICAgICAgYnV5VG9rZW5BZGRyZXNzOiByZXNwb25zZS5xdW90ZS5idXlUb2tlbkFkZHJlc3MsXG4gICAgICAgICAgICBnYXM6IHByb3RvVG9CaWdOdW1iZXIocmVzcG9uc2UucXVvdGUuZ2FzKSxcbiAgICAgICAgICAgIHByaWNlOiBwcm90b1RvQmlnTnVtYmVyKHJlc3BvbnNlLnF1b3RlLnByaWNlKSxcbiAgICAgICAgICAgIHNlbGxBbW91bnQ6IHByb3RvVG9CaWdOdW1iZXIocmVzcG9uc2UucXVvdGUuc2VsbEFtb3VudCksXG4gICAgICAgICAgICBzZWxsVG9rZW5BZGRyZXNzOiByZXNwb25zZS5xdW90ZS5zZWxsVG9rZW5BZGRyZXNzLFxuICAgICAgICB9LFxuICAgIH07XG59XG4iXSwidmVyc2lvbiI6M30=