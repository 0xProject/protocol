dc6fd2a1e03e7790db9c9de81cc08169
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const protocol_utils_1 = require("@0x/protocol-utils");
const utils_1 = require("@0x/utils");
const express = require("express");
const asyncHandler = require("express-async-handler");
const HttpStatus = require("http-status-codes");
const supertest = require("supertest");
const dummy_mm_handler_1 = require("../../src/handlers/dummy_mm_handler");
const signature_utils_1 = require("../../src/utils/signature_utils");
const POLYGON_CHAIN_ID = 137;
const USDC_POLYGON = '0x2791bca1f2de4661ed88a30c99a7a9449aa84174';
const USDT_POLYGON = '0xc2132d05d31c914a87c6611c10748aeb04b58e8f';
const MM_ADDRESS = '0x06754422cf9f54ae0e67d42fd788b33d8eb4c5d5';
const INTEGRATOR_ID = '74188355-c85b-4f18-9de4-6dec3ec61b8d';
const dummyMMHandler = new dummy_mm_handler_1.DummyMMHandlers();
const emptyOtcOrder = new protocol_utils_1.OtcOrder();
const emptyOtcOrderParam = {
    maker: emptyOtcOrder.maker,
    taker: emptyOtcOrder.taker,
    makerAmount: emptyOtcOrder.makerAmount.toString(),
    takerAmount: emptyOtcOrder.takerAmount.toString(),
    makerToken: emptyOtcOrder.makerToken,
    takerToken: emptyOtcOrder.takerToken,
    txOrigin: emptyOtcOrder.txOrigin,
    expiryAndNonce: emptyOtcOrder.expiryAndNonce.toString(),
    chainId: emptyOtcOrder.chainId.toString(),
    verifyingContract: emptyOtcOrder.verifyingContract,
};
const acceptedOtcOrder = new protocol_utils_1.OtcOrder({
    makerToken: USDC_POLYGON,
    takerToken: USDT_POLYGON,
    takerAmount: new utils_1.BigNumber('200'),
    chainId: POLYGON_CHAIN_ID,
});
const acceptedOtcOrderParam = {
    maker: acceptedOtcOrder.maker,
    taker: acceptedOtcOrder.taker,
    makerAmount: acceptedOtcOrder.makerAmount.toString(),
    takerAmount: acceptedOtcOrder.takerAmount.toString(),
    makerToken: acceptedOtcOrder.makerToken,
    takerToken: acceptedOtcOrder.takerToken,
    txOrigin: acceptedOtcOrder.txOrigin,
    expiryAndNonce: acceptedOtcOrder.expiryAndNonce.toString(),
    chainId: acceptedOtcOrder.chainId.toString(),
    verifyingContract: acceptedOtcOrder.verifyingContract,
};
const refusedOtcOrder = new protocol_utils_1.OtcOrder({
    makerToken: USDC_POLYGON,
    takerToken: USDT_POLYGON,
    takerAmount: new utils_1.BigNumber('1000000'),
    chainId: POLYGON_CHAIN_ID,
});
const refusedOtcOrderParam = {
    maker: refusedOtcOrder.maker,
    taker: refusedOtcOrder.taker,
    makerAmount: refusedOtcOrder.makerAmount.toString(),
    takerAmount: refusedOtcOrder.takerAmount.toString(),
    makerToken: refusedOtcOrder.makerToken,
    takerToken: refusedOtcOrder.takerToken,
    txOrigin: refusedOtcOrder.txOrigin,
    expiryAndNonce: refusedOtcOrder.expiryAndNonce.toString(),
    chainId: refusedOtcOrder.chainId.toString(),
    verifyingContract: refusedOtcOrder.verifyingContract,
};
describe('DummyMMHandlers', () => {
    describe('signRfqtV2Async', () => {
        it('returns BAD_REQUEST when order hash does not match with order hash query param', async () => {
            const response = await supertest(express()
                .use(express.json())
                .post('/rfqt/v2/sign', asyncHandler(dummyMMHandler.signRfqtV2Async.bind(dummyMMHandler))))
                .post('/rfqt/v2/sign')
                .set('Content-type', 'application/json')
                .send({
                order: emptyOtcOrderParam,
                orderHash: '0xrandom',
                feeAmount: '10',
                feeToken: '0xfee',
                expiry: '20',
            });
            expect(response.statusCode).toEqual(HttpStatus.BAD_REQUEST);
        });
        it('returns NO_CONTENT when tokens in the order are not part of provided liquity', async () => {
            const response = await supertest(express()
                .use(express.json())
                .post('/rfqt/v2/sign', asyncHandler(dummyMMHandler.signRfqtV2Async.bind(dummyMMHandler))))
                .post('/rfqt/v2/sign')
                .set('Content-type', 'application/json')
                .send({
                order: emptyOtcOrderParam,
                orderHash: emptyOtcOrder.getHash(),
                feeAmount: '10',
                feeToken: '0xfee',
                expiry: '20',
            });
            expect(response.statusCode).toEqual(HttpStatus.NO_CONTENT);
        });
        it('returns NO_CONTENT when the market marker refuses to sign the order', async () => {
            const response = await supertest(express()
                .use(express.json())
                .post('/rfqt/v2/sign', asyncHandler(dummyMMHandler.signRfqtV2Async.bind(dummyMMHandler))))
                .post('/rfqt/v2/sign')
                .set('Content-type', 'application/json')
                .send({
                order: refusedOtcOrderParam,
                orderHash: refusedOtcOrder.getHash(),
                feeAmount: '10',
                feeToken: '0xfee',
                expiry: '20',
            });
            expect(response.statusCode).toEqual(HttpStatus.NO_CONTENT);
        });
        it('returns OK when the market marker signs', async () => {
            const response = await supertest(express()
                .use(express.json())
                .post('/rfqt/v2/sign', asyncHandler(dummyMMHandler.signRfqtV2Async.bind(dummyMMHandler))))
                .post('/rfqt/v2/sign')
                .set('Content-type', 'application/json')
                .send({
                order: acceptedOtcOrderParam,
                orderHash: acceptedOtcOrder.getHash(),
                feeAmount: '10',
                feeToken: '0xfee',
                expiry: '20',
            });
            expect(response.statusCode).toEqual(HttpStatus.OK);
            const signer = (0, signature_utils_1.getSignerFromHash)(acceptedOtcOrder.getHash(), response.body.makerSignature);
            expect(signer).toEqual(MM_ADDRESS);
        });
    });
    describe('getQuoteRfqtV2Async', () => {
        it('returns BAD_REQUEST when missing integrator id', async () => {
            const response = await supertest(express().get('/rfqt/v2/quote', asyncHandler(dummyMMHandler.getQuoteRfqtV2Async.bind(dummyMMHandler))))
                .get('/rfqt/v2/quote')
                .query({
                sellTokenAddress: USDC_POLYGON,
                buyTokenAddress: USDT_POLYGON,
                sellAmountBaseUnits: '200',
                txOrigin: '0x123456789',
                takerAddress: '0x123456789',
                feeToken: USDC_POLYGON,
                feeAmount: '10',
                chainId: POLYGON_CHAIN_ID.toString(),
            });
            expect(response.statusCode).toEqual(HttpStatus.BAD_REQUEST);
        });
        it('returns BAD_REQUEST when integrator id is not whitelisted', async () => {
            const response = await supertest(express().get('/rfqt/v2/quote', asyncHandler(dummyMMHandler.getQuoteRfqtV2Async.bind(dummyMMHandler))))
                .get('/rfqt/v2/quote')
                .set('0x-integrator-id', '0123')
                .query({
                sellTokenAddress: USDC_POLYGON,
                buyTokenAddress: USDT_POLYGON,
                sellAmountBaseUnits: '200',
                txOrigin: '0x123456789',
                takerAddress: '0x123456789',
                feeToken: USDC_POLYGON,
                feeAmount: '10',
                chainId: POLYGON_CHAIN_ID.toString(),
                integratorId: '0123',
            });
            expect(response.statusCode).toEqual(HttpStatus.BAD_REQUEST);
        });
        it('returns NO_CONTENT when tokens in the order are not part of provided liquity', async () => {
            const response = await supertest(express().get('/rfqt/v2/quote', asyncHandler(dummyMMHandler.getQuoteRfqtV2Async.bind(dummyMMHandler))))
                .get('/rfqt/v2/quote')
                .set('0x-integrator-id', INTEGRATOR_ID)
                .query({
                sellTokenAddress: '0x1234',
                buyTokenAddress: USDT_POLYGON,
                sellAmountBaseUnits: '200',
                txOrigin: '0x123456789',
                takerAddress: '0x123456789',
                feeToken: USDC_POLYGON,
                feeAmount: '10',
                chainId: POLYGON_CHAIN_ID.toString(),
                integratorId: INTEGRATOR_ID,
            });
            expect(response.statusCode).toEqual(HttpStatus.NO_CONTENT);
        });
        it('returns NO_CONTENT when buy/sell amount > 2', async () => {
            const response = await supertest(express().get('/rfqt/v2/quote', asyncHandler(dummyMMHandler.getQuoteRfqtV2Async.bind(dummyMMHandler))))
                .get('/rfqt/v2/quote')
                .set('0x-integrator-id', INTEGRATOR_ID)
                .query({
                sellTokenAddress: USDC_POLYGON,
                buyTokenAddress: USDT_POLYGON,
                sellAmountBaseUnits: '20000000000',
                txOrigin: '0x123456789',
                takerAddress: '0x123456789',
                feeToken: USDC_POLYGON,
                feeAmount: '10',
                chainId: POLYGON_CHAIN_ID.toString(),
                integratorId: INTEGRATOR_ID,
            });
            expect(response.statusCode).toEqual(HttpStatus.NO_CONTENT);
        });
        it('returns NO_CONTENT when trading amount is considered odd', async () => {
            const response = await supertest(express().get('/rfqt/v2/quote', asyncHandler(dummyMMHandler.getQuoteRfqtV2Async.bind(dummyMMHandler))))
                .get('/rfqt/v2/quote')
                .set('0x-integrator-id', INTEGRATOR_ID)
                .query({
                sellTokenAddress: USDC_POLYGON,
                buyTokenAddress: USDT_POLYGON,
                sellAmountBaseUnits: '1000000',
                txOrigin: '0x123456789',
                takerAddress: '0x123456789',
                feeToken: USDC_POLYGON,
                feeAmount: '10',
                chainId: POLYGON_CHAIN_ID.toString(),
                integratorId: INTEGRATOR_ID,
            });
            expect(response.statusCode).toEqual(HttpStatus.NO_CONTENT);
        });
        it('returns OK the market maker signs the order', async () => {
            const response = await supertest(express().get('/rfqt/v2/quote', asyncHandler(dummyMMHandler.getQuoteRfqtV2Async.bind(dummyMMHandler))))
                .get('/rfqt/v2/quote')
                .set('0x-integrator-id', INTEGRATOR_ID)
                .query({
                sellTokenAddress: USDC_POLYGON,
                buyTokenAddress: USDT_POLYGON,
                sellAmountBaseUnits: '200',
                txOrigin: '0x123456789',
                takerAddress: '0x123456789',
                feeToken: USDC_POLYGON,
                feeAmount: '10',
                chainId: POLYGON_CHAIN_ID.toString(),
                integratorId: INTEGRATOR_ID,
            });
            expect(response.statusCode).toEqual(HttpStatus.OK);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvaGFuZGxlcnMvZHVtbXlfbW1faGFuZGxlcl90ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsdURBQThDO0FBQzlDLHFDQUFzQztBQUN0QyxtQ0FBbUM7QUFDbkMsc0RBQXNEO0FBQ3RELGdEQUFnRDtBQUNoRCx1Q0FBdUM7QUFFdkMsMEVBQXNFO0FBQ3RFLHFFQUFvRTtBQUVwRSxNQUFNLGdCQUFnQixHQUFHLEdBQUcsQ0FBQztBQUM3QixNQUFNLFlBQVksR0FBRyw0Q0FBNEMsQ0FBQztBQUNsRSxNQUFNLFlBQVksR0FBRyw0Q0FBNEMsQ0FBQztBQUNsRSxNQUFNLFVBQVUsR0FBRyw0Q0FBNEMsQ0FBQztBQUNoRSxNQUFNLGFBQWEsR0FBRyxzQ0FBc0MsQ0FBQztBQUM3RCxNQUFNLGNBQWMsR0FBRyxJQUFJLGtDQUFlLEVBQUUsQ0FBQztBQUM3QyxNQUFNLGFBQWEsR0FBRyxJQUFJLHlCQUFRLEVBQUUsQ0FBQztBQUNyQyxNQUFNLGtCQUFrQixHQUFHO0lBQ3ZCLEtBQUssRUFBRSxhQUFhLENBQUMsS0FBSztJQUMxQixLQUFLLEVBQUUsYUFBYSxDQUFDLEtBQUs7SUFDMUIsV0FBVyxFQUFFLGFBQWEsQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFO0lBQ2pELFdBQVcsRUFBRSxhQUFhLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRTtJQUNqRCxVQUFVLEVBQUUsYUFBYSxDQUFDLFVBQVU7SUFDcEMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxVQUFVO0lBQ3BDLFFBQVEsRUFBRSxhQUFhLENBQUMsUUFBUTtJQUNoQyxjQUFjLEVBQUUsYUFBYSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUU7SUFDdkQsT0FBTyxFQUFFLGFBQWEsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFO0lBQ3pDLGlCQUFpQixFQUFFLGFBQWEsQ0FBQyxpQkFBaUI7Q0FDckQsQ0FBQztBQUNGLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSx5QkFBUSxDQUFD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RUFBRSxJQUFJO2dCQUNmLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3BDLFlBQVksRUFBRSxhQUFhO2FBQzlCLENBQUMsQ0FBQztZQUVQLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RCxNQUFNLFFBQVEsR0FBRyxNQUFNLFNBQVMsQ0FDNUIsT0FBTyxFQUFFLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFlBQVksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FDekc7aUJBQ0ksR0FBRyxDQUFDLGdCQUFnQixDQUFDO2lCQUNyQixHQUFHLENBQUMsa0JBQWtCLEVBQUUsYUFBYSxDQUFDO2lCQUN0QyxLQUFLLENBQUM7Z0JBQ0gsZ0JBQWdCLEVBQUUsWUFBWTtnQkFDOUIsZUFBZSxFQUFFLFlBQVk7Z0JBQzdCLG1CQUFtQixFQUFFLEtBQUs7Z0JBQzFCLFFBQVEsRUFBRSxhQUFhO2dCQUN2QixZQUFZLEVBQUUsYUFBYTtnQkFDM0IsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFNBQVMsRUFBRSxJQUFJO2dCQUNmLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3BDLFlBQVksRUFBRSxhQUFhO2FBQzlCLENBQUMsQ0FBQztZQUVQLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvaGFuZGxlcnMvZHVtbXlfbW1faGFuZGxlcl90ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE90Y09yZGVyIH0gZnJvbSAnQDB4L3Byb3RvY29sLXV0aWxzJztcbmltcG9ydCB7IEJpZ051bWJlciB9IGZyb20gJ0AweC91dGlscyc7XG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0ICogYXMgYXN5bmNIYW5kbGVyIGZyb20gJ2V4cHJlc3MtYXN5bmMtaGFuZGxlcic7XG5pbXBvcnQgKiBhcyBIdHRwU3RhdHVzIGZyb20gJ2h0dHAtc3RhdHVzLWNvZGVzJztcbmltcG9ydCAqIGFzIHN1cGVydGVzdCBmcm9tICdzdXBlcnRlc3QnO1xuXG5pbXBvcnQgeyBEdW1teU1NSGFuZGxlcnMgfSBmcm9tICcuLi8uLi9zcmMvaGFuZGxlcnMvZHVtbXlfbW1faGFuZGxlcic7XG5pbXBvcnQgeyBnZXRTaWduZXJGcm9tSGFzaCB9IGZyb20gJy4uLy4uL3NyYy91dGlscy9zaWduYXR1cmVfdXRpbHMnO1xuXG5jb25zdCBQT0xZR09OX0NIQUlOX0lEID0gMTM3O1xuY29uc3QgVVNEQ19QT0xZR09OID0gJzB4Mjc5MWJjYTFmMmRlNDY2MWVkODhhMzBjOTlhN2E5NDQ5YWE4NDE3NCc7XG5jb25zdCBVU0RUX1BPTFlHT04gPSAnMHhjMjEzMmQwNWQzMWM5MTRhODdjNjYxMWMxMDc0OGFlYjA0YjU4ZThmJztcbmNvbnN0IE1NX0FERFJFU1MgPSAnMHgwNjc1NDQyMmNmOWY1NGFlMGU2N2Q0MmZkNzg4YjMzZDhlYjRjNWQ1JztcbmNvbnN0IElOVEVHUkFUT1JfSUQgPSAnNzQxODgzNTUtYzg1Yi00ZjE4LTlkZTQtNmRlYzNlYzYxYjhkJztcbmNvbnN0IGR1bW15TU1IYW5kbGVyID0gbmV3IER1bW15TU1IYW5kbGVycygpO1xuY29uc3QgZW1wdHlPdGNPcmRlciA9IG5ldyBPdGNPcmRlcigpO1xuY29uc3QgZW1wdHlPdGNPcmRlclBhcmFtID0ge1xuICAgIG1ha2VyOiBlbXB0eU90Y09yZGVyLm1ha2VyLFxuICAgIHRha2VyOiBlbXB0eU90Y09yZGVyLnRha2VyLFxuICAgIG1ha2VyQW1vdW50OiBlbXB0eU90Y09yZGVyLm1ha2VyQW1vdW50LnRvU3RyaW5nKCksXG4gICAgdGFrZXJBbW91bnQ6IGVtcHR5T3RjT3JkZXIudGFrZXJBbW91bnQudG9TdHJpbmcoKSxcbiAgICBtYWtlclRva2VuOiBlbXB0eU90Y09yZGVyLm1ha2VyVG9rZW4sXG4gICAgdGFrZXJUb2tlbjogZW1wdHlPdGNPcmRlci50YWtlclRva2VuLFxuICAgIHR4T3JpZ2luOiBlbXB0eU90Y09yZGVyLnR4T3JpZ2luLFxuICAgIGV4cGlyeUFuZE5vbmNlOiBlbXB0eU90Y09yZGVyLmV4cGlyeUFuZE5vbmNlLnRvU3RyaW5nKCksXG4gICAgY2hhaW5JZDogZW1wdHlPdGNPcmRlci5jaGFpbklkLnRvU3RyaW5nKCksXG4gICAgdmVyaWZ5aW5nQ29udHJhY3Q6IGVtcHR5T3RjT3JkZXIudmVyaWZ5aW5nQ29udHJhY3QsXG59O1xuY29uc3QgYWNjZXB0ZWRPdGNPcmRlciA9IG5ldyBPdGNPcmRlcih7XG4gICAgbWFrZXJUb2tlbjogVVNEQ19QT0xZR09OLFxuICAgIHRha2VyVG9rZW46IFVTRFRfUE9MWUdPTixcbiAgICB0YWtlckFtb3VudDogbmV3IEJpZ051bWJlcignMjAwJyksXG4gICAgY2hhaW5JZDogUE9MWUdPTl9DSEFJTl9JRCxcbn0pO1xuY29uc3QgYWNjZXB0ZWRPdGNPcmRlclBhcmFtID0ge1xuICAgIG1ha2VyOiBhY2NlcHRlZE90Y09yZGVyLm1ha2VyLFxuICAgIHRha2VyOiBhY2NlcHRlZE90Y09yZGVyLnRha2VyLFxuICAgIG1ha2VyQW1vdW50OiBhY2NlcHRlZE90Y09yZGVyLm1ha2VyQW1vdW50LnRvU3RyaW5nKCksXG4gICAgdGFrZXJBbW91bnQ6IGFjY2VwdGVkT3RjT3JkZXIudGFrZXJBbW91bnQudG9TdHJpbmcoKSxcbiAgICBtYWtlclRva2VuOiBhY2NlcHRlZE90Y09yZGVyLm1ha2VyVG9rZW4sXG4gICAgdGFrZXJUb2tlbjogYWNjZXB0ZWRPdGNPcmRlci50YWtlclRva2VuLFxuICAgIHR4T3JpZ2luOiBhY2NlcHRlZE90Y09yZGVyLnR4T3JpZ2luLFxuICAgIGV4cGlyeUFuZE5vbmNlOiBhY2NlcHRlZE90Y09yZGVyLmV4cGlyeUFuZE5vbmNlLnRvU3RyaW5nKCksXG4gICAgY2hhaW5JZDogYWNjZXB0ZWRPdGNPcmRlci5jaGFpbklkLnRvU3RyaW5nKCksXG4gICAgdmVyaWZ5aW5nQ29udHJhY3Q6IGFjY2VwdGVkT3RjT3JkZXIudmVyaWZ5aW5nQ29udHJhY3QsXG59O1xuY29uc3QgcmVmdXNlZE90Y09yZGVyID0gbmV3IE90Y09yZGVyKHtcbiAgICBtYWtlclRva2VuOiBVU0RDX1BPTFlHT04sXG4gICAgdGFrZXJUb2tlbjogVVNEVF9QT0xZR09OLFxuICAgIHRha2VyQW1vdW50OiBuZXcgQmlnTnVtYmVyKCcxMDAwMDAwJyksXG4gICAgY2hhaW5JZDogUE9MWUdPTl9DSEFJTl9JRCxcbn0pO1xuY29uc3QgcmVmdXNlZE90Y09yZGVyUGFyYW0gPSB7XG4gICAgbWFrZXI6IHJlZnVzZWRPdGNPcmRlci5tYWtlcixcbiAgICB0YWtlcjogcmVmdXNlZE90Y09yZGVyLnRha2VyLFxuICAgIG1ha2VyQW1vdW50OiByZWZ1c2VkT3RjT3JkZXIubWFrZXJBbW91bnQudG9TdHJpbmcoKSxcbiAgICB0YWtlckFtb3VudDogcmVmdXNlZE90Y09yZGVyLnRha2VyQW1vdW50LnRvU3RyaW5nKCksXG4gICAgbWFrZXJUb2tlbjogcmVmdXNlZE90Y09yZGVyLm1ha2VyVG9rZW4sXG4gICAgdGFrZXJUb2tlbjogcmVmdXNlZE90Y09yZGVyLnRha2VyVG9rZW4sXG4gICAgdHhPcmlnaW46IHJlZnVzZWRPdGNPcmRlci50eE9yaWdpbixcbiAgICBleHBpcnlBbmROb25jZTogcmVmdXNlZE90Y09yZGVyLmV4cGlyeUFuZE5vbmNlLnRvU3RyaW5nKCksXG4gICAgY2hhaW5JZDogcmVmdXNlZE90Y09yZGVyLmNoYWluSWQudG9TdHJpbmcoKSxcbiAgICB2ZXJpZnlpbmdDb250cmFjdDogcmVmdXNlZE90Y09yZGVyLnZlcmlmeWluZ0NvbnRyYWN0LFxufTtcblxuZGVzY3JpYmUoJ0R1bW15TU1IYW5kbGVycycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnc2lnblJmcXRWMkFzeW5jJywgKCkgPT4ge1xuICAgICAgICBpdCgncmV0dXJucyBCQURfUkVRVUVTVCB3aGVuIG9yZGVyIGhhc2ggZG9lcyBub3QgbWF0Y2ggd2l0aCBvcmRlciBoYXNoIHF1ZXJ5IHBhcmFtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpXG4gICAgICAgICAgICAgICAgICAgIC51c2UoZXhwcmVzcy5qc29uKCkpXG4gICAgICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJywgYXN5bmNIYW5kbGVyKGR1bW15TU1IYW5kbGVyLnNpZ25SZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJylcbiAgICAgICAgICAgICAgICAuc2V0KCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgICAgICAgICBvcmRlcjogZW1wdHlPdGNPcmRlclBhcmFtLFxuICAgICAgICAgICAgICAgICAgICBvcmRlckhhc2g6ICcweHJhbmRvbScsXG4gICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwJyxcbiAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW46ICcweGZlZScsXG4gICAgICAgICAgICAgICAgICAgIGV4cGlyeTogJzIwJyxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvRXF1YWwoSHR0cFN0YXR1cy5CQURfUkVRVUVTVCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdyZXR1cm5zIE5PX0NPTlRFTlQgd2hlbiB0b2tlbnMgaW4gdGhlIG9yZGVyIGFyZSBub3QgcGFydCBvZiBwcm92aWRlZCBsaXF1aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpXG4gICAgICAgICAgICAgICAgICAgIC51c2UoZXhwcmVzcy5qc29uKCkpXG4gICAgICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJywgYXN5bmNIYW5kbGVyKGR1bW15TU1IYW5kbGVyLnNpZ25SZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJylcbiAgICAgICAgICAgICAgICAuc2V0KCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgICAgICAgICBvcmRlcjogZW1wdHlPdGNPcmRlclBhcmFtLFxuICAgICAgICAgICAgICAgICAgICBvcmRlckhhc2g6IGVtcHR5T3RjT3JkZXIuZ2V0SGFzaCgpLFxuICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMCcsXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiAnMHhmZWUnLFxuICAgICAgICAgICAgICAgICAgICBleHBpcnk6ICcyMCcsXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXNDb2RlKS50b0VxdWFsKEh0dHBTdGF0dXMuTk9fQ09OVEVOVCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdyZXR1cm5zIE5PX0NPTlRFTlQgd2hlbiB0aGUgbWFya2V0IG1hcmtlciByZWZ1c2VzIHRvIHNpZ24gdGhlIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpXG4gICAgICAgICAgICAgICAgICAgIC51c2UoZXhwcmVzcy5qc29uKCkpXG4gICAgICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJywgYXN5bmNIYW5kbGVyKGR1bW15TU1IYW5kbGVyLnNpZ25SZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJylcbiAgICAgICAgICAgICAgICAuc2V0KCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgICAgICAgICBvcmRlcjogcmVmdXNlZE90Y09yZGVyUGFyYW0sXG4gICAgICAgICAgICAgICAgICAgIG9yZGVySGFzaDogcmVmdXNlZE90Y09yZGVyLmdldEhhc2goKSxcbiAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiAnMTAnLFxuICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogJzB4ZmVlJyxcbiAgICAgICAgICAgICAgICAgICAgZXhwaXJ5OiAnMjAnLFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzQ29kZSkudG9FcXVhbChIdHRwU3RhdHVzLk5PX0NPTlRFTlQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgncmV0dXJucyBPSyB3aGVuIHRoZSBtYXJrZXQgbWFya2VyIHNpZ25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpXG4gICAgICAgICAgICAgICAgICAgIC51c2UoZXhwcmVzcy5qc29uKCkpXG4gICAgICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJywgYXN5bmNIYW5kbGVyKGR1bW15TU1IYW5kbGVyLnNpZ25SZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5wb3N0KCcvcmZxdC92Mi9zaWduJylcbiAgICAgICAgICAgICAgICAuc2V0KCdDb250ZW50LXR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgICAgICAgICBvcmRlcjogYWNjZXB0ZWRPdGNPcmRlclBhcmFtLFxuICAgICAgICAgICAgICAgICAgICBvcmRlckhhc2g6IGFjY2VwdGVkT3RjT3JkZXIuZ2V0SGFzaCgpLFxuICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMCcsXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiAnMHhmZWUnLFxuICAgICAgICAgICAgICAgICAgICBleHBpcnk6ICcyMCcsXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXNDb2RlKS50b0VxdWFsKEh0dHBTdGF0dXMuT0spO1xuICAgICAgICAgICAgY29uc3Qgc2lnbmVyID0gZ2V0U2lnbmVyRnJvbUhhc2goYWNjZXB0ZWRPdGNPcmRlci5nZXRIYXNoKCksIHJlc3BvbnNlLmJvZHkubWFrZXJTaWduYXR1cmUpO1xuICAgICAgICAgICAgZXhwZWN0KHNpZ25lcikudG9FcXVhbChNTV9BRERSRVNTKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZ2V0UXVvdGVSZnF0VjJBc3luYycsICgpID0+IHtcbiAgICAgICAgaXQoJ3JldHVybnMgQkFEX1JFUVVFU1Qgd2hlbiBtaXNzaW5nIGludGVncmF0b3IgaWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHN1cGVydGVzdChcbiAgICAgICAgICAgICAgICBleHByZXNzKCkuZ2V0KCcvcmZxdC92Mi9xdW90ZScsIGFzeW5jSGFuZGxlcihkdW1teU1NSGFuZGxlci5nZXRRdW90ZVJmcXRWMkFzeW5jLmJpbmQoZHVtbXlNTUhhbmRsZXIpKSksXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLmdldCgnL3JmcXQvdjIvcXVvdGUnKVxuICAgICAgICAgICAgICAgIC5xdWVyeSh7XG4gICAgICAgICAgICAgICAgICAgIHNlbGxUb2tlbkFkZHJlc3M6IFVTRENfUE9MWUdPTixcbiAgICAgICAgICAgICAgICAgICAgYnV5VG9rZW5BZGRyZXNzOiBVU0RUX1BPTFlHT04sXG4gICAgICAgICAgICAgICAgICAgIHNlbGxBbW91bnRCYXNlVW5pdHM6ICcyMDAnLFxuICAgICAgICAgICAgICAgICAgICB0eE9yaWdpbjogJzB4MTIzNDU2Nzg5JyxcbiAgICAgICAgICAgICAgICAgICAgdGFrZXJBZGRyZXNzOiAnMHgxMjM0NTY3ODknLFxuICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogVVNEQ19QT0xZR09OLFxuICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMCcsXG4gICAgICAgICAgICAgICAgICAgIGNoYWluSWQ6IFBPTFlHT05fQ0hBSU5fSUQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvRXF1YWwoSHR0cFN0YXR1cy5CQURfUkVRVUVTVCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdyZXR1cm5zIEJBRF9SRVFVRVNUIHdoZW4gaW50ZWdyYXRvciBpZCBpcyBub3Qgd2hpdGVsaXN0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHN1cGVydGVzdChcbiAgICAgICAgICAgICAgICBleHByZXNzKCkuZ2V0KCcvcmZxdC92Mi9xdW90ZScsIGFzeW5jSGFuZGxlcihkdW1teU1NSGFuZGxlci5nZXRRdW90ZVJmcXRWMkFzeW5jLmJpbmQoZHVtbXlNTUhhbmRsZXIpKSksXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLmdldCgnL3JmcXQvdjIvcXVvdGUnKVxuICAgICAgICAgICAgICAgIC5zZXQoJzB4LWludGVncmF0b3ItaWQnLCAnMDEyMycpXG4gICAgICAgICAgICAgICAgLnF1ZXJ5KHtcbiAgICAgICAgICAgICAgICAgICAgc2VsbFRva2VuQWRkcmVzczogVVNEQ19QT0xZR09OLFxuICAgICAgICAgICAgICAgICAgICBidXlUb2tlbkFkZHJlc3M6IFVTRFRfUE9MWUdPTixcbiAgICAgICAgICAgICAgICAgICAgc2VsbEFtb3VudEJhc2VVbml0czogJzIwMCcsXG4gICAgICAgICAgICAgICAgICAgIHR4T3JpZ2luOiAnMHgxMjM0NTY3ODknLFxuICAgICAgICAgICAgICAgICAgICB0YWtlckFkZHJlc3M6ICcweDEyMzQ1Njc4OScsXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBVU0RDX1BPTFlHT04sXG4gICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwJyxcbiAgICAgICAgICAgICAgICAgICAgY2hhaW5JZDogUE9MWUdPTl9DSEFJTl9JRC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBpbnRlZ3JhdG9ySWQ6ICcwMTIzJyxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvRXF1YWwoSHR0cFN0YXR1cy5CQURfUkVRVUVTVCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdyZXR1cm5zIE5PX0NPTlRFTlQgd2hlbiB0b2tlbnMgaW4gdGhlIG9yZGVyIGFyZSBub3QgcGFydCBvZiBwcm92aWRlZCBsaXF1aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpLmdldCgnL3JmcXQvdjIvcXVvdGUnLCBhc3luY0hhbmRsZXIoZHVtbXlNTUhhbmRsZXIuZ2V0UXVvdGVSZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5nZXQoJy9yZnF0L3YyL3F1b3RlJylcbiAgICAgICAgICAgICAgICAuc2V0KCcweC1pbnRlZ3JhdG9yLWlkJywgSU5URUdSQVRPUl9JRClcbiAgICAgICAgICAgICAgICAucXVlcnkoe1xuICAgICAgICAgICAgICAgICAgICBzZWxsVG9rZW5BZGRyZXNzOiAnMHgxMjM0JyxcbiAgICAgICAgICAgICAgICAgICAgYnV5VG9rZW5BZGRyZXNzOiBVU0RUX1BPTFlHT04sXG4gICAgICAgICAgICAgICAgICAgIHNlbGxBbW91bnRCYXNlVW5pdHM6ICcyMDAnLFxuICAgICAgICAgICAgICAgICAgICB0eE9yaWdpbjogJzB4MTIzNDU2Nzg5JyxcbiAgICAgICAgICAgICAgICAgICAgdGFrZXJBZGRyZXNzOiAnMHgxMjM0NTY3ODknLFxuICAgICAgICAgICAgICAgICAgICBmZWVUb2tlbjogVVNEQ19QT0xZR09OLFxuICAgICAgICAgICAgICAgICAgICBmZWVBbW91bnQ6ICcxMCcsXG4gICAgICAgICAgICAgICAgICAgIGNoYWluSWQ6IFBPTFlHT05fQ0hBSU5fSUQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaW50ZWdyYXRvcklkOiBJTlRFR1JBVE9SX0lELFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzQ29kZSkudG9FcXVhbChIdHRwU3RhdHVzLk5PX0NPTlRFTlQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgncmV0dXJucyBOT19DT05URU5UIHdoZW4gYnV5L3NlbGwgYW1vdW50ID4gMicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3VwZXJ0ZXN0KFxuICAgICAgICAgICAgICAgIGV4cHJlc3MoKS5nZXQoJy9yZnF0L3YyL3F1b3RlJywgYXN5bmNIYW5kbGVyKGR1bW15TU1IYW5kbGVyLmdldFF1b3RlUmZxdFYyQXN5bmMuYmluZChkdW1teU1NSGFuZGxlcikpKSxcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAuZ2V0KCcvcmZxdC92Mi9xdW90ZScpXG4gICAgICAgICAgICAgICAgLnNldCgnMHgtaW50ZWdyYXRvci1pZCcsIElOVEVHUkFUT1JfSUQpXG4gICAgICAgICAgICAgICAgLnF1ZXJ5KHtcbiAgICAgICAgICAgICAgICAgICAgc2VsbFRva2VuQWRkcmVzczogVVNEQ19QT0xZR09OLFxuICAgICAgICAgICAgICAgICAgICBidXlUb2tlbkFkZHJlc3M6IFVTRFRfUE9MWUdPTixcbiAgICAgICAgICAgICAgICAgICAgc2VsbEFtb3VudEJhc2VVbml0czogJzIwMDAwMDAwMDAwJyxcbiAgICAgICAgICAgICAgICAgICAgdHhPcmlnaW46ICcweDEyMzQ1Njc4OScsXG4gICAgICAgICAgICAgICAgICAgIHRha2VyQWRkcmVzczogJzB4MTIzNDU2Nzg5JyxcbiAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW46IFVTRENfUE9MWUdPTixcbiAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiAnMTAnLFxuICAgICAgICAgICAgICAgICAgICBjaGFpbklkOiBQT0xZR09OX0NIQUlOX0lELnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JJZDogSU5URUdSQVRPUl9JRCxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvRXF1YWwoSHR0cFN0YXR1cy5OT19DT05URU5UKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3JldHVybnMgTk9fQ09OVEVOVCB3aGVuIHRyYWRpbmcgYW1vdW50IGlzIGNvbnNpZGVyZWQgb2RkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpLmdldCgnL3JmcXQvdjIvcXVvdGUnLCBhc3luY0hhbmRsZXIoZHVtbXlNTUhhbmRsZXIuZ2V0UXVvdGVSZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5nZXQoJy9yZnF0L3YyL3F1b3RlJylcbiAgICAgICAgICAgICAgICAuc2V0KCcweC1pbnRlZ3JhdG9yLWlkJywgSU5URUdSQVRPUl9JRClcbiAgICAgICAgICAgICAgICAucXVlcnkoe1xuICAgICAgICAgICAgICAgICAgICBzZWxsVG9rZW5BZGRyZXNzOiBVU0RDX1BPTFlHT04sXG4gICAgICAgICAgICAgICAgICAgIGJ1eVRva2VuQWRkcmVzczogVVNEVF9QT0xZR09OLFxuICAgICAgICAgICAgICAgICAgICBzZWxsQW1vdW50QmFzZVVuaXRzOiAnMTAwMDAwMCcsXG4gICAgICAgICAgICAgICAgICAgIHR4T3JpZ2luOiAnMHgxMjM0NTY3ODknLFxuICAgICAgICAgICAgICAgICAgICB0YWtlckFkZHJlc3M6ICcweDEyMzQ1Njc4OScsXG4gICAgICAgICAgICAgICAgICAgIGZlZVRva2VuOiBVU0RDX1BPTFlHT04sXG4gICAgICAgICAgICAgICAgICAgIGZlZUFtb3VudDogJzEwJyxcbiAgICAgICAgICAgICAgICAgICAgY2hhaW5JZDogUE9MWUdPTl9DSEFJTl9JRC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBpbnRlZ3JhdG9ySWQ6IElOVEVHUkFUT1JfSUQsXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXNDb2RlKS50b0VxdWFsKEh0dHBTdGF0dXMuTk9fQ09OVEVOVCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdyZXR1cm5zIE9LIHRoZSBtYXJrZXQgbWFrZXIgc2lnbnMgdGhlIG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdXBlcnRlc3QoXG4gICAgICAgICAgICAgICAgZXhwcmVzcygpLmdldCgnL3JmcXQvdjIvcXVvdGUnLCBhc3luY0hhbmRsZXIoZHVtbXlNTUhhbmRsZXIuZ2V0UXVvdGVSZnF0VjJBc3luYy5iaW5kKGR1bW15TU1IYW5kbGVyKSkpLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5nZXQoJy9yZnF0L3YyL3F1b3RlJylcbiAgICAgICAgICAgICAgICAuc2V0KCcweC1pbnRlZ3JhdG9yLWlkJywgSU5URUdSQVRPUl9JRClcbiAgICAgICAgICAgICAgICAucXVlcnkoe1xuICAgICAgICAgICAgICAgICAgICBzZWxsVG9rZW5BZGRyZXNzOiBVU0RDX1BPTFlHT04sXG4gICAgICAgICAgICAgICAgICAgIGJ1eVRva2VuQWRkcmVzczogVVNEVF9QT0xZR09OLFxuICAgICAgICAgICAgICAgICAgICBzZWxsQW1vdW50QmFzZVVuaXRzOiAnMjAwJyxcbiAgICAgICAgICAgICAgICAgICAgdHhPcmlnaW46ICcweDEyMzQ1Njc4OScsXG4gICAgICAgICAgICAgICAgICAgIHRha2VyQWRkcmVzczogJzB4MTIzNDU2Nzg5JyxcbiAgICAgICAgICAgICAgICAgICAgZmVlVG9rZW46IFVTRENfUE9MWUdPTixcbiAgICAgICAgICAgICAgICAgICAgZmVlQW1vdW50OiAnMTAnLFxuICAgICAgICAgICAgICAgICAgICBjaGFpbklkOiBQT0xZR09OX0NIQUlOX0lELnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGludGVncmF0b3JJZDogSU5URUdSQVRPUl9JRCxcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1c0NvZGUpLnRvRXF1YWwoSHR0cFN0YXR1cy5PSyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=