641aed95d7b3c3fe30ac665708b96310
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkWorkerHeartbeatsAsync = exports.checkSqsQueueAsync = exports.getHttpIssues = exports.transformResultToShortResponse = exports.computeHealthCheckAsync = exports.HealthCheckStatus = void 0;
const utils_1 = require("@0x/utils");
const prom_client_1 = require("prom-client");
const constants_1 = require("../core/constants");
const SQS_QUEUE_SIZE_DEGRADED_THRESHOLD = 10; // More messages sitting in queue than this will cause a DEGRADED issue
const SQS_QUEUE_SIZE_FAILED_THRESHOLD = 20; // More messages sitting in queue than this will cause a FAILED issue
const RECENT_HEARTBEAT_AGE_THRESHOLD = 5; // (minutes) Heartbeats older than this will produce a DEGRADED issue. A FAILED issue is produced if NO heartbeats are newer than this.
const BALANCE_FAILED_THRESHOLD = 0.04; // (eth) If NO worker has a balance higher than this, a FAILED issue gets created.
// tslint:disable-next-line: custom-no-magic-numbers
const BALANCE_DEGRADED_THRESHOLD = 0.1; // (eth) If < 2 workers have a balance lower than this, a DEGRADED issue gets created.
const MS_IN_MINUTE = 60000;
const BALANCE_DEGRADED_THRESHOLD_WEI = new utils_1.BigNumber(BALANCE_DEGRADED_THRESHOLD).shiftedBy(constants_1.ETH_DECIMALS);
const BALANCE_FAILED_THRESHOLD_WEI = new utils_1.BigNumber(BALANCE_FAILED_THRESHOLD).shiftedBy(constants_1.ETH_DECIMALS);
const RFQM_HEALTH_CHECK_ISSUE_GAUGE = new prom_client_1.Gauge({
    name: 'rfqm_health_check_issue_gauge',
    labelNames: ['label' /* :HealthCheckLabel */, 'chain_id'],
    help: 'Gauge indicating the current status for each label. Value corresponds to the `statusSeverity`',
});
const RFQM_TOTAL_SYSTEM_TRADE_CAPACITY_GAUGE = new prom_client_1.Gauge({
    name: 'rfqm_total_system_trade_capacity',
    labelNames: ['chain_id'],
    help: 'Total amount of ETH in the worker pool divided by the current expected gas of a trade',
});
var HealthCheckStatus;
(function (HealthCheckStatus) {
    HealthCheckStatus["Operational"] = "operational";
    HealthCheckStatus["Maintenance"] = "maintenance";
    HealthCheckStatus["Degraded"] = "degraded";
    HealthCheckStatus["Failed"] = "failed";
})(HealthCheckStatus = exports.HealthCheckStatus || (exports.HealthCheckStatus = {}));
/**
 * Produces a full health check from the given inupts.
 */
async function computeHealthCheckAsync(isMaintainenceMode, offerings, producer, heartbeats, chainId, gasPrice) {
    const pairs = transformPairs(offerings);
    const httpIssues = getHttpIssues(isMaintainenceMode);
    const httpStatus = getWorstStatus(httpIssues.map((issue) => issue.status));
    const queueIssues = await checkSqsQueueAsync(producer);
    const heartbeatIssues = await checkWorkerHeartbeatsAsync(heartbeats);
    const workersIssues = [...queueIssues, ...heartbeatIssues];
    const workersStatus = getWorstStatus(workersIssues.map((issue) => issue.status));
    // Prometheus counters
    const severityByLabel = {
        'RFQM_MAINTENANCE_MODE config `true`': statusSeverity(HealthCheckStatus.Operational),
        'queue size': statusSeverity(HealthCheckStatus.Operational),
        'worker balance': statusSeverity(HealthCheckStatus.Operational),
        'worker heartbeat': statusSeverity(HealthCheckStatus.Operational),
    };
    [...httpIssues, ...workersIssues].forEach((issue) => (severityByLabel[issue.label] = Math.max(severityByLabel[issue.label], statusSeverity(issue.status))));
    Object.entries(severityByLabel).forEach(([label, severity]) => {
        RFQM_HEALTH_CHECK_ISSUE_GAUGE.labels(label, chainId.toString()).set(severity);
    });
    if (gasPrice) {
        // Note that this gauge is an estimation of the total number of trades, since two workers could have
        // 50% of the amount for one trade and the gauge would show 1 but the actual capacity would be 0.
        const totalWorkerBalance = heartbeats.reduce((total, { balance }) => total.plus(balance), new utils_1.BigNumber(0));
        const totalSystemTradeCapacity = totalWorkerBalance.div(gasPrice.times(constants_1.RFQM_TX_GAS_ESTIMATE));
        RFQM_TOTAL_SYSTEM_TRADE_CAPACITY_GAUGE.labels(chainId.toString()).set(totalSystemTradeCapacity.toNumber());
    }
    return {
        status: getWorstStatus([httpStatus, workersStatus]),
        pairs,
        http: { status: httpStatus, issues: httpIssues },
        workers: { status: workersStatus, issues: workersIssues },
    };
}
exports.computeHealthCheckAsync = computeHealthCheckAsync;
/**
 * Transform the full health check result into the minimal response the Matcha UI requires.
 */
function transformResultToShortResponse(result) {
    return {
        isOperational: result.status === HealthCheckStatus.Operational || result.status === HealthCheckStatus.Degraded,
        pairs: Object.entries(result.pairs)
            .filter(([_pair, status]) => status === HealthCheckStatus.Operational || status === HealthCheckStatus.Degraded)
            .map(([pair, _status]) => {
            const [tokenA, tokenB] = pair.split('-');
            return [tokenA, tokenB];
        }),
    };
}
exports.transformResultToShortResponse = transformResultToShortResponse;
/**
 * Changes the set of trading pairs from the format used in config to the format used in the health check response.
 */
function transformPairs(offerings) {
    return Object.values(offerings)
        .flat()
        .reduce((result, pair) => {
        const [tokenA, tokenB] = pair.sort();
        // Currently, we assume all pairs are operation. In the future, this may not be the case.
        result[`${tokenA}-${tokenB}`] = HealthCheckStatus.Operational;
        return result;
    }, {});
}
/**
 * Creates issues related to the server/API not specific to the worker farm.
 */
function getHttpIssues(isMaintainenceMode) {
    const issues = [];
    if (isMaintainenceMode) {
        issues.push({
            status: HealthCheckStatus.Maintenance,
            description: 'RFQM is set to maintainence mode via the 0x API configuration',
            label: 'RFQM_MAINTENANCE_MODE config `true`',
        });
    }
    return issues;
}
exports.getHttpIssues = getHttpIssues;
/**
 * Runs checks on the SQS queue to detect if there are messages piling up.
 */
async function checkSqsQueueAsync(producer) {
    const results = [];
    const messagesInQueue = await producer.queueSize();
    if (messagesInQueue === 0) {
        return results;
    }
    if (messagesInQueue > SQS_QUEUE_SIZE_FAILED_THRESHOLD) {
        results.push({
            status: HealthCheckStatus.Failed,
            description: `SQS queue contains ${messagesInQueue} messages (threshold is ${SQS_QUEUE_SIZE_FAILED_THRESHOLD})`,
            label: 'queue size',
        });
    }
    else if (messagesInQueue > SQS_QUEUE_SIZE_DEGRADED_THRESHOLD) {
        results.push({
            status: HealthCheckStatus.Degraded,
            description: `SQS queue contains ${messagesInQueue} messages (threshold is ${SQS_QUEUE_SIZE_DEGRADED_THRESHOLD})`,
            label: 'queue size',
        });
    }
    return results;
}
exports.checkSqsQueueAsync = checkSqsQueueAsync;
/**
 * Returns a numerical value which corresponds to the "severity" of a `HealthCheckStatus` enum member.
 * Higher values are more severe. (Oh to have SwiftLang enums here.)
 */
function statusSeverity(status) {
    // tslint:disable custom-no-magic-numbers
    switch (status) {
        case HealthCheckStatus.Failed:
            return 4;
        case HealthCheckStatus.Maintenance:
            return 3;
        case HealthCheckStatus.Degraded:
            return 2;
        case HealthCheckStatus.Operational:
            return 1;
        default:
            throw new Error(`Received unknown status: ${status}`);
    }
    // tslint:enable custom-no-magic-numbers
}
/**
 * Accepts a list of statuses and returns the worst status
 */
function getWorstStatus(statuses) {
    if (!statuses.length) {
        return HealthCheckStatus.Operational;
    }
    return statuses.reduce((worstStatus, currentStatus) => statusSeverity(currentStatus) > statusSeverity(worstStatus) ? currentStatus : worstStatus, HealthCheckStatus.Operational);
}
/**
 * Looks at the worker heartbeats and produces appropriate issues based on the age
 * of the heartbeats and the worker balances.
 *
 * Heartbeat Age: Checks the most recent heartbeat and produces a FAILED issue if it is older than the failed
 * threshold. For heartbeats other than the most recent, will only produce a DEGRADED issue. (i.e. the check only
 * fails if ALL workers are stuck)
 *
 * Worker Balance: Like with the age check, this only produces a FAILED issue if all workers are below the failed
 * balance. Individual worker balances produce a DEGRADED issue if they are below BALANCE_DEGRADED_THRESHOLD.
 *
 * Current date is an optional parameter for testing.
 */
async function checkWorkerHeartbeatsAsync(heartbeats, nowDate = new Date()) {
    const results = [];
    if (!heartbeats.length) {
        return [
            {
                status: HealthCheckStatus.Failed,
                description: 'No worker heartbeats were found',
                label: 'worker heartbeat',
            },
        ];
    }
    // Heartbeat Age
    const sortedHeartbeats = heartbeats.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());
    const newestHeartbeat = sortedHeartbeats[0];
    const newestHeartbeatAgeMinutes = (nowDate.getTime() - newestHeartbeat.timestamp.getTime()) / MS_IN_MINUTE;
    if (newestHeartbeatAgeMinutes > RECENT_HEARTBEAT_AGE_THRESHOLD) {
        results.push({
            status: HealthCheckStatus.Failed,
            description: `No worker has published a heartbeat in the last ${RECENT_HEARTBEAT_AGE_THRESHOLD} minutes`,
            label: 'worker heartbeat',
        });
    }
    // TODO (rhinodavid): Think about how this will work when we downscale and a worker isn't producing new
    // hearbeats because it's been removed.
    sortedHeartbeats.forEach(({ index, timestamp, address }) => {
        const heartbeatAgeMinutes = (nowDate.getTime() - timestamp.getTime()) / MS_IN_MINUTE;
        if (heartbeatAgeMinutes >= RECENT_HEARTBEAT_AGE_THRESHOLD) {
            results.push({
                status: HealthCheckStatus.Degraded,
                description: `Worker ${index} (${address}) last heartbeat was ${heartbeatAgeMinutes} ago`,
                label: 'worker heartbeat',
            });
        }
    });
    // Balances
    const heartbeatsAboveCriticalBalanceThreshold = heartbeats.filter(({ balance }) => balance.isGreaterThanOrEqualTo(BALANCE_FAILED_THRESHOLD_WEI));
    if (heartbeatsAboveCriticalBalanceThreshold.length === 0) {
        results.push({
            status: HealthCheckStatus.Failed,
            description: `No worker has a balance greater than the failed threshold (${BALANCE_FAILED_THRESHOLD})`,
            label: 'worker heartbeat',
        });
    }
    const heartbeatsAboveDegradedBalanceThreshold = heartbeats.filter(({ balance }) => balance.isGreaterThan(BALANCE_DEGRADED_THRESHOLD_WEI));
    if (heartbeatsAboveDegradedBalanceThreshold.length < 2) {
        results.push({
            status: HealthCheckStatus.Degraded,
            description: `Less than two workers have a balance above the degraded threshold (${BALANCE_DEGRADED_THRESHOLD})`,
            label: 'worker heartbeat',
        });
    }
    return results;
}
exports.checkWorkerHeartbeatsAsync = checkWorkerHeartbeatsAsync;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9yZnFtX2hlYWx0aF9jaGVjay50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxxQ0FBc0M7QUFDdEMsNkNBQW9DO0FBR3BDLGlEQUF1RTtBQUl2RSxNQUFNLGlDQUFpQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLHVFQUF1RTtBQUNySCxNQUFNLCtCQUErQixHQUFHLEVBQUUsQ0FBQyxDQUFDLHFFQUFxRTtBQUVqSCxNQUFNLDhCQUE4QixHQUFHLENBQUMsQ0FBQyxDQUFDLHVJQUF1STtBQUVqTCxNQUFNLHdCQUF3QixHQUFHLElBQUksQ0FBQyxDQUFDLGtGQUFrRjtBQUN6SCxvREFBb0Q7QUFDcEQsTUFBTSwwQkFBMEIsR0FBRyxHQUFHLENBQUMsQ0FBQyxzRkFBc0Y7QUFFOUgsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDO0FBRTNCLE1BQU0sOEJBQThCLEdBQUcsSUFBSSxpQkFBUyxDQUFDLDBCQUEwQixDQUFDLENBQUMsU0FBUyxDQUFDLHdCQUFZLENBQUMsQ0FBQztBQUN6RyxNQUFNLDRCQUE0QixHQUFHLElBQUksaUJBQVMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLFNBQVMsQ0FBQyx3QkFBWSxDQUFDLENBQUM7QUFFckcsTUFBTSw2QkFBNkIsR0FBRyxJQUFJLG1CQUFLLENBQUM7SUFDNUMsSUFBSSxFQUFFLCtCQUErQjtJQUNyQyxVQUFVLEVBQUUsQ0FBQyxPQUFPLENBQUMsdUJBQXVCLEVBQUUsVUFBVSxDQUFDO0lBQ3pELElBQUksRUFBRSwrRkFBK0Y7Q0FDeEcsQ0FBQyxDQUFDO0FBRUgsTUFBTSxzQ0FBc0MsR0FBRyxJQUFJLG1CQUFLLENBQUM7SUFDckQsSUFBSSxFQUFFLGtDQUFrQztJQUN4QyxVQUFVLEVBQUUsQ0FBQyxVQUFVLENBQUM7SUFDeEIsSUFBSSxFQUFFLHVGQUF1RjtDQUNoRyxDQUFDLENBQUM7QUFFSCxJQUFZLGlCQUtYO0FBTEQsV0FBWSxpQkFBaUI7SUFDekIsZ0RBQTJCLENB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QyxJQUFJLENBQUM7Z0JBQ1QsTUFBTSxFQUFFLGlCQUFpQixDQUFDLFFBQVE7Z0JBQ2xDLFdBQVcsRUFBRSxVQUFVLEtBQUssS0FBSyxPQUFPLHdCQUF3QixtQkFBbUIsTUFBTTtnQkFDekYsS0FBSyxFQUFFLGtCQUFrQjthQUM1QixDQUFDLENBQUM7U0FDTjtJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsV0FBVztJQUNYLE1BQU0sdUNBQXVDLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUM5RSxPQUFPLENBQUMsc0JBQXNCLENBQUMsNEJBQTRCLENBQUMsQ0FDL0QsQ0FBQztJQUNGLElBQUksdUNBQXVDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUN0RCxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ1QsTUFBTSxFQUFFLGlCQUFpQixDQUFDLE1BQU07WUFDaEMsV0FBVyxFQUFFLDhEQUE4RCx3QkFBd0IsR0FBRztZQUN0RyxLQUFLLEVBQUUsa0JBQWtCO1NBQzVCLENBQUMsQ0FBQztLQUNOO0lBRUQsTUFBTSx1Q0FBdUMsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLENBQzlFLE9BQU8sQ0FBQyxhQUFhLENBQUMsOEJBQThCLENBQUMsQ0FDeEQsQ0FBQztJQUNGLElBQUksdUNBQXVDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUNwRCxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ1QsTUFBTSxFQUFFLGlCQUFpQixDQUFDLFFBQVE7WUFDbEMsV0FBVyxFQUFFLHNFQUFzRSwwQkFBMEIsR0FBRztZQUNoSCxLQUFLLEVBQUUsa0JBQWtCO1NBQzVCLENBQUMsQ0FBQztLQUNOO0lBQ0QsT0FBTyxPQUFPLENBQUM7QUFDbkIsQ0FBQztBQTlERCxnRUE4REMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy91dGlscy9yZnFtX2hlYWx0aF9jaGVjay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdAMHgvdXRpbHMnO1xuaW1wb3J0IHsgR2F1Z2UgfSBmcm9tICdwcm9tLWNsaWVudCc7XG5pbXBvcnQgeyBQcm9kdWNlciB9IGZyb20gJ3Nxcy1wcm9kdWNlcic7XG5cbmltcG9ydCB7IEVUSF9ERUNJTUFMUywgUkZRTV9UWF9HQVNfRVNUSU1BVEUgfSBmcm9tICcuLi9jb3JlL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBSZnFtV29ya2VySGVhcnRiZWF0RW50aXR5IH0gZnJvbSAnLi4vZW50aXRpZXMnO1xuaW1wb3J0IHsgUmZxTWFrZXJBc3NldE9mZmVyaW5ncyB9IGZyb20gJy4vcmZxX21ha2VyX21hbmFnZXInO1xuXG5jb25zdCBTUVNfUVVFVUVfU0laRV9ERUdSQURFRF9USFJFU0hPTEQgPSAxMDsgLy8gTW9yZSBtZXNzYWdlcyBzaXR0aW5nIGluIHF1ZXVlIHRoYW4gdGhpcyB3aWxsIGNhdXNlIGEgREVHUkFERUQgaXNzdWVcbmNvbnN0IFNRU19RVUVVRV9TSVpFX0ZBSUxFRF9USFJFU0hPTEQgPSAyMDsgLy8gTW9yZSBtZXNzYWdlcyBzaXR0aW5nIGluIHF1ZXVlIHRoYW4gdGhpcyB3aWxsIGNhdXNlIGEgRkFJTEVEIGlzc3VlXG5cbmNvbnN0IFJFQ0VOVF9IRUFSVEJFQVRfQUdFX1RIUkVTSE9MRCA9IDU7IC8vIChtaW51dGVzKSBIZWFydGJlYXRzIG9sZGVyIHRoYW4gdGhpcyB3aWxsIHByb2R1Y2UgYSBERUdSQURFRCBpc3N1ZS4gQSBGQUlMRUQgaXNzdWUgaXMgcHJvZHVjZWQgaWYgTk8gaGVhcnRiZWF0cyBhcmUgbmV3ZXIgdGhhbiB0aGlzLlxuXG5jb25zdCBCQUxBTkNFX0ZBSUxFRF9USFJFU0hPTEQgPSAwLjA0OyAvLyAoZXRoKSBJZiBOTyB3b3JrZXIgaGFzIGEgYmFsYW5jZSBoaWdoZXIgdGhhbiB0aGlzLCBhIEZBSUxFRCBpc3N1ZSBnZXRzIGNyZWF0ZWQuXG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGN1c3RvbS1uby1tYWdpYy1udW1iZXJzXG5jb25zdCBCQUxBTkNFX0RFR1JBREVEX1RIUkVTSE9MRCA9IDAuMTsgLy8gKGV0aCkgSWYgPCAyIHdvcmtlcnMgaGF2ZSBhIGJhbGFuY2UgbG93ZXIgdGhhbiB0aGlzLCBhIERFR1JBREVEIGlzc3VlIGdldHMgY3JlYXRlZC5cblxuY29uc3QgTVNfSU5fTUlOVVRFID0gNjAwMDA7XG5cbmNvbnN0IEJBTEFOQ0VfREVHUkFERURfVEhSRVNIT0xEX1dFSSA9IG5ldyBCaWdOdW1iZXIoQkFMQU5DRV9ERUdSQURFRF9USFJFU0hPTEQpLnNoaWZ0ZWRCeShFVEhfREVDSU1BTFMpO1xuY29uc3QgQkFMQU5DRV9GQUlMRURfVEhSRVNIT0xEX1dFSSA9IG5ldyBCaWdOdW1iZXIoQkFMQU5DRV9GQUlMRURfVEhSRVNIT0xEKS5zaGlmdGVkQnkoRVRIX0RFQ0lNQUxTKTtcblxuY29uc3QgUkZRTV9IRUFMVEhfQ0hFQ0tfSVNTVUVfR0FVR0UgPSBuZXcgR2F1Z2Uoe1xuICAgIG5hbWU6ICdyZnFtX2hlYWx0aF9jaGVja19pc3N1ZV9nYXVnZScsXG4gICAgbGFiZWxOYW1lczogWydsYWJlbCcgLyogOkhlYWx0aENoZWNrTGFiZWwgKi8sICdjaGFpbl9pZCddLFxuICAgIGhlbHA6ICdHYXVnZSBpbmRpY2F0aW5nIHRoZSBjdXJyZW50IHN0YXR1cyBmb3IgZWFjaCBsYWJlbC4gVmFsdWUgY29ycmVzcG9uZHMgdG8gdGhlIGBzdGF0dXNTZXZlcml0eWAnLFxufSk7XG5cbmNvbnN0IFJGUU1fVE9UQUxfU1lTVEVNX1RSQURFX0NBUEFDSVRZX0dBVUdFID0gbmV3IEdhdWdlKHtcbiAgICBuYW1lOiAncmZxbV90b3RhbF9zeXN0ZW1fdHJhZGVfY2FwYWNpdHknLFxuICAgIGxhYmVsTmFtZXM6IFsnY2hhaW5faWQnXSxcbiAgICBoZWxwOiAnVG90YWwgYW1vdW50IG9mIEVUSCBpbiB0aGUgd29ya2VyIHBvb2wgZGl2aWRlZCBieSB0aGUgY3VycmVudCBleHBlY3RlZCBnYXMgb2YgYSB0cmFkZScsXG59KTtcblxuZXhwb3J0IGVudW0gSGVhbHRoQ2hlY2tTdGF0dXMge1xuICAgIE9wZXJhdGlvbmFsID0gJ29wZXJhdGlvbmFsJyxcbiAgICBNYWludGVuYW5jZSA9ICdtYWludGVuYW5jZScsXG4gICAgRGVncmFkZWQgPSAnZGVncmFkZWQnLFxuICAgIEZhaWxlZCA9ICdmYWlsZWQnLFxufVxuXG50eXBlIEhlYWx0aENoZWNrTGFiZWwgPSAnUkZRTV9NQUlOVEVOQU5DRV9NT0RFIGNvbmZpZyBgdHJ1ZWAnIHwgJ3F1ZXVlIHNpemUnIHwgJ3dvcmtlciBiYWxhbmNlJyB8ICd3b3JrZXIgaGVhcnRiZWF0JztcblxuaW50ZXJmYWNlIEhlYWx0aENoZWNrSXNzdWUge1xuICAgIHN0YXR1czogSGVhbHRoQ2hlY2tTdGF0dXM7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBsYWJlbDogSGVhbHRoQ2hlY2tMYWJlbDtcbn1cblxuLyoqXG4gKiBUaGUgY29tcGxldGUgcmVzdWx0IG9mIGFuIFJGUW0gaGVhbHRoIGNoZWNrIHJvdXRpbmUuXG4gKiBGb3IgcHVibGljIHVzZXJzLCB0aGlzIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gYSBgUmZxbUhlYWx0aENoZWNrU2hvcnRSZXNwb25zZWAgYmVmb3JlIGJlaW5nXG4gKiBzZW50IGluIHRoZSByZXBvbnNlIGluIG9yZGVyIHRvIG5vdCBleHBvc2UgcG90ZW50aWFsbHktc2Vuc2l0aXZlIHN5c3RlbSBkZXRhaWxzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEhlYWx0aENoZWNrUmVzdWx0IHtcbiAgICBzdGF0dXM6IEhlYWx0aENoZWNrU3RhdHVzO1xuICAgIHBhaXJzOiB7XG4gICAgICAgIFtwYWlyOiBzdHJpbmddOiBIZWFsdGhDaGVja1N0YXR1czsgLy8gd2hlcmUgdGhlIHBhaXIgaGFzIHRoZSBmb3JtIGAke2NvbnRyYWN0QX0tJHtjb250cmFjdEJ9YFxuICAgIH07XG4gICAgaHR0cDoge1xuICAgICAgICBzdGF0dXM6IEhlYWx0aENoZWNrU3RhdHVzO1xuICAgICAgICBpc3N1ZXM6IEhlYWx0aENoZWNrSXNzdWVbXTtcbiAgICB9O1xuICAgIHdvcmtlcnM6IHtcbiAgICAgICAgc3RhdHVzOiBIZWFsdGhDaGVja1N0YXR1cztcbiAgICAgICAgaXNzdWVzOiBIZWFsdGhDaGVja0lzc3VlW107XG4gICAgfTtcbiAgICAvLyBUT0RPIChyaGlub2RhdmlkKTogQWRkIE1hcmtldE1ha2Vyc1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJmcW1IZWFsdGhDaGVja1Nob3J0UmVzcG9uc2Uge1xuICAgIGlzT3BlcmF0aW9uYWw6IGJvb2xlYW47XG4gICAgcGFpcnM6IFtzdHJpbmcsIHN0cmluZ11bXTtcbn1cblxuLyoqXG4gKiBQcm9kdWNlcyBhIGZ1bGwgaGVhbHRoIGNoZWNrIGZyb20gdGhlIGdpdmVuIGludXB0cy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvbXB1dGVIZWFsdGhDaGVja0FzeW5jKFxuICAgIGlzTWFpbnRhaW5lbmNlTW9kZTogYm9vbGVhbixcbiAgICBvZmZlcmluZ3M6IFJmcU1ha2VyQXNzZXRPZmZlcmluZ3MsXG4gICAgcHJvZHVjZXI6IFByb2R1Y2VyLFxuICAgIGhlYXJ0YmVhdHM6IFJmcW1Xb3JrZXJIZWFydGJlYXRFbnRpdHlbXSxcbiAgICBjaGFpbklkOiBudW1iZXIsXG4gICAgZ2FzUHJpY2U/OiBCaWdOdW1iZXIsXG4pOiBQcm9taXNlPEhlYWx0aENoZWNrUmVzdWx0PiB7XG4gICAgY29uc3QgcGFpcnMgPSB0cmFuc2Zvcm1QYWlycyhvZmZlcmluZ3MpO1xuXG4gICAgY29uc3QgaHR0cElzc3VlcyA9IGdldEh0dHBJc3N1ZXMoaXNNYWludGFpbmVuY2VNb2RlKTtcbiAgICBjb25zdCBodHRwU3RhdHVzID0gZ2V0V29yc3RTdGF0dXMoaHR0cElzc3Vlcy5tYXAoKGlzc3VlKSA9PiBpc3N1ZS5zdGF0dXMpKTtcblxuICAgIGNvbnN0IHF1ZXVlSXNzdWVzID0gYXdhaXQgY2hlY2tTcXNRdWV1ZUFzeW5jKHByb2R1Y2VyKTtcbiAgICBjb25zdCBoZWFydGJlYXRJc3N1ZXMgPSBhd2FpdCBjaGVja1dvcmtlckhlYXJ0YmVhdHNBc3luYyhoZWFydGJlYXRzKTtcbiAgICBjb25zdCB3b3JrZXJzSXNzdWVzID0gWy4uLnF1ZXVlSXNzdWVzLCAuLi5oZWFydGJlYXRJc3N1ZXNdO1xuICAgIGNvbnN0IHdvcmtlcnNTdGF0dXMgPSBnZXRXb3JzdFN0YXR1cyh3b3JrZXJzSXNzdWVzLm1hcCgoaXNzdWUpID0+IGlzc3VlLnN0YXR1cykpO1xuXG4gICAgLy8gUHJvbWV0aGV1cyBjb3VudGVyc1xuICAgIGNvbnN0IHNldmVyaXR5QnlMYWJlbDogUmVjb3JkPEhlYWx0aENoZWNrTGFiZWwsIG51bWJlcj4gPSB7XG4gICAgICAgICdSRlFNX01BSU5URU5BTkNFX01PREUgY29uZmlnIGB0cnVlYCc6IHN0YXR1c1NldmVyaXR5KEhlYWx0aENoZWNrU3RhdHVzLk9wZXJhdGlvbmFsKSxcbiAgICAgICAgJ3F1ZXVlIHNpemUnOiBzdGF0dXNTZXZlcml0eShIZWFsdGhDaGVja1N0YXR1cy5PcGVyYXRpb25hbCksXG4gICAgICAgICd3b3JrZXIgYmFsYW5jZSc6IHN0YXR1c1NldmVyaXR5KEhlYWx0aENoZWNrU3RhdHVzLk9wZXJhdGlvbmFsKSxcbiAgICAgICAgJ3dvcmtlciBoZWFydGJlYXQnOiBzdGF0dXNTZXZlcml0eShIZWFsdGhDaGVja1N0YXR1cy5PcGVyYXRpb25hbCksXG4gICAgfTtcbiAgICBbLi4uaHR0cElzc3VlcywgLi4ud29ya2Vyc0lzc3Vlc10uZm9yRWFjaChcbiAgICAgICAgKGlzc3VlKSA9PlxuICAgICAgICAgICAgKHNldmVyaXR5QnlMYWJlbFtpc3N1ZS5sYWJlbF0gPSBNYXRoLm1heChzZXZlcml0eUJ5TGFiZWxbaXNzdWUubGFiZWxdLCBzdGF0dXNTZXZlcml0eShpc3N1ZS5zdGF0dXMpKSksXG4gICAgKTtcbiAgICBPYmplY3QuZW50cmllcyhzZXZlcml0eUJ5TGFiZWwpLmZvckVhY2goKFtsYWJlbCwgc2V2ZXJpdHldKSA9PiB7XG4gICAgICAgIFJGUU1fSEVBTFRIX0NIRUNLX0lTU1VFX0dBVUdFLmxhYmVscyhsYWJlbCwgY2hhaW5JZC50b1N0cmluZygpKS5zZXQoc2V2ZXJpdHkpO1xuICAgIH0pO1xuXG4gICAgaWYgKGdhc1ByaWNlKSB7XG4gICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIGdhdWdlIGlzIGFuIGVzdGltYXRpb24gb2YgdGhlIHRvdGFsIG51bWJlciBvZiB0cmFkZXMsIHNpbmNlIHR3byB3b3JrZXJzIGNvdWxkIGhhdmVcbiAgICAgICAgLy8gNTAlIG9mIHRoZSBhbW91bnQgZm9yIG9uZSB0cmFkZSBhbmQgdGhlIGdhdWdlIHdvdWxkIHNob3cgMSBidXQgdGhlIGFjdHVhbCBjYXBhY2l0eSB3b3VsZCBiZSAwLlxuICAgICAgICBjb25zdCB0b3RhbFdvcmtlckJhbGFuY2UgPSBoZWFydGJlYXRzLnJlZHVjZSgodG90YWwsIHsgYmFsYW5jZSB9KSA9PiB0b3RhbC5wbHVzKGJhbGFuY2UpLCBuZXcgQmlnTnVtYmVyKDApKTtcbiAgICAgICAgY29uc3QgdG90YWxTeXN0ZW1UcmFkZUNhcGFjaXR5ID0gdG90YWxXb3JrZXJCYWxhbmNlLmRpdihnYXNQcmljZS50aW1lcyhSRlFNX1RYX0dBU19FU1RJTUFURSkpO1xuICAgICAgICBSRlFNX1RPVEFMX1NZU1RFTV9UUkFERV9DQVBBQ0lUWV9HQVVHRS5sYWJlbHMoY2hhaW5JZC50b1N0cmluZygpKS5zZXQodG90YWxTeXN0ZW1UcmFkZUNhcGFjaXR5LnRvTnVtYmVyKCkpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogZ2V0V29yc3RTdGF0dXMoW2h0dHBTdGF0dXMsIHdvcmtlcnNTdGF0dXNdKSxcbiAgICAgICAgcGFpcnMsXG4gICAgICAgIGh0dHA6IHsgc3RhdHVzOiBodHRwU3RhdHVzLCBpc3N1ZXM6IGh0dHBJc3N1ZXMgfSxcbiAgICAgICAgd29ya2VyczogeyBzdGF0dXM6IHdvcmtlcnNTdGF0dXMsIGlzc3Vlczogd29ya2Vyc0lzc3VlcyB9LFxuICAgIH07XG59XG5cbi8qKlxuICogVHJhbnNmb3JtIHRoZSBmdWxsIGhlYWx0aCBjaGVjayByZXN1bHQgaW50byB0aGUgbWluaW1hbCByZXNwb25zZSB0aGUgTWF0Y2hhIFVJIHJlcXVpcmVzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNmb3JtUmVzdWx0VG9TaG9ydFJlc3BvbnNlKHJlc3VsdDogSGVhbHRoQ2hlY2tSZXN1bHQpOiBSZnFtSGVhbHRoQ2hlY2tTaG9ydFJlc3BvbnNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpc09wZXJhdGlvbmFsOiByZXN1bHQuc3RhdHVzID09PSBIZWFsdGhDaGVja1N0YXR1cy5PcGVyYXRpb25hbCB8fCByZXN1bHQuc3RhdHVzID09PSBIZWFsdGhDaGVja1N0YXR1cy5EZWdyYWRlZCxcbiAgICAgICAgcGFpcnM6IE9iamVjdC5lbnRyaWVzKHJlc3VsdC5wYWlycylcbiAgICAgICAgICAgIC5maWx0ZXIoXG4gICAgICAgICAgICAgICAgKFtfcGFpciwgc3RhdHVzXSkgPT4gc3RhdHVzID09PSBIZWFsdGhDaGVja1N0YXR1cy5PcGVyYXRpb25hbCB8fCBzdGF0dXMgPT09IEhlYWx0aENoZWNrU3RhdHVzLkRlZ3JhZGVkLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm1hcCgoW3BhaXIsIF9zdGF0dXNdKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3Rva2VuQSwgdG9rZW5CXSA9IHBhaXIuc3BsaXQoJy0nKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gW3Rva2VuQSwgdG9rZW5CXTtcbiAgICAgICAgICAgIH0pLFxuICAgIH07XG59XG5cbi8qKlxuICogQ2hhbmdlcyB0aGUgc2V0IG9mIHRyYWRpbmcgcGFpcnMgZnJvbSB0aGUgZm9ybWF0IHVzZWQgaW4gY29uZmlnIHRvIHRoZSBmb3JtYXQgdXNlZCBpbiB0aGUgaGVhbHRoIGNoZWNrIHJlc3BvbnNlLlxuICovXG5mdW5jdGlvbiB0cmFuc2Zvcm1QYWlycyhvZmZlcmluZ3M6IFJmcU1ha2VyQXNzZXRPZmZlcmluZ3MpOiB7IFtwYWlyOiBzdHJpbmddOiBIZWFsdGhDaGVja1N0YXR1cyB9IHtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhvZmZlcmluZ3MpXG4gICAgICAgIC5mbGF0KClcbiAgICAgICAgLnJlZHVjZSgocmVzdWx0OiB7IFtwYWlyOiBzdHJpbmddOiBIZWFsdGhDaGVja1N0YXR1cyB9LCBwYWlyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbdG9rZW5BLCB0b2tlbkJdID0gcGFpci5zb3J0KCk7XG4gICAgICAgICAgICAvLyBDdXJyZW50bHksIHdlIGFzc3VtZSBhbGwgcGFpcnMgYXJlIG9wZXJhdGlvbi4gSW4gdGhlIGZ1dHVyZSwgdGhpcyBtYXkgbm90IGJlIHRoZSBjYXNlLlxuICAgICAgICAgICAgcmVzdWx0W2Ake3Rva2VuQX0tJHt0b2tlbkJ9YF0gPSBIZWFsdGhDaGVja1N0YXR1cy5PcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sIHt9KTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGlzc3VlcyByZWxhdGVkIHRvIHRoZSBzZXJ2ZXIvQVBJIG5vdCBzcGVjaWZpYyB0byB0aGUgd29ya2VyIGZhcm0uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRIdHRwSXNzdWVzKGlzTWFpbnRhaW5lbmNlTW9kZTogYm9vbGVhbik6IEhlYWx0aENoZWNrSXNzdWVbXSB7XG4gICAgY29uc3QgaXNzdWVzOiBIZWFsdGhDaGVja0lzc3VlW10gPSBbXTtcbiAgICBpZiAoaXNNYWludGFpbmVuY2VNb2RlKSB7XG4gICAgICAgIGlzc3Vlcy5wdXNoKHtcbiAgICAgICAgICAgIHN0YXR1czogSGVhbHRoQ2hlY2tTdGF0dXMuTWFpbnRlbmFuY2UsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JGUU0gaXMgc2V0IHRvIG1haW50YWluZW5jZSBtb2RlIHZpYSB0aGUgMHggQVBJIGNvbmZpZ3VyYXRpb24nLFxuICAgICAgICAgICAgbGFiZWw6ICdSRlFNX01BSU5URU5BTkNFX01PREUgY29uZmlnIGB0cnVlYCcsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gaXNzdWVzO1xufVxuXG4vKipcbiAqIFJ1bnMgY2hlY2tzIG9uIHRoZSBTUVMgcXVldWUgdG8gZGV0ZWN0IGlmIHRoZXJlIGFyZSBtZXNzYWdlcyBwaWxpbmcgdXAuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1Nxc1F1ZXVlQXN5bmMocHJvZHVjZXI6IFByb2R1Y2VyKTogUHJvbWlzZTxIZWFsdGhDaGVja0lzc3VlW10+IHtcbiAgICBjb25zdCByZXN1bHRzOiBIZWFsdGhDaGVja0lzc3VlW10gPSBbXTtcbiAgICBjb25zdCBtZXNzYWdlc0luUXVldWUgPSBhd2FpdCBwcm9kdWNlci5xdWV1ZVNpemUoKTtcbiAgICBpZiAobWVzc2FnZXNJblF1ZXVlID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbiAgICBpZiAobWVzc2FnZXNJblF1ZXVlID4gU1FTX1FVRVVFX1NJWkVfRkFJTEVEX1RIUkVTSE9MRCkge1xuICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgc3RhdHVzOiBIZWFsdGhDaGVja1N0YXR1cy5GYWlsZWQsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFNRUyBxdWV1ZSBjb250YWlucyAke21lc3NhZ2VzSW5RdWV1ZX0gbWVzc2FnZXMgKHRocmVzaG9sZCBpcyAke1NRU19RVUVVRV9TSVpFX0ZBSUxFRF9USFJFU0hPTER9KWAsXG4gICAgICAgICAgICBsYWJlbDogJ3F1ZXVlIHNpemUnLFxuICAgICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKG1lc3NhZ2VzSW5RdWV1ZSA+IFNRU19RVUVVRV9TSVpFX0RFR1JBREVEX1RIUkVTSE9MRCkge1xuICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgc3RhdHVzOiBIZWFsdGhDaGVja1N0YXR1cy5EZWdyYWRlZCxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgU1FTIHF1ZXVlIGNvbnRhaW5zICR7bWVzc2FnZXNJblF1ZXVlfSBtZXNzYWdlcyAodGhyZXNob2xkIGlzICR7U1FTX1FVRVVFX1NJWkVfREVHUkFERURfVEhSRVNIT0xEfSlgLFxuICAgICAgICAgICAgbGFiZWw6ICdxdWV1ZSBzaXplJyxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBudW1lcmljYWwgdmFsdWUgd2hpY2ggY29ycmVzcG9uZHMgdG8gdGhlIFwic2V2ZXJpdHlcIiBvZiBhIGBIZWFsdGhDaGVja1N0YXR1c2AgZW51bSBtZW1iZXIuXG4gKiBIaWdoZXIgdmFsdWVzIGFyZSBtb3JlIHNldmVyZS4gKE9oIHRvIGhhdmUgU3dpZnRMYW5nIGVudW1zIGhlcmUuKVxuICovXG5mdW5jdGlvbiBzdGF0dXNTZXZlcml0eShzdGF0dXM6IEhlYWx0aENoZWNrU3RhdHVzKTogbnVtYmVyIHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZSBjdXN0b20tbm8tbWFnaWMtbnVtYmVyc1xuICAgIHN3aXRjaCAoc3RhdHVzKSB7XG4gICAgICAgIGNhc2UgSGVhbHRoQ2hlY2tTdGF0dXMuRmFpbGVkOlxuICAgICAgICAgICAgcmV0dXJuIDQ7XG4gICAgICAgIGNhc2UgSGVhbHRoQ2hlY2tTdGF0dXMuTWFpbnRlbmFuY2U6XG4gICAgICAgICAgICByZXR1cm4gMztcbiAgICAgICAgY2FzZSBIZWFsdGhDaGVja1N0YXR1cy5EZWdyYWRlZDpcbiAgICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICBjYXNlIEhlYWx0aENoZWNrU3RhdHVzLk9wZXJhdGlvbmFsOlxuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFJlY2VpdmVkIHVua25vd24gc3RhdHVzOiAke3N0YXR1c31gKTtcbiAgICB9XG4gICAgLy8gdHNsaW50OmVuYWJsZSBjdXN0b20tbm8tbWFnaWMtbnVtYmVyc1xufVxuXG4vKipcbiAqIEFjY2VwdHMgYSBsaXN0IG9mIHN0YXR1c2VzIGFuZCByZXR1cm5zIHRoZSB3b3JzdCBzdGF0dXNcbiAqL1xuZnVuY3Rpb24gZ2V0V29yc3RTdGF0dXMoc3RhdHVzZXM6IEhlYWx0aENoZWNrU3RhdHVzW10pOiBIZWFsdGhDaGVja1N0YXR1cyB7XG4gICAgaWYgKCFzdGF0dXNlcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIEhlYWx0aENoZWNrU3RhdHVzLk9wZXJhdGlvbmFsO1xuICAgIH1cbiAgICByZXR1cm4gc3RhdHVzZXMucmVkdWNlKFxuICAgICAgICAod29yc3RTdGF0dXMsIGN1cnJlbnRTdGF0dXMpID0+XG4gICAgICAgICAgICBzdGF0dXNTZXZlcml0eShjdXJyZW50U3RhdHVzKSA+IHN0YXR1c1NldmVyaXR5KHdvcnN0U3RhdHVzKSA/IGN1cnJlbnRTdGF0dXMgOiB3b3JzdFN0YXR1cyxcbiAgICAgICAgSGVhbHRoQ2hlY2tTdGF0dXMuT3BlcmF0aW9uYWwsXG4gICAgKTtcbn1cblxuLyoqXG4gKiBMb29rcyBhdCB0aGUgd29ya2VyIGhlYXJ0YmVhdHMgYW5kIHByb2R1Y2VzIGFwcHJvcHJpYXRlIGlzc3VlcyBiYXNlZCBvbiB0aGUgYWdlXG4gKiBvZiB0aGUgaGVhcnRiZWF0cyBhbmQgdGhlIHdvcmtlciBiYWxhbmNlcy5cbiAqXG4gKiBIZWFydGJlYXQgQWdlOiBDaGVja3MgdGhlIG1vc3QgcmVjZW50IGhlYXJ0YmVhdCBhbmQgcHJvZHVjZXMgYSBGQUlMRUQgaXNzdWUgaWYgaXQgaXMgb2xkZXIgdGhhbiB0aGUgZmFpbGVkXG4gKiB0aHJlc2hvbGQuIEZvciBoZWFydGJlYXRzIG90aGVyIHRoYW4gdGhlIG1vc3QgcmVjZW50LCB3aWxsIG9ubHkgcHJvZHVjZSBhIERFR1JBREVEIGlzc3VlLiAoaS5lLiB0aGUgY2hlY2sgb25seVxuICogZmFpbHMgaWYgQUxMIHdvcmtlcnMgYXJlIHN0dWNrKVxuICpcbiAqIFdvcmtlciBCYWxhbmNlOiBMaWtlIHdpdGggdGhlIGFnZSBjaGVjaywgdGhpcyBvbmx5IHByb2R1Y2VzIGEgRkFJTEVEIGlzc3VlIGlmIGFsbCB3b3JrZXJzIGFyZSBiZWxvdyB0aGUgZmFpbGVkXG4gKiBiYWxhbmNlLiBJbmRpdmlkdWFsIHdvcmtlciBiYWxhbmNlcyBwcm9kdWNlIGEgREVHUkFERUQgaXNzdWUgaWYgdGhleSBhcmUgYmVsb3cgQkFMQU5DRV9ERUdSQURFRF9USFJFU0hPTEQuXG4gKlxuICogQ3VycmVudCBkYXRlIGlzIGFuIG9wdGlvbmFsIHBhcmFtZXRlciBmb3IgdGVzdGluZy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrV29ya2VySGVhcnRiZWF0c0FzeW5jKFxuICAgIGhlYXJ0YmVhdHM6IFJmcW1Xb3JrZXJIZWFydGJlYXRFbnRpdHlbXSxcbiAgICBub3dEYXRlOiBEYXRlID0gbmV3IERhdGUoKSxcbik6IFByb21pc2U8SGVhbHRoQ2hlY2tJc3N1ZVtdPiB7XG4gICAgY29uc3QgcmVzdWx0czogSGVhbHRoQ2hlY2tJc3N1ZVtdID0gW107XG4gICAgaWYgKCFoZWFydGJlYXRzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0YXR1czogSGVhbHRoQ2hlY2tTdGF0dXMuRmFpbGVkLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTm8gd29ya2VyIGhlYXJ0YmVhdHMgd2VyZSBmb3VuZCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICd3b3JrZXIgaGVhcnRiZWF0JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG4gICAgfVxuXG4gICAgLy8gSGVhcnRiZWF0IEFnZVxuICAgIGNvbnN0IHNvcnRlZEhlYXJ0YmVhdHMgPSBoZWFydGJlYXRzLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wLmdldFRpbWUoKSAtIGEudGltZXN0YW1wLmdldFRpbWUoKSk7XG4gICAgY29uc3QgbmV3ZXN0SGVhcnRiZWF0ID0gc29ydGVkSGVhcnRiZWF0c1swXTtcbiAgICBjb25zdCBuZXdlc3RIZWFydGJlYXRBZ2VNaW51dGVzID0gKG5vd0RhdGUuZ2V0VGltZSgpIC0gbmV3ZXN0SGVhcnRiZWF0LnRpbWVzdGFtcC5nZXRUaW1lKCkpIC8gTVNfSU5fTUlOVVRFO1xuICAgIGlmIChuZXdlc3RIZWFydGJlYXRBZ2VNaW51dGVzID4gUkVDRU5UX0hFQVJUQkVBVF9BR0VfVEhSRVNIT0xEKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICBzdGF0dXM6IEhlYWx0aENoZWNrU3RhdHVzLkZhaWxlZCxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgTm8gd29ya2VyIGhhcyBwdWJsaXNoZWQgYSBoZWFydGJlYXQgaW4gdGhlIGxhc3QgJHtSRUNFTlRfSEVBUlRCRUFUX0FHRV9USFJFU0hPTER9IG1pbnV0ZXNgLFxuICAgICAgICAgICAgbGFiZWw6ICd3b3JrZXIgaGVhcnRiZWF0JyxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIFRPRE8gKHJoaW5vZGF2aWQpOiBUaGluayBhYm91dCBob3cgdGhpcyB3aWxsIHdvcmsgd2hlbiB3ZSBkb3duc2NhbGUgYW5kIGEgd29ya2VyIGlzbid0IHByb2R1Y2luZyBuZXdcbiAgICAvLyBoZWFyYmVhdHMgYmVjYXVzZSBpdCdzIGJlZW4gcmVtb3ZlZC5cbiAgICBzb3J0ZWRIZWFydGJlYXRzLmZvckVhY2goKHsgaW5kZXgsIHRpbWVzdGFtcCwgYWRkcmVzcyB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGhlYXJ0YmVhdEFnZU1pbnV0ZXMgPSAobm93RGF0ZS5nZXRUaW1lKCkgLSB0aW1lc3RhbXAuZ2V0VGltZSgpKSAvIE1TX0lOX01JTlVURTtcbiAgICAgICAgaWYgKGhlYXJ0YmVhdEFnZU1pbnV0ZXMgPj0gUkVDRU5UX0hFQVJUQkVBVF9BR0VfVEhSRVNIT0xEKSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHN0YXR1czogSGVhbHRoQ2hlY2tTdGF0dXMuRGVncmFkZWQsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGBXb3JrZXIgJHtpbmRleH0gKCR7YWRkcmVzc30pIGxhc3QgaGVhcnRiZWF0IHdhcyAke2hlYXJ0YmVhdEFnZU1pbnV0ZXN9IGFnb2AsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICd3b3JrZXIgaGVhcnRiZWF0JyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBCYWxhbmNlc1xuICAgIGNvbnN0IGhlYXJ0YmVhdHNBYm92ZUNyaXRpY2FsQmFsYW5jZVRocmVzaG9sZCA9IGhlYXJ0YmVhdHMuZmlsdGVyKCh7IGJhbGFuY2UgfSkgPT5cbiAgICAgICAgYmFsYW5jZS5pc0dyZWF0ZXJUaGFuT3JFcXVhbFRvKEJBTEFOQ0VfRkFJTEVEX1RIUkVTSE9MRF9XRUkpLFxuICAgICk7XG4gICAgaWYgKGhlYXJ0YmVhdHNBYm92ZUNyaXRpY2FsQmFsYW5jZVRocmVzaG9sZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgIHN0YXR1czogSGVhbHRoQ2hlY2tTdGF0dXMuRmFpbGVkLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBObyB3b3JrZXIgaGFzIGEgYmFsYW5jZSBncmVhdGVyIHRoYW4gdGhlIGZhaWxlZCB0aHJlc2hvbGQgKCR7QkFMQU5DRV9GQUlMRURfVEhSRVNIT0xEfSlgLFxuICAgICAgICAgICAgbGFiZWw6ICd3b3JrZXIgaGVhcnRiZWF0JyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgaGVhcnRiZWF0c0Fib3ZlRGVncmFkZWRCYWxhbmNlVGhyZXNob2xkID0gaGVhcnRiZWF0cy5maWx0ZXIoKHsgYmFsYW5jZSB9KSA9PlxuICAgICAgICBiYWxhbmNlLmlzR3JlYXRlclRoYW4oQkFMQU5DRV9ERUdSQURFRF9USFJFU0hPTERfV0VJKSxcbiAgICApO1xuICAgIGlmIChoZWFydGJlYXRzQWJvdmVEZWdyYWRlZEJhbGFuY2VUaHJlc2hvbGQubGVuZ3RoIDwgMikge1xuICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgc3RhdHVzOiBIZWFsdGhDaGVja1N0YXR1cy5EZWdyYWRlZCxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBgTGVzcyB0aGFuIHR3byB3b3JrZXJzIGhhdmUgYSBiYWxhbmNlIGFib3ZlIHRoZSBkZWdyYWRlZCB0aHJlc2hvbGQgKCR7QkFMQU5DRV9ERUdSQURFRF9USFJFU0hPTER9KWAsXG4gICAgICAgICAgICBsYWJlbDogJ3dvcmtlciBoZWFydGJlYXQnLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG59XG4iXSwidmVyc2lvbiI6M30=