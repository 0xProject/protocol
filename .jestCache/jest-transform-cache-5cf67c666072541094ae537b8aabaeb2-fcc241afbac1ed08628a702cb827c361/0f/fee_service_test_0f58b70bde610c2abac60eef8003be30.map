{"file":"/Users/davidwalsh/code-local/0x-rfq-api/test/services/fee_service_test.ts","mappings":"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","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/test/services/fee_service_test.ts"],"sourcesContent":["// tslint:disable:max-file-line-count\r\n// tslint:disable:custom-no-magic-numbers\r\n\r\nimport { BigNumber } from '@0x/utils';\r\nimport { anything, instance, mock, when } from 'ts-mockito';\r\n\r\nimport { DEFAULT_FEE_MODEL_CONFIGURATION, FeeModelConfiguration } from '../../src/config';\r\nimport {\r\n    BPS_TO_RATIO,\r\n    DEFAULT_MIN_EXPIRY_DURATION_MS,\r\n    RFQM_TX_OTC_ORDER_GAS_ESTIMATE,\r\n    ZERO,\r\n} from '../../src/core/constants';\r\nimport {\r\n    calculateDefaultFeeAmount,\r\n    calculatePriceImprovementAmount,\r\n    reviseQuoteWithFees,\r\n    FeeService,\r\n} from '../../src/services/fee_service';\r\nimport { QuoteContext } from '../../src/services/types';\r\nimport { FeeWithDetails, IndicativeQuote, TokenMetadata } from '../../src/core/types';\r\nimport { ConfigManager } from '../../src/utils/config_manager';\r\nimport { GasStationAttendantEthereum } from '../../src/utils/GasStationAttendantEthereum';\r\nimport { TokenPriceOracle } from '../../src/utils/TokenPriceOracle';\r\nimport { AmmQuote, ZeroExApiClient } from '../../src/utils/ZeroExApiClient';\r\n\r\nconst feeTokenSymbol = 'fee';\r\nconst feeTokenAddress = 'feeTokenAddress';\r\nconst feeTokenDecimals = 18;\r\n\r\nconst buildFeeService = (overrides: {\r\n    feeModelConfiguration?: FeeModelConfiguration;\r\n    gasPrice?: BigNumber;\r\n    tradeTokenPrice?: BigNumber | null;\r\n    feeTokenPrice?: BigNumber | null;\r\n    ammQuote?: AmmQuote | null;\r\n    chainId?: number;\r\n    feeTokenMetadata?: TokenMetadata;\r\n    configManagerMock?: ConfigManager;\r\n    gasStationAttendantMock?: GasStationAttendantEthereum;\r\n    tokenPriceOracleMock?: TokenPriceOracle;\r\n    zeroExApiClientMock?: ZeroExApiClient;\r\n}): FeeService => {\r\n    const chainId = overrides?.chainId || 1337;\r\n    const feeTokenMetadata = overrides?.feeTokenMetadata || {\r\n        symbol: feeTokenSymbol,\r\n        decimals: feeTokenDecimals,\r\n        tokenAddress: feeTokenAddress,\r\n    };\r\n    const feeModelConfiguration = overrides?.feeModelConfiguration || DEFAULT_FEE_MODEL_CONFIGURATION;\r\n    const gasPrice = overrides?.gasPrice || new BigNumber(1e9);\r\n    const tradeTokenPrice = overrides?.tradeTokenPrice || null;\r\n    const feeTokenPrice = overrides?.feeTokenPrice || null;\r\n    const ammQuote = overrides?.ammQuote || null;\r\n\r\n    const configManagerMock = mock(ConfigManager);\r\n    when(configManagerMock.getFeeModelConfiguration(chainId, anything(), anything())).thenReturn(feeModelConfiguration);\r\n\r\n    const gasStationAttendantMock = mock(GasStationAttendantEthereum);\r\n    when(gasStationAttendantMock.getExpectedTransactionGasRateAsync()).thenResolve(gasPrice);\r\n\r\n    const tokenPriceOracleMock = mock(TokenPriceOracle);\r\n    when(tokenPriceOracleMock.batchFetchTokenPriceAsync(anything())).thenResolve([tradeTokenPrice, feeTokenPrice]);\r\n\r\n    const zeroExApiClientMock = mock(ZeroExApiClient);\r\n    when(zeroExApiClientMock.fetchAmmQuoteAsync(anything())).thenResolve(ammQuote);\r\n\r\n    return new FeeService(\r\n        chainId,\r\n        feeTokenMetadata,\r\n        instance(overrides?.configManagerMock || configManagerMock),\r\n        instance(overrides?.gasStationAttendantMock || gasStationAttendantMock),\r\n        instance(overrides?.tokenPriceOracleMock || tokenPriceOracleMock),\r\n        instance(overrides?.zeroExApiClientMock || zeroExApiClientMock),\r\n        DEFAULT_MIN_EXPIRY_DURATION_MS,\r\n    );\r\n};\r\n\r\ndescribe('FeeService', () => {\r\n    const workflow = 'rfqm';\r\n    const txOrigin = 'registryAddress';\r\n    const makerToken = 'UsdcAddress';\r\n    const makerTokenDecimals = 6;\r\n    const makerTokenPrice = new BigNumber(1e-6);\r\n\r\n    const takerToken = 'WbtcAddress';\r\n    const takerTokenDecimals = 18;\r\n    const takerTokenPrice = new BigNumber(6e-14);\r\n\r\n    const gasPrice = new BigNumber(1e9);\r\n    const gasEstimate = RFQM_TX_OTC_ORDER_GAS_ESTIMATE;\r\n\r\n    const feeTokenPrice = new BigNumber(3e-15);\r\n\r\n    const integrator = {\r\n        apiKeys: [],\r\n        integratorId: 'integratorId',\r\n        allowedChainIds: [1, 3, 137, 1337],\r\n        label: 'dummy integrator',\r\n        plp: true,\r\n        rfqm: true,\r\n        rfqt: true,\r\n    };\r\n\r\n    const takerAddress = 'takerAddress';\r\n\r\n    afterAll(() => {\r\n        jest.useRealTimers();\r\n    });\r\n\r\n    describe('calculateFeeAsync v0', () => {\r\n        const feeModelVersion = 0;\r\n        it('should calculate v0 fee for RFQm correctly', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(0.345e18);\r\n            const tradeSizeBps = 5;\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio: 0,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: takerTokenPrice,\r\n                feeTokenPrice,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                isFirm: true,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedGasFeeAmount,\r\n                details: {\r\n                    kind: 'gasOnly',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: null,\r\n                    feeTokenBaseUnitPriceUsd: null,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n        it('should calculate v0 fee for RFQt correctly', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(0.345e18);\r\n            const tradeSizeBps = 5;\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio: 0,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: takerTokenPrice,\r\n                feeTokenPrice,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow: 'rfqt',\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                isFirm: true,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: new BigNumber(0),\r\n                details: {\r\n                    kind: 'gasOnly',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: new BigNumber(0),\r\n                    gasPrice: new BigNumber(0),\r\n                },\r\n                breakdown: {},\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: null,\r\n                    feeTokenBaseUnitPriceUsd: null,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n    });\r\n\r\n    describe('calculateFeeAsync v1', () => {\r\n        const feeModelVersion = 1;\r\n        it('should calculate v1 fee for RFQm selling correctly', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(0.345e18);\r\n            const tradeSizeBps = 5;\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio: 0,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: takerTokenPrice,\r\n                feeTokenPrice,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                isFirm: true,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n            const expectedZeroExFeeAmount = assetFillAmount\r\n                .times(tradeSizeBps * BPS_TO_RATIO)\r\n                .times(takerTokenPrice)\r\n                .div(feeTokenPrice)\r\n                .integerValue();\r\n            const expectedTotalFeeAmount = expectedZeroExFeeAmount.plus(expectedGasFeeAmount);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedTotalFeeAmount,\r\n                details: {\r\n                    kind: 'default',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: expectedZeroExFeeAmount,\r\n                    tradeSizeBps,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: takerTokenPrice,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: expectedZeroExFeeAmount,\r\n                        details: {\r\n                            kind: 'volume',\r\n                            tradeSizeBps,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: takerTokenPrice,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n        it('should calculate v1 fee for RFQm buying correctly', async () => {\r\n            // Given\r\n            const isSelling = false;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(5000e6);\r\n            const tradeSizeBps = 4;\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio: 0,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                makerAmount: assetFillAmount,\r\n                isFirm: false,\r\n                takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n            const expectedZeroExFeeAmount = assetFillAmount\r\n                .times(tradeSizeBps * BPS_TO_RATIO)\r\n                .times(makerTokenPrice)\r\n                .div(feeTokenPrice)\r\n                .integerValue();\r\n            const expectedTotalFeeAmount = expectedZeroExFeeAmount.plus(expectedGasFeeAmount);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedTotalFeeAmount,\r\n                details: {\r\n                    kind: 'default',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: expectedZeroExFeeAmount,\r\n                    tradeSizeBps,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: expectedZeroExFeeAmount,\r\n                        details: {\r\n                            kind: 'volume',\r\n                            tradeSizeBps,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n        it('should calculate v1 fee for RFQt selling correctly', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(0.345e18);\r\n            const tradeSizeBps = 5;\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio: 0,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: takerTokenPrice,\r\n                feeTokenPrice,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow: 'rfqt',\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                isFirm: true,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedZeroExFeeAmount = assetFillAmount\r\n                .times(tradeSizeBps * BPS_TO_RATIO)\r\n                .times(takerTokenPrice)\r\n                .div(feeTokenPrice)\r\n                .integerValue();\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedZeroExFeeAmount,\r\n                details: {\r\n                    kind: 'default',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: new BigNumber(0),\r\n                    gasPrice: new BigNumber(0),\r\n                    zeroExFeeAmount: expectedZeroExFeeAmount,\r\n                    tradeSizeBps,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: takerTokenPrice,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n                breakdown: {\r\n                    zeroEx: {\r\n                        amount: expectedZeroExFeeAmount,\r\n                        details: {\r\n                            kind: 'volume',\r\n                            tradeSizeBps,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: takerTokenPrice,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n        it('should not include zeroEx fee for non-configured pairs', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(0.345e18);\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                gasPrice,\r\n                tradeTokenPrice: takerTokenPrice,\r\n                feeTokenPrice,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                isFirm: false,\r\n                takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedGasFeeAmount,\r\n                details: {\r\n                    kind: 'default',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: new BigNumber(0),\r\n                    tradeSizeBps: 0,\r\n                    feeTokenBaseUnitPriceUsd: null,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: new BigNumber(0),\r\n                        details: {\r\n                            kind: 'volume',\r\n                            tradeSizeBps: 0,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: null,\r\n                    feeTokenBaseUnitPriceUsd: null,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n        it('should not include zeroEx fee if price oracle is down', async () => {\r\n            // Given\r\n            const isSelling = false;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(5000e6);\r\n            const tradeSizeBps = 4;\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio: 0,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice: null,\r\n            });\r\n\r\n            // When\r\n            const { feeWithDetails: fee } = await feeService.calculateFeeAsync({\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                makerAmount: assetFillAmount,\r\n                isFirm: true,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            });\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedGasFeeAmount,\r\n                details: {\r\n                    kind: 'gasOnly',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: null,\r\n                    feeTokenBaseUnitPriceUsd: null,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(fee).toMatchObject(expectedFee);\r\n        });\r\n    });\r\n\r\n    describe('calculateFeeAsync v2', () => {\r\n        const feeModelVersion = 2;\r\n        it('should calculate v2 `price improvement` based fee for sell correctly if price improvement detection succeeded', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(1e18);\r\n            const marginRakeRatio = 0.5;\r\n\r\n            const ammMakerAmount = new BigNumber(3450e6);\r\n            const expectedSlippage = new BigNumber(-0.01);\r\n            const estimatedAmmGasFeeWei = new BigNumber(100e9);\r\n            const decodedUniqueId = '1234-5678';\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: ammMakerAmount,\r\n                takerAmount: assetFillAmount,\r\n                expectedSlippage,\r\n                estimatedGasFeeWei: estimatedAmmGasFeeWei,\r\n                decodedUniqueId,\r\n            };\r\n\r\n            const mm1MakerAmount = new BigNumber(3550e6);\r\n            const mm2MakerAmount = new BigNumber(3600e6);\r\n            const mmQuotes: IndicativeQuote[] = [\r\n                {\r\n                    maker: 'maker1Address',\r\n                    makerUri: 'http://maker1.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm1MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n                {\r\n                    maker: 'maker2Address',\r\n                    makerUri: 'http://maker2.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm2MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n            ];\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio,\r\n                    tradeSizeBps: 0,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice,\r\n                ammQuote,\r\n            });\r\n\r\n            const quoteContext: QuoteContext = {\r\n                workflow,\r\n                chainId: 1337,\r\n                isFirm: true,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            };\r\n\r\n            // When\r\n            jest.useFakeTimers().setSystemTime(1650000000000);\r\n            const { feeWithDetails, quotesWithGasFee, ammQuoteUniqueId } = await feeService.calculateFeeAsync(\r\n                quoteContext,\r\n                async () => {\r\n                    return Promise.resolve(mmQuotes);\r\n                },\r\n            );\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n            const expectedMargin = mm2MakerAmount\r\n                .minus(ammMakerAmount.times(new BigNumber(1).plus(expectedSlippage)))\r\n                .times(makerTokenPrice)\r\n                .div(feeTokenPrice)\r\n                .plus(estimatedAmmGasFeeWei)\r\n                .integerValue();\r\n            const expectedZeroExFeeAmount = expectedMargin.times(marginRakeRatio).integerValue();\r\n            const expectedTotalFeeAmount = expectedZeroExFeeAmount.plus(expectedGasFeeAmount);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedTotalFeeAmount,\r\n                details: {\r\n                    kind: 'margin',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: expectedZeroExFeeAmount,\r\n                    margin: expectedMargin,\r\n                    marginRakeRatio,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: expectedZeroExFeeAmount,\r\n                        details: {\r\n                            kind: 'price_improvement',\r\n                            priceImprovement: expectedMargin,\r\n                            rakeRatio: marginRakeRatio,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n            };\r\n            expect(feeWithDetails).toMatchObject(expectedFee);\r\n            expect(quotesWithGasFee).toMatchObject(mmQuotes);\r\n            expect(ammQuoteUniqueId).toBe(decodedUniqueId);\r\n\r\n            // When\r\n            const revisedQuotes = await feeService.reviseQuotesAsync(\r\n                // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                quotesWithGasFee!,\r\n                expectedZeroExFeeAmount,\r\n                quoteContext,\r\n            );\r\n\r\n            // Then\r\n            const expectedRevisedQuotes = mmQuotes.map((quote) =>\r\n                reviseQuoteWithFees(quote, expectedZeroExFeeAmount, isSelling, makerTokenPrice, feeTokenPrice),\r\n            );\r\n\r\n            expect(revisedQuotes).toMatchObject(expectedRevisedQuotes);\r\n        });\r\n        it('should calculate v2 `price improvement` based fee for buy correctly if price improvement detection succeeded', async () => {\r\n            // Given\r\n            const isSelling = false;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(1e18);\r\n            const marginRakeRatio = 0.4;\r\n\r\n            const ammTakerAmount = new BigNumber(3450e6);\r\n            const expectedSlippage = new BigNumber(-0.1);\r\n            const estimatedAmmGasFeeWei = new BigNumber(100e9);\r\n            const decodedUniqueId = '1234-5678';\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: assetFillAmount,\r\n                takerAmount: ammTakerAmount,\r\n                expectedSlippage,\r\n                estimatedGasFeeWei: estimatedAmmGasFeeWei,\r\n                decodedUniqueId,\r\n            };\r\n\r\n            const mm1TakerAmount = new BigNumber(3400e6);\r\n            const mm2TakerAmount = new BigNumber(3350e6);\r\n            const mmQuotes: IndicativeQuote[] = [\r\n                {\r\n                    maker: 'maker1Address',\r\n                    makerUri: 'http://maker1.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: assetFillAmount,\r\n                    takerAmount: mm1TakerAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n                {\r\n                    maker: 'maker2Address',\r\n                    makerUri: 'http://maker2.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: assetFillAmount,\r\n                    takerAmount: mm2TakerAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n            ];\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio,\r\n                    tradeSizeBps: 0,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: takerTokenPrice,\r\n                feeTokenPrice,\r\n                ammQuote,\r\n            });\r\n\r\n            const quoteContext: QuoteContext = {\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                makerAmount: assetFillAmount,\r\n                isFirm: false,\r\n                takerAddress,\r\n                integrator,\r\n            };\r\n\r\n            // When\r\n            jest.useFakeTimers().setSystemTime(1650000000000);\r\n            const { feeWithDetails, quotesWithGasFee, ammQuoteUniqueId } = await feeService.calculateFeeAsync(\r\n                quoteContext,\r\n                async () => {\r\n                    return Promise.resolve(mmQuotes);\r\n                },\r\n            );\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n            const expectedMargin = ammTakerAmount\r\n                .times(new BigNumber(1).minus(expectedSlippage))\r\n                .minus(mm2TakerAmount)\r\n                .times(takerTokenPrice)\r\n                .div(feeTokenPrice)\r\n                .plus(estimatedAmmGasFeeWei)\r\n                .integerValue();\r\n            const expectedZeroExFeeAmount = expectedMargin.times(marginRakeRatio).integerValue();\r\n            const expectedTotalFeeAmount = expectedZeroExFeeAmount.plus(expectedGasFeeAmount);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedTotalFeeAmount,\r\n                details: {\r\n                    kind: 'margin',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: expectedZeroExFeeAmount,\r\n                    margin: expectedMargin,\r\n                    marginRakeRatio,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: takerTokenPrice,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: expectedZeroExFeeAmount,\r\n                        details: {\r\n                            kind: 'price_improvement',\r\n                            priceImprovement: expectedMargin,\r\n                            rakeRatio: marginRakeRatio,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: takerTokenPrice,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(feeWithDetails).toMatchObject(expectedFee);\r\n            expect(quotesWithGasFee).toMatchObject(mmQuotes);\r\n            expect(ammQuoteUniqueId).toBe(decodedUniqueId);\r\n\r\n            // When\r\n            const revisedQuotes = await feeService.reviseQuotesAsync(\r\n                // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                quotesWithGasFee!,\r\n                expectedZeroExFeeAmount,\r\n                quoteContext,\r\n            );\r\n\r\n            // Then\r\n            const expectedRevisedQuotes = mmQuotes.map((quote) =>\r\n                reviseQuoteWithFees(quote, expectedZeroExFeeAmount, isSelling, takerTokenPrice, feeTokenPrice),\r\n            );\r\n\r\n            expect(revisedQuotes).toMatchObject(expectedRevisedQuotes);\r\n        });\r\n        it('should calculate v2 `default` fee correctly if token price query succeeded but 0x-api query failed', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(1e18);\r\n            const marginRakeRatio = 0.5;\r\n            const tradeSizeBps = 5;\r\n\r\n            const ammQuote = null;\r\n\r\n            const mm1MakerAmount = new BigNumber(3550e6);\r\n            const mm2MakerAmount = new BigNumber(3600e6);\r\n            const mmQuotes: IndicativeQuote[] = [\r\n                {\r\n                    maker: 'maker1Address',\r\n                    makerUri: 'http://maker1.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm1MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n                {\r\n                    maker: 'maker2Address',\r\n                    makerUri: 'http://maker2.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm2MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n            ];\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice,\r\n                ammQuote,\r\n            });\r\n\r\n            const quoteContext: QuoteContext = {\r\n                workflow,\r\n                chainId: 1337,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                isFirm: true,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            };\r\n\r\n            // When\r\n            jest.useFakeTimers().setSystemTime(1650000000000);\r\n            const { feeWithDetails, quotesWithGasFee, ammQuoteUniqueId } = await feeService.calculateFeeAsync(\r\n                quoteContext,\r\n                async () => {\r\n                    return Promise.resolve(mmQuotes);\r\n                },\r\n            );\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n            const expectedZeroExFeeAmount = calculateDefaultFeeAmount(\r\n                mm2MakerAmount,\r\n                tradeSizeBps,\r\n                makerTokenPrice,\r\n                feeTokenPrice,\r\n            );\r\n            const expectedTotalFeeAmount = expectedZeroExFeeAmount.plus(expectedGasFeeAmount);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedTotalFeeAmount,\r\n                details: {\r\n                    kind: 'default',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: expectedZeroExFeeAmount,\r\n                    tradeSizeBps,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: expectedZeroExFeeAmount,\r\n                        details: {\r\n                            kind: 'volume',\r\n                            tradeSizeBps,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n            };\r\n            expect(feeWithDetails).toMatchObject(expectedFee);\r\n            expect(quotesWithGasFee).toMatchObject(mmQuotes);\r\n            expect(ammQuoteUniqueId).toBe(undefined);\r\n\r\n            // When\r\n            const revisedQuotes = await feeService.reviseQuotesAsync(\r\n                // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me\r\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n                quotesWithGasFee!,\r\n                expectedZeroExFeeAmount,\r\n                quoteContext,\r\n            );\r\n\r\n            // Then\r\n            const expectedRevisedQuotes = mmQuotes.map((quote) =>\r\n                reviseQuoteWithFees(quote, expectedZeroExFeeAmount, isSelling, makerTokenPrice, feeTokenPrice),\r\n            );\r\n\r\n            expect(revisedQuotes).toMatchObject(expectedRevisedQuotes);\r\n        });\r\n        it('should calculate v2 `gasOnly` fee correctly if token price query failed', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(1e18);\r\n            const marginRakeRatio = 0.5;\r\n            const tradeSizeBps = 5;\r\n\r\n            const ammMakerAmount = new BigNumber(3450e6);\r\n            const expectedSlippage = new BigNumber(-0.01);\r\n            const estimatedAmmGasFeeWei = new BigNumber(100e9);\r\n            const decodedUniqueId = '1234-5678';\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: ammMakerAmount,\r\n                takerAmount: assetFillAmount,\r\n                expectedSlippage,\r\n                estimatedGasFeeWei: estimatedAmmGasFeeWei,\r\n                decodedUniqueId,\r\n            };\r\n\r\n            const mm1MakerAmount = new BigNumber(3550e6);\r\n            const mm2MakerAmount = new BigNumber(3600e6);\r\n            const mmQuotes: IndicativeQuote[] = [\r\n                {\r\n                    maker: 'maker1Address',\r\n                    makerUri: 'http://maker1.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm1MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n                {\r\n                    maker: 'maker2Address',\r\n                    makerUri: 'http://maker2.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm2MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n            ];\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio,\r\n                    tradeSizeBps,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice: null,\r\n                ammQuote,\r\n            });\r\n\r\n            // When\r\n            jest.useFakeTimers().setSystemTime(1650000000000);\r\n            const { feeWithDetails, quotesWithGasFee, ammQuoteUniqueId } = await feeService.calculateFeeAsync(\r\n                {\r\n                    workflow,\r\n                    chainId: 1337,\r\n                    feeModelVersion,\r\n                    txOrigin,\r\n                    makerToken,\r\n                    takerToken,\r\n                    originalMakerToken: makerToken,\r\n                    makerTokenDecimals,\r\n                    takerTokenDecimals,\r\n                    isUnwrap,\r\n                    isSelling,\r\n                    assetFillAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    isFirm: true,\r\n                    takerAddress,\r\n                    trader: takerAddress,\r\n                    integrator,\r\n                },\r\n                async () => {\r\n                    return Promise.resolve(mmQuotes);\r\n                },\r\n            );\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedGasFeeAmount,\r\n                details: {\r\n                    kind: 'gasOnly',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: null,\r\n                    feeTokenBaseUnitPriceUsd: null,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: null,\r\n                },\r\n            };\r\n            expect(feeWithDetails).toMatchObject(expectedFee);\r\n            expect(quotesWithGasFee).toMatchObject(mmQuotes);\r\n            expect(ammQuoteUniqueId).toBe(decodedUniqueId);\r\n        });\r\n        it('should calculate v2 `price improvement` based fee with zero zeroExFee if price improvement is zero', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(1e18);\r\n            const marginRakeRatio = 0.5;\r\n\r\n            const ammMakerAmount = new BigNumber(4000e6);\r\n            const expectedSlippage = new BigNumber(-0.01);\r\n            const estimatedAmmGasFeeWei = new BigNumber(100e9);\r\n            const decodedUniqueId = '1234-5678';\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: ammMakerAmount,\r\n                takerAmount: assetFillAmount,\r\n                expectedSlippage,\r\n                estimatedGasFeeWei: estimatedAmmGasFeeWei,\r\n                decodedUniqueId,\r\n            };\r\n\r\n            const mm1MakerAmount = new BigNumber(3550e6);\r\n            const mm2MakerAmount = new BigNumber(3600e6);\r\n            const mmQuotes: IndicativeQuote[] = [\r\n                {\r\n                    maker: 'maker1Address',\r\n                    makerUri: 'http://maker1.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm1MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n                {\r\n                    maker: 'maker2Address',\r\n                    makerUri: 'http://maker2.com',\r\n                    makerToken,\r\n                    takerToken,\r\n                    makerAmount: mm2MakerAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    expiry: new BigNumber(1652722767),\r\n                },\r\n            ];\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio,\r\n                    tradeSizeBps: 0,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice,\r\n                ammQuote,\r\n            });\r\n\r\n            // When\r\n            jest.useFakeTimers().setSystemTime(1650000000000);\r\n            const { feeWithDetails, quotesWithGasFee, ammQuoteUniqueId } = await feeService.calculateFeeAsync(\r\n                {\r\n                    workflow,\r\n                    chainId: 1337,\r\n                    feeModelVersion,\r\n                    txOrigin,\r\n                    makerToken,\r\n                    takerToken,\r\n                    originalMakerToken: makerToken,\r\n                    makerTokenDecimals,\r\n                    takerTokenDecimals,\r\n                    isUnwrap,\r\n                    isSelling,\r\n                    assetFillAmount,\r\n                    takerAmount: assetFillAmount,\r\n                    isFirm: true,\r\n                    takerAddress,\r\n                    trader: takerAddress,\r\n                    integrator,\r\n                },\r\n                async () => {\r\n                    return Promise.resolve(mmQuotes);\r\n                },\r\n            );\r\n\r\n            // Then\r\n            const expectedGasFeeAmount = gasPrice.times(gasEstimate);\r\n\r\n            const expectedFee: FeeWithDetails = {\r\n                type: 'fixed',\r\n                token: feeTokenAddress,\r\n                amount: expectedGasFeeAmount,\r\n                details: {\r\n                    kind: 'margin',\r\n                    feeModelVersion,\r\n                    gasFeeAmount: expectedGasFeeAmount,\r\n                    gasPrice,\r\n                    zeroExFeeAmount: ZERO,\r\n                    margin: ZERO,\r\n                    marginRakeRatio,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n                breakdown: {\r\n                    gas: {\r\n                        amount: expectedGasFeeAmount,\r\n                        details: {\r\n                            gasPrice,\r\n                            estimatedGas: new BigNumber(gasEstimate),\r\n                        },\r\n                    },\r\n                    zeroEx: {\r\n                        amount: ZERO,\r\n                        details: {\r\n                            kind: 'price_improvement',\r\n                            priceImprovement: ZERO,\r\n                            rakeRatio: marginRakeRatio,\r\n                        },\r\n                    },\r\n                },\r\n                conversionRates: {\r\n                    nativeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    feeTokenBaseUnitPriceUsd: feeTokenPrice,\r\n                    takerTokenBaseUnitPriceUsd: null,\r\n                    makerTokenBaseUnitPriceUsd: makerTokenPrice,\r\n                },\r\n            };\r\n            expect(feeWithDetails).toMatchObject(expectedFee);\r\n            expect(quotesWithGasFee).toMatchObject(mmQuotes);\r\n            expect(ammQuoteUniqueId).toBe(decodedUniqueId);\r\n        });\r\n        it('should throw if called from RFQt workflow', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const isUnwrap = false;\r\n            const assetFillAmount = new BigNumber(1e18);\r\n            const marginRakeRatio = 0.5;\r\n\r\n            const ammMakerAmount = new BigNumber(3450e6);\r\n            const expectedSlippage = new BigNumber(-0.01);\r\n            const estimatedAmmGasFeeWei = new BigNumber(100e9);\r\n            const decodedUniqueId = '1234-5678';\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: ammMakerAmount,\r\n                takerAmount: assetFillAmount,\r\n                expectedSlippage,\r\n                estimatedGasFeeWei: estimatedAmmGasFeeWei,\r\n                decodedUniqueId,\r\n            };\r\n\r\n            const feeService: FeeService = buildFeeService({\r\n                feeModelConfiguration: {\r\n                    marginRakeRatio,\r\n                    tradeSizeBps: 0,\r\n                },\r\n                gasPrice,\r\n                tradeTokenPrice: makerTokenPrice,\r\n                feeTokenPrice,\r\n                ammQuote,\r\n            });\r\n\r\n            const quoteContext: QuoteContext = {\r\n                workflow: 'rfqt',\r\n                chainId: 1337,\r\n                isFirm: true,\r\n                feeModelVersion,\r\n                txOrigin,\r\n                makerToken,\r\n                takerToken,\r\n                originalMakerToken: makerToken,\r\n                makerTokenDecimals,\r\n                takerTokenDecimals,\r\n                isUnwrap,\r\n                isSelling,\r\n                assetFillAmount,\r\n                takerAmount: assetFillAmount,\r\n                takerAddress,\r\n                trader: takerAddress,\r\n                integrator,\r\n            };\r\n\r\n            // When\r\n            await expect(() => feeService.calculateFeeAsync(quoteContext)).rejects.toThrow('Not implemented');\r\n        });\r\n    });\r\n\r\n    describe('pure function calculateDefaultFeeAmount()', () => {\r\n        it('should calculate default fee amount correctly', async () => {\r\n            // Given\r\n            const tradeTokenAmount = new BigNumber(1e18);\r\n            const feeRateBps = 5;\r\n            const tradeTokenBaseUnitPriceUsd = new BigNumber(6e-14);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const defaultFeeAmount = calculateDefaultFeeAmount(\r\n                tradeTokenAmount,\r\n                feeRateBps,\r\n                tradeTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            const expectedDefaultFeeAmount = new BigNumber(1e16);\r\n            expect(defaultFeeAmount).toMatchObject(expectedDefaultFeeAmount);\r\n        });\r\n        it('should return zero if bps is zero', async () => {\r\n            // Given\r\n            const tradeTokenAmount = new BigNumber(1e18);\r\n            const feeRateBps = 0;\r\n            const tradeTokenBaseUnitPriceUsd = new BigNumber(6e-14);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const defaultFeeAmount = calculateDefaultFeeAmount(\r\n                tradeTokenAmount,\r\n                feeRateBps,\r\n                tradeTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            expect(defaultFeeAmount).toMatchObject(ZERO);\r\n        });\r\n        it('should return zero if either trade token price or fee token price is null', async () => {\r\n            // Given\r\n            const tradeTokenAmount = new BigNumber(1e18);\r\n            const feeRateBps = 5;\r\n            const tradeTokenBaseUnitPriceUsd = new BigNumber(6e-14);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const defaultFeeAmount1 = calculateDefaultFeeAmount(\r\n                tradeTokenAmount,\r\n                feeRateBps,\r\n                null,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n            const defaultFeeAmount2 = calculateDefaultFeeAmount(\r\n                tradeTokenAmount,\r\n                feeRateBps,\r\n                tradeTokenBaseUnitPriceUsd,\r\n                null,\r\n            );\r\n\r\n            // Then\r\n            expect(defaultFeeAmount1).toMatchObject(ZERO);\r\n            expect(defaultFeeAmount2).toMatchObject(ZERO);\r\n        });\r\n    });\r\n    describe('pure function calculatePriceImprovementAmount()', () => {\r\n        it('should calculate price improvement amount for selling correctly', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const assetFillAmount = new BigNumber(3e17);\r\n            const makerQuoteWithGasFee: IndicativeQuote = {\r\n                maker: 'maker1Address',\r\n                makerUri: 'http://maker1.com',\r\n                makerToken,\r\n                takerToken,\r\n                makerAmount: new BigNumber(1100e6),\r\n                takerAmount: assetFillAmount,\r\n                expiry: new BigNumber(1652722767),\r\n            };\r\n\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: new BigNumber(1000e6),\r\n                takerAmount: assetFillAmount,\r\n                expectedSlippage: new BigNumber(-0.02),\r\n                estimatedGasFeeWei: new BigNumber(10e15),\r\n            };\r\n\r\n            const quoteTokenBaseUnitPriceUsd = new BigNumber(1e-6);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const priceImprovementAmount = calculatePriceImprovementAmount(\r\n                makerQuoteWithGasFee,\r\n                ammQuote,\r\n                isSelling,\r\n                quoteTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            const expectedPriceImprovementAmount = new BigNumber(50e15);\r\n            expect(priceImprovementAmount).toMatchObject(expectedPriceImprovementAmount);\r\n        });\r\n        it('should calculate price improvement amount for buying correctly', async () => {\r\n            // Given\r\n            const isSelling = false;\r\n            const assetFillAmount = new BigNumber(3e17);\r\n            const makerQuoteWithGasFee: IndicativeQuote = {\r\n                maker: 'maker1Address',\r\n                makerUri: 'http://maker1.com',\r\n                makerToken,\r\n                takerToken,\r\n                makerAmount: assetFillAmount,\r\n                takerAmount: new BigNumber(900e6),\r\n                expiry: new BigNumber(1652722767),\r\n            };\r\n\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: assetFillAmount,\r\n                takerAmount: new BigNumber(1000e6),\r\n                expectedSlippage: new BigNumber(-0.02),\r\n                estimatedGasFeeWei: new BigNumber(10e15),\r\n            };\r\n\r\n            const quoteTokenBaseUnitPriceUsd = new BigNumber(1e-6);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const priceImprovementAmount = calculatePriceImprovementAmount(\r\n                makerQuoteWithGasFee,\r\n                ammQuote,\r\n                isSelling,\r\n                quoteTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            const expectedPriceImprovementAmount = new BigNumber(50e15);\r\n            expect(priceImprovementAmount).toMatchObject(expectedPriceImprovementAmount);\r\n        });\r\n        it('should return zero if there is no price improvement', async () => {\r\n            // Given\r\n            const isSelling = false;\r\n            const assetFillAmount = new BigNumber(3e17);\r\n            const makerQuoteWithGasFee: IndicativeQuote = {\r\n                maker: 'maker1Address',\r\n                makerUri: 'http://maker1.com',\r\n                makerToken,\r\n                takerToken,\r\n                makerAmount: assetFillAmount,\r\n                takerAmount: new BigNumber(1051e6),\r\n                expiry: new BigNumber(1652722767),\r\n            };\r\n\r\n            const ammQuote: AmmQuote = {\r\n                makerAmount: assetFillAmount,\r\n                takerAmount: new BigNumber(1000e6),\r\n                expectedSlippage: new BigNumber(-0.02),\r\n                estimatedGasFeeWei: new BigNumber(10e15),\r\n            };\r\n\r\n            const quoteTokenBaseUnitPriceUsd = new BigNumber(1e-6);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const priceImprovementAmount = calculatePriceImprovementAmount(\r\n                makerQuoteWithGasFee,\r\n                ammQuote,\r\n                isSelling,\r\n                quoteTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            expect(priceImprovementAmount).toMatchObject(ZERO);\r\n        });\r\n    });\r\n    describe('pure function reviseQuoteWithZeroExFee()', () => {\r\n        it('should revise quote correctly for selling', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const assetFillAmount = new BigNumber(3e17);\r\n            const makerQuoteWithGasFee: IndicativeQuote = {\r\n                maker: 'maker1Address',\r\n                makerUri: 'http://maker1.com',\r\n                makerToken,\r\n                takerToken,\r\n                makerAmount: new BigNumber(1000e6),\r\n                takerAmount: assetFillAmount,\r\n                expiry: new BigNumber(1652722767),\r\n            };\r\n\r\n            const zeroExFeeAmount = new BigNumber(10e15);\r\n\r\n            const quoteTokenBaseUnitPriceUsd = new BigNumber(1e-6);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const revisedQuote = reviseQuoteWithFees(\r\n                makerQuoteWithGasFee,\r\n                zeroExFeeAmount,\r\n                isSelling,\r\n                quoteTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            const expectedRevisedMakerAmount = new BigNumber(970e6);\r\n            expect(revisedQuote.makerAmount).toMatchObject(expectedRevisedMakerAmount);\r\n        });\r\n        it('should revise quote correctly for buying', async () => {\r\n            // Given\r\n            const isSelling = false;\r\n            const assetFillAmount = new BigNumber(3e17);\r\n            const makerQuoteWithGasFee: IndicativeQuote = {\r\n                maker: 'maker1Address',\r\n                makerUri: 'http://maker1.com',\r\n                makerToken,\r\n                takerToken,\r\n                makerAmount: assetFillAmount,\r\n                takerAmount: new BigNumber(1000e6),\r\n                expiry: new BigNumber(1652722767),\r\n            };\r\n\r\n            const zeroExFeeAmount = new BigNumber(10e15);\r\n\r\n            const quoteTokenBaseUnitPriceUsd = new BigNumber(1e-6);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const revisedQuote = reviseQuoteWithFees(\r\n                makerQuoteWithGasFee,\r\n                zeroExFeeAmount,\r\n                isSelling,\r\n                quoteTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            const expectedRevisedTakerAmount = new BigNumber(1030e6);\r\n            expect(revisedQuote.takerAmount).toMatchObject(expectedRevisedTakerAmount);\r\n        });\r\n        it('should not revise quote correctly for zero zeroExFee', async () => {\r\n            // Given\r\n            const isSelling = true;\r\n            const assetFillAmount = new BigNumber(3e17);\r\n            const makerQuoteWithGasFee: IndicativeQuote = {\r\n                maker: 'maker1Address',\r\n                makerUri: 'http://maker1.com',\r\n                makerToken,\r\n                takerToken,\r\n                makerAmount: new BigNumber(1000e6),\r\n                takerAmount: assetFillAmount,\r\n                expiry: new BigNumber(1652722767),\r\n            };\r\n\r\n            const zeroExFeeAmount = ZERO;\r\n\r\n            const quoteTokenBaseUnitPriceUsd = new BigNumber(1e-6);\r\n            const feeTokenBaseUnitPriceUsd = new BigNumber(3e-15);\r\n\r\n            // When\r\n            const revisedQuote = reviseQuoteWithFees(\r\n                makerQuoteWithGasFee,\r\n                zeroExFeeAmount,\r\n                isSelling,\r\n                quoteTokenBaseUnitPriceUsd,\r\n                feeTokenBaseUnitPriceUsd,\r\n            );\r\n\r\n            // Then\r\n            const expectedRevisedMakerAmount = new BigNumber(1000e6);\r\n            expect(revisedQuote.makerAmount).toMatchObject(expectedRevisedMakerAmount);\r\n            expect(revisedQuote.takerAmount).toMatchObject(assetFillAmount);\r\n        });\r\n    });\r\n});\r\n"],"version":3}