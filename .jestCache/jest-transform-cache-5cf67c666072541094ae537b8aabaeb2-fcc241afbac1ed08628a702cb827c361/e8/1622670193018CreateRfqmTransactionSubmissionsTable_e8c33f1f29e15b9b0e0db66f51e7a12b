606dffd8c726fb4e44fb659335e8e20f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CreateRfqmTransactionSubmissionsTable1622670193018 = void 0;
const typeorm_1 = require("typeorm");
const newTableName = 'rfqm_transaction_submissions';
const transactionSubmissionsTable = new typeorm_1.Table({
    name: newTableName,
    columns: [
        { name: 'transaction_hash', type: 'varchar', isPrimary: true },
        { name: 'order_hash', type: 'varchar' },
        { name: 'created_at', type: 'timestamptz', default: 'NOW()' },
        { name: 'updated_at', type: 'timestamptz', isNullable: true },
        // important transaction properties
        { name: 'from', type: 'varchar', isNullable: true },
        { name: 'to', type: 'varchar', isNullable: true },
        { name: 'nonce', type: 'bigint', isNullable: true },
        { name: 'gas_price', type: 'numeric', isNullable: true },
        { name: 'gas_used', type: 'numeric', isNullable: true },
        { name: 'block_mined', type: 'numeric', isNullable: true },
        { name: 'status', type: 'varchar' },
        { name: 'status_reason', type: 'varchar', isNullable: true },
        { name: 'metadata', type: 'jsonb', isNullable: true },
    ],
});
const createdAtIndex = new typeorm_1.TableIndex({
    name: `rfqm_transaction_submissions_created_at_index`,
    columnNames: ['created_at'],
});
const statusIndex = new typeorm_1.TableIndex({ name: `rfqm_transaction_submissions_status_index`, columnNames: ['status'] });
const foreignKey = new typeorm_1.TableForeignKey({
    name: 'rfqm_transaction_submissions_order_hash_foreign_key',
    columnNames: ['order_hash'],
    referencedColumnNames: ['order_hash'],
    referencedTableName: 'rfqm_jobs',
    onDelete: 'RESTRICT',
});
class CreateRfqmTransactionSubmissionsTable1622670193018 {
    async up(queryRunner) {
        await queryRunner.createTable(transactionSubmissionsTable);
        await queryRunner.createIndex(newTableName, createdAtIndex);
        await queryRunner.createIndex(newTableName, statusIndex);
        await queryRunner.createForeignKey(newTableName, foreignKey);
    }
    async down(queryRunner) {
        await queryRunner.dropForeignKey(newTableName, foreignKey);
        await queryRunner.dropIndex(newTableName, createdAtIndex);
        await queryRunner.dropIndex(newTableName, statusIndex);
        await queryRunner.dropTable(transactionSubmissionsTable);
    }
}
exports.CreateRfqmTransactionSubmissionsTable1622670193018 = CreateRfqmTransactionSubmissionsTable1622670193018;
//# sourceMappingURL=1622670193018-CreateRfqmTransactionSubmissionsTable.js.map