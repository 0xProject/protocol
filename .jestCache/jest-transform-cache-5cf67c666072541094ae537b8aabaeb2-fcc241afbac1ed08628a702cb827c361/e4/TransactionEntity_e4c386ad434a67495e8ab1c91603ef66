90261c539aed5f393a1d63236ad21421
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var TransactionEntity_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TransactionEntity = void 0;
const assert_1 = require("@0x/assert");
const utils_1 = require("@0x/utils");
const typeorm_1 = require("typeorm");
const config_1 = require("../config");
const constants_1 = require("../core/constants");
const transformers_1 = require("./transformers");
var TransactionStates;
(function (TransactionStates) {
    // transaction has been constructed, but not yet submitted to the network.
    TransactionStates["Unsubmitted"] = "unsubmitted";
    // transaction has been submitted to the network.
    TransactionStates["Submitted"] = "submitted";
    // transaction has been spotted in the mempool.
    TransactionStates["Mempool"] = "mempool";
    // transaction has not been mined in the expected time.
    TransactionStates["Stuck"] = "stuck";
    // transaction has been mined.
    TransactionStates["Included"] = "included";
    // transaction is confirmed.
    TransactionStates["Confirmed"] = "confirmed";
    // transaction is no longer in the mempool.
    TransactionStates["Dropped"] = "dropped";
    // transaction has been aborted because a new transaction with the same
    // nonce has been mined.
    TransactionStates["Aborted"] = "aborted";
    // transaction was in an unsubmitted state for too long.
    TransactionStates["Cancelled"] = "cancelled";
})(TransactionStates || (TransactionStates = {}));
let TransactionEntity = TransactionEntity_1 = class TransactionEntity {
    // HACK(oskar) we want all fields to be set and valid, otherwise we should
    // not accept a transaction entity, however because of this issue:
    // https://github.com/typeorm/typeorm/issues/1772 we cannot accept undefined
    // as an argument to the constructor, to not break migrations with
    // serialize. Please use the public static make method instead.
    constructor(opts = {
        refHash: '',
        txHash: '',
        to: '',
        data: '',
        apiKey: '',
        takerAddress: '',
        status: '',
        expectedMinedInSec: config_1.META_TXN_RELAY_EXPECTED_MINED_SEC,
        nonce: 0,
        gasPrice: constants_1.ZERO,
        value: constants_1.ZERO,
        from: '',
        gas: null,
        gasUsed: null,
        txStatus: null,
    }) {
        this.refHash = opts.refHash;
        this.txHash = opts.txHash;
        this.takerAddress = opts.takerAddress;
        this.to = opts.to;
        this.data = opts.data;
        this.apiKey = opts.apiKey;
        this.status = opts.status;
        this.expectedMinedInSec = opts.expectedMinedInSec;
        this.nonce = opts.nonce;
        this.gasPrice = opts.gasPrice;
        this.value = opts.value;
        this.blockNumber = opts.blockNumber;
        this.from = opts.from;
        this.gas = opts.gas;
        this.gasUsed = opts.gasUsed;
        this.txStatus = opts.txStatus;
        const now = new Date();
        this.expectedAt = new Date(now.getTime() + this.expectedMinedInSec * constants_1.ONE_SECOND_MS);
    }
    static make(opts) {
        assert_1.assert.isHexString('refHash', opts.refHash);
        if (opts.txHash !== undefined) {
            assert_1.assert.isHexString('txHash', opts.txHash);
        }
        if (opts.from !== undefined) {
            assert_1.assert.isETHAddressHex('from', opts.from);
        }
        assert_1.assert.doesBelongToStringEnum('status', opts.status, TransactionStates);
        if (opts.nonce !== undefined && !Number.isInteger(opts.nonce) && opts.nonce <= 0) {
            throw new Error(`Expected nonce to be a positive integer, encountered: ${opts.nonce}`);
        }
        if (opts.blockNumber !== undefined && !Number.isInteger(opts.blockNumber) && opts.blockNumber <= 0) {
            throw new Error(`Expected blockNumber to be a positive integer, encountered: ${opts.blockNumber}`);
        }
        return new TransactionEntity_1(opts);
    }
};
__decorate([
    (0, typeorm_1.PrimaryColumn)({ name: 'ref_hash', type: 'varchar' }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "refHash", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'data', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "data", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'to', type: 'varchar' }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "to", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'tx_hash', type: 'varchar', unique: true, nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "txHash", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'status', type: 'varchar' }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'taker_address', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "takerAddress", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'expected_mined_in_sec', type: 'int' }),
    __metadata("design:type", Number)
], TransactionEntity.prototype, "expectedMinedInSec", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'gas_price', type: 'bigint', nullable: true, transformer: transformers_1.BigNumberTransformer }),
    __metadata("design:type", utils_1.BigNumber)
], TransactionEntity.prototype, "gasPrice", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'value', type: 'bigint', nullable: true, transformer: transformers_1.BigNumberTransformer }),
    __metadata("design:type", utils_1.BigNumber)
], TransactionEntity.prototype, "value", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'gas', type: 'int', nullable: true }),
    __metadata("design:type", Object)
], TransactionEntity.prototype, "gas", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'from', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "from", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'nonce', type: 'bigint', nullable: true, transformer: transformers_1.BigIntTransformer }),
    __metadata("design:type", Number)
], TransactionEntity.prototype, "nonce", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'gas_used', type: 'int', nullable: true }),
    __metadata("design:type", Object)
], TransactionEntity.prototype, "gasUsed", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'block_number', type: 'bigint', nullable: true, transformer: transformers_1.BigIntTransformer }),
    __metadata("design:type", Number)
], TransactionEntity.prototype, "blockNumber", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'tx_status', type: 'int', nullable: true }),
    __metadata("design:type", Object)
], TransactionEntity.prototype, "txStatus", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'api_key', type: 'varchar', nullable: true }),
    __metadata("design:type", String)
], TransactionEntity.prototype, "apiKey", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({ name: 'created_at', type: 'timestamptz' }),
    __metadata("design:type", Date)
], TransactionEntity.prototype, "createdAt", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)({ name: 'updated_at', type: 'timestamptz' }),
    __metadata("design:type", Date)
], TransactionEntity.prototype, "updatedAt", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'expected_at', type: 'timestamptz' }),
    __metadata("design:type", Date)
], TransactionEntity.prototype, "expectedAt", void 0);
TransactionEntity = TransactionEntity_1 = __decorate([
    (0, typeorm_1.Entity)({ name: 'transactions' }),
    __metadata("design:paramtypes", [Object])
], TransactionEntity);
exports.TransactionEntity = TransactionEntity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3NyYy9lbnRpdGllcy9UcmFuc2FjdGlvbkVudGl0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEsdUNBQW9DO0FBQ3BDLHFDQUFzQztBQUN0QyxxQ0FBNEY7QUFFNUYsc0NBQThEO0FBQzlELGlEQUF3RDtBQUV4RCxpREFBeUU7QUFHekUsSUFBSyxpQkFvQko7QUFwQkQsV0FBSyxpQkFBaUI7SUFDbEIsMEVBQTBFO0lBQzFFLGdEQUEyQixDQUFBO0lBQzNCLGlEQUFpRDtJQUNqRCw0Q0FBdUIsQ0FBQTtJQUN2QiwrQ0FBK0M7SUFDL0Msd0NBQW1CLENBQUE7SUFDbkIsdURBQXVEO0lBQ3ZELG9DQUFlLENBQUE7SUFDZiw4QkFBOEI7SUFDOUIsMENBQXFCLENBQUE7SUFDckIsNEJBQTRCO0lBQzVCLDRDQUF1QixDQUFBO0lBQ3ZCLDJDQUEyQztJQUMzQyx3Q0FBbUIsQ0FBQTtJQUNuQix1RUFBdUU7SUFDdkUsd0JBQXdCO0lBQ3hCLHdDQUFtQixDQUFBO0lBQ25CLHdEQUF3RDtJQUN4RCw0Q0FBdUIsQ0FBQTtBQUMzQixDQUFDLEVBcEJJLGlCQUFpQixLQUFqQixpQkFBaUIsUUFvQnJCO0FBR0QsSUFBYSxpQkFBaUIseUJBQTlCLE1BQWEsaUJBQWlCO0lBK0UxQiwwRUFBMEU7SUFDMUUsa0VBQWtFO0lBQ2xFLDRFQUE0RTtJQUM1RSxrRUFBa0U7SUFDbEUsK0RBQStEO0lBQy9ELFlBQ0ksT0FBOEI7UUFDMUIsT0FBTyxFQUFFLEVBQUU7UUFDWCxNQUFNLEVBQUUsRUFBRTtRQUNWLEVBQUUsRUFBRSxFQUFFO1FBQ04sSUFBSSxFQUFFLEVBQUU7UUFDUixNQUFNLEVBQUUsRUFBRTtRQUNWLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE1BQU0sRUFBRSxFQUFFO1FBQ1Ysa0JBQWtCLEVBQUUsMENBQWlDO1FBQ3JELEtBQUssRUFBRSxDQUFDO1FBQ1IsUUFBUSxFQUFFLGdCQUFJO1FBQ2QsS0FBSyxFQUFFLGdCQUFJO1FBQ1gsSUFBSSxFQUFFLEVBQUU7UUFDUixHQUFHLEVBQUUsSUFBSTtRQUNULE9BQU8sRUFBRSxJQUFJO1FBQ2IsUUFBUSxFQUFFLElBQUk7S0FDakI7UUFFRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzFCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUN0QyxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMxQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDMUIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztRQUNsRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDeEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQzlCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQzlCLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixHQUFHLHlCQUFhLENBQUMsQ0FBQztJQUN4RixDQUFDO0lBNURNLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBMkI7UUFDMUMsZUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVDLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxTQUFTLEVBQUU7WUFDM0IsZUFBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQzdDO1FBQ0QsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRTtZQUN6QixlQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0M7UUFDRCxlQUFNLENBQUMsc0JBQXNCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztRQUN4RSxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssU0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQUU7WUFDOUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx5REFBeUQsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7U0FDMUY7UUFDRCxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssU0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLEVBQUU7WUFDaEcsTUFBTSxJQUFJLEtBQUssQ0FBQywrREFBK0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7U0FDdEc7UUFDRCxPQUFPLElBQUksbUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkMsQ0FBQztDQTZDSixDQUFBO0FBckhHO0lBSkMsSUFBQSx1QkFBYSxFQUFDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUM7O2tEQUk5QjtBQUd2QjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7OytDQUNyQztBQUdyQjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDOzs2Q0FDckI7QUFHbkI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7O2lEQUNwRDtBQUd2QjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDOztpREFDdEI7QUFHdEI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDOzt1REFDdEM7QUFHN0I7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsdUJBQXVCLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDOzs2REFDcEI7QUFHbkM7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsbUNBQW9CLEVBQUUsQ0FBQzs4QkFDL0UsaUJBQVM7bURBQUM7QUFHNUI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsbUNBQW9CLEVBQUUsQ0FBQzs4QkFDOUUsaUJBQVM7Z0RBQUM7QUFHekI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDOzs4Q0FDMUI7QUFHM0I7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDOzsrQ0FDckM7QUFHckI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsZ0NBQWlCLEVBQUUsQ0FBQzs7Z0RBQ3BFO0FBR3RCO0lBREMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQzs7a0RBQzNCO0FBRy9CO0lBREMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLGdDQUFpQixFQUFFLENBQUM7O3NEQUNyRTtBQUc1QjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7O21EQUMzQjtBQUdoQztJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7O2lEQUN0QztBQUd2QjtJQURDLElBQUEsMEJBQWdCLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsQ0FBQzs4QkFDM0MsSUFBSTtvREFBQztBQUd4QjtJQURDLElBQUEsMEJBQWdCLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsQ0FBQzs4QkFDM0MsSUFBSTtvREFBQztBQUd4QjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDOzhCQUNsQyxJQUFJO3FEQUFDO0FBM0RmLGlCQUFpQjtJQUQ3QixJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLENBQUM7O0dBQ3BCLGlCQUFpQixDQTBIN0I7QUExSFksOENBQWlCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS9zcmMvZW50aXRpZXMvVHJhbnNhY3Rpb25FbnRpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXNzZXJ0IH0gZnJvbSAnQDB4L2Fzc2VydCc7XG5pbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tICdAMHgvdXRpbHMnO1xuaW1wb3J0IHsgQ29sdW1uLCBDcmVhdGVEYXRlQ29sdW1uLCBFbnRpdHksIFByaW1hcnlDb2x1bW4sIFVwZGF0ZURhdGVDb2x1bW4gfSBmcm9tICd0eXBlb3JtJztcblxuaW1wb3J0IHsgTUVUQV9UWE5fUkVMQVlfRVhQRUNURURfTUlORURfU0VDIH0gZnJvbSAnLi4vY29uZmlnJztcbmltcG9ydCB7IE9ORV9TRUNPTkRfTVMsIFpFUk8gfSBmcm9tICcuLi9jb3JlL2NvbnN0YW50cyc7XG5cbmltcG9ydCB7IEJpZ0ludFRyYW5zZm9ybWVyLCBCaWdOdW1iZXJUcmFuc2Zvcm1lciB9IGZyb20gJy4vdHJhbnNmb3JtZXJzJztcbmltcG9ydCB7IFRyYW5zYWN0aW9uRW50aXR5T3B0cyB9IGZyb20gJy4vdHlwZXMnO1xuXG5lbnVtIFRyYW5zYWN0aW9uU3RhdGVzIHtcbiAgICAvLyB0cmFuc2FjdGlvbiBoYXMgYmVlbiBjb25zdHJ1Y3RlZCwgYnV0IG5vdCB5ZXQgc3VibWl0dGVkIHRvIHRoZSBuZXR3b3JrLlxuICAgIFVuc3VibWl0dGVkID0gJ3Vuc3VibWl0dGVkJyxcbiAgICAvLyB0cmFuc2FjdGlvbiBoYXMgYmVlbiBzdWJtaXR0ZWQgdG8gdGhlIG5ldHdvcmsuXG4gICAgU3VibWl0dGVkID0gJ3N1Ym1pdHRlZCcsXG4gICAgLy8gdHJhbnNhY3Rpb24gaGFzIGJlZW4gc3BvdHRlZCBpbiB0aGUgbWVtcG9vbC5cbiAgICBNZW1wb29sID0gJ21lbXBvb2wnLFxuICAgIC8vIHRyYW5zYWN0aW9uIGhhcyBub3QgYmVlbiBtaW5lZCBpbiB0aGUgZXhwZWN0ZWQgdGltZS5cbiAgICBTdHVjayA9ICdzdHVjaycsXG4gICAgLy8gdHJhbnNhY3Rpb24gaGFzIGJlZW4gbWluZWQuXG4gICAgSW5jbHVkZWQgPSAnaW5jbHVkZWQnLFxuICAgIC8vIHRyYW5zYWN0aW9uIGlzIGNvbmZpcm1lZC5cbiAgICBDb25maXJtZWQgPSAnY29uZmlybWVkJyxcbiAgICAvLyB0cmFuc2FjdGlvbiBpcyBubyBsb25nZXIgaW4gdGhlIG1lbXBvb2wuXG4gICAgRHJvcHBlZCA9ICdkcm9wcGVkJyxcbiAgICAvLyB0cmFuc2FjdGlvbiBoYXMgYmVlbiBhYm9ydGVkIGJlY2F1c2UgYSBuZXcgdHJhbnNhY3Rpb24gd2l0aCB0aGUgc2FtZVxuICAgIC8vIG5vbmNlIGhhcyBiZWVuIG1pbmVkLlxuICAgIEFib3J0ZWQgPSAnYWJvcnRlZCcsXG4gICAgLy8gdHJhbnNhY3Rpb24gd2FzIGluIGFuIHVuc3VibWl0dGVkIHN0YXRlIGZvciB0b28gbG9uZy5cbiAgICBDYW5jZWxsZWQgPSAnY2FuY2VsbGVkJyxcbn1cblxuQEVudGl0eSh7IG5hbWU6ICd0cmFuc2FjdGlvbnMnIH0pXG5leHBvcnQgY2xhc3MgVHJhbnNhY3Rpb25FbnRpdHkge1xuICAgIEBQcmltYXJ5Q29sdW1uKHsgbmFtZTogJ3JlZl9oYXNoJywgdHlwZTogJ3ZhcmNoYXInIH0pXG4gICAgLy8gcmVmZXJlbmNlIGhhc2ggY2FuIGJlIGVpdGhlciBiZSB0aGUgemVyb0V4VHJhbnNhY3Rpb24gaGFzaCBvciB0aGUgYWN0dWFsXG4gICAgLy8gdHhIYXNoIGRlcGVuZGluZyBvbiB3aGV0aGVyIHdlIGFyZSBzdWJtaXR0aW5nIGEgbWV0YS10cmFuc2FjdGlvbiBvciBhblxuICAgIC8vIHVuc3RpY2tpbmcgZXRoZXJldW0gdHJhbnNhY3Rpb24uXG4gICAgcHVibGljIHJlZkhhc2g6IHN0cmluZztcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAnZGF0YScsIHR5cGU6ICd2YXJjaGFyJywgbnVsbGFibGU6IHRydWUgfSlcbiAgICBwdWJsaWMgZGF0YT86IHN0cmluZztcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAndG8nLCB0eXBlOiAndmFyY2hhcicgfSlcbiAgICBwdWJsaWMgdG8/OiBzdHJpbmc7XG5cbiAgICBAQ29sdW1uKHsgbmFtZTogJ3R4X2hhc2gnLCB0eXBlOiAndmFyY2hhcicsIHVuaXF1ZTogdHJ1ZSwgbnVsbGFibGU6IHRydWUgfSlcbiAgICBwdWJsaWMgdHhIYXNoPzogc3RyaW5nO1xuXG4gICAgQENvbHVtbih7IG5hbWU6ICdzdGF0dXMnLCB0eXBlOiAndmFyY2hhcicgfSlcbiAgICBwdWJsaWMgc3RhdHVzOiBzdHJpbmc7XG5cbiAgICBAQ29sdW1uKHsgbmFtZTogJ3Rha2VyX2FkZHJlc3MnLCB0eXBlOiAndmFyY2hhcicsIG51bGxhYmxlOiB0cnVlIH0pXG4gICAgcHVibGljIHRha2VyQWRkcmVzcz86IHN0cmluZztcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAnZXhwZWN0ZWRfbWluZWRfaW5fc2VjJywgdHlwZTogJ2ludCcgfSlcbiAgICBwdWJsaWMgZXhwZWN0ZWRNaW5lZEluU2VjPzogbnVtYmVyO1xuXG4gICAgQENvbHVtbih7IG5hbWU6ICdnYXNfcHJpY2UnLCB0eXBlOiAnYmlnaW50JywgbnVsbGFibGU6IHRydWUsIHRyYW5zZm9ybWVyOiBCaWdOdW1iZXJUcmFuc2Zvcm1lciB9KVxuICAgIHB1YmxpYyBnYXNQcmljZT86IEJpZ051bWJlcjtcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAndmFsdWUnLCB0eXBlOiAnYmlnaW50JywgbnVsbGFibGU6IHRydWUsIHRyYW5zZm9ybWVyOiBCaWdOdW1iZXJUcmFuc2Zvcm1lciB9KVxuICAgIHB1YmxpYyB2YWx1ZT86IEJpZ051bWJlcjtcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAnZ2FzJywgdHlwZTogJ2ludCcsIG51bGxhYmxlOiB0cnVlIH0pXG4gICAgcHVibGljIGdhcz86IG51bWJlciB8IG51bGw7XG5cbiAgICBAQ29sdW1uKHsgbmFtZTogJ2Zyb20nLCB0eXBlOiAndmFyY2hhcicsIG51bGxhYmxlOiB0cnVlIH0pXG4gICAgcHVibGljIGZyb20/OiBzdHJpbmc7XG5cbiAgICBAQ29sdW1uKHsgbmFtZTogJ25vbmNlJywgdHlwZTogJ2JpZ2ludCcsIG51bGxhYmxlOiB0cnVlLCB0cmFuc2Zvcm1lcjogQmlnSW50VHJhbnNmb3JtZXIgfSlcbiAgICBwdWJsaWMgbm9uY2U/OiBudW1iZXI7XG5cbiAgICBAQ29sdW1uKHsgbmFtZTogJ2dhc191c2VkJywgdHlwZTogJ2ludCcsIG51bGxhYmxlOiB0cnVlIH0pXG4gICAgcHVibGljIGdhc1VzZWQ/OiBudW1iZXIgfCBudWxsO1xuXG4gICAgQENvbHVtbih7IG5hbWU6ICdibG9ja19udW1iZXInLCB0eXBlOiAnYmlnaW50JywgbnVsbGFibGU6IHRydWUsIHRyYW5zZm9ybWVyOiBCaWdJbnRUcmFuc2Zvcm1lciB9KVxuICAgIHB1YmxpYyBibG9ja051bWJlcj86IG51bWJlcjtcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAndHhfc3RhdHVzJywgdHlwZTogJ2ludCcsIG51bGxhYmxlOiB0cnVlIH0pXG4gICAgcHVibGljIHR4U3RhdHVzPzogbnVtYmVyIHwgbnVsbDtcblxuICAgIEBDb2x1bW4oeyBuYW1lOiAnYXBpX2tleScsIHR5cGU6ICd2YXJjaGFyJywgbnVsbGFibGU6IHRydWUgfSlcbiAgICBwdWJsaWMgYXBpS2V5Pzogc3RyaW5nO1xuXG4gICAgQENyZWF0ZURhdGVDb2x1bW4oeyBuYW1lOiAnY3JlYXRlZF9hdCcsIHR5cGU6ICd0aW1lc3RhbXB0eicgfSlcbiAgICBwdWJsaWMgY3JlYXRlZEF0PzogRGF0ZTtcblxuICAgIEBVcGRhdGVEYXRlQ29sdW1uKHsgbmFtZTogJ3VwZGF0ZWRfYXQnLCB0eXBlOiAndGltZXN0YW1wdHonIH0pXG4gICAgcHVibGljIHVwZGF0ZWRBdD86IERhdGU7XG5cbiAgICBAQ29sdW1uKHsgbmFtZTogJ2V4cGVjdGVkX2F0JywgdHlwZTogJ3RpbWVzdGFtcHR6JyB9KVxuICAgIHB1YmxpYyBleHBlY3RlZEF0OiBEYXRlO1xuXG4gICAgcHVibGljIHN0YXRpYyBtYWtlKG9wdHM6IFRyYW5zYWN0aW9uRW50aXR5T3B0cyk6IFRyYW5zYWN0aW9uRW50aXR5IHtcbiAgICAgICAgYXNzZXJ0LmlzSGV4U3RyaW5nKCdyZWZIYXNoJywgb3B0cy5yZWZIYXNoKTtcbiAgICAgICAgaWYgKG9wdHMudHhIYXNoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGFzc2VydC5pc0hleFN0cmluZygndHhIYXNoJywgb3B0cy50eEhhc2gpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRzLmZyb20gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgYXNzZXJ0LmlzRVRIQWRkcmVzc0hleCgnZnJvbScsIG9wdHMuZnJvbSk7XG4gICAgICAgIH1cbiAgICAgICAgYXNzZXJ0LmRvZXNCZWxvbmdUb1N0cmluZ0VudW0oJ3N0YXR1cycsIG9wdHMuc3RhdHVzLCBUcmFuc2FjdGlvblN0YXRlcyk7XG4gICAgICAgIGlmIChvcHRzLm5vbmNlICE9PSB1bmRlZmluZWQgJiYgIU51bWJlci5pc0ludGVnZXIob3B0cy5ub25jZSkgJiYgb3B0cy5ub25jZSA8PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIG5vbmNlIHRvIGJlIGEgcG9zaXRpdmUgaW50ZWdlciwgZW5jb3VudGVyZWQ6ICR7b3B0cy5ub25jZX1gKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0cy5ibG9ja051bWJlciAhPT0gdW5kZWZpbmVkICYmICFOdW1iZXIuaXNJbnRlZ2VyKG9wdHMuYmxvY2tOdW1iZXIpICYmIG9wdHMuYmxvY2tOdW1iZXIgPD0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBibG9ja051bWJlciB0byBiZSBhIHBvc2l0aXZlIGludGVnZXIsIGVuY291bnRlcmVkOiAke29wdHMuYmxvY2tOdW1iZXJ9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbkVudGl0eShvcHRzKTtcbiAgICB9XG5cbiAgICAvLyBIQUNLKG9za2FyKSB3ZSB3YW50IGFsbCBmaWVsZHMgdG8gYmUgc2V0IGFuZCB2YWxpZCwgb3RoZXJ3aXNlIHdlIHNob3VsZFxuICAgIC8vIG5vdCBhY2NlcHQgYSB0cmFuc2FjdGlvbiBlbnRpdHksIGhvd2V2ZXIgYmVjYXVzZSBvZiB0aGlzIGlzc3VlOlxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS90eXBlb3JtL3R5cGVvcm0vaXNzdWVzLzE3NzIgd2UgY2Fubm90IGFjY2VwdCB1bmRlZmluZWRcbiAgICAvLyBhcyBhbiBhcmd1bWVudCB0byB0aGUgY29uc3RydWN0b3IsIHRvIG5vdCBicmVhayBtaWdyYXRpb25zIHdpdGhcbiAgICAvLyBzZXJpYWxpemUuIFBsZWFzZSB1c2UgdGhlIHB1YmxpYyBzdGF0aWMgbWFrZSBtZXRob2QgaW5zdGVhZC5cbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgICAgICBvcHRzOiBUcmFuc2FjdGlvbkVudGl0eU9wdHMgPSB7XG4gICAgICAgICAgICByZWZIYXNoOiAnJyxcbiAgICAgICAgICAgIHR4SGFzaDogJycsXG4gICAgICAgICAgICB0bzogJycsXG4gICAgICAgICAgICBkYXRhOiAnJyxcbiAgICAgICAgICAgIGFwaUtleTogJycsXG4gICAgICAgICAgICB0YWtlckFkZHJlc3M6ICcnLFxuICAgICAgICAgICAgc3RhdHVzOiAnJyxcbiAgICAgICAgICAgIGV4cGVjdGVkTWluZWRJblNlYzogTUVUQV9UWE5fUkVMQVlfRVhQRUNURURfTUlORURfU0VDLFxuICAgICAgICAgICAgbm9uY2U6IDAsXG4gICAgICAgICAgICBnYXNQcmljZTogWkVSTyxcbiAgICAgICAgICAgIHZhbHVlOiBaRVJPLFxuICAgICAgICAgICAgZnJvbTogJycsXG4gICAgICAgICAgICBnYXM6IG51bGwsXG4gICAgICAgICAgICBnYXNVc2VkOiBudWxsLFxuICAgICAgICAgICAgdHhTdGF0dXM6IG51bGwsXG4gICAgICAgIH0sXG4gICAgKSB7XG4gICAgICAgIHRoaXMucmVmSGFzaCA9IG9wdHMucmVmSGFzaDtcbiAgICAgICAgdGhpcy50eEhhc2ggPSBvcHRzLnR4SGFzaDtcbiAgICAgICAgdGhpcy50YWtlckFkZHJlc3MgPSBvcHRzLnRha2VyQWRkcmVzcztcbiAgICAgICAgdGhpcy50byA9IG9wdHMudG87XG4gICAgICAgIHRoaXMuZGF0YSA9IG9wdHMuZGF0YTtcbiAgICAgICAgdGhpcy5hcGlLZXkgPSBvcHRzLmFwaUtleTtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBvcHRzLnN0YXR1cztcbiAgICAgICAgdGhpcy5leHBlY3RlZE1pbmVkSW5TZWMgPSBvcHRzLmV4cGVjdGVkTWluZWRJblNlYztcbiAgICAgICAgdGhpcy5ub25jZSA9IG9wdHMubm9uY2U7XG4gICAgICAgIHRoaXMuZ2FzUHJpY2UgPSBvcHRzLmdhc1ByaWNlO1xuICAgICAgICB0aGlzLnZhbHVlID0gb3B0cy52YWx1ZTtcbiAgICAgICAgdGhpcy5ibG9ja051bWJlciA9IG9wdHMuYmxvY2tOdW1iZXI7XG4gICAgICAgIHRoaXMuZnJvbSA9IG9wdHMuZnJvbTtcbiAgICAgICAgdGhpcy5nYXMgPSBvcHRzLmdhcztcbiAgICAgICAgdGhpcy5nYXNVc2VkID0gb3B0cy5nYXNVc2VkO1xuICAgICAgICB0aGlzLnR4U3RhdHVzID0gb3B0cy50eFN0YXR1cztcbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgdGhpcy5leHBlY3RlZEF0ID0gbmV3IERhdGUobm93LmdldFRpbWUoKSArIHRoaXMuZXhwZWN0ZWRNaW5lZEluU2VjICogT05FX1NFQ09ORF9NUyk7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9