f81544801156b6d0707510dd1446bd6e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// tslint:disable:custom-no-magic-numbers
// tslint:disable:no-empty
// tslint:disable:max-file-line-count
const contract_addresses_1 = require("@0x/contract-addresses");
const chai_1 = require("chai");
const ts_mockito_1 = require("ts-mockito");
const typeorm_1 = require("typeorm");
const entities_1 = require("../../src/entities");
const rfq_maker_service_1 = require("../../src/services/rfq_maker_service");
const config_manager_1 = require("../../src/utils/config_manager");
const rfq_maker_db_utils_1 = require("../../src/utils/rfq_maker_db_utils");
describe('RfqMakerService', () => {
    const makerId = 'fakeMaker1';
    const makerApiKey = 'fakeMakerApiKey1';
    const chainId = contract_addresses_1.ChainId.Ganache;
    const updatedAt = new Date();
    const pairs = [
        ['0x374a16f5e686c09b0cc9e8bc3466b3b645c74aa7', '0xf84830b73b2ed3c7267e7638f500110ea47fdf30'],
    ];
    describe('getRfqMakerAsync', () => {
        it('should get RfqMaker entity from db connection', async () => {
            // Given
            const rfqMaker = new entities_1.RfqMaker({
                makerId,
                chainId,
                updatedAt,
                pairs,
                rfqtUri: null,
                rfqmUri: null,
            });
            const repositoryMock = (0, ts_mockito_1.mock)(typeorm_1.Repository);
            (0, ts_mockito_1.when)(repositoryMock.findOne((0, ts_mockito_1.anything)())).thenResolve(rfqMaker);
            const connectionMock = (0, ts_mockito_1.mock)(typeorm_1.Connection);
            (0, ts_mockito_1.when)(connectionMock.getRepository(entities_1.RfqMaker)).thenReturn((0, ts_mockito_1.instance)(repositoryMock));
            const rfqDbUtils = new rfq_maker_db_utils_1.RfqMakerDbUtils((0, ts_mockito_1.instance)(connectionMock));
            const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
            const rfqMakerService = new rfq_maker_service_1.RfqMakerService(rfqDbUtils, configManagerMock);
            // When
            const rfqMakerFromSevice = await rfqMakerService.getRfqMakerAsync(makerId, chainId);
            // Then
            (0, chai_1.expect)(rfqMakerFromSevice.makerId).to.be.eq(makerId);
            (0, chai_1.expect)(rfqMakerFromSevice.chainId).to.be.eq(chainId);
            (0, chai_1.expect)(rfqMakerFromSevice.updatedAt).to.be.eq(updatedAt);
            (0, chai_1.expect)(rfqMakerFromSevice.pairs).to.be.eq(pairs);
        });
        it('should get default RfqMaker entity if there is no information in DB', async () => {
            // Given
            const repositoryMock = (0, ts_mockito_1.mock)(typeorm_1.Repository);
            (0, ts_mockito_1.when)(repositoryMock.findOne((0, ts_mockito_1.anything)())).thenResolve(undefined);
            const connectionMock = (0, ts_mockito_1.mock)(typeorm_1.Connection);
            (0, ts_mockito_1.when)(connectionMock.getRepository(entities_1.RfqMaker)).thenReturn((0, ts_mockito_1.instance)(repositoryMock));
            const rfqDbUtils = new rfq_maker_db_utils_1.RfqMakerDbUtils((0, ts_mockito_1.instance)(connectionMock));
            const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
            const rfqMakerService = new rfq_maker_service_1.RfqMakerService(rfqDbUtils, configManagerMock);
            // When
            const rfqMakerFromSevice = await rfqMakerService.getRfqMakerAsync(makerId, chainId);
            // Then
            (0, chai_1.expect)(rfqMakerFromSevice.makerId).to.be.eq(makerId);
            (0, chai_1.expect)(rfqMakerFromSevice.chainId).to.be.eq(chainId);
            (0, chai_1.expect)(rfqMakerFromSevice.updatedAt).to.be.eq(null);
            (0, chai_1.expect)(rfqMakerFromSevice.pairs.length).to.be.eq(0);
        });
    });
    describe('createOrUpdateRfqMakerAsync', () => {
        it('should create or update the RfqMaker entity through db connection', async () => {
            // Given
            const repositoryMock = (0, ts_mockito_1.mock)(typeorm_1.Repository);
            (0, ts_mockito_1.when)(repositoryMock.save((0, ts_mockito_1.anything)())).thenCall((rfqMaker) => {
                // Then
                (0, chai_1.expect)(rfqMaker.makerId).to.be.eq(makerId);
                (0, chai_1.expect)(rfqMaker.chainId).to.be.eq(chainId);
                (0, chai_1.expect)(rfqMaker.pairs).to.be.eq(pairs);
            });
            const connectionMock = (0, ts_mockito_1.mock)(typeorm_1.Connection);
            (0, ts_mockito_1.when)(connectionMock.getRepository(entities_1.RfqMaker)).thenReturn((0, ts_mockito_1.instance)(repositoryMock));
            const rfqDbUtils = new rfq_maker_db_utils_1.RfqMakerDbUtils((0, ts_mockito_1.instance)(connectionMock));
            const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
            const rfqMakerService = new rfq_maker_service_1.RfqMakerService(rfqDbUtils, configManagerMock);
            // When
            await rfqMakerService.createOrUpdateRfqMakerAsync(makerId, chainId, pairs, null, null);
        });
    });
    describe('patchRfqMakerAsync', () => {
        it('should update pairs', async () => {
            // Given
            const originalRfqMaker = new entities_1.RfqMaker({
                makerId,
                chainId,
                updatedAt,
                pairs,
                rfqtUri: null,
                rfqmUri: null,
            });
            const newPairs = [];
            const rfqMakerServiceMock = (0, ts_mockito_1.mock)(rfq_maker_service_1.RfqMakerService);
            (0, ts_mockito_1.when)(rfqMakerServiceMock.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenResolve(originalRfqMaker);
            // Expect
            (0, ts_mockito_1.when)(rfqMakerServiceMock.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall((makerIdToSave, chainIdToSave, pairsToSave, rfqtUriToSave, rfqmUriToSave) => {
                (0, chai_1.expect)(makerIdToSave).to.be.eq(originalRfqMaker.makerId);
                (0, chai_1.expect)(chainIdToSave).to.be.eq(originalRfqMaker.chainId);
                (0, chai_1.expect)(pairsToSave).to.be.eq(newPairs);
                (0, chai_1.expect)(rfqtUriToSave).to.be.eq(originalRfqMaker.rfqtUri);
                (0, chai_1.expect)(rfqmUriToSave).to.be.eq(originalRfqMaker.rfqmUri);
            });
            const rfqMakerService = (0, ts_mockito_1.instance)(rfqMakerServiceMock);
            // When
            await rfqMakerService.patchRfqMakerAsync(makerId, chainId, newPairs, undefined, undefined);
        });
        it('should update URIs from null to a valid string', async () => {
            // Given
            const originalRfqMaker = new entities_1.RfqMaker({
                makerId,
                chainId,
                updatedAt,
                pairs,
                rfqtUri: null,
                rfqmUri: null,
            });
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-inferrable-types
            const newRfqtUri = 'http://localhost:3001';
            const rfqMakerServiceMock = (0, ts_mockito_1.mock)(rfq_maker_service_1.RfqMakerService);
            (0, ts_mockito_1.when)(rfqMakerServiceMock.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenResolve(originalRfqMaker);
            // Expect
            (0, ts_mockito_1.when)(rfqMakerServiceMock.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall((makerIdToSave, chainIdToSave, pairsToSave, rfqtUriToSave, rfqmUriToSave) => {
                (0, chai_1.expect)(makerIdToSave).to.be.eq(originalRfqMaker.makerId);
                (0, chai_1.expect)(chainIdToSave).to.be.eq(originalRfqMaker.chainId);
                (0, chai_1.expect)(pairsToSave).to.be.eq(originalRfqMaker.pairs);
                (0, chai_1.expect)(rfqtUriToSave).to.be.eq(newRfqtUri);
                (0, chai_1.expect)(rfqmUriToSave).to.be.eq(originalRfqMaker.rfqmUri);
            });
            const rfqMakerService = (0, ts_mockito_1.instance)(rfqMakerServiceMock);
            // When
            await rfqMakerService.patchRfqMakerAsync(makerId, chainId, undefined, newRfqtUri, undefined);
        });
        it('should update URIs from string to null', async () => {
            // Given
            const originalRfqMaker = new entities_1.RfqMaker({
                makerId,
                chainId,
                updatedAt,
                pairs,
                rfqtUri: 'http://localhost:3001',
                rfqmUri: 'http://localhost:3002',
            });
            const rfqMakerServiceMock = (0, ts_mockito_1.mock)(rfq_maker_service_1.RfqMakerService);
            (0, ts_mockito_1.when)(rfqMakerServiceMock.getRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenResolve(originalRfqMaker);
            // Expect
            (0, ts_mockito_1.when)(rfqMakerServiceMock.createOrUpdateRfqMakerAsync((0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)(), (0, ts_mockito_1.anything)())).thenCall((makerIdToSave, chainIdToSave, pairsToSave, rfqtUriToSave, rfqmUriToSave) => {
                (0, chai_1.expect)(makerIdToSave).to.be.eq(originalRfqMaker.makerId);
                (0, chai_1.expect)(chainIdToSave).to.be.eq(originalRfqMaker.chainId);
                (0, chai_1.expect)(pairsToSave).to.be.eq(originalRfqMaker.pairs);
                (0, chai_1.expect)(rfqtUriToSave).to.be.eq(originalRfqMaker.rfqtUri);
                (0, chai_1.expect)(rfqmUriToSave).to.be.eq(null);
            });
            const rfqMakerService = (0, ts_mockito_1.instance)(rfqMakerServiceMock);
            // When
            await rfqMakerService.patchRfqMakerAsync(makerId, chainId, undefined, undefined, null);
        });
    });
    describe('mapMakerApiKeyToId', () => {
        it('should map maker api key to maker id correctly', async () => {
            // Given
            const rfqDbUtils = (0, ts_mockito_1.mock)(rfq_maker_db_utils_1.RfqMakerDbUtils);
            const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
            (0, ts_mockito_1.when)(configManagerMock.getRfqMakerIdForApiKey(makerApiKey)).thenReturn(makerId);
            const rfqMakerService = new rfq_maker_service_1.RfqMakerService(rfqDbUtils, (0, ts_mockito_1.instance)(configManagerMock));
            // When
            const makerIdFromService = rfqMakerService.mapMakerApiKeyToId(makerApiKey);
            // Then
            (0, chai_1.expect)(makerIdFromService).to.be.eq(makerId);
        });
        it('should return null for undefined api key', async () => {
            // Given
            const rfqDbUtilsMock = (0, ts_mockito_1.mock)(rfq_maker_db_utils_1.RfqMakerDbUtils);
            const configManagerMock = (0, ts_mockito_1.mock)(config_manager_1.ConfigManager);
            (0, ts_mockito_1.when)(configManagerMock.getRfqMakerIdForApiKey(makerApiKey)).thenReturn(makerId);
            const rfqMakerService = new rfq_maker_service_1.RfqMakerService(rfqDbUtilsMock, (0, ts_mockito_1.instance)(configManagerMock));
            // When
            const makerIdFromService = rfqMakerService.mapMakerApiKeyToId(undefined);
            // Then
            (0, chai_1.expect)(makerIdFromService).to.be.eq(null);
        });
    });
    describe('isValidChainId', () => {
        it('should return false for invalid number chainId', async () => {
            // Given
            const invalidChainId = '123a';
            // When
            const isValidChainId = rfq_maker_service_1.RfqMakerService.isValidChainId(invalidChainId);
            // Then
            (0, chai_1.expect)(isValidChainId).to.be.eq(false);
        });
        it('should return false for unknown number chainId', async () => {
            // Given
            const invalidChainId = '12345';
            // When
            const isValidChainId = rfq_maker_service_1.RfqMakerService.isValidChainId(invalidChainId);
            // Then
            (0, chai_1.expect)(isValidChainId).to.be.eq(false);
        });
        it('should return number ChainId for well formated chainId', async () => {
            // Given
            const validChainId = '1337';
            // When
            const isValidChainId = rfq_maker_service_1.RfqMakerService.isValidChainId(validChainId);
            // Then
            (0, chai_1.expect)(isValidChainId).to.be.eq(true);
        });
    });
    describe('validatePairsPayload', () => {
        it('should pass with valid input pairs', async () => {
            (0, chai_1.expect)(() => {
                rfq_maker_service_1.RfqMakerService.validatePairsPayloadOrThrow(pairs);
            }).to.not.throw();
        });
        it('should throw for non array input', async () => {
            (0, chai_1.expect)(() => {
                // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                rfq_maker_service_1.RfqMakerService.validatePairsPayloadOrThrow('123');
            }).to.throw();
        });
        it('should throw for array of non arrays', async () => {
            (0, chai_1.expect)(() => {
                // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                rfq_maker_service_1.RfqMakerService.validatePairsPayloadOrThrow(['123']);
            }).to.throw();
        });
        it('should throw for incorrect sub-array length', async () => {
            (0, chai_1.expect)(() => {
                // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                rfq_maker_service_1.RfqMakerService.validatePairsPayloadOrThrow(['123']);
            }).to.throw();
        });
        it('should throw for pairs of invalid ethereum addresses', async () => {
            (0, chai_1.expect)(() => {
                rfq_maker_service_1.RfqMakerService.validatePairsPayloadOrThrow([['123', '234']]);
            }).to.throw();
        });
        it('should throw for pairs of identical ethereum addresses', async () => {
            (0, chai_1.expect)(() => {
                rfq_maker_service_1.RfqMakerService.validatePairsPayloadOrThrow([
                    ['0x374a16f5e686c09b0cc9e8bc3466b3b645c74aa7', '0x374a16f5e686c09b0cc9e8bc3466b3b645c74aa7'],
                ]);
            }).to.throw();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3Qvc2VydmljZXMvcmZxX21ha2VyX3NlcnZpY2VfdGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHlDQUF5QztBQUN6QywwQkFBMEI7QUFDMUIscUNBQXFDO0FBRXJDLCtEQUFpRDtBQUNqRCwrQkFBOEI7QUFDOUIsMkNBQTREO0FBQzVELHFDQUFpRDtBQUVqRCxpREFBOEM7QUFDOUMsNEVBQXVFO0FBQ3ZFLG1FQUErRDtBQUMvRCwyRUFBcUU7QUFFckUsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUM3QixNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUM7SUFDN0IsTUFBTSxXQUFXLEdBQUcsa0JBQWtCLENBQUM7SUFDdkMsTUFBTSxPQUFPLEdBQUcsNEJBQU8sQ0FBQyxPQUFPLENBQUM7SUFDaEMsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUM3QixNQUFNLEtBQUssR0FBdUI7UUFDOUIsQ0FBQyw0Q0FBNEMsRUFBRSw0Q0FBNEMsQ0FBQztLQUMvRixDQUFDO0lBRUYsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0QsUUFBUTtZQUNSLE1BQU0sUUFBUSxHQUFhLElBQUksbUJBQVEsQ0FBQztnQkFDcEMsT0FBTztnQkFDUCxPQUFPO2dCQUNQLFNBQVM7Z0JBQ1QsS0FBSztnQkFDTCxPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUsSUFBSTthQUNoQixDQUFDLENBQUM7WUFDSCxNQUFNLGNBQWMsR0FBRyxJQUFBLGlCQUFJLEVBQUMsb0JBQVUsQ0FBQyxDQUFDO1lBQ3hDLElBQUEsaUJBQUksRUFBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUEscUJBQVEsR0FBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDL0QsTUFBTSxjQUFjLEdBQUcs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QyxLQUFLLEVBQUUsQ0FBQztRQUNsQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx3REFBd0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRSxJQUFBLGFBQU0sRUFBQyxHQUFHLEVBQUU7Z0JBQ1IsbUNBQWUsQ0FBQywyQkFBMkIsQ0FBQztvQkFDeEMsQ0FBQyw0Q0FBNEMsRUFBRSw0Q0FBNEMsQ0FBQztpQkFDL0YsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZGF2aWR3YWxzaC9jb2RlLWxvY2FsLzB4LXJmcS1hcGkvdGVzdC9zZXJ2aWNlcy9yZnFfbWFrZXJfc2VydmljZV90ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlOmN1c3RvbS1uby1tYWdpYy1udW1iZXJzXG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby1lbXB0eVxuLy8gdHNsaW50OmRpc2FibGU6bWF4LWZpbGUtbGluZS1jb3VudFxuXG5pbXBvcnQgeyBDaGFpbklkIH0gZnJvbSAnQDB4L2NvbnRyYWN0LWFkZHJlc3Nlcyc7XG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcbmltcG9ydCB7IGFueXRoaW5nLCBpbnN0YW5jZSwgbW9jaywgd2hlbiB9IGZyb20gJ3RzLW1vY2tpdG8nO1xuaW1wb3J0IHsgQ29ubmVjdGlvbiwgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xuXG5pbXBvcnQgeyBSZnFNYWtlciB9IGZyb20gJy4uLy4uL3NyYy9lbnRpdGllcyc7XG5pbXBvcnQgeyBSZnFNYWtlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvcmZxX21ha2VyX3NlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlnTWFuYWdlciB9IGZyb20gJy4uLy4uL3NyYy91dGlscy9jb25maWdfbWFuYWdlcic7XG5pbXBvcnQgeyBSZnFNYWtlckRiVXRpbHMgfSBmcm9tICcuLi8uLi9zcmMvdXRpbHMvcmZxX21ha2VyX2RiX3V0aWxzJztcblxuZGVzY3JpYmUoJ1JmcU1ha2VyU2VydmljZScsICgpID0+IHtcbiAgICBjb25zdCBtYWtlcklkID0gJ2Zha2VNYWtlcjEnO1xuICAgIGNvbnN0IG1ha2VyQXBpS2V5ID0gJ2Zha2VNYWtlckFwaUtleTEnO1xuICAgIGNvbnN0IGNoYWluSWQgPSBDaGFpbklkLkdhbmFjaGU7XG4gICAgY29uc3QgdXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBwYWlyczogW3N0cmluZywgc3RyaW5nXVtdID0gW1xuICAgICAgICBbJzB4Mzc0YTE2ZjVlNjg2YzA5YjBjYzllOGJjMzQ2NmIzYjY0NWM3NGFhNycsICcweGY4NDgzMGI3M2IyZWQzYzcyNjdlNzYzOGY1MDAxMTBlYTQ3ZmRmMzAnXSxcbiAgICBdO1xuXG4gICAgZGVzY3JpYmUoJ2dldFJmcU1ha2VyQXN5bmMnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IFJmcU1ha2VyIGVudGl0eSBmcm9tIGRiIGNvbm5lY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXI6IFJmcU1ha2VyID0gbmV3IFJmcU1ha2VyKHtcbiAgICAgICAgICAgICAgICBtYWtlcklkLFxuICAgICAgICAgICAgICAgIGNoYWluSWQsXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0LFxuICAgICAgICAgICAgICAgIHBhaXJzLFxuICAgICAgICAgICAgICAgIHJmcXRVcmk6IG51bGwsXG4gICAgICAgICAgICAgICAgcmZxbVVyaTogbnVsbCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgcmVwb3NpdG9yeU1vY2sgPSBtb2NrKFJlcG9zaXRvcnkpO1xuICAgICAgICAgICAgd2hlbihyZXBvc2l0b3J5TW9jay5maW5kT25lKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZShyZnFNYWtlcik7XG4gICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uTW9jayA9IG1vY2soQ29ubmVjdGlvbik7XG4gICAgICAgICAgICB3aGVuKGNvbm5lY3Rpb25Nb2NrLmdldFJlcG9zaXRvcnkoUmZxTWFrZXIpKS50aGVuUmV0dXJuKGluc3RhbmNlKHJlcG9zaXRvcnlNb2NrKSk7XG4gICAgICAgICAgICBjb25zdCByZnFEYlV0aWxzID0gbmV3IFJmcU1ha2VyRGJVdGlscyhpbnN0YW5jZShjb25uZWN0aW9uTW9jaykpO1xuXG4gICAgICAgICAgICBjb25zdCBjb25maWdNYW5hZ2VyTW9jayA9IG1vY2soQ29uZmlnTWFuYWdlcik7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyU2VydmljZSA9IG5ldyBSZnFNYWtlclNlcnZpY2UocmZxRGJVdGlscywgY29uZmlnTWFuYWdlck1vY2spO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlckZyb21TZXZpY2UgPSBhd2FpdCByZnFNYWtlclNlcnZpY2UuZ2V0UmZxTWFrZXJBc3luYyhtYWtlcklkLCBjaGFpbklkKTtcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KHJmcU1ha2VyRnJvbVNldmljZS5tYWtlcklkKS50by5iZS5lcShtYWtlcklkKTtcbiAgICAgICAgICAgIGV4cGVjdChyZnFNYWtlckZyb21TZXZpY2UuY2hhaW5JZCkudG8uYmUuZXEoY2hhaW5JZCk7XG4gICAgICAgICAgICBleHBlY3QocmZxTWFrZXJGcm9tU2V2aWNlLnVwZGF0ZWRBdCkudG8uYmUuZXEodXBkYXRlZEF0KTtcbiAgICAgICAgICAgIGV4cGVjdChyZnFNYWtlckZyb21TZXZpY2UucGFpcnMpLnRvLmJlLmVxKHBhaXJzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgZGVmYXVsdCBSZnFNYWtlciBlbnRpdHkgaWYgdGhlcmUgaXMgbm8gaW5mb3JtYXRpb24gaW4gREInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgcmVwb3NpdG9yeU1vY2sgPSBtb2NrKFJlcG9zaXRvcnkpO1xuICAgICAgICAgICAgd2hlbihyZXBvc2l0b3J5TW9jay5maW5kT25lKGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbk1vY2sgPSBtb2NrKENvbm5lY3Rpb24pO1xuICAgICAgICAgICAgd2hlbihjb25uZWN0aW9uTW9jay5nZXRSZXBvc2l0b3J5KFJmcU1ha2VyKSkudGhlblJldHVybihpbnN0YW5jZShyZXBvc2l0b3J5TW9jaykpO1xuICAgICAgICAgICAgY29uc3QgcmZxRGJVdGlscyA9IG5ldyBSZnFNYWtlckRiVXRpbHMoaW5zdGFuY2UoY29ubmVjdGlvbk1vY2spKTtcblxuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlck1vY2sgPSBtb2NrKENvbmZpZ01hbmFnZXIpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlclNlcnZpY2UgPSBuZXcgUmZxTWFrZXJTZXJ2aWNlKHJmcURiVXRpbHMsIGNvbmZpZ01hbmFnZXJNb2NrKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJGcm9tU2V2aWNlID0gYXdhaXQgcmZxTWFrZXJTZXJ2aWNlLmdldFJmcU1ha2VyQXN5bmMobWFrZXJJZCwgY2hhaW5JZCk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChyZnFNYWtlckZyb21TZXZpY2UubWFrZXJJZCkudG8uYmUuZXEobWFrZXJJZCk7XG4gICAgICAgICAgICBleHBlY3QocmZxTWFrZXJGcm9tU2V2aWNlLmNoYWluSWQpLnRvLmJlLmVxKGNoYWluSWQpO1xuICAgICAgICAgICAgZXhwZWN0KHJmcU1ha2VyRnJvbVNldmljZS51cGRhdGVkQXQpLnRvLmJlLmVxKG51bGwpO1xuICAgICAgICAgICAgZXhwZWN0KHJmcU1ha2VyRnJvbVNldmljZS5wYWlycy5sZW5ndGgpLnRvLmJlLmVxKDApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjcmVhdGVPclVwZGF0ZVJmcU1ha2VyQXN5bmMnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIG9yIHVwZGF0ZSB0aGUgUmZxTWFrZXIgZW50aXR5IHRocm91Z2ggZGIgY29ubmVjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCByZXBvc2l0b3J5TW9jayA9IG1vY2soUmVwb3NpdG9yeSk7XG4gICAgICAgICAgICB3aGVuKHJlcG9zaXRvcnlNb2NrLnNhdmUoYW55dGhpbmcoKSkpLnRoZW5DYWxsKChyZnFNYWtlcikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgICAgICBleHBlY3QocmZxTWFrZXIubWFrZXJJZCkudG8uYmUuZXEobWFrZXJJZCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJmcU1ha2VyLmNoYWluSWQpLnRvLmJlLmVxKGNoYWluSWQpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChyZnFNYWtlci5wYWlycykudG8uYmUuZXEocGFpcnMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uTW9jayA9IG1vY2soQ29ubmVjdGlvbik7XG4gICAgICAgICAgICB3aGVuKGNvbm5lY3Rpb25Nb2NrLmdldFJlcG9zaXRvcnkoUmZxTWFrZXIpKS50aGVuUmV0dXJuKGluc3RhbmNlKHJlcG9zaXRvcnlNb2NrKSk7XG4gICAgICAgICAgICBjb25zdCByZnFEYlV0aWxzID0gbmV3IFJmcU1ha2VyRGJVdGlscyhpbnN0YW5jZShjb25uZWN0aW9uTW9jaykpO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnTWFuYWdlck1vY2sgPSBtb2NrKENvbmZpZ01hbmFnZXIpO1xuXG4gICAgICAgICAgICBjb25zdCByZnFNYWtlclNlcnZpY2UgPSBuZXcgUmZxTWFrZXJTZXJ2aWNlKHJmcURiVXRpbHMsIGNvbmZpZ01hbmFnZXJNb2NrKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgYXdhaXQgcmZxTWFrZXJTZXJ2aWNlLmNyZWF0ZU9yVXBkYXRlUmZxTWFrZXJBc3luYyhtYWtlcklkLCBjaGFpbklkLCBwYWlycywgbnVsbCwgbnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3BhdGNoUmZxTWFrZXJBc3luYycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCB1cGRhdGUgcGFpcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxSZnFNYWtlcjogUmZxTWFrZXIgPSBuZXcgUmZxTWFrZXIoe1xuICAgICAgICAgICAgICAgIG1ha2VySWQsXG4gICAgICAgICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICAgICAgICB1cGRhdGVkQXQsXG4gICAgICAgICAgICAgICAgcGFpcnMsXG4gICAgICAgICAgICAgICAgcmZxdFVyaTogbnVsbCxcbiAgICAgICAgICAgICAgICByZnFtVXJpOiBudWxsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBuZXdQYWlyczogW3N0cmluZywgc3RyaW5nXVtdID0gW107XG4gICAgICAgICAgICBjb25zdCByZnFNYWtlclNlcnZpY2VNb2NrID0gbW9jayhSZnFNYWtlclNlcnZpY2UpO1xuICAgICAgICAgICAgd2hlbihyZnFNYWtlclNlcnZpY2VNb2NrLmdldFJmcU1ha2VyQXN5bmMoYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKG9yaWdpbmFsUmZxTWFrZXIpO1xuXG4gICAgICAgICAgICAvLyBFeHBlY3RcbiAgICAgICAgICAgIHdoZW4oXG4gICAgICAgICAgICAgICAgcmZxTWFrZXJTZXJ2aWNlTW9jay5jcmVhdGVPclVwZGF0ZVJmcU1ha2VyQXN5bmMoXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICkudGhlbkNhbGwoKG1ha2VySWRUb1NhdmUsIGNoYWluSWRUb1NhdmUsIHBhaXJzVG9TYXZlLCByZnF0VXJpVG9TYXZlLCByZnFtVXJpVG9TYXZlKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KG1ha2VySWRUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIubWFrZXJJZCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGNoYWluSWRUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIuY2hhaW5JZCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHBhaXJzVG9TYXZlKS50by5iZS5lcShuZXdQYWlycyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJmcXRVcmlUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIucmZxdFVyaSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJmcW1VcmlUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIucmZxbVVyaSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyU2VydmljZSA9IGluc3RhbmNlKHJmcU1ha2VyU2VydmljZU1vY2spO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBhd2FpdCByZnFNYWtlclNlcnZpY2UucGF0Y2hSZnFNYWtlckFzeW5jKG1ha2VySWQsIGNoYWluSWQsIG5ld1BhaXJzLCB1bmRlZmluZWQsIHVuZGVmaW5lZCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBVUklzIGZyb20gbnVsbCB0byBhIHZhbGlkIHN0cmluZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbFJmcU1ha2VyOiBSZnFNYWtlciA9IG5ldyBSZnFNYWtlcih7XG4gICAgICAgICAgICAgICAgbWFrZXJJZCxcbiAgICAgICAgICAgICAgICBjaGFpbklkLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdCxcbiAgICAgICAgICAgICAgICBwYWlycyxcbiAgICAgICAgICAgICAgICByZnF0VXJpOiBudWxsLFxuICAgICAgICAgICAgICAgIHJmcW1Vcmk6IG51bGwsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8taW5mZXJyYWJsZS10eXBlc1xuICAgICAgICAgICAgY29uc3QgbmV3UmZxdFVyaTogc3RyaW5nID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMSc7XG4gICAgICAgICAgICBjb25zdCByZnFNYWtlclNlcnZpY2VNb2NrID0gbW9jayhSZnFNYWtlclNlcnZpY2UpO1xuICAgICAgICAgICAgd2hlbihyZnFNYWtlclNlcnZpY2VNb2NrLmdldFJmcU1ha2VyQXN5bmMoYW55dGhpbmcoKSwgYW55dGhpbmcoKSkpLnRoZW5SZXNvbHZlKG9yaWdpbmFsUmZxTWFrZXIpO1xuXG4gICAgICAgICAgICAvLyBFeHBlY3RcbiAgICAgICAgICAgIHdoZW4oXG4gICAgICAgICAgICAgICAgcmZxTWFrZXJTZXJ2aWNlTW9jay5jcmVhdGVPclVwZGF0ZVJmcU1ha2VyQXN5bmMoXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFueXRoaW5nKCksXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICkudGhlbkNhbGwoKG1ha2VySWRUb1NhdmUsIGNoYWluSWRUb1NhdmUsIHBhaXJzVG9TYXZlLCByZnF0VXJpVG9TYXZlLCByZnFtVXJpVG9TYXZlKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KG1ha2VySWRUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIubWFrZXJJZCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGNoYWluSWRUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIuY2hhaW5JZCk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHBhaXJzVG9TYXZlKS50by5iZS5lcShvcmlnaW5hbFJmcU1ha2VyLnBhaXJzKTtcbiAgICAgICAgICAgICAgICBleHBlY3QocmZxdFVyaVRvU2F2ZSkudG8uYmUuZXEobmV3UmZxdFVyaSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJmcW1VcmlUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIucmZxbVVyaSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyU2VydmljZSA9IGluc3RhbmNlKHJmcU1ha2VyU2VydmljZU1vY2spO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBhd2FpdCByZnFNYWtlclNlcnZpY2UucGF0Y2hSZnFNYWtlckFzeW5jKG1ha2VySWQsIGNoYWluSWQsIHVuZGVmaW5lZCwgbmV3UmZxdFVyaSwgdW5kZWZpbmVkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KCdzaG91bGQgdXBkYXRlIFVSSXMgZnJvbSBzdHJpbmcgdG8gbnVsbCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbFJmcU1ha2VyOiBSZnFNYWtlciA9IG5ldyBSZnFNYWtlcih7XG4gICAgICAgICAgICAgICAgbWFrZXJJZCxcbiAgICAgICAgICAgICAgICBjaGFpbklkLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdCxcbiAgICAgICAgICAgICAgICBwYWlycyxcbiAgICAgICAgICAgICAgICByZnF0VXJpOiAnaHR0cDovL2xvY2FsaG9zdDozMDAxJyxcbiAgICAgICAgICAgICAgICByZnFtVXJpOiAnaHR0cDovL2xvY2FsaG9zdDozMDAyJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgcmZxTWFrZXJTZXJ2aWNlTW9jayA9IG1vY2soUmZxTWFrZXJTZXJ2aWNlKTtcbiAgICAgICAgICAgIHdoZW4ocmZxTWFrZXJTZXJ2aWNlTW9jay5nZXRSZnFNYWtlckFzeW5jKGFueXRoaW5nKCksIGFueXRoaW5nKCkpKS50aGVuUmVzb2x2ZShvcmlnaW5hbFJmcU1ha2VyKTtcblxuICAgICAgICAgICAgLy8gRXhwZWN0XG4gICAgICAgICAgICB3aGVuKFxuICAgICAgICAgICAgICAgIHJmcU1ha2VyU2VydmljZU1vY2suY3JlYXRlT3JVcGRhdGVSZnFNYWtlckFzeW5jKFxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxuICAgICAgICAgICAgICAgICAgICBhbnl0aGluZygpLFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICApLnRoZW5DYWxsKChtYWtlcklkVG9TYXZlLCBjaGFpbklkVG9TYXZlLCBwYWlyc1RvU2F2ZSwgcmZxdFVyaVRvU2F2ZSwgcmZxbVVyaVRvU2F2ZSkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChtYWtlcklkVG9TYXZlKS50by5iZS5lcShvcmlnaW5hbFJmcU1ha2VyLm1ha2VySWQpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChjaGFpbklkVG9TYXZlKS50by5iZS5lcShvcmlnaW5hbFJmcU1ha2VyLmNoYWluSWQpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChwYWlyc1RvU2F2ZSkudG8uYmUuZXEob3JpZ2luYWxSZnFNYWtlci5wYWlycyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJmcXRVcmlUb1NhdmUpLnRvLmJlLmVxKG9yaWdpbmFsUmZxTWFrZXIucmZxdFVyaSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJmcW1VcmlUb1NhdmUpLnRvLmJlLmVxKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCByZnFNYWtlclNlcnZpY2UgPSBpbnN0YW5jZShyZnFNYWtlclNlcnZpY2VNb2NrKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgYXdhaXQgcmZxTWFrZXJTZXJ2aWNlLnBhdGNoUmZxTWFrZXJBc3luYyhtYWtlcklkLCBjaGFpbklkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgbnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ21hcE1ha2VyQXBpS2V5VG9JZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBtYXAgbWFrZXIgYXBpIGtleSB0byBtYWtlciBpZCBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgcmZxRGJVdGlscyA9IG1vY2soUmZxTWFrZXJEYlV0aWxzKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXJNb2NrID0gbW9jayhDb25maWdNYW5hZ2VyKTtcbiAgICAgICAgICAgIHdoZW4oY29uZmlnTWFuYWdlck1vY2suZ2V0UmZxTWFrZXJJZEZvckFwaUtleShtYWtlckFwaUtleSkpLnRoZW5SZXR1cm4obWFrZXJJZCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyU2VydmljZSA9IG5ldyBSZnFNYWtlclNlcnZpY2UocmZxRGJVdGlscywgaW5zdGFuY2UoY29uZmlnTWFuYWdlck1vY2spKTtcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgbWFrZXJJZEZyb21TZXJ2aWNlID0gcmZxTWFrZXJTZXJ2aWNlLm1hcE1ha2VyQXBpS2V5VG9JZChtYWtlckFwaUtleSk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChtYWtlcklkRnJvbVNlcnZpY2UpLnRvLmJlLmVxKG1ha2VySWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIGZvciB1bmRlZmluZWQgYXBpIGtleScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCByZnFEYlV0aWxzTW9jayA9IG1vY2soUmZxTWFrZXJEYlV0aWxzKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZ01hbmFnZXJNb2NrID0gbW9jayhDb25maWdNYW5hZ2VyKTtcbiAgICAgICAgICAgIHdoZW4oY29uZmlnTWFuYWdlck1vY2suZ2V0UmZxTWFrZXJJZEZvckFwaUtleShtYWtlckFwaUtleSkpLnRoZW5SZXR1cm4obWFrZXJJZCk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJmcU1ha2VyU2VydmljZSA9IG5ldyBSZnFNYWtlclNlcnZpY2UocmZxRGJVdGlsc01vY2ssIGluc3RhbmNlKGNvbmZpZ01hbmFnZXJNb2NrKSk7XG5cbiAgICAgICAgICAgIC8vIFdoZW5cbiAgICAgICAgICAgIGNvbnN0IG1ha2VySWRGcm9tU2VydmljZSA9IHJmcU1ha2VyU2VydmljZS5tYXBNYWtlckFwaUtleVRvSWQodW5kZWZpbmVkKTtcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KG1ha2VySWRGcm9tU2VydmljZSkudG8uYmUuZXEobnVsbCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2lzVmFsaWRDaGFpbklkJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3IgaW52YWxpZCBudW1iZXIgY2hhaW5JZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIEdpdmVuXG4gICAgICAgICAgICBjb25zdCBpbnZhbGlkQ2hhaW5JZCA9ICcxMjNhJztcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgaXNWYWxpZENoYWluSWQgPSBSZnFNYWtlclNlcnZpY2UuaXNWYWxpZENoYWluSWQoaW52YWxpZENoYWluSWQpO1xuXG4gICAgICAgICAgICAvLyBUaGVuXG4gICAgICAgICAgICBleHBlY3QoaXNWYWxpZENoYWluSWQpLnRvLmJlLmVxKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIHVua25vd24gbnVtYmVyIGNoYWluSWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBHaXZlblxuICAgICAgICAgICAgY29uc3QgaW52YWxpZENoYWluSWQgPSAnMTIzNDUnO1xuXG4gICAgICAgICAgICAvLyBXaGVuXG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkQ2hhaW5JZCA9IFJmcU1ha2VyU2VydmljZS5pc1ZhbGlkQ2hhaW5JZChpbnZhbGlkQ2hhaW5JZCk7XG5cbiAgICAgICAgICAgIC8vIFRoZW5cbiAgICAgICAgICAgIGV4cGVjdChpc1ZhbGlkQ2hhaW5JZCkudG8uYmUuZXEoZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBudW1iZXIgQ2hhaW5JZCBmb3Igd2VsbCBmb3JtYXRlZCBjaGFpbklkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLy8gR2l2ZW5cbiAgICAgICAgICAgIGNvbnN0IHZhbGlkQ2hhaW5JZCA9ICcxMzM3JztcblxuICAgICAgICAgICAgLy8gV2hlblxuICAgICAgICAgICAgY29uc3QgaXNWYWxpZENoYWluSWQgPSBSZnFNYWtlclNlcnZpY2UuaXNWYWxpZENoYWluSWQodmFsaWRDaGFpbklkKTtcblxuICAgICAgICAgICAgLy8gVGhlblxuICAgICAgICAgICAgZXhwZWN0KGlzVmFsaWRDaGFpbklkKS50by5iZS5lcSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndmFsaWRhdGVQYWlyc1BheWxvYWQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcGFzcyB3aXRoIHZhbGlkIGlucHV0IHBhaXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBSZnFNYWtlclNlcnZpY2UudmFsaWRhdGVQYWlyc1BheWxvYWRPclRocm93KHBhaXJzKTtcbiAgICAgICAgICAgIH0pLnRvLm5vdC50aHJvdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGZvciBub24gYXJyYXkgaW5wdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIFJmcU1ha2VyU2VydmljZS52YWxpZGF0ZVBhaXJzUGF5bG9hZE9yVGhyb3coJzEyMycgYXMgYW55KTtcbiAgICAgICAgICAgIH0pLnRvLnRocm93KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdGhyb3cgZm9yIGFycmF5IG9mIG5vbiBhcnJheXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIFJmcU1ha2VyU2VydmljZS52YWxpZGF0ZVBhaXJzUGF5bG9hZE9yVGhyb3coWycxMjMnXSBhcyBhbnkpO1xuICAgICAgICAgICAgfSkudG8udGhyb3coKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBmb3IgaW5jb3JyZWN0IHN1Yi1hcnJheSBsZW5ndGgnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vICRlc2xpbnQtZml4LW1lIGh0dHBzOi8vZ2l0aHViLmNvbS9yaGlub2RhdmlkL2VzbGludC1maXgtbWVcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIFJmcU1ha2VyU2VydmljZS52YWxpZGF0ZVBhaXJzUGF5bG9hZE9yVGhyb3coWycxMjMnXSBhcyBhbnkpO1xuICAgICAgICAgICAgfSkudG8udGhyb3coKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBmb3IgcGFpcnMgb2YgaW52YWxpZCBldGhlcmV1bSBhZGRyZXNzZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICAgICAgICAgIFJmcU1ha2VyU2VydmljZS52YWxpZGF0ZVBhaXJzUGF5bG9hZE9yVGhyb3coW1snMTIzJywgJzIzNCddXSk7XG4gICAgICAgICAgICB9KS50by50aHJvdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGZvciBwYWlycyBvZiBpZGVudGljYWwgZXRoZXJldW0gYWRkcmVzc2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBSZnFNYWtlclNlcnZpY2UudmFsaWRhdGVQYWlyc1BheWxvYWRPclRocm93KFtcbiAgICAgICAgICAgICAgICAgICAgWycweDM3NGExNmY1ZTY4NmMwOWIwY2M5ZThiYzM0NjZiM2I2NDVjNzRhYTcnLCAnMHgzNzRhMTZmNWU2ODZjMDliMGNjOWU4YmMzNDY2YjNiNjQ1Yzc0YWE3J10sXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9KS50by50aHJvdygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9