{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/utils/runner_utils.ts","mappings":";;;AAAA,6CAAoE;AAEpE,mCAAmC;AAEnC,sCAAuE;AACvE,iDAAiD;AACjD,sCAAmC;AAEnC;;;;GAIG;AACI,KAAK,UAAU,0BAA0B,CAAI,gBAA8C;IAC9F,MAAM,OAAO,GAAQ,EAAE,CAAC;IACxB,KAAK,MAAM,UAAU,IAAI,gBAAgB,EAAE;QACvC,IAAI;YACA,MAAM,MAAM,GAAG,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC;YACvC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACxB;QAAC,OAAO,KAAK,EAAE;YACZ,eAAM,CAAC,KAAK,CAAC,EAAE,YAAY,EAAE,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,EAAE,EAAE,oCAAoC,CAAC,CAAC;SAC3G;KACJ;IACD,OAAO,OAAO,CAAC;AACnB,CAAC;AAXD,gEAWC;AAED;;;;GAIG;AACI,KAAK,UAAU,iBAAiB,CAAC,OAAiB;IACrD,KAAK,MAAM,MAAM,IAAI,OAAO,EAAE;QAC1B,IAAI;YACA,MAAM,MAAM,CAAC,KAAK,EAAE,CAAC;SACxB;QAAC,OAAO,KAAK,EAAE;YACZ,eAAM,CAAC,KAAK,CACR,EAAE,YAAY,EAAE,KAAK,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,EAAE,EACnD,6BAA6B,MAAM,CAAC,IAAI,EAAE,CAC7C,CAAC;SACL;KACJ;AACL,CAAC;AAXD,8CAWC;AAED;;GAEG;AACH,SAAgB,kBAAkB;IAC9B,IAAI,kCAAyB,EAAE;QAC3B,MAAM,cAAc,GAAG,IAAI,0BAAc,EAAE,CAAC;QAC5C,MAAM,aAAa,GAAG,IAAA,+BAAmB,EAAC,cAAc,CAAC,CAAC;QAC1D,MAAM,UAAU,GAAG,OAAO,EAAE,CAAC;QAE7B,UAAU,CAAC,GAAG,CAAC,wBAAY,EAAE,aAAa,CAAC,CAAC;QAC5C,MAAM,aAAa,GAAG,UAAU,CAAC,MAAM,CAAC,wBAAe,EAAE,GAAG,EAAE;YAC1D,eAAM,CAAC,IAAI,CAAC,oCAAoC,wBAAe,EAAE,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;QAEH,aAAa,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,EAAE;YAChC,eAAM,CAAC,KAAK,CAAC,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,EAAE,EAAE,yBAAyB,CAAC,CAAC;QACzF,CAAC,CAAC,CAAC;KACN;AACL,CAAC;AAfD,gDAeC","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/utils/runner_utils.ts"],"sourcesContent":["import { createMetricsRouter, MetricsService } from '@0x/api-utils';\r\nimport { Worker } from 'bullmq';\r\nimport * as express from 'express';\r\n\r\nimport { ENABLE_PROMETHEUS_METRICS, PROMETHEUS_PORT } from '../config';\r\nimport { METRICS_PATH } from '../core/constants';\r\nimport { logger } from '../logger';\r\n\r\n/**\r\n * Close redis connections.\r\n *\r\n * @param redisConnections Redis connections to close.\r\n */\r\nexport async function closeRedisConnectionsAsync<T>(redisConnections: { quit: () => Promise<T> }[]): Promise<T[]> {\r\n    const results: T[] = [];\r\n    for (const connection of redisConnections) {\r\n        try {\r\n            const result = await connection.quit();\r\n            results.push(result);\r\n        } catch (error) {\r\n            logger.error({ errorMessage: error.message, stack: error.stack }, 'Faied to shutdown redis connection');\r\n        }\r\n    }\r\n    return results;\r\n}\r\n\r\n/**\r\n * Close bullmq workers.\r\n *\r\n * @param workers Bullmq workers to close.\r\n */\r\nexport async function closeWorkersAsync(workers: Worker[]): Promise<void> {\r\n    for (const worker of workers) {\r\n        try {\r\n            await worker.close();\r\n        } catch (error) {\r\n            logger.error(\r\n                { errorMessage: error.message, stack: error.stack },\r\n                `Failed to shutdown worker ${worker.name}`,\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Start the metrics server.\r\n */\r\nexport function startMetricsServer(): void {\r\n    if (ENABLE_PROMETHEUS_METRICS) {\r\n        const metricsService = new MetricsService();\r\n        const metricsRouter = createMetricsRouter(metricsService);\r\n        const metricsApp = express();\r\n\r\n        metricsApp.use(METRICS_PATH, metricsRouter);\r\n        const metricsServer = metricsApp.listen(PROMETHEUS_PORT, () => {\r\n            logger.info(`Metrics (HTTP) listening on port ${PROMETHEUS_PORT}`);\r\n        });\r\n\r\n        metricsServer.on('error', (error) => {\r\n            logger.error({ errorMessage: error, stack: error.stack }, 'Error in metrics server');\r\n        });\r\n    }\r\n}\r\n"],"version":3}