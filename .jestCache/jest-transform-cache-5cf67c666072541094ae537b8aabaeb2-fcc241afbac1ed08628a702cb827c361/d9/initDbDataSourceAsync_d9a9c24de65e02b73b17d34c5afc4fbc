2cacd2118fc8475c05c05ddeb449e10f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initDbDataSourceAsync = void 0;
const getDbDataSourceAsync_1 = require("../../src/getDbDataSourceAsync");
/**
 * Get the DB connection and initialize it by installing extension and synchronize schemas
 * @returns db connection
 */
// $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
// eslint-disable-next-line @typescript-eslint/no-inferrable-types
async function initDbDataSourceAsync(port = 5432) {
    const dataSource = await (0, getDbDataSourceAsync_1.getDbDataSourceAsync)(`postgres://api:api@localhost:${port}/api`);
    await dataSource.query(`CREATE EXTENSION IF NOT EXISTS pgcrypto`); // used by view `rfq_maker_pairs_update_time_hashes`
    await dataSource.query(`CREATE EXTENSION IF NOT EXISTS "uuid-ossp"`); // used by `meta_transaction_jobs` to generate uuid
    await dataSource.synchronize(true);
    return dataSource;
}
exports.initDbDataSourceAsync = initDbDataSourceAsync;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvdGVzdF91dGlscy9pbml0RGJEYXRhU291cmNlQXN5bmMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBRUEseUVBQXNFO0FBRXRFOzs7R0FHRztBQUNILDZEQUE2RDtBQUM3RCxrRUFBa0U7QUFDM0QsS0FBSyxVQUFVLHFCQUFxQixDQUFDLE9BQWUsSUFBSTtJQUMzRCxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUEsMkNBQW9CLEVBQUMsZ0NBQWdDLElBQUksTUFBTSxDQUFDLENBQUM7SUFDMUYsTUFBTSxVQUFVLENBQUMsS0FBSyxDQUFDLHlDQUF5QyxDQUFDLENBQUMsQ0FBQyxvREFBb0Q7SUFDdkgsTUFBTSxVQUFVLENBQUMsS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUMsQ0FBQyxtREFBbUQ7SUFDekgsTUFBTSxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLE9BQU8sVUFBVSxDQUFDO0FBQ3RCLENBQUM7QUFORCxzREFNQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZGF2aWR3YWxzaC9jb2RlLWxvY2FsLzB4LXJmcS1hcGkvdGVzdC90ZXN0X3V0aWxzL2luaXREYkRhdGFTb3VyY2VBc3luYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhU291cmNlIH0gZnJvbSAndHlwZW9ybSc7XG5cbmltcG9ydCB7IGdldERiRGF0YVNvdXJjZUFzeW5jIH0gZnJvbSAnLi4vLi4vc3JjL2dldERiRGF0YVNvdXJjZUFzeW5jJztcblxuLyoqXG4gKiBHZXQgdGhlIERCIGNvbm5lY3Rpb24gYW5kIGluaXRpYWxpemUgaXQgYnkgaW5zdGFsbGluZyBleHRlbnNpb24gYW5kIHN5bmNocm9uaXplIHNjaGVtYXNcbiAqIEByZXR1cm5zIGRiIGNvbm5lY3Rpb25cbiAqL1xuLy8gJGVzbGludC1maXgtbWUgaHR0cHM6Ly9naXRodWIuY29tL3JoaW5vZGF2aWQvZXNsaW50LWZpeC1tZVxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1pbmZlcnJhYmxlLXR5cGVzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdERiRGF0YVNvdXJjZUFzeW5jKHBvcnQ6IG51bWJlciA9IDU0MzIpOiBQcm9taXNlPERhdGFTb3VyY2U+IHtcbiAgICBjb25zdCBkYXRhU291cmNlID0gYXdhaXQgZ2V0RGJEYXRhU291cmNlQXN5bmMoYHBvc3RncmVzOi8vYXBpOmFwaUBsb2NhbGhvc3Q6JHtwb3J0fS9hcGlgKTtcbiAgICBhd2FpdCBkYXRhU291cmNlLnF1ZXJ5KGBDUkVBVEUgRVhURU5TSU9OIElGIE5PVCBFWElTVFMgcGdjcnlwdG9gKTsgLy8gdXNlZCBieSB2aWV3IGByZnFfbWFrZXJfcGFpcnNfdXBkYXRlX3RpbWVfaGFzaGVzYFxuICAgIGF3YWl0IGRhdGFTb3VyY2UucXVlcnkoYENSRUFURSBFWFRFTlNJT04gSUYgTk9UIEVYSVNUUyBcInV1aWQtb3NzcFwiYCk7IC8vIHVzZWQgYnkgYG1ldGFfdHJhbnNhY3Rpb25fam9ic2AgdG8gZ2VuZXJhdGUgdXVpZFxuICAgIGF3YWl0IGRhdGFTb3VyY2Uuc3luY2hyb25pemUodHJ1ZSk7XG4gICAgcmV0dXJuIGRhdGFTb3VyY2U7XG59XG4iXSwidmVyc2lvbiI6M30=