{"file":"/Users/davidwalsh/code-local/0x-rfq-api/src/entities/MetaTransactionJobEntity.ts","mappings":"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","names":[],"sources":["/Users/davidwalsh/code-local/0x-rfq-api/src/entities/MetaTransactionJobEntity.ts"],"sourcesContent":["import { MetaTransaction, Signature } from '@0x/protocol-utils';\nimport { BigNumber } from '@0x/utils';\nimport { Column, Entity, Index, PrimaryGeneratedColumn, UpdateDateColumn } from 'typeorm';\n\nimport { Approval, Fee } from '../core/types';\n\nimport { BigNumberTransformer, FeeTransformer, MetaTransactionTransformer } from './transformers';\nimport { RfqmJobStatus } from './types';\n\nexport type MetaTransactionJobConstructorOpts = Pick<\n    MetaTransactionJobEntity,\n    | 'chainId'\n    | 'expiry'\n    | 'fee'\n    | 'inputToken'\n    | 'inputTokenAmount'\n    | 'integratorId'\n    | 'metaTransaction'\n    | 'metaTransactionHash'\n    | 'minOutputTokenAmount'\n    | 'outputToken'\n    | 'takerAddress'\n    | 'takerSignature'\n> &\n    Partial<MetaTransactionJobEntity>;\n\n@Entity({ name: 'meta_transaction_jobs' })\nexport class MetaTransactionJobEntity {\n    // Differentiator for different flavors of RFQM jobs\n    public kind: 'meta_transaction_job';\n\n    // UUID and would be generated automatically during insertion\n    @PrimaryGeneratedColumn('uuid')\n    public id!: string;\n\n    @Index()\n    @Column({ name: 'meta_transaction_hash', type: 'varchar', unique: true })\n    public metaTransactionHash: string;\n\n    @Index()\n    @Column({ name: 'created_at', type: 'timestamptz', default: () => 'now()' })\n    public createdAt!: Date;\n\n    @UpdateDateColumn({ name: 'updated_at', type: 'timestamptz', nullable: true })\n    public updatedAt: Date | null;\n\n    // The expiration time of the job, in unix seconds\n    @Column({ name: 'expiry', type: 'numeric', transformer: BigNumberTransformer })\n    public expiry: BigNumber;\n\n    @Column({ name: 'chain_id', type: 'integer' })\n    public chainId: number;\n\n    @Column({ name: 'integrator_id', type: 'varchar' })\n    public integratorId: string;\n\n    @Index()\n    @Column({ name: 'status', type: 'varchar' })\n    public status: RfqmJobStatus;\n\n    @Column({ name: 'fee', type: 'jsonb', transformer: FeeTransformer })\n    public fee: Fee;\n\n    @Column({ name: 'meta_transaction', type: 'jsonb', transformer: MetaTransactionTransformer })\n    public metaTransaction: MetaTransaction;\n\n    @Index()\n    @Column({ name: 'worker_address', type: 'varchar', nullable: true })\n    public workerAddress: string | null;\n\n    @Column({ name: 'affiliate_address', type: 'varchar', nullable: true })\n    public affiliateAddress: string | null;\n\n    @Index()\n    @Column({ name: 'taker_address', type: 'varchar' })\n    public takerAddress: string;\n\n    // The taker's signature of the metaTransaction hash.\n    @Column({ name: 'taker_signature', type: 'jsonb' })\n    public takerSignature: Signature;\n\n    // The optional approval object that contains the EIP-712 context (which includes\n    // the message that the taker will sign). This is stored to help us prepare the\n    // calldata for gasless approvals\n    @Column({ name: 'approval', type: 'jsonb', nullable: true })\n    public approval: Approval | null;\n\n    // The signature for the approval.\n    @Column({ name: 'approval_signature', type: 'jsonb', nullable: true })\n    public approvalSignature: Signature | null;\n\n    @Column({ name: 'input_token', type: 'varchar' })\n    public inputToken: string;\n\n    @Column({ name: 'output_token', type: 'varchar' })\n    public outputToken: string;\n\n    @Column({ name: 'input_token_amount', type: 'numeric', transformer: BigNumberTransformer })\n    public inputTokenAmount: BigNumber;\n\n    @Column({ name: 'min_output_token_amount', type: 'numeric', transformer: BigNumberTransformer })\n    public minOutputTokenAmount: BigNumber;\n\n    @Column({ name: 'settled_output_token_amount', type: 'numeric', transformer: BigNumberTransformer, nullable: true })\n    public settledOutputTokenAmount: BigNumber | null;\n\n    /**\n     * Used to get the 'canonical' hash of the job. This is useful\n     * because it can also be called on an rfqm job and\n     * that will return the order hash.\n     */\n    public getHash(): string {\n        return this.metaTransactionHash;\n    }\n\n    // TypeORM runs a validation check where it calls this initializer with no argument.\n    // With no default `opts`, `opts` will be undefined and the validation will throw,\n    // therefore, add this hacky default.\n    // tslint:disable-next-line no-object-literal-type-assertion\n    constructor(opts: MetaTransactionJobConstructorOpts = {} as MetaTransactionJobConstructorOpts) {\n        this.kind = 'meta_transaction_job';\n\n        // allow createdAt overrides for testing\n        if (opts.createdAt) {\n            this.createdAt = opts.createdAt;\n        }\n\n        this.affiliateAddress = opts.affiliateAddress ?? null;\n        this.approval = opts.approval ?? null;\n        this.approvalSignature = opts.approvalSignature ?? null;\n        this.chainId = opts.chainId;\n        this.expiry = opts.expiry;\n        this.fee = opts.fee;\n        this.inputToken = opts.inputToken;\n        this.inputTokenAmount = opts.inputTokenAmount;\n        this.integratorId = opts.integratorId;\n        this.metaTransaction = opts.metaTransaction;\n        this.metaTransactionHash = opts.metaTransactionHash;\n        this.minOutputTokenAmount = opts.minOutputTokenAmount;\n        this.outputToken = opts.outputToken;\n        this.settledOutputTokenAmount = opts.settledOutputTokenAmount ?? null;\n        this.status = opts.status ?? RfqmJobStatus.PendingEnqueued;\n        this.takerAddress = opts.takerAddress;\n        this.takerSignature = opts.takerSignature;\n        this.updatedAt = opts.updatedAt ?? null;\n        this.workerAddress = opts.workerAddress ?? null;\n    }\n}\n"],"version":3}