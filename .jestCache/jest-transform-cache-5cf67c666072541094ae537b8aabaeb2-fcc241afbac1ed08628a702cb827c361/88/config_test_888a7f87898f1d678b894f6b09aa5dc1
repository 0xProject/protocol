a8128aacb108eda4e8434b78eab6d9f6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// tslint:disable custom-no-magic-numbers
const chai_1 = require("chai");
const config_1 = require("../src/config");
const constants_1 = require("./constants");
/**
 * Configuration tests which run against the config in `test_env` file.
 */
describe('Config', () => {
    describe('getIntegratorIdForApiKey', () => {
        it('gets the integrator ID for an api key', () => {
            const id = (0, config_1.getIntegratorIdForApiKey)('test-api-key-1');
            (0, chai_1.expect)(id).to.equal('test-integrator-id-1');
        });
        it('correctly parses whitelist', () => {
            try {
                (0, config_1.getIntegratorByIdOrThrow)('test-integrator-id-2');
                chai_1.expect.fail(`"test-integrator-id-2" should not exist`);
            }
            catch (e) {
                (0, chai_1.expect)(e.toString()).to.equal('AssertionError: "test-integrator-id-2" should not exist');
            }
        });
        it('allows us to fetch Integrator by Integrator key', () => {
            const { whitelistIntegratorUrls } = (0, config_1.getIntegratorByIdOrThrow)('test-integrator-id-1');
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            (0, chai_1.expect)(whitelistIntegratorUrls.length).to.eql(1);
            // $eslint-fix-me https://github.com/rhinodavid/eslint-fix-me
            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
            (0, chai_1.expect)(whitelistIntegratorUrls[0]).to.eql('http://foo.bar');
        });
        it('returns `undefined` for non-existent api keys', () => {
            const id = (0, config_1.getIntegratorIdForApiKey)('test-api-key-does-not-exist');
            (0, chai_1.expect)(id).to.equal(undefined);
        });
    });
    describe('getApiKeyWhitelistFromIntegratorsAcl', () => {
        it('gets keys for allowed liquidity sources', () => {
            const rfqtKeys = (0, config_1.getApiKeyWhitelistFromIntegratorsAcl)('rfqt');
            (0, chai_1.expect)(rfqtKeys.length).to.eql(2);
            (0, chai_1.expect)(rfqtKeys[0]).to.eql('test-api-key-1');
            (0, chai_1.expect)(rfqtKeys[1]).to.eql('test-api-key-2');
            const rfqmKeys = (0, config_1.getApiKeyWhitelistFromIntegratorsAcl)('rfqm');
            (0, chai_1.expect)(rfqmKeys.length).to.eql(3); // tslint:disable-line: custom-no-magic-numbers
            (0, chai_1.expect)(rfqmKeys[0]).to.eql('test-api-key-1');
            (0, chai_1.expect)(rfqmKeys[1]).to.eql('test-api-key-2');
            (0, chai_1.expect)(rfqmKeys[2]).to.eql('test-api-key-3');
        });
        it("doesn't add disallowed liquidity sources to allowed API keys", () => {
            const plpKeys = (0, config_1.getApiKeyWhitelistFromIntegratorsAcl)('plp');
            (0, chai_1.expect)(plpKeys.length).to.equal(0);
        });
    });
    describe('ZERO_EX_FEE_CONFIGURATION_MAP', () => {
        it('correctly processes raw 0x fee config', () => {
            (0, chai_1.expect)(config_1.ZERO_EX_FEE_CONFIGURATION_MAP).to.be.eql(constants_1.ZERO_EX_FEE_CONFIGURATIONS);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhdmlkd2Fsc2gvY29kZS1sb2NhbC8weC1yZnEtYXBpL3Rlc3QvY29uZmlnX3Rlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx5Q0FBeUM7QUFDekMsK0JBQThCO0FBRTlCLDBDQUt1QjtBQUN2QiwyQ0FBeUQ7QUFFekQ7O0dBRUc7QUFDSCxRQUFRLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtJQUNwQixRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDN0MsTUFBTSxFQUFFLEdBQUcsSUFBQSxpQ0FBd0IsRUFBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXRELElBQUEsYUFBTSxFQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7WUFDbEMsSUFBSTtnQkFDQSxJQUFBLGlDQUF3QixFQUFDLHNCQUFzQixDQUFDLENBQUM7Z0JBQ2pELGFBQU0sQ0FBQyxJQUFJLENBQUMseUNBQXlDLENBQUMsQ0FBQzthQUMxRDtZQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNSLElBQUEsYUFBTSxFQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMseURBQXlELENBQUMsQ0FBQzthQUM1RjtRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEdBQUcsRUFBRTtZQUN2RCxNQUFNLEVBQUUsdUJBQXVCLEVBQUUsR0FBRyxJQUFBLGlDQUF3QixFQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDckYsNkRBQTZEO1lBQzdELG9FQUFvRTtZQUNwRSxJQUFBLGFBQU0sRUFBQyx1QkFBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELDZEQUE2RDtZQUM3RCxvRUFBb0U7WUFDcEUsSUFBQSxhQUFNLEVBQUMsdUJBQXdCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDakUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0NBQStDLEVBQUUsR0FBRyxFQUFFO1lBQ3JELE1BQU0sRUFBRSxHQUFHLElBQUEsaUNBQXdCLEVBQUMsNkJBQTZCLENBQUMsQ0FBQztZQUNuRSxJQUFBLGFBQU0sRUFBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsc0NBQXNDLEVBQUUsR0FBRyxFQUFFO1FBQ2xELEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsTUFBTSxRQUFRLEdBQUcsSUFBQSw2Q0FBb0MsRUFBQyxNQUFNLENBQUMsQ0FBQztZQUM5RCxJQUFBLGFBQU0sRUFBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQyxJQUFBLGFBQU0sRUFBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDN0MsSUFBQSxhQUFNLEVBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRTdDLE1BQU0sUUFBUSxHQUFHLElBQUEsNkNBQW9DLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFDOUQsSUFBQSxhQUFNLEVBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQywrQ0FBK0M7WUFDbEYsSUFBQSxhQUFNLEVBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzdDLElBQUEsYUFBTSxFQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUM3QyxJQUFBLGFBQU0sRUFBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsOERBQThELEVBQUUsR0FBRyxFQUFFO1lBQ3BFLE1BQU0sT0FBTyxHQUFHLElBQUEsNkNBQW9DLEVBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUQsSUFBQSxhQUFNLEVBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDM0MsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxJQUFBLGFBQU0sRUFBQyxzQ0FBNkIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLHNDQUEwQixDQUFDLENBQUM7UUFDaEYsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZHdhbHNoL2NvZGUtbG9jYWwvMHgtcmZxLWFwaS90ZXN0L2NvbmZpZ190ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHRzbGludDpkaXNhYmxlIGN1c3RvbS1uby1tYWdpYy1udW1iZXJzXG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcblxuaW1wb3J0IHtcbiAgICBnZXRBcGlLZXlXaGl0ZWxpc3RGcm9tSW50ZWdyYXRvcnNBY2wsXG4gICAgZ2V0SW50ZWdyYXRvckJ5SWRPclRocm93LFxuICAgIGdldEludGVncmF0b3JJZEZvckFwaUtleSxcbiAgICBaRVJPX0VYX0ZFRV9DT05GSUdVUkFUSU9OX01BUCxcbn0gZnJvbSAnLi4vc3JjL2NvbmZpZyc7XG5pbXBvcnQgeyBaRVJPX0VYX0ZFRV9DT05GSUdVUkFUSU9OUyB9IGZyb20gJy4vY29uc3RhbnRzJztcblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIHRlc3RzIHdoaWNoIHJ1biBhZ2FpbnN0IHRoZSBjb25maWcgaW4gYHRlc3RfZW52YCBmaWxlLlxuICovXG5kZXNjcmliZSgnQ29uZmlnJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdnZXRJbnRlZ3JhdG9ySWRGb3JBcGlLZXknLCAoKSA9PiB7XG4gICAgICAgIGl0KCdnZXRzIHRoZSBpbnRlZ3JhdG9yIElEIGZvciBhbiBhcGkga2V5JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaWQgPSBnZXRJbnRlZ3JhdG9ySWRGb3JBcGlLZXkoJ3Rlc3QtYXBpLWtleS0xJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChpZCkudG8uZXF1YWwoJ3Rlc3QtaW50ZWdyYXRvci1pZC0xJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdjb3JyZWN0bHkgcGFyc2VzIHdoaXRlbGlzdCcsICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZ2V0SW50ZWdyYXRvckJ5SWRPclRocm93KCd0ZXN0LWludGVncmF0b3ItaWQtMicpO1xuICAgICAgICAgICAgICAgIGV4cGVjdC5mYWlsKGBcInRlc3QtaW50ZWdyYXRvci1pZC0yXCIgc2hvdWxkIG5vdCBleGlzdGApO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGV4cGVjdChlLnRvU3RyaW5nKCkpLnRvLmVxdWFsKCdBc3NlcnRpb25FcnJvcjogXCJ0ZXN0LWludGVncmF0b3ItaWQtMlwiIHNob3VsZCBub3QgZXhpc3QnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2FsbG93cyB1cyB0byBmZXRjaCBJbnRlZ3JhdG9yIGJ5IEludGVncmF0b3Iga2V5JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyB3aGl0ZWxpc3RJbnRlZ3JhdG9yVXJscyB9ID0gZ2V0SW50ZWdyYXRvckJ5SWRPclRocm93KCd0ZXN0LWludGVncmF0b3ItaWQtMScpO1xuICAgICAgICAgICAgLy8gJGVzbGludC1maXgtbWUgaHR0cHM6Ly9naXRodWIuY29tL3JoaW5vZGF2aWQvZXNsaW50LWZpeC1tZVxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgIGV4cGVjdCh3aGl0ZWxpc3RJbnRlZ3JhdG9yVXJscyEubGVuZ3RoKS50by5lcWwoMSk7XG4gICAgICAgICAgICAvLyAkZXNsaW50LWZpeC1tZSBodHRwczovL2dpdGh1Yi5jb20vcmhpbm9kYXZpZC9lc2xpbnQtZml4LW1lXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICAgICAgZXhwZWN0KHdoaXRlbGlzdEludGVncmF0b3JVcmxzIVswXSkudG8uZXFsKCdodHRwOi8vZm9vLmJhcicpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgncmV0dXJucyBgdW5kZWZpbmVkYCBmb3Igbm9uLWV4aXN0ZW50IGFwaSBrZXlzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaWQgPSBnZXRJbnRlZ3JhdG9ySWRGb3JBcGlLZXkoJ3Rlc3QtYXBpLWtleS1kb2VzLW5vdC1leGlzdCcpO1xuICAgICAgICAgICAgZXhwZWN0KGlkKS50by5lcXVhbCh1bmRlZmluZWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXRBcGlLZXlXaGl0ZWxpc3RGcm9tSW50ZWdyYXRvcnNBY2wnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdnZXRzIGtleXMgZm9yIGFsbG93ZWQgbGlxdWlkaXR5IHNvdXJjZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZnF0S2V5cyA9IGdldEFwaUtleVdoaXRlbGlzdEZyb21JbnRlZ3JhdG9yc0FjbCgncmZxdCcpO1xuICAgICAgICAgICAgZXhwZWN0KHJmcXRLZXlzLmxlbmd0aCkudG8uZXFsKDIpO1xuICAgICAgICAgICAgZXhwZWN0KHJmcXRLZXlzWzBdKS50by5lcWwoJ3Rlc3QtYXBpLWtleS0xJyk7XG4gICAgICAgICAgICBleHBlY3QocmZxdEtleXNbMV0pLnRvLmVxbCgndGVzdC1hcGkta2V5LTInKTtcblxuICAgICAgICAgICAgY29uc3QgcmZxbUtleXMgPSBnZXRBcGlLZXlXaGl0ZWxpc3RGcm9tSW50ZWdyYXRvcnNBY2woJ3JmcW0nKTtcbiAgICAgICAgICAgIGV4cGVjdChyZnFtS2V5cy5sZW5ndGgpLnRvLmVxbCgzKTsgLy8gdHNsaW50OmRpc2FibGUtbGluZTogY3VzdG9tLW5vLW1hZ2ljLW51bWJlcnNcbiAgICAgICAgICAgIGV4cGVjdChyZnFtS2V5c1swXSkudG8uZXFsKCd0ZXN0LWFwaS1rZXktMScpO1xuICAgICAgICAgICAgZXhwZWN0KHJmcW1LZXlzWzFdKS50by5lcWwoJ3Rlc3QtYXBpLWtleS0yJyk7XG4gICAgICAgICAgICBleHBlY3QocmZxbUtleXNbMl0pLnRvLmVxbCgndGVzdC1hcGkta2V5LTMnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiZG9lc24ndCBhZGQgZGlzYWxsb3dlZCBsaXF1aWRpdHkgc291cmNlcyB0byBhbGxvd2VkIEFQSSBrZXlzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBscEtleXMgPSBnZXRBcGlLZXlXaGl0ZWxpc3RGcm9tSW50ZWdyYXRvcnNBY2woJ3BscCcpO1xuICAgICAgICAgICAgZXhwZWN0KHBscEtleXMubGVuZ3RoKS50by5lcXVhbCgwKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnWkVST19FWF9GRUVfQ09ORklHVVJBVElPTl9NQVAnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdjb3JyZWN0bHkgcHJvY2Vzc2VzIHJhdyAweCBmZWUgY29uZmlnJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KFpFUk9fRVhfRkVFX0NPTkZJR1VSQVRJT05fTUFQKS50by5iZS5lcWwoWkVST19FWF9GRUVfQ09ORklHVVJBVElPTlMpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9