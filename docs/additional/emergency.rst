###############################
EMERGENCY
###############################

.. _Feature: ../architecture/features.html
.. _Features: ../architecture/features.html
.. _Transformer: ../architecture/transformers.html
.. _Transformers: ../architecture/transformers.html
.. _most recent release: ./releases.html
.. _Rollback Script: https://github.com/0xProject/protocol/blob/development/contracts/zero-ex/scripts/rollback.ts
.. _Exchange Proxy Governor: ../basics/addresses.html
.. _#1: #release-is-broken

In this section we outline a playbook for handling emergencies at the protocol level.

.. table:: 
    :widths: 6 40 54

    +--------------------------------+---------------------------------------+------------------------------------------------------+
    |                                | **What Happened?**                    | **How To Handle**                                    |
    +--------------------------------+---------------------------------------+------------------------------------------------------+
    | `#1 <#release-is-broken>`_     | Our `most recent release`_ is broken. | Rollback the deployment.                             |
    +--------------------------------+---------------------------------------+------------------------------------------------------+
    | `#2 <#feature-is-broken>`_     | A `Feature`_ is broken.               | Rollback the Feature to a working version (or NIL).  |
    +--------------------------------+---------------------------------------+------------------------------------------------------+
    | `#3 <#transformer-is-broken>`_ | A `Transformer`_ is broken.           | Update 0x API to use a working version (or disable). |
    +--------------------------------+---------------------------------------+------------------------------------------------------+
    | `#4 <#funds-are-at-risk>`_     | Funds are at risk + cannot do 1-3.    | Temporarily disable the entire protocol.             |
    +--------------------------------+---------------------------------------+------------------------------------------------------+


.. note::

    A `Rollback Script`_ is used to generate calldata in the sections below. This can be run using ``yarn rollback`` from the `/contracts/src/zero-ex <https://github.com/0xProject/protocol/tree/development/contracts/zero-ex>`_ directory. You will need an HTTP Web3 Provider URL, which can be created in about two minutes through `infura.org/register <https://infura.io/register>`_. The output calldata must be submitted to the `Exchange Proxy Governor`_ by a 0x Multisig holder. It must then be confirmed by a second 0x Multisig holder before it can be executed. There is no timelock on executing rollbacks.

.. warning::

    Be sure to communicate with other teams and external integrators / market makers when rolling back, as this may have downstream effects. Because of this it is also generally not advisable to rollback more than one release.

#1: Release is Broken
---------------------

An entire release can be rolled back; however, this should only be done for the most recent release. Below is the calldata to rollback the most recent `Hot-Pants Release <./releases.html#hot-pants>`_.

.. code-block:: solidity

    0x000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000009e00000000000000000000000000000000000000000000000000000000000000be0000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003e0000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000000000000000000000000000000000000000056000000000000000000000000000000000000000000000000000000000000005e0000000000000000000000000000000000000000000000000000000000000066000000000000000000000000000000000000000000000000000000000000006e0000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000000000000000000000000000000000007e0000000000000000000000000000000000000000000000000000000000000086000000000000000000000000000000000000000000000000000000000000008e000000000000000000000000000000000000000000000000000000000000000449db64a40287b071b000000000000000000000000000000000000000000000000000000000000000000000000000000001e2a62c6cd508c6689ddbad637a195087051ab270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40353c047b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a403d61ed3e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a403fb2da38000000000000000000000000000000000000000000000000000000000000000000000000000000001f01b6f37f8b234e607c2981a02dff2e69dfbe360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40415565b0000000000000000000000000000000000000000000000000000000000000000000000000000000000f52576ba4c2464f903d3f13786681b214657fba0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a404d54cdb6000000000000000000000000000000000000000000000000000000000000000000000000000000001e2a62c6cd508c6689ddbad637a195087051ab270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4056ce180a000000000000000000000000000000000000000000000000000000000000000000000000000000001e2a62c6cd508c6689ddbad637a195087051ab270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40625971920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4072d17d03000000000000000000000000000000000000000000000000000000000000000000000000000000001f01b6f37f8b234e607c2981a02dff2e69dfbe360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4087c96419000000000000000000000000000000000000000000000000000000000000000000000000000000001e2a62c6cd508c6689ddbad637a195087051ab270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a409f1ec78b000000000000000000000000000000000000000000000000000000000000000000000000000000001e2a62c6cd508c6689ddbad637a195087051ab270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40ae550497000000000000000000000000000000000000000000000000000000000000000000000000000000001f01b6f37f8b234e607c2981a02dff2e69dfbe360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40c5579ec80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40d9627aa400000000000000000000000000000000000000000000000000000000000000000000000000000000b25512e952747d42614782addb79805d564a80420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40f028e9be000000000000000000000000000000000000000000000000000000000000000000000000000000001e2a62c6cd508c6689ddbad637a195087051ab2700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

**To generate:**

1. Run ``yarn rollback``.
2. Select ``Deployment History``.
3. Select the latest release to rollback (bottom of list).
4. Select ``Rollback this deployment``.
5. Enter an RPC endpoint (HTTP Web3 Provider URL). Create one for free at `infura.org/register <https://infura.io/register>`_.
6. Hold tight while the rollback script generates calldata!
7. The script will verify the functions to rollback. Select ``y`` if they are correct. See the `Releases Section <./releases.html>`_.
8. Select how many transactions to generate (sometimes the calldata can be quite large). Typically 1 transaction is enough.


#2: Feature is Broken
---------------------

Individual functions from `Features <../architecture/features.html>`_ can be rolled back, either to an earlier version or completely removed from the Proxy (by rolling all way back). It is generally better to rollback entire deployments, especially if there are downstream effects.

.. warning::

    Rolling back individual functions can be dangerous because we may end up in a permutation of the system that has not been fully tested. Because of this it is strongly recommended to rollback entire deployments. This should only be used in extreme circumstances.

**To generate:**

1. Run ``yarn rollback``.
2. Select ``Generate rollback calldata``.
3. Scroll through and select the functions to rollback using the right arrow key. You can also search for a function by typing its name.
4. Hit ``<Enter>`` once you've selected all functions to rollback.
5. Choose to ``DISABLE`` the functions or simply roll them back to a previous version.
6. Select how many transactions to generate (sometimes the calldata can be quite large). Typically 1 transaction is enough.


#3: Transformer is Broken
-------------------------

`Transformers <../architecture/transformers.html>`_ are trustless and do not have access to user funds. They are also not managed by the Proxy. If a transformer is broken, simply update 0x API to stop routing trades through the Transformer.

#4: Funds Are At Risk
---------------------

If funds are at risk and we must shutdown the entire protocol, run the following calldata to temporarily disable all functionality within the Proxy. Note: this does not include the Function Registry or Ownable. Below is the emergency shutdown calldata as of the `Hot-Pants Release <./releases.html#hot-pants>`_.

.. code-block:: solidity

    0x0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000015a0000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000003800000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000048000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000580000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006800000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000078000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000880000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000009800000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000a800000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000000000000000000000000000000000b800000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000c800000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000d800000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000e800000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000f8000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001080000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000449db64a40287b071b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40353c047b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a403d61ed3e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a403fb2da380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40415565b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40496f471e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a404d54cdb60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4056ce180a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40625971920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a406ba6bbc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4072d17d030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40769250ea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a408171c4070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4087c964190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a4089dd02e70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a408da5cb5b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a409b0518180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a409f1ec78b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40ae5504970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40c5579ec80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40c853c9690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40d9627aa40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40dfd007490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40e42639360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40f028e9be0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40f68fd38d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40f7c3a33b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000449db64a40f7fcd38400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000


**To generate:**

1. Run ``yarn rollback``.
2. Select ``Emergency shutdown calldata``.
3. Select how many transactions to generate (sometimes the calldata can be quite large). Typically 1 transaction is enough.